<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì‚¬ì´ë“œì¡ - ì·¨ì—… ë©˜í† ë§ í”Œë«í¼</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React 18 CDN (Development) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Meta Tags for SEO -->
    <meta name="description" content="í˜„ì§ìì™€ êµ¬ì§ìë¥¼ ì—°ê²°í•˜ëŠ” ì·¨ì—… ë©˜í† ë§ í”Œë«í¼. ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ë¶€í„° 1:1 ë©˜í† ë§ê¹Œì§€.">
    <meta name="keywords" content="ì·¨ì—…ë©˜í† ë§, í˜„ì§ììƒë‹´, ì·¨ì—…ê²½ìŸë ¥ì§„ë‹¨, ì»¤ë¦¬ì–´ì½”ì¹­, ì¸ì‚¬ì´ë“œì¡">
    <meta name="author" content="(ì£¼)ì˜¤í”ˆì»¤ë„¥íŠ¸">
    
    <!-- Open Graph -->
    <meta property="og:title" content="ì¸ì‚¬ì´ë“œì¡ - ì·¨ì—… ë©˜í† ë§ í”Œë«í¼">
    <meta property="og:description" content="í˜„ì§ìì™€ êµ¬ì§ìë¥¼ ì—°ê²°í•˜ëŠ” ì‹¤ë¬´ ì¤‘ì‹¬ ì»¤ë¦¬ì–´ ìƒë‹´ ì„œë¹„ìŠ¤">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://knwwhr.github.io/insidejob">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>">
    
    <!-- ì¸ì‚¬ì´ë“œì¡ ìŠ¤íƒ€ì¼ -->
    <style>
        /* ì¸ì‚¬ì´ë“œì¡ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ (ì›ë³¸ ê·¸ëŒ€ë¡œ) */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 16px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ë“¤ (ì›ë³¸ ê·¸ëŒ€ë¡œ) */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ì¸í’‹ ìŠ¤íƒ€ì¼ ê°œì„  */
        input[type="text"], 
        input[type="number"], 
        select, 
        textarea {
            transition: all 0.2s;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        select:focus, 
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ê°œì„  */
        input[type="checkbox"] {
            accent-color: #3b82f6;
            width: 16px;
            height: 16px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            background-color: #ffffff;
            cursor: pointer;
            appearance: auto;
            -webkit-appearance: checkbox;
            -moz-appearance: checkbox;
        }
        
        input[type="checkbox"]:checked {
            accent-color: #3b82f6;
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        
        /* ì»¤ìŠ¤í…€ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .custom-checkbox {
            appearance: auto !important;
            -webkit-appearance: checkbox !important;
            -moz-appearance: checkbox !important;
            width: 16px !important;
            height: 16px !important;
            cursor: pointer !important;
        }
        
        /* ì „ë¬¸ê°€ ë“±ë¡ ì²´í¬ë°•ìŠ¤ ê°•ì œ ìŠ¤íƒ€ì¼ */
        .expert-checkbox {
            pointer-events: auto !important;
            position: relative !important;
            z-index: 999 !important;
        }

        /* í˜¸ë²„ íš¨ê³¼ */
        .hover-lift {
            transition: transform 0.2s;
        }

        .hover-lift:hover {
            transform: translateY(-2px);
        }

        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .card {
                padding: 16px;
                margin-bottom: 12px;
            }
            
            .btn-primary {
                padding: 14px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 12px;
                border-radius: 12px;
            }
            
            .btn-primary {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        /* í•œê¸€ ì¤„ë°”ë€œ ë°©ì§€ */
        .no-break-korean {
            word-break: keep-all;
            white-space: nowrap;
        }

        .break-keep {
            word-break: keep-all;
        }

        /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ìë™ í¬ê¸° ì¡°ì • */
        .responsive-text {
            font-size: clamp(0.75rem, 3vw, 1rem);
        }

        .responsive-text-sm {
            font-size: clamp(0.65rem, 2.5vw, 0.875rem);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // ğŸ“§ í†µí•© ì´ë©”ì¼ & ì•Œë¦¼ ì‹œìŠ¤í…œ
        const EmailManager = {
            // ì´ë©”ì¼ í…œí”Œë¦¿ ì •ì˜
            templates: {
                welcome: {
                    subject: '[ì¸ì‚¬ì´ë“œì¡] íšŒì›ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰',
                    getHtml: (data) => `
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #3b82f6; text-align: center;">ğŸ¯ ì¸ì‚¬ì´ë“œì¡ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h1>
                            <p>ì•ˆë…•í•˜ì„¸ìš” ${data.nickname}ë‹˜,</p>
                            <p>ì·¨ì—… ë©˜í† ë§ í”Œë«í¼ <strong>ì¸ì‚¬ì´ë“œì¡</strong>ì— ê°€ì…í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                            
                            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                <h3 style="margin: 0 0 10px 0; color: #374151;">ğŸš€ ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
                                <ol style="margin: 0; padding-left: 20px;">
                                    <li><strong>ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨</strong>ì„ ì™„ë£Œí•˜ì„¸ìš” (3ë¶„ ì†Œìš”)</li>
                                    <li>ê´€ì‹¬ ìˆëŠ” ì§ë¬´ì˜ <strong>í˜„ì§ì</strong>ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</li>
                                    <li><strong>ì»¤ë®¤ë‹ˆí‹°</strong>ì—ì„œ ë‹¤ë¥¸ êµ¬ì§ìë“¤ê³¼ ì •ë³´ë¥¼ ê³µìœ í•˜ì„¸ìš”</li>
                                </ol>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://knwwhr.github.io/insidejob/" style="background-color: #3b82f6; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: bold;">ì¸ì‚¬ì´ë“œì¡ ì‹œì‘í•˜ê¸°</a>
                            </div>
                            
                            <p style="color: #6b7280; font-size: 14px;">ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”.<br/>ì¸ì‚¬ì´ë“œì¡ ìš´ì˜íŒ€ ë“œë¦¼</p>
                        </div>
                    `
                },
                expert_approved: {
                    subject: '[ì¸ì‚¬ì´ë“œì¡] í˜„ì§ì ìŠ¹ì¸ ì™„ë£Œ ğŸ‰',
                    getHtml: (data) => `
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #10b981; text-align: center;">ğŸ‰ í˜„ì§ì ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
                            <p>ì•ˆë…•í•˜ì„¸ìš” ${data.nickname}ë‹˜,</p>
                            <p>ì¸ì‚¬ì´ë“œì¡ í˜„ì§ì ì‹ ì²­ì´ <strong style="color: #10b981;">ìŠ¹ì¸</strong>ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            
                            <div style="background: #ecfdf5; border-left: 4px solid #10b981; padding: 15px; margin: 20px 0;">
                                <p style="margin: 0;"><strong>ìŠ¹ì¸ ì‚¬ìœ :</strong> ${data.reason || 'í˜„ì§ì ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.'}</p>
                            </div>
                            
                            <p>ì´ì œ ì¸ì‚¬ì´ë“œì¡ì—ì„œ í˜„ì§ìë¡œ í™œë™í•˜ë©° êµ¬ì§ìë“¤ì—ê²Œ ì†Œì¤‘í•œ ë©˜í† ë§ì„ ì œê³µí•´ì£¼ì„¸ìš”!</p>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://knwwhr.github.io/insidejob/" style="background-color: #10b981; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: bold;">í˜„ì§ì ëŒ€ì‹œë³´ë“œ ë°”ë¡œê°€ê¸°</a>
                            </div>
                            
                            <p style="color: #6b7280; font-size: 14px;">ê°ì‚¬í•©ë‹ˆë‹¤.<br/>ì¸ì‚¬ì´ë“œì¡ ìš´ì˜íŒ€</p>
                        </div>
                    `
                },
                expert_rejected: {
                    subject: '[ì¸ì‚¬ì´ë“œì¡] í˜„ì§ì ì‹ ì²­ ê²€í†  ê²°ê³¼',
                    getHtml: (data) => `
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #f59e0b; text-align: center;">í˜„ì§ì ì‹ ì²­ ê²€í†  ê²°ê³¼</h1>
                            <p>ì•ˆë…•í•˜ì„¸ìš” ${data.nickname}ë‹˜,</p>
                            <p>ì¸ì‚¬ì´ë“œì¡ í˜„ì§ì ì‹ ì²­ì„ ê²€í† í•œ ê²°ê³¼ë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p>
                            
                            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0;">
                                <p style="margin: 0;"><strong>ê²€í†  ê²°ê³¼:</strong> ìŠ¹ì¸ ë³´ë¥˜</p>
                                <p style="margin: 10px 0 0 0;"><strong>ì‚¬ìœ :</strong> ${data.reason || 'ìê²© ìš”ê±´ ë¯¸ë‹¬'}</p>
                            </div>
                            
                            <p>ì¶”ê°€ ìê²©ì¦ì´ë‚˜ ê²½ë ¥ì„ ë³´ì™„í•˜ì‹  í›„ ë‹¤ì‹œ ì‹ ì²­í•´ì£¼ì„¸ìš”. ì–¸ì œë“  ì¬ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤!</p>
                            
                            <p style="color: #6b7280; font-size: 14px;">ê°ì‚¬í•©ë‹ˆë‹¤.<br/>ì¸ì‚¬ì´ë“œì¡ ìš´ì˜íŒ€</p>
                        </div>
                    `
                },
                consultation_booked: {
                    subject: '[ì¸ì‚¬ì´ë“œì¡] ë©˜í† ë§ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
                    getHtml: (data) => `
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #3b82f6; text-align: center;">ğŸ“… ë©˜í† ë§ ì˜ˆì•½ ì™„ë£Œ</h1>
                            <p>ì•ˆë…•í•˜ì„¸ìš” ${data.clientName || data.expertName}ë‹˜,</p>
                            <p>ë©˜í† ë§ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            
                            <div style="background: #eff6ff; border: 1px solid #3b82f6; border-radius: 8px; padding: 20px; margin: 20px 0;">
                                <h3 style="margin: 0 0 15px 0; color: #1e40af;">ğŸ“‹ ì˜ˆì•½ ìƒì„¸ì •ë³´</h3>
                                <p style="margin: 5px 0;"><strong>ë‚ ì§œ:</strong> ${data.date}</p>
                                <p style="margin: 5px 0;"><strong>ì‹œê°„:</strong> ${data.time}</p>
                                <p style="margin: 5px 0;"><strong>ìƒë‹´ ì‹œê°„:</strong> ${data.duration}ë¶„</p>
                                <p style="margin: 5px 0;"><strong>ìƒë‹´ ë°©ì‹:</strong> ${data.method}</p>
                                <p style="margin: 5px 0;"><strong>ìƒë‹´ë£Œ:</strong> ${data.amount?.toLocaleString()}ì›</p>
                            </div>
                            
                            <p>ì˜ˆì•½ ì‹œê°„ 15ë¶„ ì „ë¶€í„° ì±„íŒ…ë°©ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://knwwhr.github.io/insidejob/" style="background-color: #3b82f6; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: bold;">ì¸ì‚¬ì´ë“œì¡ ë°”ë¡œê°€ê¸°</a>
                            </div>
                            
                            <p style="color: #6b7280; font-size: 14px;">ê°ì‚¬í•©ë‹ˆë‹¤.<br/>ì¸ì‚¬ì´ë“œì¡ ìš´ì˜íŒ€</p>
                        </div>
                    `
                },
                new_message: {
                    subject: '[ì¸ì‚¬ì´ë“œì¡] ìƒˆ ìª½ì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤',
                    getHtml: (data) => `
                        <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <h1 style="color: #8b5cf6; text-align: center;">ğŸ“© ìƒˆ ìª½ì§€ ì•Œë¦¼</h1>
                            <p>ì•ˆë…•í•˜ì„¸ìš” ${data.receiverName}ë‹˜,</p>
                            <p><strong>${data.senderName}</strong>ë‹˜ìœ¼ë¡œë¶€í„° ìƒˆ ìª½ì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.</p>
                            
                            <div style="background: #f5f3ff; border-left: 4px solid #8b5cf6; padding: 15px; margin: 20px 0;">
                                <h4 style="margin: 0 0 10px 0;">ì œëª©: ${data.subject}</h4>
                                <p style="margin: 0; color: #6b7280;">${data.preview}...</p>
                            </div>
                            
                            <div style="text-align: center; margin: 30px 0;">
                                <a href="https://knwwhr.github.io/insidejob/" style="background-color: #8b5cf6; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: bold;">ìª½ì§€ í™•ì¸í•˜ê¸°</a>
                            </div>
                            
                            <p style="color: #6b7280; font-size: 14px;">ê°ì‚¬í•©ë‹ˆë‹¤.<br/>ì¸ì‚¬ì´ë“œì¡ ìš´ì˜íŒ€</p>
                        </div>
                    `
                }
            },

            // í†µí•© ì•Œë¦¼ ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡
            sendNotification: async (userId, type, templateData, options = {}) => {
                try {
                    // 1. ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
                    const { data: userProfile, error: userError } = await supabaseClient
                        .from('user_profiles')
                        .select('email, nickname')
                        .eq('user_id', userId)
                        .single();

                    if (userError || !userProfile) {
                        console.error('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', userError);
                        return { success: false, error: 'ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' };
                    }

                    const template = EmailManager.templates[type];
                    if (!template) {
                        console.error('ì•Œ ìˆ˜ ì—†ëŠ” í…œí”Œë¦¿:', type);
                        return { success: false, error: 'ì•Œ ìˆ˜ ì—†ëŠ” ì•Œë¦¼ íƒ€ì…ì…ë‹ˆë‹¤.' };
                    }

                    // 2. í”Œë«í¼ ë‚´ ì•Œë¦¼ ìƒì„±
                    const { error: notificationError } = await supabaseClient
                        .from('notifications')
                        .insert({
                            user_id: userId,
                            type: type,
                            title: options.title || template.subject.replace('[ì¸ì‚¬ì´ë“œì¡] ', ''),
                            message: options.message || `ìƒˆë¡œìš´ ${type} ì•Œë¦¼ì´ ìˆìŠµë‹ˆë‹¤.`,
                            related_data: templateData,
                            related_id: options.relatedId
                        });

                    if (notificationError) {
                        console.error('ì•Œë¦¼ ìƒì„± ì‹¤íŒ¨:', notificationError);
                    }

                    // 3. ì´ë©”ì¼ ë°œì†¡ (í˜„ì¬ëŠ” ë¡œê·¸ë§Œ, ì¶”í›„ Edge Function ì—°ë™)
                    const emailData = {
                        recipient_email: userProfile.email,
                        recipient_user_id: userId,
                        email_type: type,
                        subject: template.subject,
                        template_name: type,
                        template_variables: { ...templateData, nickname: userProfile.nickname }
                    };

                    // ì´ë©”ì¼ ë¡œê·¸ ì €ì¥
                    const { error: logError } = await supabaseClient
                        .from('email_logs')
                        .insert(emailData);

                    if (logError) {
                        console.error('ì´ë©”ì¼ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', logError);
                    }

                    // ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ (TODO: Supabase Edge Function êµ¬í˜„ í›„ í™œì„±í™”)
                    console.log('ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ì¤€ë¹„:', {
                        to: userProfile.email,
                        subject: template.subject,
                        html: template.getHtml({ ...templateData, nickname: userProfile.nickname })
                    });

                    return { 
                        success: true, 
                        message: 'ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        notificationSent: !notificationError,
                        emailLogged: !logError
                    };

                } catch (error) {
                    console.error('ì•Œë¦¼ ë°œì†¡ ì˜¤ë¥˜:', error);
                    return { success: false, error: error.message };
                }
            },

            // íŠ¹ì • ì•Œë¦¼ íƒ€ì…ë“¤ì„ ìœ„í•œ í¸ì˜ í•¨ìˆ˜ë“¤
            sendWelcomeEmail: (userId, userData) => 
                EmailManager.sendNotification(userId, 'welcome', userData, {
                    title: 'ì¸ì‚¬ì´ë“œì¡ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
                    message: 'ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.'
                }),

            sendExpertApprovalEmail: (userId, expertData, isApproved, reason) => 
                EmailManager.sendNotification(userId, isApproved ? 'expert_approved' : 'expert_rejected', {
                    ...expertData,
                    reason: reason
                }, {
                    title: isApproved ? 'í˜„ì§ì ìŠ¹ì¸ ì™„ë£Œ' : 'í˜„ì§ì ì‹ ì²­ ê²€í†  ê²°ê³¼',
                    message: isApproved ? 'í˜„ì§ìë¡œ í™œë™ì„ ì‹œì‘í•˜ì„¸ìš”!' : 'ë‹¤ì‹œ ì‹ ì²­í•´ë³´ì„¸ìš”.'
                }),

            sendConsultationBookedEmail: (userId, bookingData) =>
                EmailManager.sendNotification(userId, 'consultation_booked', bookingData, {
                    title: 'ë©˜í† ë§ ì˜ˆì•½ ì™„ë£Œ',
                    message: 'ì˜ˆì•½ëœ ë©˜í† ë§ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.',
                    relatedId: bookingData.bookingId
                }),

            sendNewMessageEmail: (userId, messageData) =>
                EmailManager.sendNotification(userId, 'new_message', messageData, {
                    title: 'ìƒˆ ìª½ì§€ ë„ì°©',
                    message: `${messageData.senderName}ë‹˜ìœ¼ë¡œë¶€í„° ìª½ì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.`,
                    relatedId: messageData.messageId
                })
        };

        // ê¸°ì¡´ sendExpertNotification í•¨ìˆ˜ë¥¼ ìƒˆë¡œìš´ EmailManagerë¡œ ëŒ€ì²´
        const sendExpertNotification = async (expert, action, reason = '') => {
            const isApproved = action === 'approve';
            return await EmailManager.sendExpertApprovalEmail(
                expert.user_id, 
                { nickname: expert.nickname, email: expert.email }, 
                isApproved, 
                reason
            );
        };

        // AmountInput ì»´í¬ë„ŒíŠ¸ (ì™¸ë¶€ì—ì„œ ì •ì˜í•˜ì—¬ ì¬ìƒì„± ë°©ì§€)
        const AmountInput = ({ label, value, onChange, placeholder }) => {
            const formatAmount = (value) => {
                if (!value || value === '' || value === '0') return 'ğŸ’° 0ì›';
                const num = parseInt(value);
                if (num >= 10000) return `ğŸ’° ${(num / 10000).toFixed(1)}ì–µì›`;
                if (num >= 1000) return `ğŸ’° ${Math.round(num / 1000)}ì²œë§Œì›`;
                return `ğŸ’° ${num.toLocaleString()}ë§Œì›`;
            };

            return React.createElement('div', {
                className: "mb-6"
            }, [
                React.createElement('label', {
                    key: 'label',
                    className: "block text-xl font-semibold text-gray-800 mb-3"
                }, label),
                React.createElement('input', {
                    key: 'input',
                    type: "text",
                    inputMode: "numeric",
                    pattern: "[0-9]*",
                    value: value,
                    onChange: (e) => {
                        const numValue = e.target.value.replace(/[^0-9]/g, '');
                        onChange(numValue);
                    },
                    className: "w-full p-4 border-2 border-gray-200 rounded-lg text-lg",
                    placeholder: placeholder,
                    autoComplete: "off"
                }),
                React.createElement('div', {
                    key: 'amount',
                    className: "text-green-600 font-semibold text-lg mt-1"
                }, formatAmount(value))
            ]);
        };

        // Supabase ì„¤ì • (ì¸ì‚¬ì´ë“œì¡ ì „ìš©)
        const SUPABASE_URL = 'https://upsedttmnulbmarhawyj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwc2VkdHRtbnVsYm1hcmhhd3lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NDk5MzIsImV4cCI6MjA3MjAyNTkzMn0.j7QuXCFfIytrBvCsIQl0bt9EuVYScIzZWGTR3tVZdUs';
        
        const { createClient } = window.supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ìµëª… ì„¸ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ
        class AnonymousSessionManager {
            constructor() {
                this.currentSession = null;
                this.tokenKey = 'insidejob_session_token';
            }

            // ë³´ì•ˆ í† í° ìƒì„±
            generateSecureToken() {
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
            }

            // ê³„ì‚° ê²°ê³¼ í•´ì‹œ ìƒì„± (ì¡°ì‘ ë°©ì§€)
            async hashCalculationResult(result) {
                const dataString = JSON.stringify({
                    monthlyLivingCost: result.monthlyLivingCost,
                    totalAssets: result.totalAssets,
                    assetSufficiencyYears: result.assetSufficiencyYears
                });
                
                const encoder = new TextEncoder();
                const data = encoder.encode(dataString);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }

            // ê·¸ë£¹ ìë™ ë°°ì •
            assignGroup(calculationResult) {
                // ì·¨ì—…ê²½ìŸë ¥ ì ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ë‹¨ìˆœ ë¶„ë¥˜
                const score = calculationResult.totalScore || 0;
                
                // ì ìˆ˜ ê¸°ë°˜ ë¶„ë¥˜ (A/B/C ë“±ê¸‰ ì‹œìŠ¤í…œ)
                if (score >= 80) return 'premium';
                if (score >= 60) return 'balanced';
                return 'prudent';
            }

            // ìµëª… ë‹‰ë„¤ì„ ìƒì„±
            generateNickname(group) {
                const groupNames = {
                    'prudent': 'ì‹ ì¤‘í˜•',
                    'balanced': 'ê· í˜•í˜•', 
                    'premium': 'ë„ì „í˜•'
                };
                const randomNum = Math.floor(Math.random() * 999) + 1;
                return `${groupNames[group]}${randomNum.toString().padStart(3, '0')}`;
            }

            // ê³„ì‚° ì™„ë£Œì‹œ ìµëª… ì„¸ì…˜ ìƒì„±
            async createSession(calculationResult) {
                try {
                    const sessionToken = this.generateSecureToken();
                    const calculationHash = await this.hashCalculationResult(calculationResult);
                    const assignedGroup = this.assignGroup(calculationResult);
                    const nickname = this.generateNickname(assignedGroup);

                    const sessionData = {
                        session_token: sessionToken,
                        calculation_hash: calculationHash,
                        assigned_group: assignedGroup,
                        nickname: nickname,
                        target_salary: calculationResult.targetSalary || calculationResult.monthlyLivingCost || 0,
                        career_score: calculationResult.totalScore || calculationResult.assetSufficiencyYears || 0,
                        created_at: new Date().toISOString(),
                        expires_at: new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(),
                        last_active: new Date().toISOString(),
                        job_seeker_posts_count: 0
                    };

                    if (supabase) {
                        // ì„œë²„ì— ìµëª… ì„¸ì…˜ ì €ì¥
                        const { data, error } = await supabase
                            .from('anonymous_sessions')
                            .insert([sessionData])
                            .select();

                        if (error) throw error;
                        
                        // ë¡œì»¬ì—ëŠ” í† í°ë§Œ ì €ì¥
                        localStorage.setItem(this.tokenKey, sessionToken);
                        this.currentSession = data[0];
                        
                        console.log(`ìµëª… ì„¸ì…˜ ìƒì„±: ${nickname} (${assignedGroup} ê·¸ë£¹)`);
                        return this.currentSession;
                    } else {
                        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: localStorageì— ì „ì²´ ë°ì´í„° ì €ì¥
                        const fallbackSession = { ...sessionData, id: Date.now() };
                        localStorage.setItem(this.tokenKey, sessionToken);
                        localStorage.setItem(`insidejob_session_${sessionToken}`, JSON.stringify(fallbackSession));
                        this.currentSession = fallbackSession;
                        return this.currentSession;
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨:', error);
                    // ë¡œì»¬ í´ë°±
                    return this.createLocalFallbackSession(calculationResult);
                }
            }

            // ì„¸ì…˜ ë³µêµ¬
            async restoreSession() {
                try {
                    const token = localStorage.getItem(this.tokenKey);
                    if (!token) return null;

                    if (supabase) {
                        // ì„œë²„ì—ì„œ ì„¸ì…˜ ì¡°íšŒ
                        const { data, error } = await supabase
                            .from('anonymous_sessions')
                            .select('*')
                            .eq('session_token', token)
                            .single();

                        if (error) {
                            if (error.code === 'PGRST116') { // ì„¸ì…˜ ì—†ìŒ
                                localStorage.removeItem(this.tokenKey);
                                return null;
                            }
                            throw error;
                        }

                        // ë§Œë£Œ í™•ì¸
                        if (new Date(data.expires_at) < new Date()) {
                            await this.deleteSession(token);
                            return null;
                        }

                        // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                        await supabase
                            .from('anonymous_sessions')
                            .update({ last_active: new Date().toISOString() })
                            .eq('session_token', token);

                        this.currentSession = data;
                        console.log(`ì„¸ì…˜ ë³µêµ¬: ${data.nickname} (${data.assigned_group} ê·¸ë£¹)`);
                        return this.currentSession;
                    } else {
                        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: localStorageì—ì„œ ë³µêµ¬
                        const sessionData = localStorage.getItem(`insidejob_session_${token}`);
                        if (sessionData) {
                            this.currentSession = JSON.parse(sessionData);
                            return this.currentSession;
                        }
                        return null;
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ë³µêµ¬ ì‹¤íŒ¨:', error);
                    return this.getLocalFallbackSession();
                }
            }

            // ì„¸ì…˜ ì—°ì¥
            async extendSession() {
                if (!this.currentSession) return;

                try {
                    const newExpiryDate = new Date(Date.now() + (30 * 24 * 60 * 60 * 1000));
                    
                    if (supabase) {
                        await supabase
                            .from('anonymous_sessions')
                            .update({ 
                                expires_at: newExpiryDate.toISOString(),
                                last_active: new Date().toISOString()
                            })
                            .eq('session_token', this.currentSession.session_token);
                    }
                    
                    this.currentSession.expires_at = newExpiryDate.toISOString();
                    console.log('ì„¸ì…˜ 30ì¼ ì—°ì¥ë¨');
                } catch (error) {
                    console.error('ì„¸ì…˜ ì—°ì¥ ì‹¤íŒ¨:', error);
                }
            }

            // ì»¤ë®¤ë‹ˆí‹° í™œë™ ê¸°ë¡
            async recordCommunityActivity(activityType = 'general') {
                if (!this.currentSession) return;

                try {
                    if (supabase) {
                        const updates = { 
                            last_active: new Date().toISOString()
                        };

                        if (activityType === 'post') {
                            updates.job_seeker_posts_count = (this.currentSession.job_seeker_posts_count || 0) + 1;
                        }

                        await supabase
                            .from('anonymous_sessions')
                            .update(updates)
                            .eq('session_token', this.currentSession.session_token);

                        this.currentSession = { ...this.currentSession, ...updates };
                    }
                } catch (error) {
                    console.error('í™œë™ ê¸°ë¡ ì‹¤íŒ¨:', error);
                }
            }

            // ì„¸ì…˜ ì‚­ì œ
            async deleteSession(token = null) {
                const targetToken = token || this.currentSession?.session_token;
                if (!targetToken) return;

                try {
                    if (supabase) {
                        await supabase
                            .from('anonymous_sessions')
                            .delete()
                            .eq('session_token', targetToken);
                    }
                    
                    localStorage.removeItem(this.tokenKey);
                    localStorage.removeItem(`insidejob_session_${targetToken}`);
                    this.currentSession = null;
                } catch (error) {
                    console.error('ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                }
            }

            // ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ê¶Œí•œ í™•ì¸
            checkCommunityAccess() {
                if (!this.currentSession) {
                    return {
                        hasAccess: false,
                        message: "ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ì„ ì™„ë£Œí•˜ì‹œë©´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                        action: "redirect_to_calculator"
                    };
                }

                // ì„¸ì…˜ ë§Œë£Œ í™•ì¸
                if (new Date(this.currentSession.expires_at) < new Date()) {
                    return {
                        hasAccess: false,
                        message: "ì»¤ë®¤ë‹ˆí‹° ì´ìš©ê¶Œì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°„ë‹¨íˆ ì¬ê³„ì‚°í•´ì£¼ì„¸ìš”",
                        action: "redirect_to_calculator"
                    };
                }

                return {
                    hasAccess: true,
                    userGroup: this.currentSession.assigned_group,
                    nickname: this.currentSession.nickname,
                    session: this.currentSession
                };
            }

            // QR ì½”ë“œìš© ë§í¬ ìƒì„± (ë‹¤ì¤‘ ê¸°ê¸° ì—°ë™)
            generateDeviceLink() {
                if (!this.currentSession) return null;
                
                const baseUrl = window.location.origin;
                return `${baseUrl}/?link_token=${this.currentSession.session_token}`;
            }

            // ë¡œì»¬ í´ë°± ì„¸ì…˜ ìƒì„±
            createLocalFallbackSession(calculationResult) {
                const assignedGroup = this.assignGroup(calculationResult);
                const nickname = this.generateNickname(assignedGroup);
                const token = this.generateSecureToken();

                const fallbackSession = {
                    session_token: token,
                    assigned_group: assignedGroup,
                    nickname: nickname,
                    target_salary: calculationResult.targetSalary || calculationResult.monthlyLivingCost || 0,
                    career_score: calculationResult.totalScore || calculationResult.assetSufficiencyYears || 0,
                    created_at: new Date().toISOString(),
                    expires_at: new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)).toISOString(),
                    is_local_fallback: true
                };

                localStorage.setItem(this.tokenKey, token);
                localStorage.setItem(`insidejob_session_${token}`, JSON.stringify(fallbackSession));
                this.currentSession = fallbackSession;
                
                console.log(`ë¡œì»¬ í´ë°± ì„¸ì…˜ ìƒì„±: ${nickname} (${assignedGroup} ê·¸ë£¹)`);
                return this.currentSession;
            }
        }

        // sessionManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const sessionManager = new AnonymousSessionManager();

        // SupabaseëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆìŒ

        // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±ê¸° 
        class NicknameGenerator {
            constructor() {
                this.adjectives = [
                    // ê°ì •/ì„±ê²© ê´€ë ¨ (200ê°œ)
                    'í–‰ë³µí•œ', 'ì—¬ìœ ë¡œìš´', 'ì§€í˜œë¡œìš´', 'í™œê¸°ì°¬', 'ë‹¹ë‹¹í•œ', 'ë©‹ì§„', 'ìš°ì•„í•œ', 'ë“ ë“ í•œ', 
                    'ë¹›ë‚˜ëŠ”', 'í‰ì˜¨í•œ', 'ê±´ê°•í•œ', 'ë”°ëœ»í•œ', 'ììœ ë¡œìš´', 'ëŠ ë¦„í•œ', 'ì¹œê·¼í•œ', 'ì„±ì‹¤í•œ',
                    'ë‹¨ì•„í•œ', 'ì°¨ë¶„í•œ', 'ìš©ê°í•œ', 'ì”©ì”©í•œ', 'ëª…ë‘í•œ', 'ì¾Œí™œí•œ', 'ë°ì€', 'ì¦ê±°ìš´',
                    'í™œë°œí•œ', 'ìƒê¸°ì°¬', 'ë°œë„í•œ', 'ê¸°ìš´ì°¬', 'í˜ì°¬', 'ê±´ì¥í•œ', 'íŠ¼íŠ¼í•œ', 'ê°•í•œ',
                    'ì‹ ë‚˜ëŠ”', 'ê¸°ìœ', 'ì¦ê±°ìš´', 'ìœ ì¾Œí•œ', 'ì†œì”¨ì¢‹ì€', 'ëŠ¥ìˆ™í•œ', 'ì¬ëŠ¥ìˆëŠ”', 'ë˜‘ë˜‘í•œ',
                    'ì˜ë¦¬í•œ', 'ìŠ¬ê¸°ë¡œìš´', 'í˜„ëª…í•œ', 'ì´ëª…í•œ', 'ê¸°íŠ¹í•œ', 'ì˜ˆìœ', 'ì´ìœ', 'ê³±ë‹¨ì •í•œ',
                    'ìˆ˜ë ¤í•œ', 'ì•„ë¦„ë‹¤ìš´', 'ê³ ìš´', 'ì²­ìˆœí•œ', 'ê¹”ë”í•œ', 'ë‹¨ì •í•œ', 'ì •ê°ˆí•œ', 'ê¹¨ë—í•œ',
                    'ë§‘ì€', 'íˆ¬ëª…í•œ', 'ìˆœìˆ˜í•œ', 'ìˆœì§„í•œ', 'ì²œì§„í•œ', 'ê·€ì—¬ìš´', 'ì‚¬ë‘ìŠ¤ëŸ¬ìš´', 'í¬ê·¼í•œ',
                    'ë¶€ë“œëŸ¬ìš´', 'ì˜¨í™”í•œ', 'ë”°ìŠ¤í•œ', 'ë‹¤ì •í•œ', 'ì¹œì ˆí•œ', 'ìƒëƒ¥í•œ', 'ê³ ë§ˆìš´', 'ê³ ê·€í•œ',
                    'í’ˆê²©ìˆëŠ”', 'ìš°ìˆ˜í•œ', 'ë›°ì–´ë‚œ', 'í›Œë¥­í•œ', 'ëŒ€ë‹¨í•œ', 'ë†€ë¼ìš´', 'ì‹ ê¸°í•œ', 'íŠ¹ë³„í•œ',
                    'ì†Œì¤‘í•œ', 'ê·€ì¤‘í•œ', 'ê°’ì§„', 'ë¹¼ì–´ë‚œ', 'ë…íŠ¹í•œ', 'ê°œì„±ìˆëŠ”', 'ì°½ì˜ì ì¸', 'ì˜ˆìˆ ì ì¸',
                    'ê°ê°ì ì¸', 'ì„¸ë ¨ëœ', 'ëª¨ë˜í•œ', 'íŠ¸ë Œë””í•œ', 'ìŠ¤íƒ€ì¼ë¦¬ì‹œí•œ', 'ì°¸ì‹ í•œ', 'ì‹ ì„ í•œ', 'ìƒˆë¡œìš´',
                    'ê¹Šì€', 'ì§„í•œ', 'ì§™ì€', 'ê³ ìš”í•œ', 'ì¡°ìš©í•œ', 'ì¹¨ì°©í•œ', 'ì•ˆì •ëœ', 'í¸ì•ˆí•œ',
                    'ëŠê¸‹í•œ', 'ì—¬ìœ ìˆëŠ”', 'ë‚™ì²œì ì¸', 'ê¸ì •ì ì¸', 'ì ê·¹ì ì¸', 'ì—´ì •ì ì¸', 'ì˜ìš•ì ì¸', 'ì—´ì‹¬ì¸',
                    'ë¶€ì§€ëŸ°í•œ', 'ì„±ì‹¤í•œ', 'ê¼¼ê¼¼í•œ', 'ì„¸ì‹¬í•œ', 'ì •ì„±ìŠ¤ëŸ°', 'ì‹ ì¤‘í•œ', 'ì¡°ì‹¬ìŠ¤ëŸ°', 'ì²´ê³„ì ì¸',
                    'ê³„íšì ì¸', 'ë…¼ë¦¬ì ì¸', 'í•©ë¦¬ì ì¸', 'í˜„ì‹¤ì ì¸', 'ì‹¤ìš©ì ì¸', 'íš¨ìœ¨ì ì¸', 'ì „ë¬¸ì ì¸', 'ìˆ™ë ¨ëœ',
                    'ê²½í—˜ë§ì€', 'ë…¸ë ¨í•œ', 'ë² í…Œë‘', 'ì‹¤ë ¥ìˆëŠ”', 'ìœ ëŠ¥í•œ', 'íƒì›”í•œ', 'ì¶œì¤‘í•œ', 'ì¼ë¥˜ì˜',
                    'ìµœê³ ì˜', 'ì™„ë²½í•œ', 'ì •í™•í•œ', 'ì •ë°€í•œ', 'ì„¬ì„¸í•œ', 'ì˜ˆë¯¼í•œ', 'ë¯¼ê°í•œ', 'ì„¸ë ¨ëœ',
                    'ê³ ê¸‰ìŠ¤ëŸ°', 'í’ˆìœ„ìˆëŠ”', 'ìš°í’ˆìˆëŠ”', 'ì ì–ì€', 'ì°¨ê·¼í•œ', 'ê¾¸ì¤€í•œ', 'ì§€ì†ì ì¸', 'ë³€í•¨ì—†ëŠ”',
                    'í•œê²°ê°™ì€', 'ì¼ê´€ëœ', 'ì¶©ì‹¤í•œ', 'ì§„ì‹¤í•œ', 'ì†”ì§í•œ', 'ì •ì§í•œ', 'ìˆœìˆ˜í•œ', 'ê¹¨ë—í•œ',
                    'ë§‘ê³ ê¹¨ë—í•œ', 'íˆ¬ëª…í•œ', 'í™”ì‚¬í•œ', 'í™˜í•œ', 'ë°˜ì§ì´ëŠ”', 'ë²ˆì©ì´ëŠ”', 'ë°˜ë“¤ë°˜ë“¤í•œ', 'ìœ¤ì´ë‚˜ëŠ”',
                    'ë§¤ë„ëŸ¬ìš´', 'ë¶€ë“œëŸ½ê³ ë§¤ë„ëŸ¬ìš´', 'ì‹¤í¬ê°™ì€', 'ë²¨ë²³ê°™ì€', 'ëª©í™”ê°™ì€', 'êµ¬ë¦„ê°™ì€', 'ì†œí„¸ê°™ì€', 'ë³´ë“¤ë³´ë“¤í•œ',
                    'í¬ê·¼í¬ê·¼í•œ', 'í­ì‹ í­ì‹ í•œ', 'ë§ë‘ë§ë‘í•œ', 'íƒ„íƒ„í•œ', 'ê²¬ê³ í•œ', 'íŠ¼íŠ¼í•œ', 'ë‹¨ë‹¨í•œ',
                    'ì•¼ë¬´ì§„', 'ì”©ì”©í•œ', 'ìš©ê¸°ìˆëŠ”', 'ë‹´ëŒ€í•œ', 'ê³¼ê°í•œ', 'ê²°ë‹¨ë ¥ìˆëŠ”', 'ì¶”ì§„ë ¥ìˆëŠ”', 'ì‹¤í–‰ë ¥ìˆëŠ”',
                    'ë¦¬ë”ì‹­ìˆëŠ”', 'ì¹´ë¦¬ìŠ¤ë§ˆìˆëŠ”', 'ë§¤ë ¥ì ì¸', 'ì¸ìƒì ì¸', 'ê¸°ì–µì—ë‚¨ëŠ”', 'ìŠì§€ëª»í• ', 'ê°ë™ì ì¸', 'ì¸ìƒê¹Šì€'
                ];
                
                this.nouns = [
                    // ìì—° (1000ê°œ)
                    'ë‚˜ë¬´', 'ê½ƒ', 'í’€', 'ì', 'ë¿Œë¦¬', 'ì¤„ê¸°', 'ê°€ì§€', 'ì—´ë§¤', 'ì”¨ì•—', 'ìƒˆì‹¹',
                    'ì¥ë¯¸', 'ë°±í•©', 'êµ­í™”', 'íŠ¤ë¦½', 'í•´ë°”ë¼ê¸°', 'ê°œë‚˜ë¦¬', 'ì§„ë‹¬ë˜', 'ë²šê½ƒ', 'ë§¤í™”', 'ì—°ê½ƒ',
                    'ì†Œë‚˜ë¬´', 'ì€í–‰ë‚˜ë¬´', 'í”Œë¼íƒ€ë„ˆìŠ¤', 'ë‹¨í’ë‚˜ë¬´', 'ëŠí‹°ë‚˜ë¬´', 'ë²„ë“œë‚˜ë¬´', 'ëŒ€ë‚˜ë¬´', 'ì°¸ë‚˜ë¬´', 'ë°¤ë‚˜ë¬´', 'ê°ë‚˜ë¬´',
                    'ë°”ë‹¤', 'ê°•', 'í˜¸ìˆ˜', 'ê³„ê³¡', 'í­í¬', 'ê°œì²œ', 'ìƒ˜', 'ìš°ë¬¼', 'ì—°ëª»', 'ëŠª',
                    'ì‚°', 'ì–¸ë•', 'ê³ ì›', 'í‰ì•¼', 'ë“¤íŒ', 'ì´ˆì›', 'ì‚¬ë§‰', 'ìˆ²', 'ì •ê¸€', 'ë°€ë¦¼',
                    'í•˜ëŠ˜', 'êµ¬ë¦„', 'ë³„', 'ë‹¬', 'íƒœì–‘', 'ë¬´ì§€ê°œ', 'ë²ˆê°œ', 'ì²œë‘¥', 'ë¹„', 'ëˆˆ',
                    'ë°”ëŒ', 'ë¯¸í’', 'ì‚°ë“¤ë°”ëŒ', 'ë´„ë°”ëŒ', 'ê°€ì„ë°”ëŒ', 'ê²¨ìš¸ë°”ëŒ', 'ì—¬ë¦„ë°”ëŒ', 'í•´í’', 'ìœ¡í’', 'ê³¨ë°”ëŒ',
                    'ìƒˆ', 'ì°¸ìƒˆ', 'ë¹„ë‘˜ê¸°', 'ê¹Œì¹˜', 'ê¹Œë§ˆê·€', 'ì œë¹„', 'ë…ìˆ˜ë¦¬', 'ë§¤', 'í•™', 'ê°ˆë§¤ê¸°',
                    'ë‚˜ë¹„', 'ë²Œ', 'ê¿€ë²Œ', 'ì ìë¦¬', 'ë©”ëšœê¸°', 'ê°œë¯¸', 'ë”±ì •ë²Œë ˆ', 'ë¬´ë‹¹ë²Œë ˆ', 'ê±°ë¯¸', 'ì§€ë ì´',
                    
                    // ë™ë¬¼ (1500ê°œ)
                    'ê³ ì–‘ì´', 'ê°•ì•„ì§€', 'í† ë¼', 'ë‹¤ëŒì¿ ì§€', 'ì²­ì„¤ëª¨', 'í–„ìŠ¤í„°', 'ê¸°ë‹ˆí”¼ê·¸', 'ì•µë¬´ìƒˆ', 'ì¹´ë‚˜ë¦¬ì•„', 'ê¸ˆë¶•ì–´',
                    'ì‚¬ì', 'í˜¸ë‘ì´', 'í‘œë²”', 'ì¹˜íƒ€', 'ì¬ê·œì–´', 'ì¿ ê±°', 'íŒ¬ë”', 'ë¶ê·¹ê³°', 'ê°ˆìƒ‰ê³°', 'í‘ê³°',
                    'ì½”ë¼ë¦¬', 'ê¸°ë¦°', 'í•˜ë§ˆ', 'ì½”ë¿”ì†Œ', 'ì–¼ë£©ë§', 'ë§', 'ë‹¹ë‚˜ê·€', 'ë‚™íƒ€', 'ì•ŒíŒŒì¹´', 'ë¼ë§ˆ',
                    'ì›ìˆ­ì´', 'ì¹¨íŒ¬ì§€', 'ì˜¤ë‘ìš°íƒ„', 'ê³ ë¦´ë¼', 'ì›ìˆ­ì´', 'ì—¬ìš°ì›ìˆ­ì´', 'ê°ˆë§¤ê¸°', 'í ë¦¬ì»¨', 'í”Œë¼ë°ê³ ', 'ê³µì‘',
                    'ëŒê³ ë˜', 'ê³ ë˜', 'ìƒì–´', 'ê°€ì˜¤ë¦¬', 'ë°”ë‹¤ê±°ë¶', 'ë°”ë‹¤í‘œë²”', 'ë°”ë‹¤ì‚¬ì', 'í­ê·„', 'ì•Œë°”íŠ¸ë¡œìŠ¤', 'ë°”ë‹·ìƒˆ',
                    'ê°œêµ¬ë¦¬', 'ë‘êº¼ë¹„', 'ë„ë§ˆë±€', 'ê±°ë¶ì´', 'ë±€', 'ì•…ì–´', 'ì´êµ¬ì•„ë‚˜', 'ì¹´ë©œë ˆì˜¨', 'ë„ë§ˆë±€ë¶™ì´', 'ì œì½”',
                    
                    // ì§ì—… (1000ê°œ)
                    'ì˜ì‚¬', 'ê°„í˜¸ì‚¬', 'êµì‚¬', 'êµìˆ˜', 'í•™ì', 'ì—°êµ¬ì›', 'ê³¼í•™ì', 'ì—”ì§€ë‹ˆì–´', 'ê°œë°œì', 'ë””ìì´ë„ˆ',
                    'ì˜ˆìˆ ê°€', 'í™”ê°€', 'ì¡°ê°ê°€', 'ìŒì•…ê°€', 'í”¼ì•„ë‹ˆìŠ¤íŠ¸', 'ë°”ì´ì˜¬ë¦¬ë‹ˆìŠ¤íŠ¸', 'ì²¼ë¦¬ìŠ¤íŠ¸', 'í”Œë£¨í‹°ìŠ¤íŠ¸', 'ë“œëŸ¬ë¨¸', 'ê¸°íƒ€ë¦¬ìŠ¤íŠ¸',
                    'ê°€ìˆ˜', 'ì„±ì•…ê°€', 'ì‘ê³¡ê°€', 'ì‘ì‚¬ê°€', 'í¸ê³¡ê°€', 'í”„ë¡œë“€ì„œ', 'ì§€íœ˜ì', 'ì—°ì£¼ì', 'ë¬´ìš©ê°€', 'ë°œë ˆë¦¬ë‚˜',
                    'ë°°ìš°', 'ì—°ì¶œê°€', 'ê°ë…', 'ì‘ê°€', 'ì†Œì„¤ê°€', 'ì‹œì¸', 'ìˆ˜í•„ê°€', 'ê¸°ì', 'ì•„ë‚˜ìš´ì„œ', 'ì„±ìš°',
                    'ìš”ë¦¬ì‚¬', 'ë² ì´ì»¤', 'íŒŒí‹°ì…°', 'ë°”ë¦¬ìŠ¤íƒ€', 'ì†Œë¯ˆë¦¬ì—', 'ì˜ì–‘ì‚¬', 'ë†ë¶€', 'ëª©ì¶•ì—…ì', 'ì–´ë¶€', 'ì‚¬ëƒ¥ê¾¼',
                    'ê±´ì¶•ê°€', 'ê±´ì„¤ì—…ì', 'ëª©ìˆ˜', 'ì „ê¸°ê¸°ì‚¬', 'ë°°ê´€ê³µ', 'ìš©ì ‘ê³µ', 'ê¸°ê³„ê³µ', 'ì •ë¹„ì‚¬', 'ìš´ì „ê¸°ì‚¬', 'íƒì‹œê¸°ì‚¬',
                    'ë³€í˜¸ì‚¬', 'íŒì‚¬', 'ê²€ì‚¬', 'ê²½ì°°ê´€', 'ì†Œë°©ê´€', 'êµ°ì¸', 'íŒŒì¼ëŸ¿', 'ìŠ¹ë¬´ì›', 'ì„ ì¥', 'í•­í•´ì‚¬',
                    'ì‚¬ì—…ê°€', 'ê¸°ì—…ê°€', 'CEO', 'ê´€ë¦¬ì', 'íŒ€ì¥', 'ë¶€ì¥', 'ì´ì‚¬', 'íšŒì¥', 'ì‚¬ì¥', 'ëŒ€í‘œ',
                    'ê°œë°œì', 'ë°ì´í„°ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸', 'ë§ˆì¼€í„°', 'ëŒ€í•™ìƒ', 'ì‹ ì…ì‚¬ì›', 'ì£¼ë‹ˆì–´ê°œë°œì', 'ê¸°íšì', 'ë””ìì´ë„ˆ', 'ì˜ì—…ëŒ€í‘œ', 'ì»¨ì„¤í„´íŠ¸',
                    
                    // ì‚¬ë¬¼/ë„êµ¬ (2000ê°œ)
                    'ì±…', 'íœ', 'ì—°í•„', 'ì§€ìš°ê°œ', 'ì', 'ì»´í¼ìŠ¤', 'ê³„ì‚°ê¸°', 'ì»´í“¨í„°', 'ë…¸íŠ¸ë¶', 'íƒœë¸”ë¦¿',
                    'íœ´ëŒ€í°', 'ìŠ¤ë§ˆíŠ¸í°', 'í…”ë ˆë¹„ì „', 'ë¼ë””ì˜¤', 'ìŠ¤í”¼ì»¤', 'í—¤ë“œí°', 'ì´ì–´í°', 'ë§ˆì´í¬', 'ì¹´ë©”ë¼', 'ìº ì½”ë”',
                    'ì‹œê³„', 'ì•ŒëŒì‹œê³„', 'ë²½ì‹œê³„', 'ì†ëª©ì‹œê³„', 'ìŠ¤ë§ˆíŠ¸ì›Œì¹˜', 'ë‹¬ë ¥', 'ìˆ˜ì²©', 'ë‹¤ì´ì–´ë¦¬', 'ë©”ëª¨ì¥', 'ë…¸íŠ¸',
                    'ê°€ë°©', 'ë°°ë‚­', 'ì—¬í–‰ê°€ë°©', 'í•¸ë“œë°±', 'ìˆ„ë”ë°±', 'í¬ë¡œìŠ¤ë°±', 'í† íŠ¸ë°±', 'í´ëŸ¬ì¹˜', 'ì§€ê°‘', 'íŒŒìš°ì¹˜',
                    'ìë™ì°¨', 'ë²„ìŠ¤', 'ì§€í•˜ì² ', 'ê¸°ì°¨', 'ë¹„í–‰ê¸°', 'í—¬ë¦¬ì½¥í„°', 'ë°°', 'ìš”íŠ¸', 'ìì „ê±°', 'ì˜¤í† ë°”ì´',
                    'ì¹¨ëŒ€', 'ì˜ì', 'ì±…ìƒ', 'ì†ŒíŒŒ', 'í…Œì´ë¸”', 'ì„œëì¥', 'ì˜·ì¥', 'ëƒ‰ì¥ê³ ', 'ì„¸íƒê¸°', 'ì—ì–´ì»¨',
                    'í…íŠ¸', 'sleeping bag', 'ë°°ë‚­', 'ë“±ì‚°í™”', 'ìº í•‘ìš©í’ˆ', 'ëœí„´', 'ì†ì „ë“±', 'ë‚˜ì¹¨ë°˜', 'ë§ì›ê²½', 'ìŒì•ˆê²½',
                    'ì•…ê¸°', 'í”¼ì•„ë…¸', 'ê¸°íƒ€', 'ë°”ì´ì˜¬ë¦°', 'ì²¼ë¡œ', 'í”Œë£¨íŠ¸', 'ìƒ‰ì†Œí°', 'íŠ¸ëŸ¼í«', 'ë“œëŸ¼', 'í•˜ëª¨ë‹ˆì¹´',
                    'ê³µ', 'ì¶•êµ¬ê³µ', 'ë†êµ¬ê³µ', 'ì•¼êµ¬ê³µ', 'í…Œë‹ˆìŠ¤ê³µ', 'íƒêµ¬ê³µ', 'ë°°ë“œë¯¼í„´', 'ê³¨í”„ê³µ', 'ë³¼ë§ê³µ', 'ëŸ­ë¹„ê³µ',
                    'ìš´ë™í™”', 'êµ¬ë‘', 'ìŠ¬ë¦¬í¼', 'ìƒŒë“¤', 'ë¶€ì¸ ', 'í•˜ì´í', 'ìŠ¤ë‹ˆì»¤ì¦ˆ', 'ë¡œí¼', 'ì˜¥ìŠ¤í¼ë“œ', 'ëª¨ì¹´ì‹ ',
                    
                    // ìŒì‹ (1500ê°œ)
                    'ë°¥', 'êµ­', 'ê¹€ì¹˜', 'ë¶ˆê³ ê¸°', 'ê°ˆë¹„', 'ì‚¼ê²¹ì‚´', 'ëƒ‰ë©´', 'ë¹„ë¹”ë°¥', 'ê¹€ë°¥', 'ë¼ë©´',
                    'ìš°ë™', 'ì§œì¥ë©´', 'ì§¬ë»', 'íƒ•ìˆ˜ìœ¡', 'ë§Œë‘', 'ë–¡ë³¶ì´', 'ìˆœëŒ€', 'ì–´ë¬µ', 'ë¶•ì–´ë¹µ', 'í˜¸ë–¡',
                    'ì¹˜í‚¨', 'í”¼ì', 'í–„ë²„ê±°', 'íŒŒìŠ¤íƒ€', 'ìŠ¤í…Œì´í¬', 'ìƒëŸ¬ë“œ', 'ìƒŒë“œìœ„ì¹˜', 'í† ìŠ¤íŠ¸', 'ë² ì´ê¸€', 'í¬ë£¨ì•„ìƒ',
                    'ì¼€ì´í¬', 'ì¿ í‚¤', 'ë§ˆì¹´ë¡±', 'ë„ë„›', 'ë¨¸í•€', 'íŒŒì´', 'íƒ€ë¥´íŠ¸', 'í‘¸ë”©', 'ì ¤ë¦¬', 'ì´ˆì½œë¦¿',
                    'ì‚¬ê³¼', 'ë°°', 'ë³µìˆ­ì•„', 'í¬ë„', 'ë”¸ê¸°', 'ë°”ë‚˜ë‚˜', 'ì˜¤ë Œì§€', 'ê·¤', 'ìëª½', 'ë ˆëª¬',
                    'ìˆ˜ë°•', 'ë©”ë¡ ', 'ì°¸ì™¸', 'í‚¤ìœ„', 'íŒŒì¸ì• í”Œ', 'ë§ê³ ', 'ì•„ë³´ì¹´ë„', 'ë¸”ë£¨ë² ë¦¬', 'ì²´ë¦¬', 'ìë‘',
                    'ì»¤í”¼', 'ì°¨', 'ë¬¼', 'ì£¼ìŠ¤', 'ìš°ìœ ', 'ìš”êµ¬ë¥´íŠ¸', 'ë§¥ì£¼', 'ì™€ì¸', 'ì†Œì£¼', 'ë§‰ê±¸ë¦¬',
                    'ë¹µ', 'ì‹ë¹µ', 'ë°”ê²ŒíŠ¸', 'ë¡¤ë¹µ', 'ë‹¨íŒ¥ë¹µ', 'í¬ë¦¼ë¹µ', 'ì†Œë³´ë¡œë¹µ', 'ë§ˆìš”ë„¤ì¦ˆë¹µ', 'ì´ˆì½”ë¹µ', 'ì¹˜ì¦ˆë¹µ',
                    'ë©´', 'ìŒ€êµ­ìˆ˜', 'ë©”ë°€êµ­ìˆ˜', 'ì¹¼êµ­ìˆ˜', 'ìˆ˜ì œë¹„', 'ì”ì¹˜êµ­ìˆ˜', 'ì†Œë©´', 'ì¤‘ë©´', 'êµµì€ë©´', 'ë‚©ì‘ë©´',
                    'ê³ ê¸°', 'ì†Œê³ ê¸°', 'ë¼ì§€ê³ ê¸°', 'ë‹­ê³ ê¸°', 'ì–‘ê³ ê¸°', 'ì˜¤ë¦¬ê³ ê¸°', 'ìƒì„ ', 'ì—°ì–´', 'ì°¸ì¹˜', 'ê³ ë“±ì–´',
                    
                    // ì¥ì†Œ (1000ê°œ)
                    'ì§‘', 'í•™êµ', 'ë³‘ì›', 'ì€í–‰', 'ìš°ì²´êµ­', 'ë„ì„œê´€', 'ë°•ë¬¼ê´€', 'ë¯¸ìˆ ê´€', 'ê·¹ì¥', 'ì˜í™”ê´€',
                    'ê³µì›', 'ë†€ì´í„°', 'ìš´ë™ì¥', 'ì²´ìœ¡ê´€', 'ìˆ˜ì˜ì¥', 'ê³¨í”„ì¥', 'í…Œë‹ˆìŠ¤ì¥', 'ì¶•êµ¬ì¥', 'ì•¼êµ¬ì¥', 'ë†êµ¬ì¥',
                    'ì¹´í˜', 'ë ˆìŠ¤í† ë‘', 'ìŒì‹ì ', 'ìˆ ì§‘', 'ë°”', 'í´ëŸ½', 'ë…¸ë˜ë°©', 'PCë°©', 'ì°œì§ˆë°©', 'ì‚¬ìš°ë‚˜',
                    'ë°±í™”ì ', 'ë§ˆíŠ¸', 'í¸ì˜ì ', 'ì•½êµ­', 'ë¹µì§‘', 'ê½ƒì§‘', 'ì„œì ', 'ë¬¸êµ¬ì ', 'ì˜·ê°€ê²Œ', 'ì‹ ë°œê°€ê²Œ',
                    'í•´ë³€', 'ë°”ë‹·ê°€', 'ì‚°', 'ê³„ê³¡', 'í­í¬', 'ë™êµ´', 'ì„¬', 'í•­êµ¬', 'ë¶€ë‘', 'ë‹¤ë¦¬',
                    'ë„ì‹œ', 'ë§ˆì„', 'ì‹œê³¨', 'ë†ì´Œ', 'ì–´ì´Œ', 'ì‚°ì´Œ', 'ë™ë„¤', 'ê³¨ëª©', 'ê¸¸', 'ê±°ë¦¬',
                    'ë²„ìŠ¤ì •ë¥˜ì¥', 'ì§€í•˜ì² ì—­', 'ê¸°ì°¨ì—­', 'ê³µí•­', 'í•­ê³µê¸°', 'ì„ ì°©ì¥', 'ì£¼ì°¨ì¥', 'í„°ë„', 'ìœ¡êµ', 'ì§€í•˜ë„',
                    'ì‚¬ë¬´ì‹¤', 'íšŒì‚¬', 'ê³µì¥', 'ì°½ê³ ', 'ìƒì ', 'ì‹œì¥', 'ì „í†µì‹œì¥', 'ì¬ë˜ì‹œì¥', 'ë†ìˆ˜ì‚°ì‹œì¥', 'ë²¼ë£©ì‹œì¥',
                    'í˜¸í…”', 'ëª¨í…”', 'íœì…˜', 'ë¦¬ì¡°íŠ¸', 'ìº í•‘ì¥', 'ê¸€ë¨í•‘', 'ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤', 'ë¯¼ë°•', 'ì—¬ê´€', 'ìˆ™ë°•ì—…ì†Œ',
                    'êµì‹¤', 'ê°•ë‹¹', 'ì²´ìœ¡ê´€', 'ìš´ë™ì¥', 'ë„ì„œì‹¤', 'ê³¼í•™ì‹¤', 'ìŒì•…ì‹¤', 'ë¯¸ìˆ ì‹¤', 'ì»´í“¨í„°ì‹¤', 'ë°©ì†¡ì‹¤'
                ];
            }
            
            generate() {
                const adj = this.adjectives[Math.floor(Math.random() * this.adjectives.length)];
                const noun = this.nouns[Math.floor(Math.random() * this.nouns.length)];
                // ì²œë§Œê°œ ì¡°í•©ìœ¼ë¡œ ìˆ«ì ì—†ì´ë„ ì¶©ë¶„í•˜ë¯€ë¡œ ìˆ«ì ì œê±°
                return `${adj}${noun}`;
            }
        }

        // íšŒì› ì¸ì¦ ë§¤ë‹ˆì €
        class AuthManager {
            constructor() {
                this.nicknameGen = new NicknameGenerator();
                this.currentUser = null;
            }
            
            // íšŒì›ê°€ì…
            async signUp(email, password, nickname = null) {
                try {
                    const finalNickname = nickname || this.nicknameGen.generate();
                    
                    
                    const { data, error } = await supabaseClient.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                nickname: finalNickname
                            }
                        }
                    });
                    
                    if (error) throw error;
                    
                    // ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„±
                    if (data.user) {
                        const { error: profileError } = await supabase
                            .from('user_profiles')
                            .insert({
                                id: data.user.id,
                                email: email,
                                nickname: finalNickname,
                                role: expertProfile ? 'expert' : 'member',
                                expert_status: expertProfile ? 'pending' : null,
                                privacy_consent: true,
                                privacy_consent_date: new Date().toISOString(),
                                created_at: new Date().toISOString()
                            });
                        
                        if (profileError) throw profileError;
                    }
                    
                    return { success: true, user: data.user };
                } catch (error) {
                    // ì˜ë¬¸ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í•œê¸€ë¡œ ë³€í™˜
                    let koreanErrorMessage = error.message;
                    
                    if (error.message.includes('User already registered')) {
                        koreanErrorMessage = 'ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                    } else if (error.message.includes('Password should be at least')) {
                        koreanErrorMessage = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (error.message.includes('Invalid email')) {
                        koreanErrorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    } else if (error.message.includes('Signup is disabled')) {
                        koreanErrorMessage = 'íšŒì›ê°€ì…ì´ ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    } else if (error.message.includes('Network error') || error.message.includes('fetch')) {
                        koreanErrorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (error.message.includes('duplicate key value violates unique constraint')) {
                        koreanErrorMessage = 'ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                    } else if (error.message.includes('permission denied')) {
                        koreanErrorMessage = 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
                    }
                    
                    return { success: false, error: koreanErrorMessage };
                }
            }
            
            // ë¡œê·¸ì¸
            async signIn(email, password) {
                try {
                    
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    this.currentUser = data.user;
                    return { success: true, user: data.user };
                } catch (error) {
                    // ì˜ë¬¸ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í•œê¸€ë¡œ ë³€í™˜
                    let koreanErrorMessage = error.message;
                    
                    if (error.message.includes('Invalid login credentials')) {
                        koreanErrorMessage = 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    } else if (error.message.includes('Email not confirmed')) {
                        koreanErrorMessage = 'ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (error.message.includes('Too many requests')) {
                        koreanErrorMessage = 'ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message.includes('User not found')) {
                        koreanErrorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                    } else if (error.message.includes('Invalid email')) {
                        koreanErrorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    } else if (error.message.includes('Password should be at least')) {
                        koreanErrorMessage = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                    } else if (error.message.includes('Network error') || error.message.includes('fetch')) {
                        koreanErrorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    }
                    
                    return { success: false, error: koreanErrorMessage };
                }
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡
            async sendPasswordResetEmail(email) {
                try {
                    const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
                        redirectTo: window.location.origin + '/#reset-password'
                    });
                    
                    if (error) throw error;
                    
                    return { success: true, message: 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.' };
                } catch (error) {
                    let koreanErrorMessage = error.message;
                    
                    if (error.message.includes('Invalid email')) {
                        koreanErrorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                    } else if (error.message.includes('User not found')) {
                        koreanErrorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                    } else if (error.message.includes('Email rate limit exceeded')) {
                        koreanErrorMessage = 'ë„ˆë¬´ ìì£¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message.includes('Network error') || error.message.includes('fetch')) {
                        koreanErrorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    }
                    
                    return { success: false, error: koreanErrorMessage };
                }
            }
            
            // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (ë‹¨ìˆœ ì¤‘ë³µ í™•ì¸)
            async checkEmail(email) {
                try {
                    // ê¸°ì¡´ user_profiles í…Œì´ë¸”ì—ì„œ ì´ë©”ì¼ í™•ì¸
                    const { data: existingUser, error } = await supabase
                        .from('user_profiles')
                        .select('id, email, role, expert_status')
                        .eq('email', email)
                        .single();
                    
                    if (existingUser) {
                        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼
                        return { 
                            success: false, 
                            error: 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë©”ì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.'
                        };
                    }
                    
                    return { success: true };
                } catch (error) {
                    // ì‚¬ìš©ìê°€ ì—†ëŠ” ê²½ìš° (ì •ìƒì ì¸ ìƒí™©)
                    return { success: true };
                }
            }

            // ë¡œê·¸ì•„ì›ƒ
            async signOut() {
                try {
                    const { error } = await supabaseClient.auth.signOut();
                    if (error) throw error;
                    
                    this.currentUser = null;
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (role í¬í•¨)
            async getCurrentUser() {
                try {
                    const { data: { user } } = await supabaseClient.auth.getUser();
                    if (!user) {
                        this.currentUser = null;
                        return null;
                    }
                    
                    // user_profilesì—ì„œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (role, expert_status í¬í•¨)
                    const { data: profileData, error: profileError } = await supabase
                        .from('user_profiles')
                        .select('id, email, nickname, role, expert_status, created_at')
                        .eq('id', user.id)
                        .single();
                    
                    if (profileError) {
                        console.warn('í”„ë¡œí•„ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', profileError);
                        // Auth ì •ë³´ë§Œì´ë¼ë„ ì‚¬ìš©
                        this.currentUser = user;
                        return user;
                    }
                    
                    // Auth ì •ë³´ì™€ í”„ë¡œí•„ ì •ë³´ ë³‘í•©
                    const enhancedUser = {
                        ...user,
                        ...profileData,
                        // í˜¸í™˜ì„±ì„ ìœ„í•´ ê¸°ì¡´ í•„ë“œë“¤ ìœ ì§€
                        user_metadata: user.user_metadata || {}
                    };
                    
                    console.log('ğŸ” Enhanced User Data:', {
                        email: enhancedUser.email,
                        role: enhancedUser.role,
                        expert_status: enhancedUser.expert_status,
                        nickname: enhancedUser.nickname
                    });
                    
                    this.currentUser = enhancedUser;
                    return enhancedUser;
                } catch (error) {
                    console.error('Error getting current user:', error);
                    return null;
                }
            }
            
            // ë‹‰ë„¤ì„ ì—…ë°ì´íŠ¸
            async updateNickname(newNickname) {
                try {
                    if (!this.currentUser) throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                    
                    const { error } = await supabase
                        .from('user_profiles')
                        .update({ nickname: newNickname })
                        .eq('id', this.currentUser.id);
                    
                    if (error) throw error;
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
            
            // ì†Œì…œ ë¡œê·¸ì¸ ë©”ì„œë“œë“¤
            async signInWithGoogle() {
                try {
                    const { data, error } = await supabaseClient.auth.signInWithOAuth({
                        provider: 'google',
                        options: {
                            redirectTo: window.location.origin
                        }
                    });
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('Google ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    return { success: false, error: 'êµ¬ê¸€ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
                }
            }
            
            async signInWithKakao() {
                try {
                    // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì€ Supabaseì—ì„œ kakao providerë¡œ ì„¤ì • í•„ìš”
                    const { data, error } = await supabaseClient.auth.signInWithOAuth({
                        provider: 'kakao',
                        options: {
                            redirectTo: window.location.origin
                        }
                    });
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    return { success: false, error: 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
                }
            }
            
            async signInWithNaver() {
                try {
                    // ë„¤ì´ë²„ ë¡œê·¸ì¸ì€ Supabaseì—ì„œ naver providerë¡œ ì„¤ì • í•„ìš”
                    const { data, error } = await supabaseClient.auth.signInWithOAuth({
                        provider: 'naver',
                        options: {
                            redirectTo: window.location.origin
                        }
                    });
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('ë„¤ì´ë²„ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    return { success: false, error: 'ë„¤ì´ë²„ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
                }
            }
            
            // ì†Œì…œ ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì²˜ë¦¬
            async handleSocialLoginCallback(user) {
                try {
                    // ì´ë¯¸ í”„ë¡œí•„ì´ ìˆëŠ”ì§€ í™•ì¸
                    const { data: existingProfile } = await supabase
                        .from('user_profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (!existingProfile) {
                        // ìƒˆ ì‚¬ìš©ì - í”„ë¡œí•„ ìƒì„±
                        const nickname = user.user_metadata?.full_name || 
                                        user.user_metadata?.name || 
                                        user.email?.split('@')[0] || 
                                        `ì‚¬ìš©ì${Math.floor(Math.random() * 1000)}`;
                        
                        const { error } = await supabase
                            .from('user_profiles')
                            .insert([{
                                id: user.id,
                                email: user.email,
                                nickname: nickname,
                                role: 'member',
                                provider: user.app_metadata?.provider || 'unknown'
                            }]);
                        
                        if (error) throw error;
                    }
                    
                    return { success: true };
                } catch (error) {
                    console.error('ì†Œì…œ ë¡œê·¸ì¸ í”„ë¡œí•„ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    return { success: false, error: error.message };
                }
            }
        }

        // ì „ì—­ ì¸ì¦ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤
        const authManager = new AuthManager();

        // ê°œì¸ì •ë³´ë™ì˜ ì²´í¬ë°•ìŠ¤ ì»´í¬ë„ŒíŠ¸
        const PrivacyConsentCheckbox = ({ checked, onChange }) => {
            return React.createElement('label', {
                className: "flex items-start space-x-3 cursor-pointer"
            }, [
                React.createElement('input', {
                    key: 'checkbox',
                    type: "checkbox",
                    checked: checked,
                    onChange: (e) => onChange(e.target.checked),
                    onClick: (e) => {
                        const newValue = !checked;
                        onChange(newValue);
                    },
                    className: "mt-1 h-4 w-4 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                }),
                React.createElement('div', {
                    key: 'content',
                    className: "flex-1"
                }, [
                    React.createElement('span', {
                        key: 'text',
                        className: "text-sm text-gray-800 font-medium"
                    }, [
                        'ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤ ',
                        React.createElement('span', {
                            key: 'required',
                            className: "text-red-500 ml-1"
                        }, '(í•„ìˆ˜)')
                    ]),
                    React.createElement('p', {
                        key: 'description',
                        className: "text-xs text-gray-500 mt-1"
                    }, 'ìœ„ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë‚´ìš©ì„ ì½ê³  ë™ì˜í•©ë‹ˆë‹¤')
                ])
            ]);
        };

        // ì „ë¬¸ê°€ìš© ê°œì¸ì •ë³´ìˆ˜ì§‘ì´ìš©ë™ì˜ì„œ ì»´í¬ë„ŒíŠ¸
        const ExpertPrivacyConsentComponent = ({ checked, onChange, termsChecked, onTermsChange }) => {
            const [showFullText, setShowFullText] = useState(false);

            return (
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <div className="mb-4">
                        <h3 className="text-lg font-semibold text-gray-800 mb-2">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h3>
                        <div className="text-sm text-gray-700 space-y-2">
                            <div className="bg-white p-3 rounded border">
                                <p><strong>â€¢ ìˆ˜ì§‘í•­ëª©:</strong> ì„±ëª…, ì´ë©”ì¼, ì—°ë½ì²˜, íšŒì‚¬ëª…, ì§ë¬´ë¶„ì•¼, ê²½ë ¥ì •ë³´, ì¬ì§ì¦ëª…ì„œ</p>
                                <p><strong>â€¢ ìˆ˜ì§‘ëª©ì :</strong> í˜„ì§ì ì‹ ì›í™•ì¸, ìê²©ê²€ì¦, ì·¨ì—…ë©˜í† ë§ ì„œë¹„ìŠ¤ ì œê³µ, ìˆ˜ìˆ˜ë£Œ ì •ì‚°</p>
                                <p><strong>â€¢ ë³´ìœ ê¸°ê°„:</strong> ì„œë¹„ìŠ¤ íƒˆí‡´ í›„ 5ë…„ (ì†Œë“ì„¸ë²•, ì „ììƒê±°ë˜ë²•)</p>
                                <p><strong>â€¢ ì œ3ì ì œê³µ:</strong> ë©˜í† ë§ ë§¤ì¹­ì„ ìœ„í•œ ìµœì†Œì •ë³´ë§Œ êµ¬ì§ìì—ê²Œ ì œê³µ</p>
                                <p className="text-red-600"><strong>â€¢ ë™ì˜ê±°ë¶€ê¶Œ:</strong> ë™ì˜ë¥¼ ê±°ë¶€í•  ìˆ˜ ìˆìœ¼ë‚˜, í˜„ì§ì ë“±ë¡ì´ ì œí•œë©ë‹ˆë‹¤</p>
                            </div>
                            
                            <button
                                type="button"
                                onClick={() => setShowFullText(!showFullText)}
                                className="text-blue-600 hover:text-blue-800 text-sm underline"
                            >
                                {showFullText ? 'ê°„ëµíˆ ë³´ê¸°' : 'ì „ë¬¸ ë³´ê¸°'}
                            </button>
                            
                            {showFullText && (
                                <div className="bg-white border border-gray-200 rounded p-4 text-xs text-gray-600 max-h-60 overflow-y-auto">
                                    <h4 className="font-semibold mb-2">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ (ì „ë¬¸)</h4>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <h5 className="font-medium">1. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì </h5>
                                            <p>- ì „ë¬¸ê°€ ì‹ ì› í™•ì¸ ë° ìê²© ê²€ì¦</p>
                                            <p>- ìƒë‹´ ì„œë¹„ìŠ¤ ì œê³µ ë° ë§¤ì¹­</p>
                                            <p>- ìˆ˜ìˆ˜ë£Œ ì •ì‚° ë° ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰</p>
                                            <p>- ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ í†µê³„ ë¶„ì„</p>
                                            <p>- ë²•ë ¹ìƒ ì˜ë¬´ì´í–‰ (ì „ììƒê±°ë˜ë²•, ì†Œë“ì„¸ë²• ë“±)</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">2. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª©</h5>
                                            <p><strong>í•„ìˆ˜í•­ëª©:</strong> ì„±ëª…, ì´ë©”ì¼, ì—°ë½ì²˜(íœ´ëŒ€í°), ì „ë¬¸ë¶„ì•¼, ê²½ë ¥ë…„ìˆ˜, ìê²©ì¦ ì •ë³´</p>
                                            <p><strong>ì„ íƒí•­ëª©:</strong> í”„ë¡œí•„ ì‚¬ì§„, ìƒì„¸ ì´ë ¥, ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</p>
                                            <p><strong>ìë™ìˆ˜ì§‘:</strong> IPì£¼ì†Œ, ì¿ í‚¤, ì ‘ì† ë¡œê·¸, ì„œë¹„ìŠ¤ ì´ìš©ê¸°ë¡</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</h5>
                                            <p>- ì„œë¹„ìŠ¤ ì´ìš©ê¸°ê°„ ì¤‘</p>
                                            <p>- ì„œë¹„ìŠ¤ íƒˆí‡´ í›„ 3ë…„ (ì „ììƒê±°ë˜ ë“±ì—ì„œì˜ ì†Œë¹„ìë³´í˜¸ì— ê´€í•œ ë²•ë¥ )</p>
                                            <p>- ì„¸ë²•ì— ë”°ë¥¸ ì¥ë¶€ë³´ê´€ì˜ë¬´: 5ë…„</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">4. ê°œì¸ì •ë³´ì˜ ì œ3ì ì œê³µ</h5>
                                            <p>- ìƒë‹´ ì‹ ì²­ ê³ ê°ì—ê²Œ ì „ë¬¸ê°€ í”„ë¡œí•„ ì •ë³´ ì œê³µ (ì„±ëª…, ì „ë¬¸ë¶„ì•¼, ê²½ë ¥, í›„ê¸°)</p>
                                            <p>- ì„¸ë¬´ ì‹ ê³ ë¥¼ ìœ„í•œ êµ­ì„¸ì²­ ì œê³µ (ë²•ì •ì˜ë¬´ì‚¬í•­)</p>
                                            <p>- ê¸°íƒ€ ë²•ë ¹ì— ì˜í•œ ì œê³µ</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">5. ê°œì¸ì •ë³´ì²˜ë¦¬ì˜ ìœ„íƒ</h5>
                                            <p>- ê²°ì œëŒ€í–‰ì‚¬: ìˆ˜ìˆ˜ë£Œ ì •ì‚° (PGì‚¬)</p>
                                            <p>- í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤: ë°ì´í„° ì €ì¥ (Supabase)</p>
                                            <p>- ì•Œë¦¼í†¡ ë°œì†¡: ì˜ˆì•½ í™•ì¸ ì•Œë¦¼ (ë¬¸ìì„œë¹„ìŠ¤)</p>
                                        </div>
                                        
                                        <div>
                                            <h5 className="font-medium">6. ì •ë³´ì£¼ì²´ì˜ ê¶Œë¦¬Â·ì˜ë¬´</h5>
                                            <p>- ê°œì¸ì •ë³´ ì—´ëŒÂ·ì •ì •Â·ì‚­ì œÂ·ì²˜ë¦¬ì •ì§€ ìš”êµ¬ê¶Œ</p>
                                            <p>- ì†í•´ë°°ìƒì²­êµ¬ê¶Œ</p>
                                            <p>- ê°œì¸ì •ë³´ë³´í˜¸ìœ„ì›íšŒ ì‹ ê³ ê¶Œ (privacy.go.kr, êµ­ë²ˆì—†ì´ 182)</p>
                                        </div>
                                        
                                        <div className="bg-yellow-50 border border-yellow-200 rounded p-2">
                                            <p className="text-red-700 font-medium">â€» ìœ„ ì‚¬í•­ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ìˆ˜ ìˆìœ¼ë‚˜, ë™ì˜ ê±°ë¶€ ì‹œ ì „ë¬¸ê°€ ë“±ë¡ ë° ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="space-y-3">
                        <div className="p-3 border rounded-lg" style={{
                            borderColor: checked ? '#ea580c' : '#d1d5db',
                            backgroundColor: checked ? '#fff7ed' : 'white'
                        }}>
                            <label 
                                className="flex items-center space-x-3 cursor-pointer"
                                onClick={() => {
                                    const newValue = !checked;
                                    if (onChange) {
                                        onChange(newValue);
                                    }
                                    
                                    // DOM ì§ì ‘ ì¡°ì‘ìœ¼ë¡œ ë™ê¸°í™”
                                    setTimeout(() => {
                                        const checkbox = document.getElementById('expert-privacy-checkbox-fixed');
                                        if (checkbox) checkbox.checked = newValue;
                                    }, 0);
                                }}
                            >
                                <input
                                    id="expert-privacy-checkbox-fixed"
                                    type="checkbox"
                                    readOnly
                                    className="mt-1 w-4 h-4 pointer-events-none"
                                    style={{ accentColor: '#ea580c' }}
                                />
                                <div className="flex-1 text-sm text-gray-800 font-medium select-none">
                                    [í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜
                                    <span className="text-red-500 ml-1">*</span>
                                </div>
                            </label>
                        </div>
                        <div className="p-3 border rounded-lg" style={{
                            borderColor: termsChecked ? '#ea580c' : '#d1d5db',
                            backgroundColor: termsChecked ? '#fff7ed' : 'white'
                        }}>
                            <label 
                                className="flex items-center space-x-3 cursor-pointer"
                                onClick={() => {
                                    const newValue = !termsChecked;
                                    if (onTermsChange) {
                                        onTermsChange(newValue);
                                    }
                                    
                                    // DOM ì§ì ‘ ì¡°ì‘ìœ¼ë¡œ ë™ê¸°í™”
                                    setTimeout(() => {
                                        const checkbox = document.getElementById('expert-terms-checkbox-fixed');
                                        if (checkbox) checkbox.checked = newValue;
                                    }, 0);
                                }}
                            >
                                <input
                                    id="expert-terms-checkbox-fixed"
                                    type="checkbox"
                                    readOnly
                                    className="mt-1 w-4 h-4 pointer-events-none"
                                    style={{ accentColor: '#ea580c' }}
                                />
                                <div className="flex-1 text-sm text-gray-800 font-medium select-none">
                                    [í•„ìˆ˜] í˜„ì§ì ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜
                                    <span className="text-red-500 ml-1">*</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            );
        };

        // íœ´ëŒ€í° ë²ˆí˜¸ ìë™ í¬ë§·íŒ… í•¨ìˆ˜
        const formatPhoneNumber = (value) => {
            // ìˆ«ìë§Œ ì¶”ì¶œ
            const numbers = value.replace(/[^\d]/g, '');
            
            // 11ìë¦¬ ì´ˆê³¼ì‹œ ìë¥´ê¸°
            if (numbers.length > 11) {
                return numbers.slice(0, 11);
            }
            
            // í¬ë§·íŒ…
            if (numbers.length <= 3) {
                return numbers;
            } else if (numbers.length <= 7) {
                return `${numbers.slice(0, 3)}-${numbers.slice(3)}`;
            } else {
                return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7)}`;
            }
        };

        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        const validatePassword = (password) => {
            const checks = {
                length: password.length >= 8,
                hasLetter: /[A-Za-z]/.test(password),
                hasNumber: /[0-9]/.test(password),
                hasSpecial: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            const typeCount = [checks.hasLetter, checks.hasNumber, checks.hasSpecial].filter(Boolean).length;
            
            return {
                isValid: checks.length && typeCount >= 2,
                checks: checks,
                typeCount: typeCount
            };
        };

        // ì „ë¬¸ê°€ ë“±ë¡ ì»´í¬ë„ŒíŠ¸ - 5ë‹¨ê³„ ë‹¤ë‹¨ê³„ ì‹œìŠ¤í…œ
        const ExpertRegistrationWizard = ({ 
            expertProfile, updateExpertProfile, expertCategories,
            specialtyInput, setSpecialtyInput,
            addSpecialty, removeSpecialty, setCurrentView 
        }) => {
            // í˜„ì¬ ë‹¨ê³„ ìƒíƒœ
            const [currentStep, setCurrentStep] = useState(1);
            
            // ê° ë‹¨ê³„ë³„ ë°ì´í„° ìƒíƒœ
            const [formData, setFormData] = useState({
                // 1ë‹¨ê³„: ê¸°ë³¸ì •ë³´ + ë™ì˜
                name: '',
                phone: '',
                email: '',
                agreePrivacy: false,
                agreeTerms: false,
                // 2ë‹¨ê³„: ì „ë¬¸ë¶„ì•¼
                category: '',
                experienceYears: '',
                keywords: '',
                // 3ë‹¨ê³„: ìê²©ê²€ì¦
                verificationType: '',
                businessNumber: '',
                licenseType: '',
                organization: '',
                experienceDescription: '',
                uploadedFiles: []
            });
            
            // ì „ë¬¸ë¶„ì•¼ ì¹´í…Œê³ ë¦¬ ë°ì´í„°
            const categories = {
                'travel': {
                    name: 'âœˆï¸ ì—¬í–‰/ì·¨ë¯¸'
                },
                'finance': {
                    name: 'ğŸ’° ì„¸ë¬´/ë²•ë¬´'
                },
            };
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            const updateFormData = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };
            
            // ë‹¨ê³„ ìœ íš¨ì„± ê²€ì‚¬
            const validateStep = (step) => {
                switch(step) {
                    case 1:
                        return formData.name && formData.phone && formData.email && 
                               formData.agreePrivacy && formData.agreeTerms;
                    case 2:
                        return formData.category && formData.experienceYears;
                    case 3:
                        const hasBasicInfo = formData.verificationType && (
                            (formData.verificationType === 'business' && formData.businessNumber) ||
                            (formData.verificationType === 'license' && formData.licenseType) ||
                            (formData.verificationType === 'organization' && formData.organization) ||
                            (formData.verificationType === 'experience' && formData.experienceDescription)
                        );
                        
                        // íŒŒì¼ ì—…ë¡œë“œê°€ í•„ìš”í•œ ê²€ì¦ ë°©ë²•ì˜ ê²½ìš° íŒŒì¼ë„ í™•ì¸
                        if (formData.verificationType === 'business' || formData.verificationType === 'license') {
                            const hasRequiredFiles = formData.uploadedFiles.some(
                                f => f.verificationType === formData.verificationType
                            );
                            return hasBasicInfo && hasRequiredFiles;
                        }
                        
                        return hasBasicInfo;
                    default:
                        return false;
                }
            };
            
            // ë‹¤ìŒ ë‹¨ê³„ë¡œ
            const nextStep = () => {
                if (validateStep(currentStep)) {
                    if (currentStep === 3) {
                        // 3ë‹¨ê³„ì—ì„œëŠ” ë°”ë¡œ ì œì¶œ
                        handleSubmit();
                    } else {
                        setCurrentStep(prev => Math.min(prev + 1, 3));
                    }
                }
            };
            
            // ì´ì „ ë‹¨ê³„ë¡œ
            const prevStep = () => {
                setCurrentStep(prev => Math.max(prev - 1, 1));
            };
            
            // ì·¨ì†Œ
            const handleCancel = () => {
                setCurrentView('login');
            };
            
            // ìµœì¢… ì œì¶œ
            const handleSubmit = async () => {
                try {
                    // ì „ì²´ ë°ì´í„°ë¥¼ expertProfileì— ì €ì¥
                    Object.keys(formData).forEach(key => {
                        updateExpertProfile(key, formData[key]);
                    });

                    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸
                    const currentUser = await authManager.getCurrentUser();
                    if (!currentUser) {
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        setCurrentView('login');
                        return;
                    }


                    // ê¸°ì¡´ ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ í™•ì¸ (ê²ŒìŠ¤íŠ¸ëŠ” ì´ë©”ì¼ë¡œ, íšŒì›ì€ user_idë¡œ)
                    let existingRequest = null;
                    let checkError = null;
                    
                    if (currentUser.isGuest) {
                        // ê²ŒìŠ¤íŠ¸ëŠ” ì´ë©”ì¼ë¡œ í™•ì¸
                        const { data, error } = await supabase
                            .from('professional_requests')
                            .select('id, status, created_at, email')
                            .eq('email', formData.email)
                            .eq('user_id', null)
                            .single();
                        existingRequest = data;
                        checkError = error;
                    } else {
                        // íšŒì›ì€ user_idë¡œ í™•ì¸
                        const { data, error } = await supabase
                            .from('professional_requests')
                            .select('id, status, created_at')
                            .eq('user_id', currentUser.id)
                            .single();
                        existingRequest = data;
                        checkError = error;
                    }

                    if (checkError && checkError.code !== 'PGRST116') {
                        // PGRST116 = No rows found (ì •ìƒ)
                        console.error('ê¸°ì¡´ ì‹ ì²­ í™•ì¸ ì˜¤ë¥˜:', checkError);
                    }

                    if (existingRequest) {
                        const statusText = existingRequest.status === 'pending' ? 'ìŠ¹ì¸ ëŒ€ê¸°' : 
                                          existingRequest.status === 'approved' ? 'ìŠ¹ì¸ ì™„ë£Œ' : 'ê±°ì ˆ';
                        const createdDate = new Date(existingRequest.created_at).toLocaleDateString('ko-KR');
                        
                        alert(`âš ï¸ ì´ë¯¸ ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ì„ í•˜ì…¨ìŠµë‹ˆë‹¤.\n\n` +
                              `ğŸ“… ì‹ ì²­ì¼: ${createdDate}\n` +
                              `ğŸ“Š í˜„ì¬ ìƒíƒœ: ${statusText}\n\n` +
                              `ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì´ì‹œë©´ ê³§ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n` +
                              `ë¬¸ì˜ì‚¬í•­ì€ ê´€ë¦¬ì(jwpaparoy@gmail.com)ì—ê²Œ ì—°ë½í•´ì£¼ì„¸ìš”.`);
                        return;
                    }

                    // Supabaseì— ì „ë¬¸ê°€ ë“±ë¡ ìš”ì²­ ì €ì¥
                    const expertRequestData = {
                        user_id: currentUser.isGuest ? null : currentUser.id,
                        name: formData.name,
                        phone: formData.phone,
                        email: formData.email,
                        category: formData.category,
                        experience_years: formData.experienceYears,
                        keywords: formData.keywords,
                        verification_type: formData.verificationType,
                        business_number: formData.businessNumber || null,
                        license_type: formData.licenseType || null,
                        organization: formData.organization || null,
                        experience_description: formData.experienceDescription || null,
                        status: 'pending', // ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    };

                    console.log('ì „ë¬¸ê°€ ë“±ë¡ ìš”ì²­ ì €ì¥:', expertRequestData);

                    // expert_requests í…Œì´ë¸”ì— ì €ì¥
                    const { data, error } = await supabase
                        .from('professional_requests')
                        .insert([expertRequestData])
                        .select();

                    if (error) {
                        console.error('ì „ë¬¸ê°€ ë“±ë¡ ìš”ì²­ ì €ì¥ ì˜¤ë¥˜:', error);
                        
                        // êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ìƒì„±
                        let errorMessage = 'ì „ë¬¸ê°€ ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n';
                        
                        if (error.code === '23505' || error.message?.includes('duplicate') || error.message?.includes('already exists')) {
                            errorMessage += 'âš ï¸ ì´ë¯¸ ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ì„ í•˜ì‹  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.\n\n';
                            errorMessage += 'ğŸ“§ ê¸°ì¡´ ì‹ ì²­ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì‹¶ìœ¼ì‹œë©´ ê´€ë¦¬ì(jwpaparoy@gmail.com)ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.\n';
                            errorMessage += 'âœ… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì´ë¼ë©´ ê³§ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
                        } else if (error.code === '23503' || error.message?.includes('foreign key')) {
                            errorMessage += 'ğŸ” ë¡œê·¸ì¸ ì •ë³´ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\n\n';
                            errorMessage += 'ë‹¤ì‹œ ë¡œê·¸ì¸ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else if (error.code === '42501' || error.message?.includes('permission') || error.message?.includes('policy')) {
                            errorMessage += 'ğŸš« ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\n\n';
                            errorMessage += 'ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        } else if (error.message?.includes('network') || error.message?.includes('timeout')) {
                            errorMessage += 'ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\n\n';
                            errorMessage += 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else {
                            errorMessage += `ğŸ” ì˜¤ë¥˜ ìƒì„¸ ì •ë³´:\n${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}\n\n`;
                            errorMessage += 'ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì‹¤ ë•Œ ìœ„ ì •ë³´ë¥¼ í•¨ê»˜ ì•Œë ¤ì£¼ì‹œë©´ ë” ë¹ ë¥¸ í•´ê²°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                        }
                        
                        alert(errorMessage);
                        return;
                    }

                    console.log('ì „ë¬¸ê°€ ë“±ë¡ ìš”ì²­ ì €ì¥ ì™„ë£Œ:', data);
                    
                    alert(`ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰

ğŸ“‹ ì œì¶œëœ ì •ë³´:
â€¢ ì´ë¦„: ${formData.name}
â€¢ ì „ë¬¸ë¶„ì•¼: ${categories[formData.category]?.name}
â€¢ ê²€ì¦ë°©ë²•: ${formData.verificationType}

ğŸ“ ê´€ë¦¬ì ê²€í†  í›„ 3-5ì¼ ë‚´ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ğŸ“§ ìŠ¹ì¸ ê²°ê³¼ë¥¼ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë¦´ê²Œìš”.`);
                    
                    setCurrentView('login');
                    
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ë“±ë¡ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    
                    let errorMessage = 'ì „ë¬¸ê°€ ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n';
                    
                    if (error.message?.includes('getCurrentUser')) {
                        errorMessage += 'ğŸ” ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                        errorMessage += 'ë‹¤ì‹œ ë¡œê·¸ì¸ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message?.includes('network') || error.name === 'NetworkError') {
                        errorMessage += 'ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œì…ë‹ˆë‹¤.\n\n';
                        errorMessage += 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else {
                        errorMessage += `ğŸ” ì˜¤ë¥˜ ì •ë³´: ${error.message || error.toString()}\n\n`;
                        errorMessage += 'ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ê´€ë¦¬ì(jwpaparoy@gmail.com)ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                    }
                    
                    alert(errorMessage);
                }
            };
            
            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì»´í¬ë„ŒíŠ¸
            const renderProgressBar = () => {
                return React.createElement('div', {
                    key: 'progress',
                    className: 'mb-8'
                }, [
                    React.createElement('div', {
                        key: 'steps',
                        className: 'flex items-center justify-center mb-4'
                    }, Array.from({length: 3}, (_, i) => {
                        const stepNum = i + 1;
                        const isActive = stepNum <= currentStep;
                        return React.createElement('div', {
                            key: stepNum,
                            className: 'flex items-center'
                        }, [
                            React.createElement('div', {
                                key: 'circle',
                                className: `w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${
                                    isActive ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-400'
                                }`
                            }, stepNum),
                            ...(stepNum < 3 ? [React.createElement('div', {
                                key: 'line',
                                className: `w-16 h-1 mx-4 ${stepNum < currentStep ? 'bg-orange-500' : 'bg-gray-200'}`
                            })] : [])
                        ]);
                    })),
                    React.createElement('div', {
                        key: 'step-title',
                        className: 'text-center text-sm text-gray-600'
                    }, [
                        '1ë‹¨ê³„: ê¸°ë³¸ì •ë³´ ë° ë™ì˜', '2ë‹¨ê³„: ì „ë¬¸ë¶„ì•¼', '3ë‹¨ê³„: ìê²©ê²€ì¦'
                    ][currentStep - 1])
                ]);
            };
            
            // 1ë‹¨ê³„: ê¸°ë³¸ì •ë³´ + ë™ì˜
            const renderStep1BasicInfo = () => {
                // DOM ì¡°ì‘ì„ setTimeoutìœ¼ë¡œ ëŒ€ì²´ (useEffect ì œê±°)
                setTimeout(() => {
                    const privacyCheckbox = document.getElementById('privacy-agree-checkbox');
                    const termsCheckbox = document.getElementById('terms-agree-checkbox');
                    
                    if (privacyCheckbox) {
                        privacyCheckbox.checked = formData.agreePrivacy;
                    }
                    if (termsCheckbox) {
                        termsCheckbox.checked = formData.agreeTerms;
                    }
                }, 0);
                
                return React.createElement('div', {
                    key: 'step1',
                    className: 'space-y-6'
                }, [
                    React.createElement('h3', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-800'
                    }, 'ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”'),
                    
                    // ê¸°ë³¸ì •ë³´ ì„¹ì…˜
                    React.createElement('div', {
                        key: 'basic-info',
                        className: 'space-y-4'
                    }, [
                        React.createElement('div', {
                            key: 'name-field'
                        }, [
                            React.createElement('label', {
                                key: 'label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'ì´ë¦„ *'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'text',
                                value: formData.name,
                                onChange: (e) => updateFormData('name', e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                                placeholder: 'ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'
                            })
                        ]),
                        
                        React.createElement('div', {
                            key: 'phone-field'
                        }, [
                            React.createElement('label', {
                                key: 'label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'ì „í™”ë²ˆí˜¸ *'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'tel',
                                value: formData.phone,
                                onChange: (e) => updateFormData('phone', e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                                placeholder: '010-1234-5678'
                            })
                        ]),
                        
                        React.createElement('div', {
                            key: 'email-field'
                        }, [
                            React.createElement('label', {
                                key: 'label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'ì´ë©”ì¼ *'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'email',
                                value: formData.email,
                                onChange: (e) => updateFormData('email', e.target.value),
                                className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                                placeholder: 'example@email.com'
                            })
                        ])
                    ]),
                    
                    // êµ¬ë¶„ì„ 
                    React.createElement('div', {
                        key: 'divider',
                        className: 'border-t border-gray-200 my-6'
                    }),
                    
                    // ì•½ê´€ ë™ì˜ ì„¹ì…˜
                    React.createElement('div', {
                        key: 'agreements',
                        className: 'space-y-4'
                    }, [
                        React.createElement('h4', {
                            key: 'agreement-title',
                            className: 'font-semibold text-gray-800'
                        }, 'ì•½ê´€ ë™ì˜'),
                        
                        // ê°œì¸ì •ë³´ ìˆ˜ì§‘ì´ìš©ë™ì˜
                        React.createElement('div', {
                            key: 'privacy-agreement',
                            className: 'border border-gray-200 rounded-lg p-4'
                        }, [
                            React.createElement('label', {
                                key: 'privacy-label',
                                className: 'flex items-start cursor-pointer'
                            }, [
                                React.createElement('input', {
                                    key: 'privacy-checkbox',
                                    type: 'checkbox',
                                    id: 'privacy-agree-checkbox',
                                    onClick: (e) => {
                                        console.log('Privacy checkbox clicked, current state:', formData.agreePrivacy);
                                        const newValue = !formData.agreePrivacy;
                                        updateFormData('agreePrivacy', newValue);
                                        console.log('Updated to:', newValue);
                                    },
                                    className: 'w-4 h-4 text-orange-600 mt-1 mr-3 cursor-pointer',
                                    style: {
                                        pointerEvents: 'auto !important',
                                        position: 'relative',
                                        zIndex: 999
                                    }
                                }),
                                React.createElement('div', {
                                    key: 'privacy-content'
                                }, [
                                    React.createElement('span', {
                                        key: 'privacy-title',
                                        className: 'font-medium text-gray-900'
                                    }, '[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜'),
                                    React.createElement('div', {
                                        key: 'privacy-details',
                                        className: 'text-xs text-gray-600 mt-2 bg-gray-50 p-3 rounded'
                                    }, [
                                        React.createElement('p', { key: 'collect' }, 'â€¢ ìˆ˜ì§‘í•­ëª©: ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼, ì „ë¬¸ë¶„ì•¼, ìê²©ì •ë³´'),
                                        React.createElement('p', { key: 'purpose' }, 'â€¢ ì´ìš©ëª©ì : í˜„ì§ì ë“±ë¡ ë° ìŠ¹ì¸, ì„œë¹„ìŠ¤ ì œê³µ, ë©˜í† ë§ ë§¤ì¹­'),
                                        React.createElement('p', { key: 'period' }, 'â€¢ ë³´ìœ ê¸°ê°„: íšŒì› íƒˆí‡´ ì‹œê¹Œì§€ (ê´€ê³„ë²•ë ¹ì— ì˜í•´ ë³´ì¡´ í•„ìš”ì‹œ ì˜ˆì™¸)')
                                    ])
                                ])
                            ])
                        ]),
                        
                        // ì „ë¬¸ê°€ ì„œë¹„ìŠ¤ ì•½ê´€ë™ì˜
                        React.createElement('div', {
                            key: 'terms-agreement',
                            className: 'border border-gray-200 rounded-lg p-4'
                        }, [
                            React.createElement('label', {
                                key: 'terms-label',
                                className: 'flex items-start cursor-pointer'
                            }, [
                                React.createElement('input', {
                                    key: 'terms-checkbox',
                                    type: 'checkbox',
                                    id: 'terms-agree-checkbox',
                                    onClick: (e) => {
                                        console.log('Terms checkbox clicked, current state:', formData.agreeTerms);
                                        const newValue = !formData.agreeTerms;
                                        updateFormData('agreeTerms', newValue);
                                        console.log('Updated to:', newValue);
                                    },
                                    className: 'w-4 h-4 text-orange-600 mt-1 mr-3 cursor-pointer',
                                    style: {
                                        pointerEvents: 'auto !important',
                                        position: 'relative',
                                        zIndex: 999
                                    }
                                }),
                                React.createElement('div', {
                                    key: 'terms-content'
                                }, [
                                    React.createElement('span', {
                                        key: 'terms-title',
                                        className: 'font-medium text-gray-900'
                                    }, '[í•„ìˆ˜] ì „ë¬¸ê°€ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜'),
                                    React.createElement('div', {
                                        key: 'terms-details',
                                        className: 'text-xs text-gray-600 mt-2 bg-gray-50 p-3 rounded'
                                    }, [
                                        React.createElement('p', { key: 'verify' }, 'â€¢ ì œì¶œí•˜ì‹  ìê²©ì •ë³´ì˜ ì§„ìœ„ì—¬ë¶€ í™•ì¸ì— ë™ì˜'),
                                        React.createElement('p', { key: 'quality' }, 'â€¢ í˜„ì§ìë¡œì„œ ì–‘ì§ˆì˜ ë©˜í† ë§ ì„œë¹„ìŠ¤ ì œê³µ ì˜ë¬´'),
                                        React.createElement('p', { key: 'rules' }, 'â€¢ í”Œë«í¼ ìš´ì˜ì •ì±… ë° ìƒë‹´ ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜'),
                                        React.createElement('p', { key: 'suspension' }, 'â€¢ ë¶€ì ì ˆí•œ ì„œë¹„ìŠ¤ ì œê³µì‹œ ê³„ì • ì •ì§€ ê°€ëŠ¥')
                                    ])
                                ])
                            ])
                        ])
                    ])
                ]);
            };
            
            // 2ë‹¨ê³„: ì „ë¬¸ë¶„ì•¼ ì„ íƒ
            const renderStep2Expertise = () => {
                // ì¹´í…Œê³ ë¦¬ ê°ì²´ ì™„ì „ ë…ë¦½ ì •ì˜
                const expertCategories = {
                    'travel': {
                        name: 'âœˆï¸ ì—¬í–‰/ì·¨ë¯¸'
                    },
                    'finance': {
                        name: 'ğŸ’° ì„¸ë¬´/ë²•ë¬´'
                    },
                };
                
                
                const elements = [
                    React.createElement('h3', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-800'
                    }, 'ì „ë¬¸ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'),
                    
                    // ì¹´í…Œê³ ë¦¬ ì„ íƒ
                    React.createElement('div', {
                        key: 'category-section'
                    }, [
                        React.createElement('label', {
                            key: 'category-label',
                            className: 'block text-sm font-medium text-gray-700 mb-3'
                        }, 'ì£¼ìš” ì¹´í…Œê³ ë¦¬ *'),
                        React.createElement('div', {
                            key: 'category-grid',
                            className: 'grid grid-cols-1 sm:grid-cols-2 gap-3'
                        }, Object.entries(expertCategories).map(([key, category]) =>
                            React.createElement('label', {
                                key: key,
                                className: `flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ${
                                    formData.category === key 
                                        ? 'border-orange-500 bg-orange-50' 
                                        : 'border-gray-200 hover:border-gray-300'
                                }`,
                                onClick: () => {
                                    updateFormData('category', key);
                                }
                            }, [
                                React.createElement('input', {
                                    key: 'radio',
                                    type: 'radio',
                                    name: 'category',
                                    value: key,
                                    checked: formData.category === key,
                                    readOnly: true,
                                    className: 'w-4 h-4 text-orange-600 mr-3 pointer-events-none'
                                }),
                                React.createElement('span', {
                                    key: 'text',
                                    className: 'font-medium'
                                }, category.name)
                            ])
                        ))
                    ]),
                    
                    // ê²½ë ¥ ì—°ìˆ˜
                    React.createElement('div', {
                        key: 'experience-section'
                    }, [
                        React.createElement('label', {
                            key: 'experience-label',
                            className: 'block text-sm font-medium text-gray-700 mb-3'
                        }, 'ê´€ë ¨ ê²½ë ¥ ì—°ìˆ˜ *'),
                        React.createElement('select', {
                            key: 'experience-select',
                            value: formData.experienceYears,
                            onChange: (e) => updateFormData('experienceYears', e.target.value),
                            className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500'
                        }, [
                            React.createElement('option', {
                                key: 'default',
                                value: ''
                            }, 'ê²½ë ¥ì„ ì„ íƒí•˜ì„¸ìš”'),
                            React.createElement('option', {
                                key: '1-3',
                                value: '1-3ë…„'
                            }, '1-3ë…„'),
                            React.createElement('option', {
                                key: '3-5',
                                value: '3-5ë…„'
                            }, '3-5ë…„'),
                            React.createElement('option', {
                                key: '5-10',
                                value: '5-10ë…„'
                            }, '5-10ë…„'),
                            React.createElement('option', {
                                key: '10+',
                                value: '10ë…„ ì´ìƒ'
                            }, '10ë…„ ì´ìƒ')
                        ])
                    ]),
                    
                    // í‚¤ì›Œë“œ ì…ë ¥
                    React.createElement('div', {
                        key: 'keywords-section'
                    }, [
                        React.createElement('label', {
                            key: 'keywords-label',
                            className: 'block text-sm font-medium text-gray-700 mb-2'
                        }, 'ì „ë¬¸ì„± í‚¤ì›Œë“œ (ì„ íƒ)'),
                        React.createElement('input', {
                            key: 'keywords-input',
                            type: 'text',
                            value: formData.keywords,
                            onChange: (e) => updateFormData('keywords', e.target.value),
                            className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                            placeholder: 'ì˜ˆ: ì›¹ê°œë°œ, ë°ì´í„°ë¶„ì„, í”„ë¡œì íŠ¸ê´€ë¦¬ ë“±'
                        }),
                        React.createElement('p', {
                            key: 'keywords-helper',
                            className: 'text-xs text-gray-500 mt-1'
                        }, 'ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•´ì„œ ì…ë ¥í•˜ì„¸ìš”'),
                        // í‚¤ì›Œë“œ íƒœê·¸ í‘œì‹œ
                        formData.keywords && formData.keywords.trim() ? React.createElement('div', {
                            key: 'keywords-tags',
                            className: 'flex flex-wrap gap-2 mt-3'
                        }, formData.keywords.split(',').map(keyword => {
                            const trimmed = keyword.trim();
                            return trimmed ? React.createElement('span', {
                                key: trimmed,
                                className: 'inline-flex items-center px-3 py-1 rounded-full text-sm bg-orange-100 text-orange-800 border border-orange-200'
                            }, [
                                React.createElement('span', {
                                    key: 'text'
                                }, trimmed),
                                React.createElement('button', {
                                    key: 'remove',
                                    type: 'button',
                                    className: 'ml-2 text-orange-600 hover:text-orange-800',
                                    onClick: () => {
                                        const newKeywords = formData.keywords
                                            .split(',')
                                            .filter(k => k.trim() !== trimmed)
                                            .join(',')
                                            .replace(/^,+|,+$/g, '') // ì•ë’¤ ì½¤ë§ˆ ì œê±°
                                            .replace(/,+/g, ','); // ì¤‘ë³µ ì½¤ë§ˆ ì œê±°
                                        updateFormData('keywords', newKeywords);
                                    }
                                }, 'Ã—')
                            ]) : null;
                        }).filter(Boolean)) : null
                    ])
                ];
                

                return React.createElement('div', {
                    key: 'step2',
                    className: 'space-y-6'
                }, elements);
            };
            
            // 3ë‹¨ê³„: ìê²© ê²€ì¦
            const renderStep3Verification = () => {
                const verificationOptions = [
                    {
                        id: 'business',
                        icon: 'ğŸ“„',
                        title: 'ì‚¬ì—…ìë“±ë¡ì¦',
                        description: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì…ë ¥ + ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ ì—…ë¡œë“œ',
                        inputLabel: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸',
                        inputPlaceholder: '123-45-67890',
                        fieldName: 'businessNumber',
                        needsFile: true,
                        fileTypes: '.pdf,.jpg,.jpeg,.png'
                    },
                    {
                        id: 'license',
                        icon: 'ğŸ“',
                        title: 'ì „ë¬¸ ìê²©ì¦',
                        description: 'ìê²©ì¦ëª… ì…ë ¥ + ìê²©ì¦ íŒŒì¼ ì—…ë¡œë“œ',
                        inputLabel: 'ìê²©ì¦ëª…',
                        inputPlaceholder: 'ì˜ˆ: ê³µì¸íšŒê³„ì‚¬, ë³€í˜¸ì‚¬, ì„¸ë¬´ì‚¬, ê³µì¸ì¤‘ê°œì‚¬',
                        fieldName: 'licenseType',
                        needsFile: true,
                        fileTypes: '.pdf,.jpg,.jpeg,.png'
                    },
                    {
                        id: 'organization',
                        icon: 'ğŸ¢',
                        title: 'ì†Œì†ê¸°ê´€',
                        description: 'ê¸°ê´€ëª… ì…ë ¥ + ì¬ì§ì¦ëª…ì„œ/ëª…í•¨ ì—…ë¡œë“œ (ì„ íƒ)',
                        inputLabel: 'ê¸°ê´€ëª…',
                        inputPlaceholder: 'ì˜ˆ: OOì»¨ì„¤íŒ…, OOëŒ€í•™êµ, OOí˜‘íšŒ',
                        fieldName: 'organization',
                        needsFile: false,
                        fileTypes: '.pdf,.jpg,.jpeg,.png'
                    },
                    {
                        id: 'experience',
                        icon: 'ğŸ‘¤',
                        title: 'ê²½ë ¥ ê¸°ë°˜',
                        description: 'êµ¬ì²´ì ì¸ ê²½ë ¥ ë‚´ìš© ì‘ì„± + ê´€ë¦¬ì ê²€í†  (7-10ì¼ ì†Œìš”)',
                        inputLabel: 'ê²½ë ¥ ìƒì„¸ ì„¤ëª…',
                        inputPlaceholder: 'ì˜ˆ: OOê¸°ì—… ì›¹ê°œë°œ 5ë…„, í’€ìŠ¤íƒ ê°œë°œ ê²½í—˜ 3ë…„, AWS ìê²©ì¦ ë³´ìœ  ë“±',
                        fieldName: 'experienceDescription',
                        needsFile: false
                    }
                ];
                
                // íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
                const handleFileUpload = (e) => {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        const newFiles = files.map(file => ({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            file: file
                        }));
                        
                        updateFormData('uploadedFiles', [
                            ...formData.uploadedFiles.filter(f => f.verificationType !== formData.verificationType),
                            ...newFiles.map(f => ({ ...f, verificationType: formData.verificationType }))
                        ]);
                    }
                };
                
                // íŒŒì¼ ì‚­ì œ í•¸ë“¤ëŸ¬
                const removeFile = (fileName) => {
                    updateFormData('uploadedFiles', 
                        formData.uploadedFiles.filter(f => f.name !== fileName)
                    );
                };
                
                // í˜„ì¬ ì„ íƒëœ ê²€ì¦ ë°©ë²•ì˜ ì—…ë¡œë“œëœ íŒŒì¼ë“¤
                const currentFiles = formData.uploadedFiles.filter(
                    f => f.verificationType === formData.verificationType
                );
                
                return React.createElement('div', {
                    key: 'step3',
                    className: 'space-y-6'
                }, [
                    React.createElement('h3', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-800'
                    }, 'ìê²© í™•ì¸ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”'),
                    
                    
                    React.createElement('div', {
                        key: 'options',
                        className: 'space-y-3'
                    }, verificationOptions.map(option =>
                        React.createElement('div', {
                            key: option.id,
                            className: 'space-y-3'
                        }, [
                            // ë¼ë””ì˜¤ ë²„íŠ¼ ì˜µì…˜
                            React.createElement('label', {
                                key: 'option',
                                className: `flex items-start p-4 border-2 rounded-lg cursor-pointer transition-all ${
                                    formData.verificationType === option.id
                                        ? 'border-orange-500 bg-orange-50'
                                        : 'border-gray-200 hover:border-gray-300'
                                }`,
                                onClick: () => {
                                    updateFormData('verificationType', option.id);
                                    // ë‹¤ë¥¸ í•„ë“œë“¤ ì´ˆê¸°í™”
                                    updateFormData('businessNumber', '');
                                    updateFormData('licenseType', '');
                                    updateFormData('organization', '');
                                    updateFormData('experienceDescription', '');
                                }
                            }, [
                                React.createElement('input', {
                                    key: 'radio',
                                    type: 'radio',
                                    name: 'verificationType',
                                    value: option.id,
                                    checked: formData.verificationType === option.id,
                                    readOnly: true,
                                    className: 'w-4 h-4 text-orange-600 mt-1 mr-3 pointer-events-none'
                                }),
                                React.createElement('div', {
                                    key: 'content',
                                    className: 'flex-1'
                                }, [
                                    React.createElement('div', {
                                        key: 'header',
                                        className: 'flex items-center mb-2'
                                    }, [
                                        React.createElement('span', {
                                            key: 'icon',
                                            className: 'text-lg mr-2'
                                        }, option.icon),
                                        React.createElement('span', {
                                            key: 'title',
                                            className: 'font-medium text-gray-900'
                                        }, option.title)
                                    ]),
                                    React.createElement('p', {
                                        key: 'desc',
                                        className: 'text-sm text-gray-600'
                                    }, option.description)
                                ])
                            ]),
                            
                            // ì…ë ¥ í•„ë“œ (í•´ë‹¹ ì˜µì…˜ ì„ íƒëœ ê²½ìš°ë§Œ)
                            formData.verificationType === option.id && option.inputLabel ? React.createElement('div', {
                                key: 'input-section',
                                className: 'ml-7 p-4 bg-gray-50 border border-gray-200 rounded-lg space-y-4'
                            }, [
                                // í…ìŠ¤íŠ¸ ì…ë ¥
                                React.createElement('div', {
                                    key: 'text-input'
                                }, [
                                    React.createElement('label', {
                                        key: 'input-label',
                                        className: 'block text-sm font-medium text-gray-700 mb-2'
                                    }, `${option.inputLabel} *`),
                                    // ê²½ë ¥ ì„¤ëª…ì€ textarea, ë‚˜ë¨¸ì§€ëŠ” input
                                    option.fieldName === 'experienceDescription' ? 
                                    React.createElement('textarea', {
                                        key: 'textarea',
                                        value: formData[option.fieldName] || '',
                                        onChange: (e) => updateFormData(option.fieldName, e.target.value),
                                        className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                                        placeholder: option.inputPlaceholder,
                                        rows: 4
                                    }) :
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'text',
                                        value: formData[option.fieldName] || '',
                                        onChange: (e) => updateFormData(option.fieldName, e.target.value),
                                        className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500',
                                        placeholder: option.inputPlaceholder
                                    })
                                ]),
                                
                                // íŒŒì¼ ì—…ë¡œë“œ (í•„ìš”í•œ ê²½ìš°)
                                React.createElement('div', {
                                    key: 'file-upload'
                                }, [
                                    React.createElement('label', {
                                        key: 'file-label',
                                        className: 'block text-sm font-medium text-gray-700 mb-2'
                                    }, `ì¦ë¹™ì„œë¥˜ ì—…ë¡œë“œ ${option.needsFile ? '*' : '(ì„ íƒ)'}`),
                                    
                                    // íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼
                                    React.createElement('div', {
                                        key: 'upload-area',
                                        className: 'border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-orange-400 transition-colors'
                                    }, [
                                        React.createElement('input', {
                                            key: 'file-input',
                                            type: 'file',
                                            accept: option.fileTypes,
                                            multiple: true,
                                            onChange: handleFileUpload,
                                            className: 'hidden',
                                            id: `file-upload-${option.id}`
                                        }),
                                        React.createElement('label', {
                                            key: 'file-button',
                                            htmlFor: `file-upload-${option.id}`,
                                            className: 'cursor-pointer'
                                        }, [
                                            React.createElement('div', {
                                                key: 'upload-content',
                                                className: 'text-gray-600'
                                            }, [
                                                React.createElement('div', {
                                                    key: 'icon',
                                                    className: 'text-2xl mb-2'
                                                }, 'ğŸ“'),
                                                React.createElement('p', {
                                                    key: 'text',
                                                    className: 'text-sm'
                                                }, 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”'),
                                                React.createElement('p', {
                                                    key: 'format',
                                                    className: 'text-xs text-gray-500 mt-1'
                                                }, 'PDF, JPG, PNG íŒŒì¼ (ìµœëŒ€ 5MB)')
                                            ])
                                        ])
                                    ]),
                                    
                                    // ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡
                                    currentFiles.length > 0 ? React.createElement('div', {
                                        key: 'file-list',
                                        className: 'mt-3 space-y-2'
                                    }, currentFiles.map((file, index) =>
                                        React.createElement('div', {
                                            key: index,
                                            className: 'flex items-center justify-between p-2 bg-white border rounded'
                                        }, [
                                            React.createElement('div', {
                                                key: 'file-info',
                                                className: 'flex items-center'
                                            }, [
                                                React.createElement('span', {
                                                    key: 'file-icon',
                                                    className: 'text-green-500 mr-2'
                                                }, 'âœ“'),
                                                React.createElement('span', {
                                                    key: 'file-name',
                                                    className: 'text-sm text-gray-800'
                                                }, file.name),
                                                React.createElement('span', {
                                                    key: 'file-size',
                                                    className: 'text-xs text-gray-500 ml-2'
                                                }, `(${Math.round(file.size / 1024)}KB)`)
                                            ]),
                                            React.createElement('button', {
                                                key: 'remove-btn',
                                                onClick: () => removeFile(file.name),
                                                className: 'text-red-500 hover:text-red-700 text-sm'
                                            }, 'ì‚­ì œ')
                                        ])
                                    )) : null,
                                    
                                    React.createElement('p', {
                                        key: 'helper',
                                        className: 'text-xs text-gray-500 mt-2'
                                    }, option.needsFile ? 
                                        'ì¦ë¹™ì„œë¥˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤. ëª…í™•í•œ ì‚¬ì§„ì´ë‚˜ ìŠ¤ìº”ë³¸ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.' :
                                        'ì¦ë¹™ì„œë¥˜ê°€ ìˆìœ¼ë©´ ë” ë¹ ë¥¸ ìŠ¹ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.')
                                ])
                            ]) : null
                        ])
                    )),
                    
                    // ê²½ë ¥ ê¸°ë°˜ ì„ íƒì‹œ ì¶”ê°€ ì•ˆë‚´
                    formData.verificationType === 'experience' ? React.createElement('div', {
                        key: 'experience-info',
                        className: 'ml-7 p-4 bg-purple-50 border border-purple-200 rounded-lg'
                    }, [
                        React.createElement('h4', {
                            key: 'title',
                            className: 'font-medium text-purple-800 mb-2'
                        }, 'ğŸ“‹ ê²½ë ¥ ê¸°ë°˜ ì‹¬ì‚¬ ì ˆì°¨'),
                        React.createElement('ul', {
                            key: 'list',
                            className: 'text-sm text-purple-700 space-y-1'
                        }, [
                            React.createElement('li', { key: '1' }, 'â€¢ 2ë‹¨ê³„ì—ì„œ ì…ë ¥í•˜ì‹  ê²½ë ¥ ì •ë³´ë¥¼ ìƒì„¸íˆ ê²€í† í•©ë‹ˆë‹¤'),
                            React.createElement('li', { key: '2' }, 'â€¢ í•„ìš”ì‹œ ì „í™” ë©´ë‹´ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤'),
                            React.createElement('li', { key: '3' }, 'â€¢ ì‹¬ì‚¬ ê¸°ê°„ì€ 7-10ì¼ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤'),
                            React.createElement('li', { key: '4' }, 'â€¢ ìŠ¹ì¸ ì‹œ ë°”ë¡œ ì „ë¬¸ê°€ í™œë™ì„ ì‹œì‘í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤')
                        ])
                    ]) : null
                ]);
            };
            
            // 3ë‹¨ê³„ ì „ë¬¸ê°€ ë“±ë¡ ì‹œìŠ¤í…œ ì™„ì„±!
            
            // ë©”ì¸ ë Œë”ë§
            return React.createElement('div', {
                className: 'max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6 sm:p-8'
            }, [
                React.createElement('div', {
                    key: 'header',
                    className: 'text-center mb-8'
                }, [
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-3xl font-bold text-gray-800'
                    }, 'ğŸ¯ ì „ë¬¸ê°€ ë“±ë¡'),
                    React.createElement('p', {
                        key: 'desc',
                        className: 'text-gray-600 mt-2'
                    }, 'ì „ë¬¸ê°€ë¡œ ë“±ë¡í•˜ê³  ìˆ˜ìµì„ ì–»ì–´ë³´ì„¸ìš”!')
                ]),
                
                renderProgressBar(),
                
                React.createElement('div', {
                    key: 'content',
                    className: 'min-h-[400px] mb-8'
                }, [
                    currentStep === 1 ? renderStep1BasicInfo() : null,
                    currentStep === 2 ? renderStep2Expertise() : null,
                    currentStep === 3 ? renderStep3Verification() : null
                ].filter(Boolean)),
                
                React.createElement('div', {
                    key: 'navigation',
                    className: 'flex justify-between'
                }, [
                    React.createElement('button', {
                        key: 'prev',
                        onClick: currentStep === 1 ? handleCancel : prevStep,
                        className: 'px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50'
                    }, currentStep === 1 ? 'ì·¨ì†Œ' : 'ì´ì „'),
                    
                    React.createElement('button', {
                        key: 'next',
                        onClick: nextStep, // nextStep í•¨ìˆ˜ì—ì„œ 3ë‹¨ê³„ì¼ ë•Œ handleSubmit í˜¸ì¶œ
                        disabled: !validateStep(currentStep),
                        className: 'px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed'
                    }, currentStep === 3 ? 'ë“±ë¡ ì‹ ì²­ ì™„ë£Œ' : 'ë‹¤ìŒ')
                ])
            ]);
        };

        // í˜¸í™˜ì„±ì„ ìœ„í•œ ë³„ì¹­
        const ExpertProfileForm = ExpertRegistrationWizard;

        // ë§ˆì´í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        const MyPageComponent = ({ currentUser, onClose, getUserType, getUserTypeName, isAdminUser, isGuest, setCurrentView, setFormData, setCalculatorResult, setCalculatorStep, showNotification }) => {
            const [userType, setUserType] = useState('member');
            const [userTypeName, setUserTypeName] = useState('ì¼ë°˜íšŒì›');
            const [activeTab, setActiveTab] = useState('profile');
            const [showRefundModal, setShowRefundModal] = useState(false);
            const [selectedPayment, setSelectedPayment] = useState(null);
            const [refundReason, setRefundReason] = useState('');
            const [refundLoading, setRefundLoading] = useState(false);
            
            // ì‚¬ìš©ì íƒ€ì… í™•ì¸ (async)
            useEffect(() => {
                const checkUserType = async () => {
                    const type = await getUserType(currentUser);
                    const typeName = getUserTypeName(type);
                    setUserType(type);
                    setUserTypeName(typeName);
                };
                
                if (currentUser) {
                    checkUserType();
                }
            }, [currentUser]);

            // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìëŠ” ë‚´ ì •ë³´ë§Œ ì‚¬ìš© ê°€ëŠ¥ - currentUser.isGuest ì‚¬ìš©
            const isCurrentUserGuest = currentUser?.isGuest;
            const tabs = [
                { id: 'profile', name: 'ë‚´ ì •ë³´', icon: 'ğŸ‘¤' },
                // ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆê±°ë‚˜ ì „ë¬¸ê°€/ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ
                ...(!isCurrentUserGuest ? [
                    { id: 'activity', name: 'í™œë™ ë‚´ì—­', icon: 'ğŸ“Š' },
                    { id: 'chat', name: 'ë©˜í† ë§ ë‚´ì—­', icon: 'ğŸ’¬' }
                ] : []),
                // ì „ë¬¸ê°€ëŠ” ì „ë¬¸ê°€ ê´€ë¦¬ íƒ­ (ìì‹ ì˜ ì„œë¹„ìŠ¤/ì˜ˆì•½ ê´€ë¦¬)
                ...(userType === 'expert' ? [{ id: 'expert', name: 'ì „ë¬¸ê°€ ê´€ë¦¬', icon: 'ğŸ¯' }] : []),
                ...(userType === 'admin' ? [{ id: 'admin', name: 'ê´€ë¦¬ì', icon: 'ğŸ‘‘' }] : [])
            ];

            return React.createElement('div', { className: "min-h-screen bg-gray-50" }, [
                // í—¤ë”
                React.createElement('div', {
                    key: 'header',
                    className: "bg-white shadow-sm border-b border-gray-200"
                }, React.createElement('div', {
                    className: "max-w-4xl mx-auto px-4 py-6"
                }, React.createElement('div', {
                    className: "flex items-center justify-between"
                }, [
                    React.createElement('div', {
                        key: 'header-left',
                        className: "flex items-center space-x-4"
                    }, [
                        React.createElement('div', {
                            key: 'avatar',
                            className: "w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center"
                        }, React.createElement('span', {
                            className: "text-white font-bold text-lg"
                        }, userType === 'admin' ? 'ğŸ‘‘' : userType === 'expert' ? 'ğŸ¯' : 'ğŸ‘¤')),
                        React.createElement('div', { key: 'user-info' }, [
                            React.createElement('h1', {
                                key: 'title',
                                className: "text-2xl font-bold text-gray-800"
                            }, 'ë§ˆì´í˜ì´ì§€'),
                            React.createElement('div', {
                                key: 'user-details',
                                className: "flex items-center space-x-2"
                            }, [
                                React.createElement('span', {
                                    key: 'user-name',
                                    className: "text-gray-600"
                                }, currentUser?.nickname || currentUser?.email),
                                React.createElement('span', {
                                    key: 'user-badge',
                                    className: `px-2 py-1 rounded-full text-xs font-medium ${
                                        userType === 'admin' ? 'bg-red-100 text-red-800' :
                                        userType === 'expert' ? 'bg-orange-100 text-orange-800' :
                                        'bg-blue-100 text-blue-800'
                                    }`
                                }, userTypeName)
                            ])
                        ])
                    ]),
                    React.createElement('button', {
                        key: 'close-btn',
                        onClick: onClose,
                        className: "p-2 text-gray-400 hover:text-gray-600 transition-colors"
                    }, React.createElement('svg', {
                        className: "w-6 h-6",
                        fill: "none",
                        stroke: "currentColor",
                        viewBox: "0 0 24 24"
                    }, React.createElement('path', {
                        strokeLinecap: "round",
                        strokeLinejoin: "round",
                        strokeWidth: 2,
                        d: "M6 18L18 6M6 6l12 12"
                    })))
                ]))),

                // íƒ­ ë©”ë‰´
                React.createElement('div', {
                    key: 'tab-menu',
                    className: "bg-white border-b border-gray-200"
                }, React.createElement('div', {
                    className: "max-w-4xl mx-auto px-4"
                }, React.createElement('div', {
                    className: "flex space-x-8"
                }, tabs.map((tab) => 
                    React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `py-4 px-2 border-b-2 font-medium text-sm transition-colors ${
                            activeTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                        }`
                    }, `${tab.icon} ${tab.name}`)
                )))),

                // íƒ­ ì»¨í…ì¸ 
                React.createElement('div', {
                    key: 'tab-content',
                    className: "max-w-4xl mx-auto px-4 py-8"
                }, [
                    // í”„ë¡œí•„ íƒ­
                    activeTab === 'profile' && 
                        React.createElement(ProfileTab, { 
                            key: 'profile-tab',
                            currentUser: currentUser, 
                            userType: userType, 
                            userTypeName: userTypeName 
                        }),
                    // ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆê±°ë‚˜ ì „ë¬¸ê°€/ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ
                    activeTab === 'activity' && !isCurrentUserGuest && 
                        React.createElement(ActivityTab, { 
                            key: 'activity-tab',
                            currentUser: currentUser,
                            userType: userType,
                            setCurrentView: setCurrentView,
                            setFormData: setFormData,
                            setCalculatorResult: setCalculatorResult,
                            setCalculatorStep: setCalculatorStep,
                            showNotification: showNotification,
                            onClose: onClose
                        }),
                    activeTab === 'chat' && !isCurrentUserGuest && 
                        <ChatHistoryComponent 
                            key='chat-tab'
                            currentUser={currentUser}
                        />,
                    activeTab === 'expert' && userType === 'expert' && 
                        React.createElement(ExpertTab, { 
                            key: 'expert-tab',
                            currentUser: currentUser 
                        }),
                    activeTab === 'admin' && userType === 'admin' && 
                        React.createElement(AdminTab, { 
                            key: 'admin-tab',
                            currentUser: currentUser 
                        }),

                    // ê²ŒìŠ¤íŠ¸ê°€ ì œí•œëœ íƒ­ì— ì ‘ê·¼í•œ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€
                    isCurrentUserGuest && (activeTab === 'activity' || activeTab === 'chat') && 
                        React.createElement('div', {
                            key: 'guest-restriction',
                            className: "text-center py-12"
                        }, React.createElement('div', {
                            className: "bg-amber-50 border border-amber-200 rounded-lg p-8 max-w-md mx-auto"
                        }, [
                            React.createElement('div', { key: 'icon', className: "text-4xl mb-4" }, 'ğŸš«'),
                            React.createElement('h3', { key: 'title', className: "text-lg font-semibold text-amber-800 mb-2" }, 'ê²ŒìŠ¤íŠ¸ ì‚¬ìš© ì œí•œ'),
                            React.createElement('p', { key: 'message', className: "text-amber-600 mb-4" }, 'ì´ ê¸°ëŠ¥ì€ ì •ì‹ íšŒì›ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'),
                            React.createElement('button', { 
                                key: 'signup-btn',
                                onClick: () => {
                                    // TODO: setAuthModeì™€ setShowAuthForm props ì¶”ê°€ í•„ìš”
                                    setCurrentView('login');
                                },
                                className: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                            }, 'íšŒì›ê°€ì…í•˜ê¸°')
                        ]))
                ].filter(Boolean)),
            ]);
        };

        // ë‚´ ì •ë³´ íƒ­
        const ProfileTab = ({ currentUser, userType, userTypeName }) => {
            const [isEditingNickname, setIsEditingNickname] = useState(false);
            const [newNickname, setNewNickname] = useState(currentUser?.nickname || '');
            const [nicknameError, setNicknameError] = useState('');
            const [isCheckingDuplicate, setIsCheckingDuplicate] = useState(false);
            const [isSavingNickname, setIsSavingNickname] = useState(false);

            // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬
            const checkNicknameDuplicate = async (nickname) => {
                if (!nickname.trim()) {
                    setNicknameError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }

                if (nickname.length < 2 || nickname.length > 20) {
                    setNicknameError('ë‹‰ë„¤ì„ì€ 2-20ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                    return false;
                }

                if (nickname === currentUser?.nickname) {
                    setNicknameError('í˜„ì¬ ë‹‰ë„¤ì„ê³¼ ë™ì¼í•©ë‹ˆë‹¤.');
                    return false;
                }

                try {
                    setIsCheckingDuplicate(true);
                    setNicknameError('');

                    const { data, error } = await supabase
                        .from('user_profiles')
                        .select('id')
                        .eq('nickname', nickname.trim())
                        .neq('id', currentUser.id);

                    if (error) throw error;

                    if (data && data.length > 0) {
                        setNicknameError('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.');
                        return false;
                    }

                    setNicknameError('');
                    return true;
                } catch (error) {
                    console.error('ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ ì˜¤ë¥˜:', error);
                    setNicknameError('ì¤‘ë³µ ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    return false;
                } finally {
                    setIsCheckingDuplicate(false);
                }
            };

            // ë‹‰ë„¤ì„ ì €ì¥
            const saveNickname = async () => {
                if (!await checkNicknameDuplicate(newNickname)) {
                    return;
                }

                try {
                    setIsSavingNickname(true);

                    const { error } = await supabase
                        .from('user_profiles')
                        .update({ nickname: newNickname.trim() })
                        .eq('id', currentUser.id);

                    if (error) throw error;

                    // currentUser ê°ì²´ ì—…ë°ì´íŠ¸
                    currentUser.nickname = newNickname.trim();
                    
                    setIsEditingNickname(false);
                    setNicknameError('');
                    
                    showToast('ë‹‰ë„¤ì„ì´ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    console.error('ë‹‰ë„¤ì„ ì €ì¥ ì˜¤ë¥˜:', error);
                    setNicknameError('ë‹‰ë„¤ì„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setIsSavingNickname(false);
                }
            };

            // ë‹‰ë„¤ì„ í¸ì§‘ ì·¨ì†Œ
            const cancelEditNickname = () => {
                setNewNickname(currentUser?.nickname || '');
                setNicknameError('');
                setIsEditingNickname(false);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-xl font-semibold mb-4">ê¸°ë³¸ ì •ë³´</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                                <div className="p-3 bg-gray-50 rounded-lg text-gray-800">{currentUser?.email}</div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ë‹‰ë„¤ì„</label>
                                {isEditingNickname ? (
                                    <div className="space-y-2">
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={newNickname}
                                                onChange={(e) => {
                                                    setNewNickname(e.target.value);
                                                    setNicknameError('');
                                                }}
                                                placeholder="ìƒˆ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                className={`flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                                                    nicknameError ? 'border-red-300' : 'border-gray-300'
                                                }`}
                                                maxLength={20}
                                                disabled={isCheckingDuplicate || isSavingNickname}
                                            />
                                        </div>
                                        {nicknameError && (
                                            <p className="text-red-600 text-sm">{nicknameError}</p>
                                        )}
                                        <div className="flex gap-2">
                                            <button
                                                onClick={saveNickname}
                                                disabled={isCheckingDuplicate || isSavingNickname || !newNickname.trim()}
                                                className="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                {isSavingNickname ? 'ì €ì¥ ì¤‘...' : isCheckingDuplicate ? 'í™•ì¸ ì¤‘...' : 'ì €ì¥'}
                                            </button>
                                            <button
                                                onClick={cancelEditNickname}
                                                disabled={isCheckingDuplicate || isSavingNickname}
                                                className="px-3 py-2 bg-gray-300 text-gray-700 rounded-lg text-sm hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                ì·¨ì†Œ
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span className="text-gray-800">{currentUser?.nickname || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ'}</span>
                                        <button
                                            onClick={() => setIsEditingNickname(true)}
                                            className="px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"
                                        >
                                            ìˆ˜ì •
                                        </button>
                                    </div>
                                )}
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">íšŒì› ìœ í˜•</label>
                                <div className="p-3 bg-gray-50 rounded-lg">
                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                        userType === 'admin' ? 'bg-red-100 text-red-800' :
                                        userType === 'expert' ? 'bg-orange-100 text-orange-800' :
                                        'bg-blue-100 text-blue-800'
                                    }`}>
                                        {userTypeName}
                                    </span>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ê°€ì…ì¼</label>
                                <div className="p-3 bg-gray-50 rounded-lg text-gray-800">
                                    {currentUser?.created_at ? new Date(currentUser.created_at).toLocaleDateString() : 'ì •ë³´ ì—†ìŒ'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // í™œë™ ë‚´ì—­ íƒ­
        const ActivityTab = ({ currentUser, userType, setCurrentView, setFormData, setCalculatorResult, setCalculatorStep, showNotification, onClose }) => {
            const [bookingHistory, setBookingHistory] = React.useState([]);
            const [paymentHistory, setPaymentHistory] = React.useState([]);
            const [calculationHistory, setCalculationHistory] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [activeSubTab, setActiveSubTab] = React.useState('calculations');
            const [showRefundModal, setShowRefundModal] = React.useState(false);
            const [selectedPayment, setSelectedPayment] = React.useState(null);
            const [refundReason, setRefundReason] = React.useState('');
            const [refundLoading, setRefundLoading] = React.useState(false);
            const [showPaymentDetailModal, setShowPaymentDetailModal] = React.useState(false);

            // í™˜ë¶ˆ ì‹ ì²­ ì²˜ë¦¬ í•¨ìˆ˜
            const handleRefundRequest = async () => {
                if (!selectedPayment || !refundReason.trim()) {
                    alert('í™˜ë¶ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                setRefundLoading(true);
                try {
                    // Mock í™˜ë¶ˆ ì²˜ë¦¬ (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ API í˜¸ì¶œ)
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬:
                    // const { error } = await supabase
                    //     .from('refund_requests')
                    //     .insert({
                    //         payment_id: selectedPayment.id,
                    //         user_id: currentUser.id,
                    //         refund_amount: selectedPayment.amount,
                    //         refund_reason: refundReason,
                    //         status: 'pending',
                    //         requested_at: new Date().toISOString()
                    //     });

                    // Mock ì„±ê³µ ì²˜ë¦¬
                    console.log('âœ… í™˜ë¶ˆ ì‹ ì²­ ì™„ë£Œ:', {
                        paymentId: selectedPayment.id,
                        amount: selectedPayment.amount,
                        reason: refundReason
                    });

                    // ê²°ì œ ë‚´ì—­ ì—…ë°ì´íŠ¸ (í™˜ë¶ˆ ì‹ ì²­ ì¤‘ìœ¼ë¡œ ìƒíƒœ ë³€ê²½)
                    setPaymentHistory(prev => prev.map(payment => 
                        payment.id === selectedPayment.id 
                            ? { ...payment, status: 'refund_requested' }
                            : payment
                    ));

                    alert('í™˜ë¶ˆ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì²˜ë¦¬ê¹Œì§€ ì˜ì—…ì¼ ê¸°ì¤€ 3-5ì¼ì´ ì†Œìš”ë©ë‹ˆë‹¤.');
                    setShowRefundModal(false);
                    setSelectedPayment(null);
                    setRefundReason('');

                } catch (error) {
                    console.error('âŒ í™˜ë¶ˆ ì‹ ì²­ ì˜¤ë¥˜:', error);
                    alert('í™˜ë¶ˆ ì‹ ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } finally {
                    setRefundLoading(false);
                }
            };

            // í™˜ë¶ˆ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ í•¨ìˆ˜
            const canRefund = (payment, booking) => {
                // ê²°ì œ ì™„ë£Œëœ ìƒíƒœì—¬ì•¼ í•¨
                if (payment.status !== 'completed') return false;
                
                // ì´ë¯¸ í™˜ë¶ˆ ì‹ ì²­í•œ ê²½ìš° ë¶ˆê°€
                if (payment.status === 'refund_requested' || payment.status === 'refunded') return false;
                
                // ìƒë‹´ 24ì‹œê°„ ì „ê¹Œì§€ë§Œ í™˜ë¶ˆ ê°€ëŠ¥ (ì‹¤ì œë¡œëŠ” ì˜ˆì•½ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨)
                const bookingDate = booking?.scheduledTime;
                if (bookingDate) {
                    const bookingTime = new Date(bookingDate).getTime();
                    const now = new Date().getTime();
                    const hoursLeft = (bookingTime - now) / (1000 * 60 * 60);
                    return hoursLeft > 24;
                }
                
                return true; // ì˜ˆì•½ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì¼ë‹¨ í™˜ë¶ˆ ê°€ëŠ¥ìœ¼ë¡œ ì²˜ë¦¬
            };

            // ì €ì¥ëœ ê³„ì‚° ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° ë° ì˜ˆì‹œ ë°ì´í„°
            const loadCalculationHistory = React.useCallback(async () => {
                    try {
                        let calculations = [];
                        
                        console.log('ğŸ” ê³„ì‚° ì´ë ¥ ë¡œë”© ì‹œì‘...', { currentUser: currentUser?.email });
                        
                        // 1. localStorageì—ì„œ í˜„ì¬ ê³„ì‚° ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
                        const savedLocal = localStorage.getItem('insidejob_calculation_result');
                        console.log('ğŸ“± localStorage ë°ì´í„°:', savedLocal ? 'Found' : 'Not found');
                        
                        if (savedLocal) {
                            try {
                                const localData = JSON.parse(savedLocal);
                                // ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
                                if (localData && localData.formData && localData.calculationResult) {
                                    calculations.push({
                                        id: 'local-' + Date.now(),
                                        source: 'local',
                                        created_at: localData.calculatedAt || localData.savedAt || new Date().toISOString(),
                                        formData: localData.formData,
                                        calculationResult: localData.calculationResult,
                                        totalAssets: localData.calculationResult.totalAssets || localData.totalAssets || 0,
                                        targetSalary: localData.calculationResult.targetSalary || localData.calculationResult.monthlyLivingCost || localData.monthlyLivingCost || 0,
                                        totalScore: localData.calculationResult.totalScore || localData.calculationResult.assetSufficiencyYears || localData.assetSufficiencyYears || 0
                                    });
                                    console.log('âœ… localStorage ê³„ì‚° ê²°ê³¼ ì¶”ê°€:', localData.formData?.age, 'ì„¸');
                                } else {
                                    console.warn('âš ï¸ localStorage ë°ì´í„°ê°€ ë¶ˆì™„ì „í•©ë‹ˆë‹¤:', localData);
                                }
                            } catch (error) {
                                console.error('âŒ localStorage ê³„ì‚° ê²°ê³¼ íŒŒì‹± ì‹¤íŒ¨:', error);
                            }
                        }
                        
                        // 2. Supabaseì—ì„œ ì‚¬ìš©ìì˜ ëª¨ë“  ê³„ì‚° ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° (íšŒì›ì¸ ê²½ìš°)
                        if (currentUser && !currentUser.isGuest && supabase) {
                            console.log('ğŸ” Supabaseì—ì„œ ê³„ì‚° ê²°ê³¼ ì¡°íšŒ ì¤‘...', currentUser.id);
                            try {
                                const { data, error } = await supabase
                                    .from('career_calculations')
                                    .select('*')
                                    .eq('user_id', currentUser.id)
                                    .order('created_at', { ascending: false });
                                
                                if (error) {
                                    console.error('âŒ Supabase ê³„ì‚° ê²°ê³¼ ì¡°íšŒ ì‹¤íŒ¨:', error);
                                    console.error('ğŸ” ì˜¤ë¥˜ ìƒì„¸:', JSON.stringify(error, null, 2));
                                } else if (data) {
                                    console.log('ğŸ“Š Supabase ê³„ì‚° ê²°ê³¼ ê°œìˆ˜:', data.length);
                                    console.log('ğŸ“„ Supabase ì›ë³¸ ë°ì´í„°:', data.length > 0 ? data[0] : 'No data');
                                    const supabaseCalculations = data.map(item => {
                                        console.log('ğŸ“„ ì²˜ë¦¬ ì¤‘ì¸ ê³„ì‚° ë°ì´í„°:', {
                                            id: item.id,
                                            form_data: item.form_data,
                                            calculation_result: item.calculation_result,
                                            created_at: item.created_at
                                        });
                                        
                                        // JSONB ë°ì´í„° ì•ˆì „í•œ íŒŒì‹±
                                        let formData = {};
                                        let calculationResult = {};
                                        
                                        try {
                                            formData = typeof item.form_data === 'string' 
                                                ? JSON.parse(item.form_data) 
                                                : (item.form_data || {});
                                                
                                            calculationResult = typeof item.calculation_result === 'string' 
                                                ? JSON.parse(item.calculation_result) 
                                                : (item.calculation_result || {});
                                        } catch (error) {
                                            console.error('ğŸš¨ JSONB íŒŒì‹± ì˜¤ë¥˜:', error, { item });
                                            formData = item.form_data || {};
                                            calculationResult = item.calculation_result || {};
                                        }
                                        
                                        console.log('âœ… ë³€í™˜ëœ ë°ì´í„°:', { 
                                            formData, 
                                            calculationResult,
                                            totalAssets: calculationResult.totalAssets,
                                            monthlyLivingCost: calculationResult.monthlyLivingCost 
                                        });
                                        
                                        return {
                                            id: item.id,
                                            source: 'database',
                                            created_at: item.created_at || item.saved_at,
                                            formData: formData,
                                            calculationResult: calculationResult,
                                            totalAssets: calculationResult.totalAssets || 0,
                                            targetSalary: calculationResult.targetSalary || calculationResult.monthlyLivingCost || 0,
                                            totalScore: calculationResult.totalScore || calculationResult.assetSufficiencyYears || 0
                                        };
                                    });
                                    calculations = [...calculations, ...supabaseCalculations];
                                    console.log('ğŸ¯ ë³€í™˜ëœ Supabase ê³„ì‚° ê²°ê³¼:', supabaseCalculations.length);
                                } else {
                                    console.log('ğŸ“­ Supabase ë°ì´í„°ê°€ nullì…ë‹ˆë‹¤');
                                }
                            } catch (error) {
                                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ê³„ì‚° ê²°ê³¼ ë¡œë”© ì‹¤íŒ¨:', error);
                                console.error('ğŸ” ìƒì„¸ ì˜¤ë¥˜ ì •ë³´:', JSON.stringify(error, null, 2));
                            }
                        } else {
                            console.log('âš ï¸ Supabase ì¡°íšŒ ê±´ë„ˆë›°ê¸°:', {
                                hasCurrentUser: !!currentUser,
                                isGuest: currentUser?.isGuest,
                                hasSupabase: !!supabase
                            });
                        }
                        
                        // ì¤‘ë³µ ì œê±° ë° ë‚ ì§œìˆœ ì •ë ¬
                        const uniqueCalculations = calculations
                            .filter((calc, index, self) => 
                                index === self.findIndex(c => 
                                    Math.abs(new Date(c.created_at) - new Date(calc.created_at)) < 60000
                                )
                            )
                            .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                        
                        console.log('ğŸ“ˆ ìµœì¢… ê³„ì‚° ê²°ê³¼ ê°œìˆ˜:', uniqueCalculations.length);
                        console.log('ğŸ“‹ ìµœì¢… ê³„ì‚° ê²°ê³¼ ë°°ì—´:', uniqueCalculations.map(c => ({
                            id: c.id,
                            source: c.source,
                            age: c.formData?.age,
                            hasData: !!c.calculationResult
                        })));
                        
                        // í…ŒìŠ¤íŠ¸ìš© ì˜ˆì‹œ ë°ì´í„° ì¶”ê°€ (ê³„ì‚° ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°)
                        if (uniqueCalculations.length === 0 && currentUser?.email?.includes('test')) {
                            console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì˜ˆì‹œ ê³„ì‚° ê²°ê³¼ ì¶”ê°€ ì¤‘...');
                            const testCalculation = {
                                id: 'test-example-' + Date.now(),
                                source: 'example',
                                created_at: new Date().toISOString(),
                                formData: {
                                    age: 55,
                                    health: 'ì–‘í˜¸',
                                    lifeMode: 'ê· í˜•',
                                    skillScore: 85,
                                    experienceScore: 70,
                                    networkScore: 60,
                                    preparationScore: 75,
                                    marketScore: 80
                                },
                                calculationResult: {
                                    totalAssets: 480000000,
                                    targetSalary: 350,
                                    totalScore: 75
                                },
                                totalAssets: 480000000,
                                targetSalary: 350,
                                totalScore: 75
                            };
                            uniqueCalculations.push(testCalculation);
                            console.log('âœ… í…ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ ì¶”ê°€ë¨');
                        }
                        
                        setCalculationHistory(uniqueCalculations);
                        setError(null);
                    } catch (error) {
                        console.error('âŒ ê³„ì‚° ì´ë ¥ ë¡œë”© ì‹¤íŒ¨:', error);
                        setError(error.message || 'ê³„ì‚° ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                        // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë¹ˆ ë°°ì—´ì„ ì„¤ì •í•˜ì—¬ UIê°€ í‘œì‹œë˜ë„ë¡ í•¨
                        setCalculationHistory([]);
                    } finally {
                        setLoading(false);
                    }
                }, [currentUser, supabase]);

            React.useEffect(() => {
                loadCalculationHistory();
            }, [loadCalculationHistory]);
                
            React.useEffect(() => {
                // ëª¨ì˜ ì˜ˆì•½ ë‚´ì—­ ë°ì´í„°
                // ì‹¤ì œ ì˜ˆì•½ ë°ì´í„°ëŠ” Supabaseì—ì„œ ì¡°íšŒ (í˜„ì¬ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì‹œì‘)
                const bookings = [];

                // ì‹¤ì œ ê²°ì œ ë°ì´í„°ëŠ” Supabaseì—ì„œ ì¡°íšŒ (í˜„ì¬ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì‹œì‘)
                const payments = [];

                // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì˜ˆì•½/ê²°ì œ ë‚´ì—­ ë¡œë“œ
                const loadUserBookingsAndPayments = async () => {
                    try {
                        if (!currentUser?.id || currentUser.isGuest) {
                            setBookingHistory([]);
                            setPaymentHistory([]);
                            setLoading(false);
                            return;
                        }

                        // Supabaseê°€ ì—†ëŠ” ê²½ìš° ëª¨ì˜ ë°ì´í„° ì‚¬ìš©
                        if (!supabase) {
                            setBookingHistory(bookings);
                            setPaymentHistory(payments);
                            setLoading(false);
                            return;
                        }

                        // ì˜ˆì•½ ë‚´ì—­ ì¡°íšŒ (í˜„ì§ì/êµ¬ì§ì êµ¬ë¶„)
                        const bookingQuery = supabase
                            .from('consultation_bookings')
                            .select(`
                                *,
                                expert:professionals!consultation_bookings_professional_id_fkey(name, title, specialties),
                                client:user_profiles!consultation_bookings_job_seeker_id_fkey(nickname, email)
                            `);

                        // ì‚¬ìš©ì ì—­í• ì— ë”°ë¼ ì¿¼ë¦¬ ì¡°ê±´ ë³€ê²½
                        if (currentUser.role === 'expert') {
                            bookingQuery.eq('professional_id', currentUser.id);
                        } else {
                            bookingQuery.eq('job_seeker_id', currentUser.id);
                        }

                        const { data: bookingsData, error: bookingsError } = await bookingQuery
                            .order('created_at', { ascending: false });

                        if (bookingsError) throw bookingsError;

                        // ê²°ì œ ë‚´ì—­ ì¡°íšŒ
                        const bookingIds = bookingsData?.map(b => b.id) || [];
                        let paymentsData = [];
                        
                        if (bookingIds.length > 0) {
                            const { data: payments, error: paymentsError } = await supabase
                                .from('payment_transactions')
                                .select('*')
                                .in('booking_id', bookingIds)
                                .order('created_at', { ascending: false });

                            if (paymentsError) throw paymentsError;
                            paymentsData = payments || [];
                        }

                        // ë°ì´í„° í¬ë§·íŒ…
                        const formattedBookings = (bookingsData || []).map(booking => ({
                            id: booking.id,
                            expertName: booking.expert?.name || 'í˜„ì§ì',
                            clientName: booking.client?.nickname || 'êµ¬ì§ì',
                            type: booking.consultation_type,
                            date: booking.scheduled_date,
                            time: booking.scheduled_time,
                            amount: booking.total_amount,
                            status: booking.booking_status,
                            method: booking.consultation_method,
                            rating: booking.job_seeker_rating,
                            review: booking.job_seeker_feedback
                        }));

                        const formattedPayments = paymentsData.map(payment => ({
                            id: payment.id,
                            bookingId: payment.booking_id,
                            date: payment.created_at?.split('T')[0],
                            amount: payment.amount,
                            method: payment.payment_gateway || 'ë¯¸ì§€ì •',
                            status: payment.status,
                            transactionId: payment.transaction_id
                        }));

                        setBookingHistory(formattedBookings);
                        setPaymentHistory(formattedPayments);
                        setLoading(false);

                    } catch (error) {
                        console.error('ì˜ˆì•½/ê²°ì œ ë‚´ì—­ ë¡œë“œ ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ë°œìƒì‹œ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
                        setBookingHistory([]);
                        setPaymentHistory([]);
                        setLoading(false);
                    }
                };

                loadUserBookingsAndPayments();
            }, [currentUser]);

            const getStatusBadge = (status) => {
                const statusConfig = {
                    completed: { bg: 'bg-green-100', text: 'text-green-800', label: 'ì™„ë£Œ' },
                    accepted: { bg: 'bg-blue-100', text: 'text-blue-800', label: 'ìŠ¹ì¸ë¨' },
                    requested: { bg: 'bg-yellow-100', text: 'text-yellow-800', label: 'ìš”ì²­ë¨' },
                    rejected: { bg: 'bg-red-100', text: 'text-red-800', label: 'ê±°ì ˆë¨' },
                    cancelled: { bg: 'bg-red-100', text: 'text-red-800', label: 'ì·¨ì†Œë¨' },
                    no_show: { bg: 'bg-gray-100', text: 'text-gray-800', label: 'ë…¸ì‡¼' },
                    refund_requested: { bg: 'bg-orange-100', text: 'text-orange-800', label: 'í™˜ë¶ˆì‹ ì²­' },
                    refunded: { bg: 'bg-purple-100', text: 'text-purple-800', label: 'í™˜ë¶ˆì™„ë£Œ' },
                    refund_rejected: { bg: 'bg-red-100', text: 'text-red-800', label: 'í™˜ë¶ˆê±°ì ˆ' }
                };
                const config = statusConfig[status] || statusConfig.requested;
                return React.createElement('span', {
                    className: `inline-flex px-2 py-1 text-xs font-semibold rounded-full ${config.bg} ${config.text}`
                }, config.label);
            };

            const renderStars = (rating) => {
                if (!rating) return null;
                return React.createElement('div', {
                    className: "flex items-center"
                }, [
                    ...[...Array(5)].map((_, i) => 
                        React.createElement('svg', {
                            key: i,
                            className: `w-4 h-4 ${i < rating ? 'text-yellow-400' : 'text-gray-300'}`,
                            fill: "currentColor",
                            viewBox: "0 0 20 20"
                        }, React.createElement('path', {
                            d: "M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        }))
                    ),
                    React.createElement('span', {
                        key: 'rating-text',
                        className: "ml-1 text-sm text-gray-600"
                    }, `(${rating}/5)`)
                ]);
            };

            return React.createElement('div', { className: "space-y-6" }, [
                React.createElement('div', { 
                    key: 'activity-content', 
                    className: "bg-white rounded-lg shadow p-6" 
                }, [
                    React.createElement('h2', { key: 'title' }, 'í™œë™ë‚´ì—­'),
                    React.createElement('p', { key: 'message' }, 'í™œë™ë‚´ì—­ì„ ì—¬ê¸°ì— í‘œì‹œí•©ë‹ˆë‹¤.')
                ])
            ]);
        };



        // ì „ë¬¸ê°€ ê´€ë¦¬ íƒ­ (ì „ë¬¸ê°€: ë‚´ ì„œë¹„ìŠ¤ ê´€ë¦¬, ê´€ë¦¬ì: ì „ë¬¸ê°€ ê´€ë¦¬)
        const ExpertTab = ({ currentUser }) => {
            const [stats, setStats] = useState({
                totalConsultations: 0,
                avgRating: 0,
                responseRate: 0,
                totalRevenue: 0,
                pendingBookings: 0,
                completedBookings: 0
            });
            const [loading, setLoading] = useState(true);

            // ì „ë¬¸ê°€ í†µê³„ ë¡œë“œ
            useEffect(() => {
                const loadExpertStats = async () => {
                    try {
                        if (!supabase) {
                            // ë°ëª¨ ë°ì´í„°
                            setStats({
                                totalConsultations: 8,
                                avgRating: 4.8,
                                responseRate: 95,
                                totalRevenue: 640000,
                                pendingBookings: 2,
                                completedBookings: 6
                            });
                            setLoading(false);
                            return;
                        }

                        // ì‹¤ì œ í†µê³„ ì¡°íšŒ
                        const { data: consultations, error } = await supabase
                            .from('consultation_bookings')
                            .select('*')
                            .eq('expert_id', currentUser.id);

                        if (error) throw error;

                        const totalConsultations = consultations?.length || 0;
                        const completedBookings = consultations?.filter(c => c.status === 'completed').length || 0;
                        const pendingBookings = consultations?.filter(c => c.status === 'pending').length || 0;
                        const totalRevenue = consultations?.reduce((sum, c) => sum + (c.expert_payout || 0), 0) || 0;

                        // í‰ì  ì¡°íšŒ (í–¥í›„ êµ¬í˜„)
                        const avgRating = 4.8; // ì„ì‹œê°’
                        const responseRate = totalConsultations > 0 ? Math.round((completedBookings / totalConsultations) * 100) : 0;

                        setStats({
                            totalConsultations,
                            avgRating,
                            responseRate,
                            totalRevenue,
                            pendingBookings,
                            completedBookings
                        });
                    } catch (error) {
                        console.error('ì „ë¬¸ê°€ í†µê³„ ë¡œë”© ì˜¤ë¥˜:', error);
                    } finally {
                        setLoading(false);
                    }
                };

                loadExpertStats();
            }, [currentUser.id]);

            if (loading) {
                return React.createElement('div', {
                    className: "flex justify-center items-center h-64"
                }, React.createElement('div', {
                    className: "animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"
                }));
            }

            return (
                <div className="space-y-6">
                    {/* ì „ë¬¸ê°€ ëŒ€ì‹œë³´ë“œ */}
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-xl font-semibold mb-4">ğŸ“Š ë‚˜ì˜ ì „ë¬¸ê°€ ëŒ€ì‹œë³´ë“œ</h2>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div className="text-center p-4 bg-orange-50 rounded-lg">
                                <div className="text-2xl font-bold text-orange-600">{stats.totalConsultations}</div>
                                <div className="text-sm text-gray-600">ì´ ìƒë‹´ ê±´ìˆ˜</div>
                            </div>
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-2xl font-bold text-green-600">{stats.avgRating}</div>
                                <div className="text-sm text-gray-600">í‰ê·  í‰ì </div>
                            </div>
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">{stats.responseRate}%</div>
                                <div className="text-sm text-gray-600">ì™„ë£Œìœ¨</div>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <div className="text-2xl font-bold text-purple-600">{(stats.totalRevenue).toLocaleString()}ì›</div>
                                <div className="text-sm text-gray-600">ì´ ìˆ˜ìµ</div>
                            </div>
                        </div>
                    </div>
                    
                    {/* ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                    <div className="bg-white rounded-lg shadow p-6">
                        <h3 className="text-lg font-semibold mb-4">âš¡ ë¹ ë¥¸ ì•¡ì„¸ìŠ¤</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <div className="text-2xl mr-3">â°</div>
                                <div>
                                    <div className="font-medium">ëŒ€ê¸° ì¤‘ì¸ ì˜ˆì•½</div>
                                    <div className="text-sm text-gray-600">{stats.pendingBookings}ê°œì˜ ìƒˆë¡œìš´ ìš”ì²­</div>
                                </div>
                            </div>
                            <div className="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <div className="text-2xl mr-3">ğŸ’°</div>
                                <div>
                                    <div className="font-medium">ì´ë²ˆ ë‹¬ ìˆ˜ìµ</div>
                                    <div className="text-sm text-gray-600">{Math.round(stats.totalRevenue * 0.3).toLocaleString()}ì› ì˜ˆìƒ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <ExpertBookingManagementComponent currentUser={currentUser} userType="expert" />
                </div>
            );
        };

        // ê´€ë¦¬ì íƒ­
        const AdminTab = ({ currentUser }) => {
            const [activeSection, setActiveSection] = useState('dashboard');
            const [stats, setStats] = useState({
                totalUsers: 0,
                totalExperts: 0,
                totalPosts: 0,
                completedCalculations: 0,
                totalRevenue: 0,
                pendingSettlements: 0,
                thisMonthRevenue: 0,
                platformFee: 0
            });
            const [statsLoading, setStatsLoading] = useState(true);

            // ì‹¤ë°ì´í„° ê¸°ë°˜ í†µê³„ ë¡œë”© (ì˜¤ë¥˜ ì•ˆì „ ì²˜ë¦¬)
            const loadRealStatistics = async () => {
                setStatsLoading(true);
                try {
                    if (!supabase) {
                        // Supabase ë¯¸ì—°ê²°ì‹œ Mock ë°ì´í„° ì‚¬ìš©
                        setStats({
                            totalUsers: 156,
                            totalExperts: 12,
                            totalPosts: 234,
                            completedCalculations: 89,
                            totalRevenue: 2450000,
                            pendingSettlements: 5,
                            thisMonthRevenue: 890000,
                            platformFee: 245000
                        });
                        return;
                    }

                    // ë³‘ë ¬ ì¿¼ë¦¬ë¡œ ëª¨ë“  í†µê³„ ìˆ˜ì§‘
                    const [
                        usersResult,
                        expertsResult,
                        postsResult,
                        calculationsResult,
                        bookingsResult,
                        settlementsResult
                    ] = await Promise.allSettled([
                        // ì „ì²´ íšŒì›ìˆ˜
                        supabase.from('user_profiles').select('id', { count: 'exact', head: true }),
                        // ì „ë¬¸ê°€ ìˆ˜
                        supabase.from('user_profiles').select('id', { count: 'exact', head: true }).eq('role', 'expert'),
                        // ê²Œì‹œê¸€ ìˆ˜
                        supabase.from('job_seeker_posts').select('id', { count: 'exact', head: true }),
                        // ê³„ì‚° ì™„ë£Œ ìˆ˜
                        supabase.from('career_calculations').select('id', { count: 'exact', head: true }),
                        // ì™„ë£Œëœ ìƒë‹´ ê±°ë˜ì•¡
                        supabase.from('consultation_bookings')
                            .select('payment_amount')
                            .eq('status', 'completed'),
                        // ëŒ€ê¸° ì¤‘ì¸ ì •ì‚°
                        supabase.from('fee_settlements').select('id', { count: 'exact', head: true }).eq('status', 'pending')
                    ]);

                    // ì•ˆì „í•œ ë°ì´í„° ì¶”ì¶œ (ì˜¤ë¥˜ì‹œ 0ìœ¼ë¡œ ê¸°ë³¸ê°’)
                    const totalUsers = usersResult.status === 'fulfilled' ? (usersResult.value?.count || 0) : 0;
                    const totalExperts = expertsResult.status === 'fulfilled' ? (expertsResult.value?.count || 0) : 0;
                    const totalPosts = postsResult.status === 'fulfilled' ? (postsResult.value?.count || 0) : 0;
                    const completedCalculations = calculationsResult.status === 'fulfilled' ? (calculationsResult.value?.count || 0) : 0;
                    const pendingSettlements = settlementsResult.status === 'fulfilled' ? (settlementsResult.value?.count || 0) : 0;

                    // ì´ ê±°ë˜ì•¡ ê³„ì‚° (ì•ˆì „í•œ ì²˜ë¦¬)
                    let totalRevenue = 0;
                    let thisMonthRevenue = 0;
                    if (bookingsResult.status === 'fulfilled' && bookingsResult.value?.data) {
                        totalRevenue = bookingsResult.value.data.reduce((sum, booking) => {
                            return sum + (booking.payment_amount || 0);
                        }, 0);
                        
                        // ì´ë²ˆ ë‹¬ ê±°ë˜ì•¡ (ìµœê·¼ 30ì¼)
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        
                        thisMonthRevenue = bookingsResult.value.data
                            .filter(booking => new Date(booking.created_at) > thirtyDaysAgo)
                            .reduce((sum, booking) => sum + (booking.payment_amount || 0), 0);
                    }

                    // í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ (20% ê¸°ì¤€)
                    const platformFee = Math.round(totalRevenue * 0.2);

                    setStats({
                        totalUsers,
                        totalExperts,
                        totalPosts,
                        completedCalculations,
                        totalRevenue,
                        pendingSettlements,
                        thisMonthRevenue,
                        platformFee
                    });

                } catch (error) {
                    console.error('í†µê³„ ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ë°œìƒì‹œ ê¸°ë³¸ Mock ë°ì´í„° ì‚¬ìš©
                    setStats({
                        totalUsers: 156,
                        totalExperts: 12,
                        totalPosts: 234,
                        completedCalculations: 89,
                        totalRevenue: 2450000,
                        pendingSettlements: 5,
                        thisMonthRevenue: 890000,
                        platformFee: 245000
                    });
                } finally {
                    setStatsLoading(false);
                }
            };

            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ì‹œ í†µê³„ ë¡œë”©
            useEffect(() => {
                loadRealStatistics();
            }, []);

            return (
                <div className="space-y-6">
                    {/* íƒ­ ë©”ë‰´ */}
                    <div className="bg-white rounded-lg shadow">
                        <div className="border-b border-gray-200">
                            <div className="flex space-x-8 px-6">
                                {[
                                    { id: 'dashboard', name: 'ëŒ€ì‹œë³´ë“œ', icon: 'ğŸ“Š' },
                                    { id: 'reports', name: 'ì‹ ê³  ê´€ë¦¬', icon: 'ğŸš¨' },
                                    { id: 'settlements', name: 'ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬', icon: 'ğŸ’°' },
                                    { id: 'experts', name: 'ì „ë¬¸ê°€ ê´€ë¦¬', icon: 'ğŸ¯' },
                                    { id: 'users', name: 'íšŒì› ê´€ë¦¬', icon: 'ğŸ‘¥' },
                                    { id: 'settings', name: 'ì‹œìŠ¤í…œ ì„¤ì •', icon: 'âš™ï¸' }
                                ].map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveSection(tab.id)}
                                        className={`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${
                                            activeSection === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.icon} {tab.name}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="p-6">
                            {activeSection === 'dashboard' && <AdminDashboard stats={stats} setActiveSection={setActiveSection} loading={statsLoading} />}
                            {activeSection === 'reports' && <ContentReportManagementSection currentUser={currentUser} />}
                            {activeSection === 'settlements' && <FeeManagementSection currentUser={currentUser} />}
                            {activeSection === 'experts' && <ExpertManagementSection currentUser={currentUser} />}
                            {activeSection === 'users' && <UserManagementSection currentUser={currentUser} />}
                            {activeSection === 'settings' && <SystemSettingsSection currentUser={currentUser} />}
                        </div>
                    </div>
                </div>
            );
        };

        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
        const AdminDashboard = ({ stats, setActiveSection, loading = false }) => (
            <div className="space-y-6">
                <div className="flex justify-between items-center">
                    <h2 className="text-xl font-semibold">ğŸ“Š í”Œë«í¼ í˜„í™©</h2>
                    {loading && (
                        <div className="flex items-center gap-2 text-sm text-gray-500">
                            <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                            ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...
                        </div>
                    )}
                </div>
                
                {/* ì£¼ìš” ì§€í‘œ */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div className="text-center p-4 bg-red-50 rounded-lg">
                        <div className="text-2xl font-bold text-red-600">
                            {loading ? (
                                <div className="animate-pulse bg-red-200 h-8 w-12 mx-auto rounded"></div>
                            ) : (
                                stats.totalUsers.toLocaleString()
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ì „ì²´ íšŒì›ìˆ˜</div>
                        {!loading && stats.totalUsers === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ë°ì´í„° ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-orange-50 rounded-lg">
                        <div className="text-2xl font-bold text-orange-600">
                            {loading ? (
                                <div className="animate-pulse bg-orange-200 h-8 w-12 mx-auto rounded"></div>
                            ) : (
                                stats.totalExperts.toLocaleString()
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ë“±ë¡ëœ ì „ë¬¸ê°€</div>
                        {!loading && stats.totalExperts === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ë°ì´í„° ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-blue-50 rounded-lg">
                        <div className="text-2xl font-bold text-blue-600">
                            {loading ? (
                                <div className="animate-pulse bg-blue-200 h-8 w-12 mx-auto rounded"></div>
                            ) : (
                                stats.totalPosts.toLocaleString()
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ì´ ê²Œì‹œê¸€</div>
                        {!loading && stats.totalPosts === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ë°ì´í„° ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-green-50 rounded-lg">
                        <div className="text-2xl font-bold text-green-600">
                            {loading ? (
                                <div className="animate-pulse bg-green-200 h-8 w-12 mx-auto rounded"></div>
                            ) : (
                                stats.completedCalculations.toLocaleString()
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ê³„ì‚° ì™„ë£Œ</div>
                        {!loading && stats.completedCalculations === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ë°ì´í„° ì—†ìŒ</div>
                        )}
                    </div>
                </div>

                {/* ìˆ˜ìµ ì§€í‘œ */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div className="text-center p-4 bg-purple-50 rounded-lg">
                        <div className="text-2xl font-bold text-purple-600">
                            {loading ? (
                                <div className="animate-pulse bg-purple-200 h-8 w-20 mx-auto rounded"></div>
                            ) : (
                                `${stats.totalRevenue.toLocaleString()}ì›`
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ëˆ„ì  ê±°ë˜ì•¡</div>
                        {!loading && stats.totalRevenue === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ê±°ë˜ ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-indigo-50 rounded-lg">
                        <div className="text-2xl font-bold text-indigo-600">
                            {loading ? (
                                <div className="animate-pulse bg-indigo-200 h-8 w-20 mx-auto rounded"></div>
                            ) : (
                                `${stats.thisMonthRevenue.toLocaleString()}ì›`
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ì´ë²ˆ ë‹¬ ê±°ë˜ì•¡</div>
                        {!loading && stats.thisMonthRevenue === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ê±°ë˜ ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-emerald-50 rounded-lg">
                        <div className="text-2xl font-bold text-emerald-600">
                            {loading ? (
                                <div className="animate-pulse bg-emerald-200 h-8 w-20 mx-auto rounded"></div>
                            ) : (
                                `${stats.platformFee.toLocaleString()}ì›`
                            )}
                        </div>
                        <div className="text-sm text-gray-600">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</div>
                        {!loading && stats.platformFee === 0 && (
                            <div className="text-xs text-gray-400 mt-1">ìˆ˜ìˆ˜ë£Œ ì—†ìŒ</div>
                        )}
                    </div>
                    <div className="text-center p-4 bg-amber-50 rounded-lg">
                        <div className="text-2xl font-bold text-amber-600">
                            {loading ? (
                                <div className="animate-pulse bg-amber-200 h-8 w-12 mx-auto rounded"></div>
                            ) : (
                                stats.pendingSettlements.toLocaleString()
                            )}
                        </div>
                        <div className="text-sm text-gray-600">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚°</div>
                        {!loading && stats.pendingSettlements === 0 && (
                            <div className="text-xs text-green-500 mt-1">ì²˜ë¦¬ ì™„ë£Œ</div>
                        )}
                    </div>
                </div>

                {/* ë¹ ë¥¸ ì•¡ì…˜ */}
                <div className="bg-gray-50 rounded-lg p-4">
                    <h3 className="font-medium mb-4">ğŸ“‹ ë¹ ë¥¸ ì‘ì—…</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <button className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm">
                            <div className="font-medium text-blue-600">ğŸ’° ì •ì‚° ì²˜ë¦¬</div>
                            <div className="text-gray-500">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚° í™•ì¸</div>
                        </button>
                        <button className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm">
                            <div className="font-medium text-green-600">ğŸ“Š ì›”ê°„ ë¦¬í¬íŠ¸</div>
                            <div className="text-gray-500">ì›”ê°„ ìˆ˜ìµ ë³´ê³ ì„œ ìƒì„±</div>
                        </button>
                        <button 
                            onClick={() => setActiveSection('experts')}
                            className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 text-left text-sm cursor-pointer hover:border-purple-300 transition-colors"
                        >
                            <div className="font-medium text-purple-600">ğŸ‘‘ ì „ë¬¸ê°€ ìŠ¹ì¸</div>
                            <div className="text-gray-500">ì‹ ê·œ ì „ë¬¸ê°€ ê²€í† </div>
                        </button>
                    </div>
                </div>
            </div>
        );

        // ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬ ì„¹ì…˜
        const FeeManagementSection = ({ currentUser }) => {
            const [settlements, setSettlements] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedPeriod, setSelectedPeriod] = useState('current');
            const [showCreateSettlement, setShowCreateSettlement] = useState(false);

            // ì •ì‚° ëª©ë¡ ë¡œë“œ (ì‹¤ë°ì´í„° ì—°ë™)
            const loadSettlements = async () => {
                try {
                    setLoading(true);
                    
                    // fee_settlements í…Œì´ë¸”ì—ì„œ ì •ì‚° ë‚´ì—­ ì¡°íšŒ
                    const { data: realSettlements, error } = await supabase
                        .from('fee_settlements')
                        .select(`
                            *,
                            expert:professionals!fee_settlements_expert_id_fkey(name, title, company),
                            booking:consultation_bookings!fee_settlements_booking_id_fkey(
                                scheduled_date, 
                                duration_minutes,
                                consultation_type,
                                job_seeker_id
                            )
                        `)
                        .order('created_at', { ascending: false });

                    if (error) {
                        console.error('ì •ì‚° ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ì‹œ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                        setSettlements(getSampleSettlements());
                        return;
                    }

                    // ì‹¤ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„°
                    if (realSettlements && realSettlements.length > 0) {
                        // ì‹¤ë°ì´í„°ë¥¼ UI í˜•ì‹ì— ë§ê²Œ ë³€í™˜
                        const formattedSettlements = realSettlements.map(settlement => ({
                            id: settlement.id,
                            expert_id: settlement.expert_id,
                            expert_name: settlement.expert?.name || 'í˜„ì§ì',
                            expert_title: settlement.expert?.title || settlement.expert?.company,
                            total_revenue: settlement.total_revenue,
                            platform_fee: settlement.platform_fee,
                            expert_payout: settlement.expert_payout,
                            status: settlement.settlement_status,
                            completed_date: settlement.completed_date,
                            paid_date: settlement.paid_date,
                            booking_info: settlement.booking,
                            created_at: settlement.created_at
                        }));
                        setSettlements(formattedSettlements);
                    } else {
                        // ì‹¤ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                        setSettlements(getSampleSettlements());
                    }
                } catch (error) {
                    console.error('ì •ì‚° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ìƒ˜í”Œ ì •ì‚° ë°ì´í„° (í´ë°±ìš©)
            const getSampleSettlements = () => [
                {
                    id: 1,
                    expert_id: 'expert1',
                    expert_name: 'ê¹€ê°œë°œíŒ€ì¥',
                    expert_title: 'ë„¤ì´ë²„ â€¢ ë°±ì—”ë“œ ê°œë°œíŒ€ì¥',
                    total_revenue: 1500000,
                    platform_fee: 300000,
                    expert_payout: 1200000,
                    status: 'pending',
                    completed_date: '2025-08-31T09:00:00Z',
                    created_at: '2025-08-31T09:00:00Z'
                },
                {
                    id: 2,
                    expert_id: 'expert2', 
                    expert_name: 'ë°•í”„ë¡ íŠ¸ì—”ë“œ',
                    expert_title: 'ì¹´ì¹´ì˜¤ â€¢ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                    total_revenue: 800000,
                    platform_fee: 160000,
                    expert_payout: 640000,
                    status: 'completed',
                    completed_date: '2025-08-25T14:30:00Z',
                    paid_date: '2025-08-26T10:00:00Z',
                    created_at: '2025-08-25T14:30:00Z'
                }
            ];

            // ì •ì‚° ìŠ¹ì¸ ì²˜ë¦¬ (ì‹¤ë°ì´í„° ì—°ë™)
            const approveSettlement = async (settlementId) => {
                try {
                    // fee_settlements í…Œì´ë¸”ì˜ ì •ì‚° ìƒíƒœë¥¼ 'paid'ë¡œ ì—…ë°ì´íŠ¸
                    const { error } = await supabase
                        .from('fee_settlements')
                        .update({ 
                            settlement_status: 'paid',
                            paid_date: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', settlementId);

                    if (error) throw error;
                    
                    alert('ì •ì‚°ì´ ìŠ¹ì¸ë˜ì–´ ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadSettlements();
                } catch (error) {
                    console.error('ì •ì‚° ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                    alert('ì •ì‚° ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ì •ì‚° ìƒì„±
            const createSettlement = async () => {
                try {
                    // ì‹¤ì œë¡œëŠ” ì •ì‚° ë¡œì§ ì‹¤í–‰
                    alert('ì •ì‚°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    setShowCreateSettlement(false);
                    loadSettlements();
                } catch (error) {
                    console.error('ì •ì‚° ìƒì„± ì˜¤ë¥˜:', error);
                    alert('ì •ì‚° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ìƒíƒœë³„ ë°°ì§€ ìƒ‰ìƒ
            const getStatusBadge = (status) => {
                switch (status) {
                    case 'pending':
                        return <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">ìŠ¹ì¸ ëŒ€ê¸°</span>;
                    case 'processing':
                        return <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">ì²˜ë¦¬ ì¤‘</span>;
                    case 'completed':
                        return <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">ì™„ë£Œ</span>;
                    case 'failed':
                        return <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">ì‹¤íŒ¨</span>;
                    default:
                        return <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs">{status}</span>;
                }
            };

            useEffect(() => {
                loadSettlements();
            }, []);

            if (loading) {
                return React.createElement('div', {
                    className: "flex items-center justify-center py-12"
                }, React.createElement('div', {
                    className: "text-center"
                }, [
                    React.createElement('div', {
                        key: 'icon',
                        className: "text-4xl mb-4"
                    }, 'ğŸ’°'),
                    React.createElement('p', {
                        key: 'text',
                        className: "text-gray-500"
                    }, 'ì •ì‚° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...')
                ]));
            }

            return (
                <div className="space-y-6">
                    {/* í—¤ë” */}
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-semibold">ğŸ’° ìˆ˜ìˆ˜ë£Œ ê´€ë¦¬</h2>
                        <div className="flex gap-3">
                            <select
                                value={selectedPeriod}
                                onChange={(e) => setSelectedPeriod(e.target.value)}
                                className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="current">ì´ë²ˆ ë‹¬</option>
                                <option value="last">ì§€ë‚œ ë‹¬</option>
                                <option value="all">ì „ì²´</option>
                            </select>
                            <button
                                onClick={() => setShowCreateSettlement(true)}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                â• ì •ì‚° ìƒì„±
                            </button>
                        </div>
                    </div>

                    {/* ì •ì‚° ìš”ì•½ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <div className="text-sm text-blue-600 font-medium">ì´ ì •ì‚° ê±´ìˆ˜</div>
                            <div className="text-2xl font-bold text-blue-700">{settlements?.length || 0}</div>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                            <div className="text-sm text-green-600 font-medium">ì™„ë£Œëœ ì •ì‚°</div>
                            <div className="text-2xl font-bold text-green-700">
                                {settlements?.filter(s => s.status === 'completed').length || 0}
                            </div>
                        </div>
                        <div className="bg-yellow-50 p-4 rounded-lg">
                            <div className="text-sm text-yellow-600 font-medium">ëŒ€ê¸° ì¤‘ì¸ ì •ì‚°</div>
                            <div className="text-2xl font-bold text-yellow-700">
                                {settlements?.filter(s => s.status === 'pending').length || 0}
                            </div>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <div className="text-sm text-purple-600 font-medium">ì´ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</div>
                            <div className="text-2xl font-bold text-purple-700">
                                {(settlements || []).reduce((sum, s) => sum + s.platform_fee, 0).toLocaleString()}ì›
                            </div>
                        </div>
                    </div>

                    {/* ì •ì‚° ëª©ë¡ */}
                    <div className="bg-white rounded-lg border border-gray-200">
                        <div className="px-6 py-4 border-b border-gray-200">
                            <h3 className="font-medium text-gray-800">ì •ì‚° ë‚´ì—­</h3>
                        </div>
                        
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì „ë¬¸ê°€</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì •ì‚° ê¸°ê°„</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒë‹´ ê±´ìˆ˜</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì´ ë§¤ì¶œ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì „ë¬¸ê°€ ìˆ˜ë ¹ì•¡</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì•¡ì…˜</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {(settlements || []).map((settlement) => (
                                        <tr key={settlement.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="font-medium text-gray-900">{settlement.expert_name}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {settlement.settlement_period}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.total_bookings}ê±´
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.total_revenue.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                {settlement.platform_fee.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                {settlement.expert_payout.toLocaleString()}ì›
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                {getStatusBadge(settlement.status)}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm space-x-2">
                                                {settlement.status === 'pending' && (
                                                    <button
                                                        onClick={() => approveSettlement(settlement.id)}
                                                        className="text-green-600 hover:text-green-900 font-medium"
                                                    >
                                                        ìŠ¹ì¸
                                                    </button>
                                                )}
                                                <button className="text-blue-600 hover:text-blue-900 font-medium">
                                                    ìƒì„¸
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* ì •ì‚° ìƒì„± ëª¨ë‹¬ */}
                    {showCreateSettlement && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold text-gray-800">ì •ì‚° ìƒì„±</h3>
                                    <button
                                        onClick={() => setShowCreateSettlement(false)}
                                        className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                                    >
                                        Ã—
                                    </button>
                                </div>

                                <div className="space-y-4 mb-6">
                                    <p className="text-gray-600">
                                        ì´ë²ˆ ë‹¬ ì™„ë£Œëœ ìƒë‹´ì— ëŒ€í•œ ì •ì‚°ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                                    </p>
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <div className="text-sm space-y-1">
                                            <div>â€¢ ëŒ€ìƒ ê¸°ê°„: 2024ë…„ 8ì›”</div>
                                            <div>â€¢ ì²˜ë¦¬ ì˜ˆìƒ ì‹œê°„: 5-10ë¶„</div>
                                            <div>â€¢ ì •ì‚° ì™„ë£Œ í›„ í˜„ì§ìì—ê²Œ ìë™ ì•Œë¦¼</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowCreateSettlement(false)}
                                        className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={createSettlement}
                                        className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                    >
                                        ì •ì‚° ìƒì„±
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì „ë¬¸ê°€ ê´€ë¦¬ ì„¹ì…˜ - ì™„ì „ êµ¬í˜„
        const ExpertManagementSection = ({ currentUser }) => {
            const [activeTab, setActiveTab] = useState('pending');
            const [experts, setExperts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [processingId, setProcessingId] = useState(null);
            const [selectedExpert, setSelectedExpert] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [showBulkActions, setShowBulkActions] = useState(false);
            const [actionReason, setActionReason] = useState('');

            // ì „ë¬¸ê°€ ëª©ë¡ ë¡œë“œ
            useEffect(() => {
                loadExperts();
            }, [activeTab]);

            const loadExperts = async () => {
                try {
                    setLoading(true);
                    if (supabase) {
                        // expert_requests í…Œì´ë¸”ì—ì„œ ì¡°íšŒ (user_profilesì™€ ì¡°ì¸)
                        const { data, error } = await supabase
                            .from('professional_requests')
                            .select(`
                                *,
                                user_profiles!inner(id, nickname, email, role)
                            `)
                            .eq('status', activeTab === 'pending' ? 'pending' : 
                                        activeTab === 'approved' ? 'approved' : 'rejected')
                            .order('created_at', { ascending: false });
                        
                        if (error) throw error;
                        console.log('ì „ë¬¸ê°€ ìš”ì²­ ëª©ë¡ ë¡œë“œ:', data);
                        setExperts(data || []);
                    } else {
                        // ë°ëª¨ ë°ì´í„°
                        const demoExperts = [
                            {
                                id: 1,
                                user_id: 'expert1',
                                email: 'expert1@example.com',
                                nickname: 'ê¹€ê°œë°œë§¤ë‹ˆì €',
                                expert_type: 'tech_development',
                                expert_title: 'ë„¤ì´ë²„ â€¢ ë°±ì—”ë“œ ê°œë°œíŒ€ì¥',
                                expert_specialties: ['ë°±ì—”ë“œê°œë°œ', 'ì‹œìŠ¤í…œì„¤ê³„', 'ê¸°ìˆ ë©´ì ‘'],
                                expert_credentials: ['ì»´í“¨í„°ê³µí•™ë°•ì‚¬', 'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬', 'AWS ìê²©ì¦'],
                                expert_experience_years: '15',
                                expert_bio: '15ë…„ ê²½ë ¥ì˜ ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤. ëŒ€ê·œëª¨ ì„œë¹„ìŠ¤ ê°œë°œê³¼ ê¸°ìˆ ë©´ì ‘ ë©˜í† ë§ì„ ì „ë¬¸ìœ¼ë¡œ í•©ë‹ˆë‹¤.',
                                expert_hourly_rate: '100000',
                                expert_phone: '010-1234-5678',
                                expert_business_license: 'BL-2024-001',
                                expert_qualification_number: 'CPA-12345',
                                expert_status: activeTab,
                                created_at: '2024-08-20T10:30:00Z',
                                expert_available_types: ['phone', 'video']
                            },
                            {
                                id: 2,
                                user_id: 'expert2',
                                email: 'expert2@example.com',
                                nickname: 'ë°•ë§ˆì¼€íŒ…ì´ì‚¬',
                                expert_type: 'marketing_planning',
                                expert_title: 'ì¹´ì¹´ì˜¤ â€¢ ë§ˆì¼€íŒ… ì „ëµì´ì‚¬',
                                expert_specialties: ['ë””ì§€í„¸ë§ˆì¼€íŒ…', 'ê·¸ë¡œìŠ¤í•´í‚¹', 'ë¸Œëœë”©'],
                                expert_credentials: ['ê²½ì˜í•™ì„ì‚¬', 'Google Analytics', 'Facebook Blueprint'],
                                expert_experience_years: '8',
                                expert_bio: '8ë…„ ê²½ë ¥ì˜ ë§ˆì¼€íŒ… ì „ëµê°€ì…ë‹ˆë‹¤. ë””ì§€í„¸ ë§ˆì¼€íŒ…ê³¼ ë¸Œëœë”© ì „ëµì„ ì „ë¬¸ìœ¼ë¡œ í•©ë‹ˆë‹¤.',
                                expert_hourly_rate: '80000',
                                expert_phone: '010-9876-5432',
                                expert_business_license: '',
                                expert_qualification_number: 'TG-67890',
                                expert_status: activeTab,
                                created_at: '2024-08-19T14:20:00Z',
                                expert_available_types: ['phone', 'video', 'chat']
                            }
                        ];
                        setExperts(activeTab === 'pending' ? demoExperts : []);
                    }
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    setExperts([]);
                } finally {
                    setLoading(false);
                }
            };

            // ì „ë¬¸ê°€ ìŠ¹ì¸/ê±°ì ˆ ì²˜ë¦¬
            const handleExpertAction = async (expertId, action, reason = '') => {
                if (!confirm(`ì •ë§ë¡œ ì´ ì „ë¬¸ê°€ë¥¼ ${action === 'approve' ? 'ìŠ¹ì¸' : 'ê±°ì ˆ'}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }

                try {
                    setProcessingId(expertId);
                    const newStatus = action === 'approve' ? 'approved' : 'rejected';
                    
                    if (supabase) {
                        // expert_requests í…Œì´ë¸” ìƒíƒœ ì—…ë°ì´íŠ¸
                        const { data: requestData, error: requestError } = await supabase
                            .from('professional_requests')
                            .update({ 
                                status: newStatus,
                                reviewed_by: currentUser.id,
                                review_reason: reason || (action === 'approve' ? 'ì „ë¬¸ê°€ ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.' : 'ìê²© ìš”ê±´ ë¯¸ë‹¬'),
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', expertId)
                            .select()
                            .single();
                        
                        if (requestError) throw requestError;

                        // ìŠ¹ì¸ëœ ê²½ìš° user_profiles í…Œì´ë¸”ì— role ì—…ë°ì´íŠ¸
                        if (action === 'approve' && requestData) {
                            const { error: profileError } = await supabase
                                .from('user_profiles')
                                .update({ 
                                    role: 'expert',
                                    expert_status: 'approved',
                                    expert_status_updated_at: new Date().toISOString(),
                                    expert_status_reason: reason || 'ì „ë¬¸ê°€ ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.'
                                })
                                .eq('id', requestData.user_id);
                            
                            if (profileError) {
                                console.warn('user_profiles ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', profileError);
                            }
                        }
                        
                        // ìŠ¹ì¸/ê±°ì ˆ ì´ë©”ì¼ ë°œì†¡
                        const currentExpert = experts.find(e => e.user_id === expertId);
                        if (currentExpert) {
                            const emailResult = await sendExpertNotification(currentExpert, action, reason);
                            if (!emailResult.success) {
                                console.warn('ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailResult.message);
                            }
                        }
                    }
                    
                    alert(`ì „ë¬¸ê°€ ${action === 'approve' ? 'ìŠ¹ì¸' : 'ê±°ì ˆ'} ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    setActionReason('');
                    setShowDetailModal(false);
                    loadExperts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                    alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setProcessingId(null);
                }
            };

            // ì „ë¬¸ê°€ ìƒì„¸ ì •ë³´ ë³´ê¸°
            const showExpertDetail = (expert) => {
                setSelectedExpert(expert);
                setShowDetailModal(true);
            };

            const tabs = [
                { id: 'pending', name: 'ìŠ¹ì¸ ëŒ€ê¸°', icon: 'â³', count: experts.filter(e => e.expert_status === 'pending').length },
                { id: 'approved', name: 'ìŠ¹ì¸ë¨', icon: 'âœ…', count: experts.filter(e => e.expert_status === 'approved').length },
                { id: 'rejected', name: 'ê±°ì ˆë¨', icon: 'âŒ', count: experts.filter(e => e.expert_status === 'rejected').length },
                { id: 'all', name: 'ì „ì²´', icon: 'ğŸ“‹', count: experts.length }
            ];

            return React.createElement('div', {
                className: 'space-y-6'
            }, [
                // í—¤ë”
                React.createElement('div', {
                    key: 'header',
                    className: 'flex items-center justify-between'
                }, [
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-xl font-semibold'
                    }, 'ğŸ¯ ì „ë¬¸ê°€ ìŠ¹ì¸ ê´€ë¦¬'),
                    React.createElement('div', {
                        key: 'header-actions',
                        className: 'flex items-center space-x-4'
                    }, [
                        // ì¼ê´„ ì²˜ë¦¬ ë²„íŠ¼ (ìŠ¹ì¸ ëŒ€ê¸° íƒ­ì—ì„œë§Œ í‘œì‹œ)
                        activeTab === 'pending' && experts?.filter(e => e.expert_status === 'pending').length > 0 ? 
                            React.createElement('div', {
                                key: 'bulk-actions',
                                className: 'flex space-x-2'
                            }, [
                                React.createElement('button', {
                                    key: 'bulk-approve',
                                    onClick: () => {
                                        if (confirm('ëª¨ë“  ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì „ë¬¸ê°€ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                            experts.filter(e => e.expert_status === 'pending')
                                                .forEach(expert => handleExpertAction(expert.user_id, 'approve'));
                                        }
                                    },
                                    disabled: processingId,
                                    className: 'px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg font-medium transition-colors disabled:opacity-50'
                                }, 'âœ… ì¼ê´„ ìŠ¹ì¸'),
                                React.createElement('button', {
                                    key: 'advanced-actions',
                                    onClick: () => setShowBulkActions(!showBulkActions),
                                    className: 'px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg font-medium transition-colors'
                                }, 'âš™ï¸ ê³ ê¸‰ ì‘ì—…')
                            ]) : null,
                        React.createElement('div', {
                            key: 'expert-count',
                            className: 'text-sm text-gray-500'
                        }, `ì´ ${experts?.length || 0}ëª…ì˜ ì „ë¬¸ê°€`)
                    ])
                ]),

                // íƒ­ ë©”ë‰´
                React.createElement('div', {
                    key: 'tab-menu',
                    className: 'border-b border-gray-200'
                }, React.createElement('div', {
                    className: 'flex space-x-8'
                }, tabs.map((tab) => 
                    React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `py-2 px-1 border-b-2 font-medium text-sm transition-colors flex items-center space-x-2 ${
                            activeTab === tab.id
                                ? 'border-blue-500 text-blue-600'
                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                        }`
                    }, [
                        React.createElement('span', { key: 'icon' }, tab.icon),
                        React.createElement('span', { key: 'name' }, tab.name),
                        activeTab !== 'all' ? React.createElement('span', {
                            key: 'count',
                            className: `px-2 py-0.5 text-xs rounded-full ${
                                activeTab === tab.id ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-500'
                            }`
                        }, experts.length) : null
                    ])
                ))),

                // ì „ë¬¸ê°€ ëª©ë¡
                loading ? React.createElement('div', {
                    key: 'loading',
                    className: 'text-center py-12'
                }, [
                    React.createElement('div', {
                        key: 'spinner',
                        className: 'inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600'
                    }),
                    React.createElement('p', {
                        key: 'text',
                        className: 'mt-2 text-gray-500'
                    }, 'ì „ë¬¸ê°€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...')
                ]) : (!experts || experts.length === 0) ? React.createElement('div', {
                    key: 'empty',
                    className: 'text-center py-12 text-gray-500'
                }, [
                    React.createElement('div', {
                        key: 'icon',
                        className: 'text-4xl mb-4'
                    }, 'ğŸ“'),
                    React.createElement('p', {
                        key: 'message'
                    }, activeTab === 'pending' ? 'ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ì „ë¬¸ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'í•´ë‹¹í•˜ëŠ” ì „ë¬¸ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.')
                ]) : React.createElement('div', {
                    key: 'expert-list',
                    className: 'space-y-4'
                }, (experts || []).map((expert) => 
                    React.createElement('div', {
                        key: expert.id || expert.user_id,
                        className: 'bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow'
                    }, [
                        React.createElement('div', {
                            key: 'expert-content',
                            className: 'text-center py-4'
                        }, [
                            React.createElement('h3', {
                                key: 'name',
                                className: 'font-semibold'
                            }, expert.nickname),
                            React.createElement('p', {
                                key: 'title',
                                className: 'text-gray-600'
                            }, expert.expert_title),
                            React.createElement('button', {
                                key: 'detail-btn',
                                onClick: () => showExpertDetail(expert),
                                className: 'mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg'
                            }, 'ìƒì„¸ ë³´ê¸°')
                        ])
                    ])
                ))
            ]);
        };

        // íšŒì› ê´€ë¦¬ ì„¹ì…˜ (ê¸°ë³¸ êµ¬í˜„)  
        const UserManagementSection = ({ currentUser }) => {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterRole, setFilterRole] = useState('all');
            const [selectedUser, setSelectedUser] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);
            
            // ê³„ì • ê´€ë¦¬ ê´€ë ¨ state
            const [showSuspendModal, setShowSuspendModal] = useState(false);
            const [suspendReason, setSuspendReason] = useState('');
            const [suspendDuration, setSuspendDuration] = useState('7'); // ê¸°ë³¸ 7ì¼
            const [actionLoading, setActionLoading] = useState(false);

            // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
            const loadUsers = async () => {
                try {
                    setLoading(true);
                    if (supabase) {
                        const { data, error } = await supabase
                            .from('user_profiles')
                            .select('*')
                            .order('created_at', { ascending: false });
                        
                        if (error) throw error;
                        setUsers(data || []);
                    } else {
                        // ë°ëª¨ ë°ì´í„°
                        const demoUsers = [
                            {
                                id: '1',
                                email: 'user1@example.com',
                                nickname: 'ì¸ì‚¬ì´ë“œì¡ìœ ì €1',
                                role: 'member',
                                created_at: '2024-08-15T10:00:00.000Z',
                                expert_status: null
                            },
                            {
                                id: '2',
                                email: 'expert1@example.com',
                                nickname: 'ê¹€ê°œë°œë§¤ë‹ˆì €',
                                role: 'expert',
                                created_at: '2024-08-10T15:30:00.000Z',
                                expert_status: 'approved'
                            }
                        ];
                        setUsers(demoUsers);
                    }
                } catch (error) {
                    console.error('Error loading users:', error);
                    setUsers([]);
                }
                setLoading(false);
            };

            useEffect(() => {
                loadUsers();
            }, []);

            // ì‚¬ìš©ì ì—­í•  ë³€ê²½
            const changeUserRole = async (userId, newRole) => {
                if (!confirm(`ì‚¬ìš©ìì˜ ì—­í• ì„ '${newRole}'ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
                
                try {
                    if (supabase) {
                        const { error } = await supabase
                            .from('user_profiles')
                            .update({ role: newRole })
                            .eq('id', userId);
                        
                        if (error) throw error;
                        loadUsers(); // ìƒˆë¡œê³ ì¹¨
                        alert('ì—­í• ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ì—­í•  ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Error changing user role:', error);
                    alert('ì—­í•  ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ê³„ì • ì •ì§€ ì²˜ë¦¬
            const suspendUser = async () => {
                if (!selectedUser || !suspendReason.trim()) {
                    alert('ì •ì§€ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                setActionLoading(true);
                try {
                    const suspendUntil = suspendDuration === 'permanent' ? null : 
                        new Date(Date.now() + parseInt(suspendDuration) * 24 * 60 * 60 * 1000).toISOString();
                    
                    if (supabase) {
                        const { error } = await supabase
                            .from('user_profiles')
                            .update({
                                account_status: 'suspended',
                                suspended_reason: suspendReason,
                                suspended_until: suspendUntil,
                                suspended_by: currentUser.id,
                                suspended_at: new Date().toISOString()
                            })
                            .eq('id', selectedUser.id);
                        
                        if (error) throw error;
                        
                        // Supabase Authì—ì„œë„ ì‚¬ìš©ì ë¹„í™œì„±í™” (ì„ íƒì‚¬í•­)
                        // await supabaseClient.auth.admin.updateUserById(selectedUser.id, { ban_duration: '999999h' });
                        
                        loadUsers();
                        setShowSuspendModal(false);
                        setSelectedUser(null);
                        setSuspendReason('');
                        alert('ê³„ì •ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ê³„ì • ì •ì§€ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Error suspending user:', error);
                    alert('ê³„ì • ì •ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setActionLoading(false);
                }
            };

            // ê³„ì • ì •ì§€ í•´ì œ
            const unsuspendUser = async (user) => {
                if (!confirm('ì´ ì‚¬ìš©ìì˜ ê³„ì • ì •ì§€ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                
                setActionLoading(true);
                try {
                    if (supabase) {
                        const { error } = await supabase
                            .from('user_profiles')
                            .update({
                                account_status: 'active',
                                suspended_reason: null,
                                suspended_until: null,
                                suspended_by: null,
                                suspended_at: null
                            })
                            .eq('id', user.id);
                        
                        if (error) throw error;
                        
                        loadUsers();
                        alert('ê³„ì • ì •ì§€ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ê³„ì • ì •ì§€ í•´ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Error unsuspending user:', error);
                    alert('ê³„ì • ì •ì§€ í•´ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setActionLoading(false);
                }
            };

            // ê³„ì • ì‚­ì œ (ë¹„í™œì„±í™”)
            const deactivateUser = async (user) => {
                const reason = prompt('ê³„ì • ì‚­ì œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
                if (!reason) return;
                
                if (!confirm(`'${user.nickname}' ì‚¬ìš©ìì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
                
                setActionLoading(true);
                try {
                    if (supabase) {
                        const { error } = await supabase
                            .from('user_profiles')
                            .update({
                                account_status: 'deleted',
                                suspended_reason: `ê³„ì • ì‚­ì œ: ${reason}`,
                                suspended_by: currentUser.id,
                                suspended_at: new Date().toISOString()
                            })
                            .eq('id', user.id);
                        
                        if (error) throw error;
                        
                        loadUsers();
                        alert('ê³„ì •ì´ ì‚­ì œ(ë¹„í™œì„±í™”)ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ê³„ì • ì‚­ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('Error deactivating user:', error);
                    alert('ê³„ì • ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setActionLoading(false);
                }
            };

            // í•„í„°ë§ëœ ì‚¬ìš©ì ëª©ë¡
            const filteredUsers = (users || []).filter(user => {
                const matchesSearch = user.nickname?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    user.email?.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesRole = filterRole === 'all' || user.role === filterRole;
                return matchesSearch && matchesRole;
            });

            const getRoleBadge = (role) => {
                const badges = {
                    'admin': { bg: 'bg-red-100', text: 'text-red-800', label: 'ê´€ë¦¬ì' },
                    'expert': { bg: 'bg-blue-100', text: 'text-blue-800', label: 'ì „ë¬¸ê°€' },
                    'member': { bg: 'bg-green-100', text: 'text-green-800', label: 'ì¼ë°˜íšŒì›' },
                    'guest': { bg: 'bg-gray-100', text: 'text-gray-800', label: 'ê²ŒìŠ¤íŠ¸' }
                };
                const badge = badges[role] || badges['member'];
                return React.createElement('span', {
                    className: `px-2 py-1 rounded-full text-xs font-medium ${badge.bg} ${badge.text}`
                }, badge.label);
            };

            const getStatusBadge = (accountStatus) => {
                const badges = {
                    'active': { bg: 'bg-green-100', text: 'text-green-800', label: 'ì •ìƒ' },
                    'suspended': { bg: 'bg-red-100', text: 'text-red-800', label: 'ì •ì§€ë¨' },
                    'deactivated': { bg: 'bg-gray-100', text: 'text-gray-800', label: 'ë¹„í™œì„±í™”' },
                    'deleted': { bg: 'bg-black', text: 'text-white', label: 'ì‚­ì œë¨' }
                };
                const badge = badges[accountStatus] || badges['active'];
                return React.createElement('span', {
                    className: `px-2 py-1 rounded-full text-xs font-medium ${badge.bg} ${badge.text}`
                }, badge.label);
            };

            return (
                <div className="space-y-6">
                    {/* í—¤ë” ë° ê²€ìƒ‰ */}
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-semibold">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
                            <p className="text-sm text-gray-500 mt-1">ì´ {users?.length || 0}ëª…ì˜ íšŒì›</p>
                        </div>
                    </div>

                    {/* ê²€ìƒ‰ ë° í•„í„° */}
                    <div className="flex gap-4 mb-6">
                        <div className="flex-1">
                            <input
                                type="text"
                                placeholder="ë‹‰ë„¤ì„ ë˜ëŠ” ì´ë©”ì¼ë¡œ ê²€ìƒ‰..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                        <select
                            value={filterRole}
                            onChange={(e) => setFilterRole(e.target.value)}
                            className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="all">ëª¨ë“  ì—­í• </option>
                            <option value="admin">ê´€ë¦¬ì</option>
                            <option value="expert">ì „ë¬¸ê°€</option>
                            <option value="member">ì¼ë°˜íšŒì›</option>
                            <option value="guest">ê²ŒìŠ¤íŠ¸</option>
                        </select>
                    </div>

                    {/* ì‚¬ìš©ì ëª©ë¡ */}
                    {loading ? (
                        <div className="text-center py-8">
                            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p className="mt-2 text-gray-500">ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    ) : filteredUsers.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                            <div className="text-4xl mb-4">ğŸ‘¥</div>
                            <p>{searchTerm ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                        </div>
                    ) : (
                        <div className="bg-white shadow rounded-lg overflow-hidden">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì‚¬ìš©ì</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì—­í• </th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ê°€ì…ì¼</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì•¡ì…˜</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredUsers.map((user) => (
                                        <tr key={user.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div>
                                                    <div className="font-medium text-gray-900">{user.nickname}</div>
                                                    <div className="text-sm text-gray-500">{user.email}</div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="space-y-1">
                                                    {getRoleBadge(user.role)}
                                                    {user.expert_status && (
                                                        <div className="text-xs text-gray-500">
                                                            ì „ë¬¸ê°€: {user.expert_status}
                                                        </div>
                                                    )}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="space-y-1">
                                                    {getStatusBadge(user.account_status || 'active')}
                                                    {user.account_status === 'suspended' && user.suspended_until && (
                                                        <div className="text-xs text-gray-500">
                                                            í•´ì œ: {new Date(user.suspended_until).toLocaleDateString('ko-KR')}
                                                        </div>
                                                    )}
                                                    {user.suspended_reason && (
                                                        <div className="text-xs text-red-600" title={user.suspended_reason}>
                                                            ì‚¬ìœ : {user.suspended_reason.length > 20 ? 
                                                                user.suspended_reason.substring(0, 20) + '...' : 
                                                                user.suspended_reason}
                                                        </div>
                                                    )}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {new Date(user.created_at).toLocaleDateString('ko-KR')}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                <div className="flex gap-2 flex-wrap">
                                                    <button
                                                        onClick={() => {
                                                            setSelectedUser(user);
                                                            setShowDetailModal(true);
                                                        }}
                                                        className="text-blue-600 hover:text-blue-800 font-medium"
                                                    >
                                                        ìƒì„¸ë³´ê¸°
                                                    </button>
                                                    
                                                    {user.role !== 'admin' && (
                                                        <>
                                                            <select
                                                                onChange={(e) => changeUserRole(user.id, e.target.value)}
                                                                className="text-sm border border-gray-300 rounded px-2 py-1"
                                                                defaultValue={user.role}
                                                            >
                                                                <option value="member">ì¼ë°˜íšŒì›</option>
                                                                <option value="expert">ì „ë¬¸ê°€</option>
                                                                <option value="admin">ê´€ë¦¬ì</option>
                                                            </select>
                                                            
                                                            {user.account_status === 'suspended' ? (
                                                                <button
                                                                    onClick={() => unsuspendUser(user)}
                                                                    disabled={actionLoading}
                                                                    className="text-green-600 hover:text-green-800 font-medium text-xs px-2 py-1 border border-green-300 rounded"
                                                                >
                                                                    ì •ì§€í•´ì œ
                                                                </button>
                                                            ) : user.account_status !== 'deleted' && (
                                                                <button
                                                                    onClick={() => {
                                                                        setSelectedUser(user);
                                                                        setShowSuspendModal(true);
                                                                    }}
                                                                    disabled={actionLoading}
                                                                    className="text-orange-600 hover:text-orange-800 font-medium text-xs px-2 py-1 border border-orange-300 rounded"
                                                                >
                                                                    ì •ì§€
                                                                </button>
                                                            )}
                                                            
                                                            {user.account_status !== 'deleted' && (
                                                                <button
                                                                    onClick={() => deactivateUser(user)}
                                                                    disabled={actionLoading}
                                                                    className="text-red-600 hover:text-red-800 font-medium text-xs px-2 py-1 border border-red-300 rounded"
                                                                >
                                                                    ì‚­ì œ
                                                                </button>
                                                            )}
                                                        </>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* ì‚¬ìš©ì ìƒì„¸ ëª¨ë‹¬ */}
                    {showDetailModal && selectedUser && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full shadow-xl">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">ì‚¬ìš©ì ìƒì„¸ ì •ë³´</h3>
                                    <button
                                        onClick={() => setShowDetailModal(false)}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        Ã—
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    <div>
                                        <span className="font-medium">ë‹‰ë„¤ì„:</span> {selectedUser.nickname}
                                    </div>
                                    <div>
                                        <span className="font-medium">ì´ë©”ì¼:</span> {selectedUser.email}
                                    </div>
                                    <div>
                                        <span className="font-medium">ì—­í• :</span> {getRoleBadge(selectedUser.role)}
                                    </div>
                                    <div>
                                        <span className="font-medium">ê°€ì…ì¼:</span> {new Date(selectedUser.created_at).toLocaleString('ko-KR')}
                                    </div>
                                    {selectedUser.expert_status && (
                                        <div>
                                            <span className="font-medium">ì „ë¬¸ê°€ ìƒíƒœ:</span> {selectedUser.expert_status}
                                        </div>
                                    )}
                                </div>
                                <div className="mt-6 flex justify-end">
                                    <button
                                        onClick={() => setShowDetailModal(false)}
                                        className="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
                                    >
                                        ë‹«ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ê³„ì • ì •ì§€ ëª¨ë‹¬ */}
                    {showSuspendModal && selectedUser && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full shadow-xl">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold text-red-600">âš ï¸ ê³„ì • ì •ì§€</h3>
                                    <button
                                        onClick={() => {
                                            setShowSuspendModal(false);
                                            setSelectedUser(null);
                                            setSuspendReason('');
                                            setSuspendDuration('7');
                                        }}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        Ã—
                                    </button>
                                </div>
                                
                                <div className="mb-4">
                                    <div className="p-3 bg-yellow-50 border border-yellow-200 rounded">
                                        <p className="text-sm text-yellow-800">
                                            <strong>{selectedUser.nickname}</strong> ì‚¬ìš©ìì˜ ê³„ì •ì„ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                                        </p>
                                        <p className="text-xs text-yellow-600 mt-1">
                                            ì •ì§€ëœ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ì´ ì œí•œë©ë‹ˆë‹¤.
                                        </p>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            ì •ì§€ ê¸°ê°„
                                        </label>
                                        <select
                                            value={suspendDuration}
                                            onChange={(e) => setSuspendDuration(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                        >
                                            <option value="1">1ì¼</option>
                                            <option value="3">3ì¼</option>
                                            <option value="7">7ì¼</option>
                                            <option value="14">14ì¼</option>
                                            <option value="30">30ì¼</option>
                                            <option value="permanent">ë¬´ê¸°í•œ</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            ì •ì§€ ì‚¬ìœ  <span className="text-red-500">*</span>
                                        </label>
                                        <textarea
                                            value={suspendReason}
                                            onChange={(e) => setSuspendReason(e.target.value)}
                                            placeholder="ì •ì§€ ì‚¬ìœ ë¥¼ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”..."
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 resize-none"
                                            rows="3"
                                        />
                                    </div>
                                </div>

                                <div className="mt-6 flex justify-end gap-3">
                                    <button
                                        onClick={() => {
                                            setShowSuspendModal(false);
                                            setSelectedUser(null);
                                            setSuspendReason('');
                                            setSuspendDuration('7');
                                        }}
                                        disabled={actionLoading}
                                        className="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={suspendUser}
                                        disabled={actionLoading || !suspendReason.trim()}
                                        className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 flex items-center gap-2"
                                    >
                                        {actionLoading && (
                                            <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                                        )}
                                        ê³„ì • ì •ì§€
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì½˜í…ì¸  ì‹ ê³  ê´€ë¦¬ ì„¹ì…˜
        const ContentReportManagementSection = ({ currentUser }) => {
            const [reports, setReports] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterStatus, setFilterStatus] = useState('all');
            const [filterCategory, setFilterCategory] = useState('all');
            const [selectedReport, setSelectedReport] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [actionLoading, setActionLoading] = useState(false);

            // ì‹ ê³  ì¹´í…Œê³ ë¦¬ ì •ì˜
            const reportCategories = {
                spam: { name: 'ìŠ¤íŒ¸/ë„ë°°', color: 'red' },
                inappropriate_content: { name: 'ë¶€ì ì ˆí•œ ì½˜í…ì¸ ', color: 'orange' },
                harassment: { name: 'ê´´ë¡­í˜/ìš•ì„¤', color: 'red' },
                fake_info: { name: 'í—ˆìœ„ ì •ë³´', color: 'yellow' },
                copyright_violation: { name: 'ì €ì‘ê¶Œ ì¹¨í•´', color: 'purple' },
                adult_content: { name: 'ì„±ì¸ ì½˜í…ì¸ ', color: 'red' },
                violence: { name: 'í­ë ¥ì  ì½˜í…ì¸ ', color: 'red' },
                other: { name: 'ê¸°íƒ€', color: 'gray' }
            };

            const reportStatuses = {
                pending: { name: 'ëŒ€ê¸° ì¤‘', color: 'yellow' },
                reviewing: { name: 'ê²€í†  ì¤‘', color: 'blue' },
                resolved: { name: 'ì²˜ë¦¬ ì™„ë£Œ', color: 'green' },
                dismissed: { name: 'ê¸°ê°', color: 'gray' }
            };

            // ì‹ ê³  ëª©ë¡ ë¡œë“œ
            const loadReports = async () => {
                setLoading(true);
                try {
                    if (!supabase) {
                        // Demo ë°ì´í„°
                        setReports([
                            {
                                id: '1',
                                target_type: 'post',
                                target_title: 'ì·¨ì—… ê´€ë ¨ ì§ˆë¬¸ì…ë‹ˆë‹¤',
                                target_author_id: 'user1',
                                reporter_id: 'user2',
                                report_category: 'spam',
                                report_reason: 'ë™ì¼í•œ ë‚´ìš©ì„ ê³„ì† ë°˜ë³µ ê²Œì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                                status: 'pending',
                                created_at: new Date().toISOString(),
                                target_author: { nickname: 'ì‹ ê³ ë‹¹í•œì‚¬ìš©ì' },
                                reporter: { nickname: 'ì‹ ê³ ì' }
                            },
                            {
                                id: '2',
                                target_type: 'expert_service',
                                target_title: 'IT ê°œë°œì ë©˜í† ë§ ì„œë¹„ìŠ¤',
                                target_author_id: 'expert1',
                                reporter_id: 'user3',
                                report_category: 'fake_info',
                                report_reason: 'í—ˆìœ„ ê²½ë ¥ì„ ê¸°ì¬í•˜ê³  ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.',
                                status: 'reviewing',
                                created_at: new Date(Date.now() - 86400000).toISOString(),
                                reviewed_by: currentUser?.id,
                                target_author: { nickname: 'ì „ë¬¸ê°€ì‚¬ìš©ì' },
                                reporter: { nickname: 'ì‹ ê³ ì2' }
                            }
                        ]);
                        return;
                    }

                    // ì‹¤ì œ DB ì¿¼ë¦¬
                    const { data, error } = await supabase
                        .from('content_reports')
                        .select(`
                            *,
                            target_author:target_author_id(nickname),
                            reporter:reporter_id(nickname),
                            reviewer:reviewed_by(nickname)
                        `)
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setReports(data || []);

                } catch (error) {
                    console.error('ì‹ ê³  ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    setReports([]);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadReports();
            }, []);

            // ì‹ ê³  ì²˜ë¦¬
            const handleReportAction = async (reportId, action, notes = '') => {
                if (!confirm(`ì´ ì‹ ê³ ë¥¼ ${action === 'resolved' ? 'ì²˜ë¦¬ ì™„ë£Œ' : 'ê¸°ê°'}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                setActionLoading(true);
                try {
                    if (supabase) {
                        const { error } = await supabase
                            .from('content_reports')
                            .update({
                                status: action,
                                reviewed_by: currentUser.id,
                                reviewed_at: new Date().toISOString(),
                                admin_notes: notes
                            })
                            .eq('id', reportId);

                        if (error) throw error;

                        // ì•¡ì…˜ ë¡œê·¸ ìƒì„±
                        await supabase.from('report_actions').insert({
                            report_id: reportId,
                            action_type: 'status_changed',
                            action_by: currentUser.id,
                            action_reason: notes,
                            previous_status: selectedReport?.status,
                            new_status: action
                        });

                        loadReports();
                        setShowDetailModal(false);
                        alert('ì‹ ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ì‹ ê³  ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ì‹ ê³  ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setActionLoading(false);
                }
            };

            // í•„í„°ë§ëœ ì‹ ê³  ëª©ë¡
            const filteredReports = reports.filter(report => {
                const matchesStatus = filterStatus === 'all' || report.status === filterStatus;
                const matchesCategory = filterCategory === 'all' || report.report_category === filterCategory;
                return matchesStatus && matchesCategory;
            });

            const getStatusBadge = (status) => {
                const statusInfo = reportStatuses[status] || reportStatuses.pending;
                const colorClasses = {
                    yellow: 'bg-yellow-100 text-yellow-800',
                    blue: 'bg-blue-100 text-blue-800',
                    green: 'bg-green-100 text-green-800',
                    gray: 'bg-gray-100 text-gray-800'
                };
                return (
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${colorClasses[statusInfo.color]}`}>
                        {statusInfo.name}
                    </span>
                );
            };

            const getCategoryBadge = (category) => {
                const categoryInfo = reportCategories[category] || reportCategories.other;
                const colorClasses = {
                    red: 'bg-red-100 text-red-800',
                    orange: 'bg-orange-100 text-orange-800',
                    yellow: 'bg-yellow-100 text-yellow-800',
                    purple: 'bg-purple-100 text-purple-800',
                    gray: 'bg-gray-100 text-gray-800'
                };
                return (
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${colorClasses[categoryInfo.color]}`}>
                        {categoryInfo.name}
                    </span>
                );
            };

            return (
                <div className="space-y-6">
                    {/* í—¤ë” ë° í†µê³„ */}
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-semibold">ğŸš¨ ì‹ ê³  ê´€ë¦¬</h2>
                            <p className="text-sm text-gray-500 mt-1">
                                ì´ {reports.length}ê±´ì˜ ì‹ ê³  (ëŒ€ê¸°: {reports.filter(r => r.status === 'pending').length}ê±´)
                            </p>
                        </div>
                        
                        <div className="flex gap-4">
                            <div className="text-center">
                                <div className="text-2xl font-bold text-red-600">{reports.filter(r => r.status === 'pending').length}</div>
                                <div className="text-xs text-gray-500">ëŒ€ê¸° ì¤‘</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-blue-600">{reports.filter(r => r.status === 'reviewing').length}</div>
                                <div className="text-xs text-gray-500">ê²€í†  ì¤‘</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-green-600">{reports.filter(r => r.status === 'resolved').length}</div>
                                <div className="text-xs text-gray-500">ì²˜ë¦¬ ì™„ë£Œ</div>
                            </div>
                        </div>
                    </div>

                    {/* í•„í„°ë§ */}
                    <div className="flex gap-4">
                        <select
                            value={filterStatus}
                            onChange={(e) => setFilterStatus(e.target.value)}
                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                        >
                            <option value="all">ëª¨ë“  ìƒíƒœ</option>
                            <option value="pending">ëŒ€ê¸° ì¤‘</option>
                            <option value="reviewing">ê²€í†  ì¤‘</option>
                            <option value="resolved">ì²˜ë¦¬ ì™„ë£Œ</option>
                            <option value="dismissed">ê¸°ê°</option>
                        </select>

                        <select
                            value={filterCategory}
                            onChange={(e) => setFilterCategory(e.target.value)}
                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                        >
                            <option value="all">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
                            {Object.entries(reportCategories).map(([key, category]) => (
                                <option key={key} value={key}>{category.name}</option>
                            ))}
                        </select>
                    </div>

                    {/* ì‹ ê³  ëª©ë¡ */}
                    {loading ? (
                        <div className="text-center py-8">
                            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"></div>
                            <p className="mt-2 text-gray-500">ì‹ ê³  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    ) : filteredReports.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                            <div className="text-4xl mb-4">ğŸ“­</div>
                            <p>ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    ) : (
                        <div className="bg-white shadow rounded-lg overflow-hidden">
                            <table className="min-w-full divide-y divide-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì‹ ê³  ë‚´ìš©</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì¹´í…Œê³ ë¦¬</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì‹ ê³ ì¼</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì•¡ì…˜</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredReports.map((report) => (
                                        <tr key={report.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4">
                                                <div>
                                                    <div className="font-medium text-gray-900">
                                                        {report.target_title || `${report.target_type} ì½˜í…ì¸ `}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        ì‹ ê³ ì: {report.reporter?.nickname || 'ìµëª…'} â†’ 
                                                        ëŒ€ìƒì: {report.target_author?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                                    </div>
                                                    <div className="text-xs text-gray-400 mt-1">
                                                        {report.report_reason.length > 50 ? 
                                                            report.report_reason.substring(0, 50) + '...' : 
                                                            report.report_reason}
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                {getCategoryBadge(report.report_category)}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                {getStatusBadge(report.status)}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {new Date(report.created_at).toLocaleDateString('ko-KR')}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                <button
                                                    onClick={() => {
                                                        setSelectedReport(report);
                                                        setShowDetailModal(true);
                                                    }}
                                                    className="text-red-600 hover:text-red-800 font-medium"
                                                >
                                                    ìƒì„¸ë³´ê¸°
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* ì‹ ê³  ìƒì„¸ ëª¨ë‹¬ */}
                    {showDetailModal && selectedReport && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-semibold text-red-600">ğŸš¨ ì‹ ê³  ìƒì„¸ ì •ë³´</h3>
                                    <button
                                        onClick={() => setShowDetailModal(false)}
                                        className="text-gray-500 hover:text-gray-700 text-2xl"
                                    >
                                        Ã—
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    {/* ê¸°ë³¸ ì •ë³´ */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">ì‹ ê³  ëŒ€ìƒ</label>
                                            <div className="mt-1 text-sm text-gray-900">
                                                {selectedReport.target_title || `${selectedReport.target_type} ì½˜í…ì¸ `}
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">ì¹´í…Œê³ ë¦¬</label>
                                            <div className="mt-1">
                                                {getCategoryBadge(selectedReport.report_category)}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">ì‹ ê³ ì</label>
                                            <div className="mt-1 text-sm text-gray-900">
                                                {selectedReport.reporter?.nickname || 'ìµëª…'}
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">ì‹ ê³  ëŒ€ìƒì</label>
                                            <div className="mt-1 text-sm text-gray-900">
                                                {selectedReport.target_author?.nickname || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                            </div>
                                        </div>
                                    </div>

                                    {/* ì‹ ê³  ë‚´ìš© */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">ì‹ ê³  ì‚¬ìœ </label>
                                        <div className="mt-1 p-3 bg-gray-50 rounded-md text-sm text-gray-900">
                                            {selectedReport.report_reason}
                                        </div>
                                    </div>

                                    {selectedReport.additional_info && (
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">ì¶”ê°€ ì •ë³´</label>
                                            <div className="mt-1 p-3 bg-gray-50 rounded-md text-sm text-gray-900">
                                                {selectedReport.additional_info}
                                            </div>
                                        </div>
                                    )}

                                    {/* í˜„ì¬ ìƒíƒœ */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">í˜„ì¬ ìƒíƒœ</label>
                                        <div className="mt-1">
                                            {getStatusBadge(selectedReport.status)}
                                            <span className="ml-2 text-sm text-gray-500">
                                                {new Date(selectedReport.created_at).toLocaleString('ko-KR')}
                                            </span>
                                        </div>
                                    </div>

                                    {/* ê´€ë¦¬ì ì²˜ë¦¬ */}
                                    {selectedReport.status === 'pending' || selectedReport.status === 'reviewing' ? (
                                        <div className="border-t pt-4 mt-6">
                                            <label className="block text-sm font-medium text-gray-700 mb-2">ê´€ë¦¬ì ì²˜ë¦¬</label>
                                            <div className="flex gap-3">
                                                <button
                                                    onClick={() => handleReportAction(selectedReport.id, 'resolved', 'ì‹ ê³  ë‚´ìš© í™•ì¸í•˜ì—¬ ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ì·¨í–ˆìŠµë‹ˆë‹¤.')}
                                                    disabled={actionLoading}
                                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                                                >
                                                    ì²˜ë¦¬ ì™„ë£Œ
                                                </button>
                                                <button
                                                    onClick={() => handleReportAction(selectedReport.id, 'dismissed', 'ê²€í†  ê²°ê³¼ ë¬¸ì œì—†ìŒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.')}
                                                    disabled={actionLoading}
                                                    className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50"
                                                >
                                                    ê¸°ê°
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        selectedReport.admin_notes && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">ê´€ë¦¬ì ì²˜ë¦¬ ë©”ëª¨</label>
                                                <div className="mt-1 p-3 bg-blue-50 rounded-md text-sm text-blue-900">
                                                    {selectedReport.admin_notes}
                                                </div>
                                            </div>
                                        )
                                    )}
                                </div>

                                <div className="mt-6 flex justify-end">
                                    <button
                                        onClick={() => setShowDetailModal(false)}
                                        className="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
                                    >
                                        ë‹«ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì‹œìŠ¤í…œ ì„¤ì • ì„¹ì…˜
        const SystemSettingsSection = ({ currentUser }) => {
            const [settings, setSettings] = useState({
                platformCommissionRate: 0.20, // 20%
                minimumConsultationTime: 10, // 10ë¶„
                maximumConsultationTime: 60, // 60ë¶„
                platformName: 'ì¸ì‚¬ì´ë“œì¡',
                supportEmail: 'support@insidejob.kr',
                maintenanceMode: false,
                autoSettlement: true
            });
            const [loading, setLoading] = useState(false);
            const [originalSettings, setOriginalSettings] = useState({});

            // ì„¤ì • ë¡œë“œ
            useEffect(() => {
                loadSettings();
            }, []);

            const loadSettings = async () => {
                try {
                    // system_settings í…Œì´ë¸”ì—ì„œ ì„¤ì • ë¡œë“œ
                    const { data, error } = await supabase
                        .from('system_settings')
                        .select('setting_key, setting_value');

                    if (error) {
                        console.error('ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                        return;
                    }

                    // ì„¤ì •ì„ ê°ì²´ í˜•íƒœë¡œ ë³€í™˜
                    const loadedSettings = {};
                    data?.forEach(setting => {
                        const value = setting.setting_value;
                        // ìˆ«ì í˜•íƒœëŠ” íŒŒì‹±, ë¶ˆë¦°ì€ ë³€í™˜, ë‚˜ë¨¸ì§€ëŠ” ë¬¸ìì—´
                        if (setting.setting_key.includes('rate') || setting.setting_key.includes('time')) {
                            loadedSettings[setting.setting_key] = parseFloat(value);
                        } else if (setting.setting_key.includes('mode') || setting.setting_key.includes('auto')) {
                            loadedSettings[setting.setting_key] = value === 'true';
                        } else {
                            loadedSettings[setting.setting_key] = value;
                        }
                    });

                    // ê¸°ë³¸ê°’ê³¼ ë³‘í•©
                    const mergedSettings = { ...settings, ...loadedSettings };
                    setSettings(mergedSettings);
                    setOriginalSettings(mergedSettings);
                } catch (error) {
                    console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            };

            // ì„¤ì • ì €ì¥
            const saveSettings = async () => {
                try {
                    setLoading(true);

                    // ë³€ê²½ëœ ì„¤ì •ë§Œ ì—…ë°ì´íŠ¸
                    const updates = [];
                    Object.keys(settings).forEach(key => {
                        if (settings[key] !== originalSettings[key]) {
                            updates.push({
                                setting_key: key,
                                setting_value: settings[key].toString(),
                                updated_at: new Date().toISOString()
                            });
                        }
                    });

                    if (updates.length === 0) {
                        alert('ë³€ê²½ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }

                    // Upsert ë°©ì‹ìœ¼ë¡œ ì„¤ì • ì €ì¥
                    const { error } = await supabase
                        .from('system_settings')
                        .upsert(updates, { 
                            onConflict: 'setting_key',
                            ignoreDuplicates: false 
                        });

                    if (error) throw error;

                    setOriginalSettings(settings);
                    alert('ì‹œìŠ¤í…œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ì„¤ì • ì €ì¥ ì˜¤ë¥˜:', error);
                    alert('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setLoading(false);
                }
            };

            // ì„¤ì • ë¦¬ì…‹
            const resetSettings = () => {
                if (confirm('ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ì·¨ì†Œí•˜ê³  ì›ë˜ ì„¤ì •ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    setSettings(originalSettings);
                }
            };

            const handleSettingChange = (key, value) => {
                setSettings(prev => ({ ...prev, [key]: value }));
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-semibold">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</h2>
                        <div className="space-x-3">
                            <button
                                onClick={resetSettings}
                                className="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
                            >
                                ì·¨ì†Œ
                            </button>
                            <button
                                onClick={saveSettings}
                                disabled={loading}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
                            >
                                {loading ? 'ì €ì¥ ì¤‘...' : 'ì„¤ì • ì €ì¥'}
                            </button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* ìˆ˜ìˆ˜ë£Œ ì„¤ì • */}
                        <div className="bg-white p-6 rounded-lg border">
                            <h3 className="text-lg font-medium mb-4">ğŸ’° ìˆ˜ìˆ˜ë£Œ ì„¤ì •</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        í”Œë«í¼ ìˆ˜ìˆ˜ë£Œìœ¨ (%)
                                    </label>
                                    <div className="flex items-center space-x-3">
                                        <input
                                            type="range"
                                            min="0"
                                            max="0.5"
                                            step="0.01"
                                            value={settings.platformCommissionRate}
                                            onChange={(e) => handleSettingChange('platformCommissionRate', parseFloat(e.target.value))}
                                            className="flex-1"
                                        />
                                        <span className="text-lg font-bold text-blue-600">
                                            {Math.round(settings.platformCommissionRate * 100)}%
                                        </span>
                                    </div>
                                    <p className="text-sm text-gray-500 mt-1">
                                        í˜„ì§ì ìˆ˜ìµ: {Math.round((1 - settings.platformCommissionRate) * 100)}%
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* ìƒë‹´ ì‹œê°„ ì„¤ì • */}
                        <div className="bg-white p-6 rounded-lg border">
                            <h3 className="text-lg font-medium mb-4">â° ìƒë‹´ ì‹œê°„ ì„¤ì •</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ìµœì†Œ ìƒë‹´ ì‹œê°„ (ë¶„)
                                    </label>
                                    <input
                                        type="number"
                                        min="5"
                                        max="30"
                                        value={settings.minimumConsultationTime}
                                        onChange={(e) => handleSettingChange('minimumConsultationTime', parseInt(e.target.value))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ìµœëŒ€ ìƒë‹´ ì‹œê°„ (ë¶„)
                                    </label>
                                    <input
                                        type="number"
                                        min="30"
                                        max="180"
                                        value={settings.maximumConsultationTime}
                                        onChange={(e) => handleSettingChange('maximumConsultationTime', parseInt(e.target.value))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* í”Œë«í¼ ì •ë³´ */}
                        <div className="bg-white p-6 rounded-lg border">
                            <h3 className="text-lg font-medium mb-4">ğŸ¢ í”Œë«í¼ ì •ë³´</h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        í”Œë«í¼ ì´ë¦„
                                    </label>
                                    <input
                                        type="text"
                                        value={settings.platformName}
                                        onChange={(e) => handleSettingChange('platformName', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ì§€ì› ì´ë©”ì¼
                                    </label>
                                    <input
                                        type="email"
                                        value={settings.supportEmail}
                                        onChange={(e) => handleSettingChange('supportEmail', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* ì‹œìŠ¤í…œ ì˜µì…˜ */}
                        <div className="bg-white p-6 rounded-lg border">
                            <h3 className="text-lg font-medium mb-4">ğŸ”§ ì‹œìŠ¤í…œ ì˜µì…˜</h3>
                            <div className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <div className="font-medium">ì ê²€ ëª¨ë“œ</div>
                                        <div className="text-sm text-gray-500">ì„œë¹„ìŠ¤ ì¼ì‹œ ì¤‘ë‹¨</div>
                                    </div>
                                    <label className="inline-flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={settings.maintenanceMode}
                                            onChange={(e) => handleSettingChange('maintenanceMode', e.target.checked)}
                                            className="form-checkbox h-4 w-4 text-blue-600"
                                        />
                                    </label>
                                </div>
                                <div className="flex items-center justify-between">
                                    <div>
                                        <div className="font-medium">ìë™ ì •ì‚°</div>
                                        <div className="text-sm text-gray-500">ìƒë‹´ ì™„ë£Œ ì‹œ ìë™ ì •ì‚° ì²˜ë¦¬</div>
                                    </div>
                                    <label className="inline-flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={settings.autoSettlement}
                                            onChange={(e) => handleSettingChange('autoSettlement', e.target.checked)}
                                            className="form-checkbox h-4 w-4 text-blue-600"
                                        />
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ì„¤ì • ìš”ì•½ */}
                    <div className="bg-blue-50 p-4 rounded-lg">
                        <h4 className="font-medium text-blue-900 mb-2">âš¡ í˜„ì¬ ì„¤ì • ìš”ì•½</h4>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <div className="text-blue-700 font-medium">í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ</div>
                                <div className="text-blue-600">{Math.round(settings.platformCommissionRate * 100)}%</div>
                            </div>
                            <div>
                                <div className="text-blue-700 font-medium">ìƒë‹´ ì‹œê°„</div>
                                <div className="text-blue-600">{settings.minimumConsultationTime}-{settings.maximumConsultationTime}ë¶„</div>
                            </div>
                            <div>
                                <div className="text-blue-700 font-medium">ì„œë¹„ìŠ¤ ìƒíƒœ</div>
                                <div className={settings.maintenanceMode ? 'text-red-600' : 'text-green-600'}>
                                    {settings.maintenanceMode ? 'ì ê²€ ì¤‘' : 'ì •ìƒ ìš´ì˜'}
                                </div>
                            </div>
                            <div>
                                <div className="text-blue-700 font-medium">ìë™ ì •ì‚°</div>
                                <div className={settings.autoSettlement ? 'text-green-600' : 'text-red-600'}>
                                    {settings.autoSettlement ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
        const AuthComponent = ({ onAuthSuccess, initialMode = 'login', generateGuestUser }) => {
            const [isLogin, setIsLogin] = useState(initialMode === 'login');
            const [authMode, setAuthMode] = useState(initialMode); // 'login', 'signup', 'expert', 'resetPassword'
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [error, setError] = useState('');
            const [resetMessage, setResetMessage] = useState('');
            const [isResetLoading, setIsResetLoading] = useState(false);
            const [generatedNickname, setGeneratedNickname] = useState('');
            const [customNickname, setCustomNickname] = useState('');
            const [useCustomNickname, setUseCustomNickname] = useState(false);
            const [privacyConsent, setPrivacyConsent] = useState(false);
            const [termsConsent, setTermsConsent] = useState(false); // ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜
            const [expertPrivacyConsent, setExpertPrivacyConsent] = useState(false); // ì „ë¬¸ê°€ ë“±ë¡ ì „ìš©
            const [expertTermsConsent, setExpertTermsConsent] = useState(false); // ì „ë¬¸ê°€ ì•½ê´€ ë™ì˜
            
            // ì „ë¬¸ê°€ ë“±ë¡ ê´€ë ¨ ìƒíƒœ
            const [expertProfile, setExpertProfile] = useState({
                name: '',
                title: '',
                expertType: 'travel',
                experienceYears: '',
                bio: '',
                specialties: [],
                hourlyRate: '',
                consultationDuration: 60,
                phone: '',
                businessLicense: '',
                qualificationNumber: '',
                verificationMethod: '', // 'business', 'license', 'experience'
                availableTypes: ['phone']
            });
            const [specialtyInput, setSpecialtyInput] = useState('');
            const [currentStep, setCurrentStep] = useState(1); // ì „ë¬¸ê°€ ë“±ë¡ ë‹¨ê³„

            useEffect(() => {
                if (!isLogin) {
                    // íšŒì›ê°€ì… ëª¨ë“œì¼ ë•Œ ë‹‰ë„¤ì„ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                    const nickname = authManager.nicknameGen.generate();
                    setGeneratedNickname(nickname);
                }
            }, [isLogin]);

            // ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬ ì •ì˜
            const expertCategories = {
                'tech_development': { name: 'IT/ê°œë°œ', icon: 'ğŸ’»', description: 'ê°œë°œì, ì—”ì§€ë‹ˆì–´, IT ì „ë¬¸ê°€' },
                'finance_consulting': { name: 'ê¸ˆìœµ/ì»¨ì„¤íŒ…', icon: 'ğŸ’°', description: 'ê¸ˆìœµê¶Œ, ì»¨ì„¤íŒ… í˜„ì§ì' },
                'marketing_planning': { name: 'ë§ˆì¼€íŒ…/ê¸°íš', icon: 'ğŸ“Š', description: 'ë§ˆì¼€í„°, ê¸°íšì, ì „ëµ ë‹´ë‹¹ì' },
                'manufacturing': { name: 'ì œì¡°/ì—”ì§€ë‹ˆì–´ë§', icon: 'âš™ï¸', description: 'ì œì¡°ì—…, ì—”ì§€ë‹ˆì–´ë§ í˜„ì§ì' },
                'public_education': { name: 'ê³µê³µ/êµìœ¡', icon: 'ğŸ›ï¸', description: 'ê³µë¬´ì›, êµìœ¡ ë¶„ì•¼ ì¢…ì‚¬ì' },
                'others': { name: 'ê¸°íƒ€', icon: 'ğŸ’¼', description: 'ê¸°íƒ€ ì—…ê³„ í˜„ì§ì' }
            };

            // ì „ë¬¸ê°€ í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            const updateExpertProfile = (field, value) => {
                setExpertProfile(prev => ({ ...prev, [field]: value }));
            };

            // ì „ë¬¸ë¶„ì•¼ ì¶”ê°€
            const addSpecialty = () => {
                if (specialtyInput.trim() && !expertProfile.specialties.includes(specialtyInput.trim())) {
                    updateExpertProfile('specialties', [...expertProfile.specialties, specialtyInput.trim()]);
                    setSpecialtyInput('');
                }
            };


            // ì „ë¬¸ë¶„ì•¼ ì œê±°
            const removeSpecialty = (index) => {
                const newSpecialties = expertProfile.specialties.filter((_, i) => i !== index);
                updateExpertProfile('specialties', newSpecialties);
            };


            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');

                try {
                    if (authMode === 'login') {
                        // ë¡œê·¸ì¸
                        const result = await authManager.signIn(email, password);
                        if (result.success) {
                            onAuthSuccess(result.user);
                        } else {
                            setError(result.error);
                        }
                    } else if (authMode === 'signup') {
                        // ì¼ë°˜ íšŒì›ê°€ì…
                        if (password !== confirmPassword) {
                            setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                            return;
                        }
                        // ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ ê²€ì¦ (í‘œì¤€ ì¤€ìˆ˜)
                        const passwordValidation = validatePassword(password);
                        if (!passwordValidation.isValid) {
                            setError('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•©ì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                            return;
                        }
                        
                        // ë‹‰ë„¤ì„ ê²€ì¦
                        const finalNickname = useCustomNickname ? customNickname.trim() : generatedNickname;
                        if (!finalNickname) {
                            setError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                            return;
                        }
                        if (useCustomNickname) {
                            if (finalNickname.length < 2 || finalNickname.length > 20) {
                                setError('ë‹‰ë„¤ì„ì€ 2-20ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                                return;
                            }
                            if (!/^[ê°€-í£a-zA-Z0-9]+$/.test(finalNickname)) {
                                setError('ë‹‰ë„¤ì„ì€ í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤');
                                return;
                            }
                        }
                        if (!privacyConsent) {
                            setError('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                            return;
                        }
                        if (!termsConsent) {
                            setError('ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                            return;
                        }

                        const result = await authManager.signUp(email, password, finalNickname);
                        if (result.success) {
                            setError('');
                            
                            // í™˜ì˜ ì´ë©”ì¼ ë°œì†¡
                            try {
                                await EmailManager.sendWelcomeEmail(result.user.id, {
                                    nickname: finalNickname,
                                    email: email
                                });
                                console.log('âœ… í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ');
                            } catch (emailError) {
                                console.error('âŒ í™˜ì˜ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailError);
                            }
                            
                            showNotification('íšŒì›ê°€ì… ì™„ë£Œ!', `ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤, ${finalNickname}ë‹˜!\nâœ¨ ë°”ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nğŸ¯ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ê³¼ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`, 'success');
                            setAuthMode('login');
                            setIsLogin(true);
                        } else {
                            setError(result.error);
                        }
                    } else if (authMode === 'expert') {
                        // ì „ë¬¸ê°€ ë“±ë¡
                        await handleExpertRegistration();
                    }
                } catch (err) {
                    setError('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            };

            const handleExpertRegistration = async () => {
                if (currentStep === 1) {
                    // 1ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ ê²€ì¦ë§Œ ìˆ˜í–‰ (íšŒì›ê°€ì…ì€ í•˜ì§€ ì•ŠìŒ)
                    if (password !== confirmPassword) {
                        setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                        return;
                    }
                    const passwordValidation = validatePassword(password);
                    if (!passwordValidation.isValid) {
                        setError('ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•©ì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                        return;
                    }
                    if (!expertPrivacyConsent) {
                        setError('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertTermsConsent) {
                        setError('ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertProfile.phone) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!/^010-\d{4}-\d{4}$/.test(expertProfile.phone)) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }

                    // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
                    const emailCheck = await authManager.checkEmail(email);
                    if (!emailCheck.success) {
                        setError(emailCheck.error);
                        return;
                    }

                    // 1ë‹¨ê³„ í†µê³¼ - 2ë‹¨ê³„ë¡œ ì´ë™ (ì•„ì§ íšŒì›ê°€ì…ì€ í•˜ì§€ ì•ŠìŒ)
                    setCurrentStep(2);
                    setError('');
                    
                    // 2ë‹¨ê³„ë¡œ ì´ë™í•  ë•Œ ìŠ¤í¬ë¡¤ì„ ìƒë‹¨ìœ¼ë¡œ ì´ë™
                    setTimeout(() => {
                        window.scrollTo({ 
                            top: 0, 
                            behavior: 'smooth' 
                        });
                    }, 100);
                    
                } else if (currentStep === 2) {
                    // 2ë‹¨ê³„: ì „ë¬¸ê°€ í”„ë¡œí•„ ì™„ì „ ê²€ì¦ ë° ë“±ë¡
                    if (!expertProfile.name || !expertProfile.title || !expertProfile.experienceYears) {
                        setError('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertProfile.expertType) {
                        setError('ì „ë¬¸ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                        return;
                    }
                    if (!expertProfile.verificationMethod) {
                        setError('ìê²© ê²€ì¦ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    
                    // ìƒë‹´ ë°©ì‹ ê²€ì¦
                    if (expertProfile.availableTypes.length === 0) {
                        setError('ì œê³µ ê°€ëŠ¥í•œ ìƒë‹´ ë°©ì‹ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”');
                        return;
                    }

                    // ì—„ê²©í•œ ê²€ì¦ ì¶”ê°€
                    if (!expertProfile.businessLicense && !expertProfile.qualificationNumber) {
                        setError('ì‚¬ì—…ìë“±ë¡ì¦ ë˜ëŠ” ìê²©ì¦ë²ˆí˜¸ ì¤‘ í•˜ë‚˜ëŠ” í•„ìˆ˜ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤');
                        return;
                    }
                    
                    // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì…ë ¥ ì‹œ ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ í•„ìˆ˜ ê²€ì¦
                    if (expertProfile.businessLicense && expertProfile.businessLicense.length >= 10 && !expertProfile.businessLicenseFile) {
                        setError('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì‹  ê²½ìš° ì‚¬ì—…ìë“±ë¡ì¦ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    if (parseInt(expertProfile.experienceYears) < 1) {
                        setError('ìµœì†Œ 1ë…„ ì´ìƒì˜ ê²½ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤');
                        return;
                    }


                    // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
                    if (expertProfile.businessLicense) {
                        const businessNumber = expertProfile.businessLicense.replace(/[^0-9]/g, '');
                        if (businessNumber.length !== 10) {
                            setError('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” 10ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                            return;
                        }
                        // ê²€ì¦ìš©ìœ¼ë¡œ ì •ê·œí™”ëœ í˜•ì‹ìœ¼ë¡œ ì €ì¥
                        const formatted = `${businessNumber.slice(0,3)}-${businessNumber.slice(3,5)}-${businessNumber.slice(5,10)}`;
                        updateExpertProfile('businessLicense', formatted);
                    }

                    // íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
                    if (!/^010-\d{4}-\d{4}$/.test(expertProfile.phone)) {
                        setError('íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }

                    try {
                        // ì´ì œ ì‹¤ì œ íšŒì›ê°€ì… ìˆ˜í–‰
                        const signUpResult = await authManager.signUp(email, password, expertProfile.name);
                        if (!signUpResult.success) {
                            setError(signUpResult.error);
                            return;
                        }

                        // ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ (ê²€í†  ëŒ€ê¸° ìƒíƒœ)
                        const { data: expertData, error: expertError } = await supabase
                            .from('experts')
                            .insert({
                                email: email,
                                name: expertProfile.name,
                                phone: expertProfile.phone,
                                title: expertProfile.title,
                                expert_type: expertProfile.category === 'travel' ? 'travel_planner' : 
                                           expertProfile.category === 'legal' ? 'lawyer' : 'consultant',
                                category: expertProfile.category,
                                specialties: expertProfile.specialties,
                                bio: expertProfile.bio,
                                experience_years: parseInt(expertProfile.experienceYears),
                                qualification_number: expertProfile.qualificationNumber || null,
                                available_consultation_types: expertProfile.availableTypes,
                                verification_status: 'pending',
                                no_sales_pledge: true,
                                senior_focused: true,
                                experience_based: true
                            })
                            .select()
                            .single();

                        if (expertError) {
                            throw new Error('ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ ì‹¤íŒ¨: ' + expertError.message);
                        }

                        console.log('ì „ë¬¸ê°€ í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ:', expertData);
                        
                        showNotification('ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ ì™„ë£Œ!', `ğŸ“ ${expertProfile.name}ë‹˜ì˜ ì „ë¬¸ê°€ ë“±ë¡ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nğŸ” ì œì¶œí•˜ì‹  ì„œë¥˜ë¥¼ ê²€í†  ì¤‘ì…ë‹ˆë‹¤.\nğŸ“§ ìŠ¹ì¸ ê²°ê³¼ë¥¼ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë¦´ê²Œìš”.\n\nâ° ê²€í†  ê¸°ê°„: ì˜ì—…ì¼ ê¸°ì¤€ 3-5ì¼`, 'success');
                        setAuthMode('login');
                        setCurrentStep(1);
                        resetExpertForm();
                    } catch (error) {
                        setError('ì „ë¬¸ê°€ ë“±ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                    }
                }
            };

            // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í•¸ë“¤ëŸ¬
            const handlePasswordReset = async (e) => {
                e.preventDefault();
                setError('');
                setResetMessage('');
                setIsResetLoading(true);
                
                if (!email) {
                    setError('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    setIsResetLoading(false);
                    return;
                }
                
                try {
                    const result = await authManager.sendPasswordResetEmail(email);
                    if (result.success) {
                        setResetMessage(result.message);
                        setEmail('');
                    } else {
                        setError(result.error);
                    }
                } catch (err) {
                    setError('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                } finally {
                    setIsResetLoading(false);
                }
            };

            // ì „ë¬¸ê°€ í¼ ì´ˆê¸°í™”
            const resetExpertForm = () => {
                setExpertProfile({
                    name: '',
                    title: '',
                    expertType: 'travel',
                    experienceYears: '',
                    bio: '',
                    specialties: [],
                    hourlyRate: '',
                    consultationDuration: 60,
                    phone: '',
                    businessLicense: '',
                    qualificationNumber: '',
                    verificationMethod: '',
                    availableTypes: ['phone']
                });
                setEmail('');
                setPassword('');
                setConfirmPassword('');
                setPrivacyConsent(false);
                setSpecialtyInput('');
                setCredentialInput('');
            };

            const regenerateNickname = () => {
                const newNickname = authManager.nicknameGen.generate();
                setGeneratedNickname(newNickname);
            };

            // ì „ë¬¸ê°€ ë“±ë¡ UI ë Œë”ë§ - ìƒˆë¡œìš´ 4ë‹¨ê³„ ìœ„ìë“œ ì‚¬ìš©
            if (authMode === 'expert') {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-orange-50 to-red-100 flex items-center justify-center py-4 px-4" },
                    React.createElement(ExpertRegistrationWizard, {
                        expertProfile: expertProfile,
                        updateExpertProfile: updateExpertProfile,
                        expertCategories: [],
                        specialtyInput: "",
                        setSpecialtyInput: () => {},
                        addSpecialty: () => {},
                        removeSpecialty: () => {},
                        setCurrentView: () => setAuthMode('login')
                    })
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-md w-full space-y-8">
                        <div className="text-center">
                            {/* ë¡œê³  ìë¦¬ - PB ë¡œê³  */}
                            <div className="mb-6">
                                <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto flex items-center justify-center">
                                    <span className="text-white font-bold text-xl">ğŸ¯</span>
                                </div>
                            </div>
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">
                                ì¸ì‚¬ì´ë“œì¡
                            </h1>
                            <p className="text-xl text-gray-600 mb-6">
                                ì„±ê³µì ì¸ ì·¨ì—…ì˜ ì‹œì‘
                            </p>
                            
                        </div>
                        
                        {/* ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í¼ */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            {authMode === 'resetPassword' ? (
                                /* ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í¼ */
                                <form className="space-y-6" onSubmit={handlePasswordReset}>
                                    <div className="text-center mb-6">
                                        <h2 className="text-2xl font-bold text-gray-900 mb-2">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h2>
                                        <p className="text-gray-600">ë“±ë¡í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì‹œë©´ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
                                    </div>
                                    
                                    <div>
                                        <label htmlFor="reset-email" className="block text-sm font-medium text-gray-700">
                                            ì´ë©”ì¼
                                        </label>
                                        <input
                                            id="reset-email"
                                            name="email"
                                            type="email"
                                            required
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                            placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                                        />
                                    </div>
                                    
                                    {resetMessage && (
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                                            <p className="text-green-800 text-sm">{resetMessage}</p>
                                        </div>
                                    )}
                                    
                                    {error && (
                                        <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                            <p className="text-red-800 text-sm">{error}</p>
                                        </div>
                                    )}
                                    
                                    <div>
                                        <button
                                            type="submit"
                                            disabled={isResetLoading}
                                            className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-lg font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
                                        >
                                            {isResetLoading ? 'ë°œì†¡ ì¤‘...' : 'ì¬ì„¤ì • ì´ë©”ì¼ ë³´ë‚´ê¸°'}
                                        </button>
                                    </div>
                                    
                                    <div className="text-center">
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setAuthMode('login');
                                                setError('');
                                                setResetMessage('');
                                                setEmail('');
                                            }}
                                            className="text-blue-600 hover:text-blue-500 text-sm font-medium"
                                        >
                                            ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                                        </button>
                                    </div>
                                </form>
                            ) : (
                            <form className="space-y-6" onSubmit={handleSubmit}>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                                        ì´ë©”ì¼
                                    </label>
                                    <input
                                        id="email"
                                        name="email"
                                        type="email"
                                        required
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                        placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                                    />
                                </div>
                                <div>
                                    <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                                        ë¹„ë°€ë²ˆí˜¸
                                    </label>
                                    <input
                                        id="password"
                                        name="password"
                                        type="password"
                                        required
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                        placeholder="ë¹„ë°€ë²ˆí˜¸"
                                    />
                                    {authMode === 'signup' && (
                                        <div className="mt-2 text-xs text-gray-500">
                                            <p className="mb-1">ë¹„ë°€ë²ˆí˜¸ ìš”êµ¬ì‚¬í•­:</p>
                                            <ul className="space-y-0.5">
                                                {(() => {
                                                    const validation = validatePassword(password);
                                                    return (
                                                        <>
                                                            <li className={`flex items-center ${validation.checks.length ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.length ? 'âœ“' : 'â—‹'}</span>
                                                                8ì ì´ìƒ
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasLetter ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasLetter ? 'âœ“' : 'â—‹'}</span>
                                                                ì˜ë¬¸ í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasNumber ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasNumber ? 'âœ“' : 'â—‹'}</span>
                                                                ìˆ«ì í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center ${validation.checks.hasSpecial ? 'text-green-600' : 'text-gray-400'}`}>
                                                                <span className="mr-2">{validation.checks.hasSpecial ? 'âœ“' : 'â—‹'}</span>
                                                                íŠ¹ìˆ˜ë¬¸ì í¬í•¨
                                                            </li>
                                                            <li className={`flex items-center text-xs mt-1 ${validation.typeCount >= 2 ? 'text-green-600' : 'text-orange-500'}`}>
                                                                <span className="mr-2">{validation.typeCount >= 2 ? 'âœ“' : '!'}</span>
                                                                ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¤‘ 2ì¢…ë¥˜ ì´ìƒ ì¡°í•© í•„ìˆ˜
                                                            </li>
                                                        </>
                                                    );
                                                })()}
                                            </ul>
                                        </div>
                                    )}
                                </div>
                                {authMode === 'signup' && (
                                    <>
                                        <div>
                                            <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700">
                                                ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                                            </label>
                                            <input
                                                id="confirmPassword"
                                                name="confirmPassword"
                                                type="password"
                                                required
                                                value={confirmPassword}
                                                onChange={(e) => setConfirmPassword(e.target.value)}
                                                className="mt-1 appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg"
                                                placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                                            />
                                        </div>
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <h4 className="text-sm font-medium text-blue-800 mb-3">ë‹‰ë„¤ì„ ì„ íƒ</h4>
                                            
                                            {/* ë‹‰ë„¤ì„ ì„ íƒ ì˜µì…˜ */}
                                            <div className="space-y-3">
                                                {/* ìë™ ìƒì„± ë‹‰ë„¤ì„ ì˜µì…˜ */}
                                                <label className="flex items-center space-x-3 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="nicknameOption"
                                                        checked={!useCustomNickname}
                                                        onChange={() => setUseCustomNickname(false)}
                                                        onClick={() => setUseCustomNickname(false)}
                                                        className="h-4 w-4 text-blue-600 border-2 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="flex items-center justify-between">
                                                            <div>
                                                                <span className="text-sm font-medium text-blue-800">ìë™ ìƒì„±</span>
                                                                <p className="text-lg font-bold text-blue-900">{generatedNickname}</p>
                                                            </div>
                                                            <button
                                                                type="button"
                                                                onClick={regenerateNickname}
                                                                className="px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded text-sm font-medium transition-colors"
                                                            >
                                                                ğŸ² ë‹¤ì‹œìƒì„±
                                                            </button>
                                                        </div>
                                                    </div>
                                                </label>
                                                
                                                {/* ì§ì ‘ ì…ë ¥ ë‹‰ë„¤ì„ ì˜µì…˜ */}
                                                <label className="flex items-start space-x-3 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="nicknameOption"
                                                        checked={useCustomNickname}
                                                        onChange={() => setUseCustomNickname(true)}
                                                        onClick={() => setUseCustomNickname(true)}
                                                        className="mt-1 h-4 w-4 text-blue-600 border-2 border-gray-300 focus:ring-blue-500"
                                                    />
                                                    <div className="flex-1">
                                                        <span className="text-sm font-medium text-blue-800">ì§ì ‘ ì…ë ¥</span>
                                                        <input
                                                            type="text"
                                                            value={customNickname}
                                                            onChange={(e) => setCustomNickname(e.target.value)}
                                                            disabled={!useCustomNickname}
                                                            placeholder="ì›í•˜ëŠ” ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                            className={`mt-1 w-full px-3 py-2 border rounded-lg text-sm ${
                                                                useCustomNickname 
                                                                    ? 'border-blue-300 focus:border-blue-500 focus:ring-blue-500' 
                                                                    : 'border-gray-200 bg-gray-50 text-gray-400'
                                                            }`}
                                                        />
                                                        {useCustomNickname && (
                                                            <p className="text-xs text-gray-500 mt-1">
                                                                2-20ì, í•œê¸€/ì˜ë¬¸/ìˆ«ì ì‚¬ìš© ê°€ëŠ¥
                                                            </p>
                                                        )}
                                                    </div>
                                                </label>
                                            </div>
                                            
                                            <p className="text-xs text-blue-600 mt-3">ğŸ’¡ ê°€ì… í›„ ì–¸ì œë“ ì§€ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”</p>
                                        </div>
                                        
                                        {/* ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ */}
                                        <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                                            <h4 className="text-sm font-medium text-gray-800 mb-3">ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜</h4>
                                            <div className="bg-white border border-gray-200 rounded p-3 text-xs text-gray-600 mb-3 max-h-40 overflow-y-auto">
                                                <div className="space-y-3">
                                                    <div>
                                                        <strong className="text-gray-800">â–  ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ëª©ì </strong>
                                                        <p>â€¢ íšŒì› ê°€ì… ë° ë³¸ì¸ í™•ì¸<br/>â€¢ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ ì„œë¹„ìŠ¤ ì œê³µ<br/>â€¢ êµ¬ì§ì ì»¤ë®¤ë‹ˆí‹° ìš´ì˜<br/>â€¢ í˜„ì§ì ë©˜í† ë§ ë§¤ì¹­ ì„œë¹„ìŠ¤<br/>â€¢ ê³ ê° ìƒë‹´ ë° ë¶ˆë§Œ ì²˜ë¦¬</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</strong>
                                                        <p>â€¢ í•„ìˆ˜í•­ëª©: ì´ë©”ì¼, ë‹‰ë„¤ì„, ë¹„ë°€ë²ˆí˜¸<br/>â€¢ ì„ íƒí•­ëª©: ë‚˜ì´, í•™ë ¥, ì „ê³µ, ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ê²°ê³¼<br/>â€¢ ìë™ìˆ˜ì§‘: ì ‘ì†IP, ì´ìš©ê¸°ë¡, ì¿ í‚¤ì •ë³´</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ê°œì¸ì •ë³´ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</strong>
                                                        <p>â€¢ íšŒì›íƒˆí‡´ ì‹œê¹Œì§€<br/>â€¢ ê´€ê³„ë²•ë ¹ì— ë”°ë¥¸ ë³´ì¡´: ìµœëŒ€ 5ë…„<br/>â€¢ ì§„ë‹¨ê²°ê³¼: íšŒì›íƒˆí‡´ í›„ ì¦‰ì‹œ ì‚­ì œ</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">â–  ê°œì¸ì •ë³´ ì œ3ì ì œê³µ</strong>
                                                        <p>â€¢ ì›ì¹™ì ìœ¼ë¡œ ì œ3ì ì œê³µí•˜ì§€ ì•ŠìŒ<br/>â€¢ ë²•ë ¹ì— ì˜í•œ ê²½ìš°ì—ë§Œ ì˜ˆì™¸ì  ì œê³µ</p>
                                                    </div>
                                                    <div>
                                                        <p>â€» ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìœ¼ë‚˜, ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜ì„œ */}
                                        <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                            <h4 className="text-sm font-medium text-gray-800 mb-3">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</h4>
                                            <div className="bg-white border border-gray-200 rounded p-3 text-xs text-gray-600 mb-3 max-h-40 overflow-y-auto">
                                                <div className="space-y-3">
                                                    <div>
                                                        <strong className="text-gray-800">ì œ1ì¡° (ëª©ì )</strong>
                                                        <p>ë³¸ ì•½ê´€ì€ ì¸ì‚¬ì´ë“œì¡(ì´í•˜ "íšŒì‚¬")ì´ ì œê³µí•˜ëŠ” ì·¨ì—… ë©˜í† ë§ í”Œë«í¼ ì„œë¹„ìŠ¤ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ íšŒì‚¬ì™€ ì´ìš©ìê°„ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">ì œ2ì¡° (ì„œë¹„ìŠ¤ ë‚´ìš©)</strong>
                                                        <p>â€¢ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ ì„œë¹„ìŠ¤<br/>â€¢ êµ¬ì§ì ì»¤ë®¤ë‹ˆí‹° ìš´ì˜<br/>â€¢ í˜„ì§ì-êµ¬ì§ì ë©˜í† ë§ ë§¤ì¹­<br/>â€¢ ì‹¤ì‹œê°„ ì±„íŒ… ìƒë‹´ ì„œë¹„ìŠ¤<br/>â€¢ ê¸°íƒ€ ì·¨ì—… ê´€ë ¨ ë¶€ê°€ ì„œë¹„ìŠ¤</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">ì œ3ì¡° (íšŒì›ì˜ ì˜ë¬´)</strong>
                                                        <p>â€¢ í—ˆìœ„ì •ë³´ ì œê³µ ê¸ˆì§€<br/>â€¢ íƒ€ì¸ì˜ ê°œì¸ì •ë³´ ì¹¨í•´ ê¸ˆì§€<br/>â€¢ ì„œë¹„ìŠ¤ ì´ìš© ê·œì • ì¤€ìˆ˜<br/>â€¢ ë¶ˆë²•ì Â·ë¶€ì ì ˆí•œ ì½˜í…ì¸  ê²Œì‹œ ê¸ˆì§€</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">ì œ4ì¡° (í˜„ì§ì ë©˜í† ë§)</strong>
                                                        <p>â€¢ í˜„ì§ìëŠ” ì •í™•í•œ ê²½ë ¥ì •ë³´ ì œê³µ ì˜ë¬´<br/>â€¢ ë©˜í† ë§ ì‹œê°„ ì¤€ìˆ˜<br/>â€¢ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 20% ë™ì˜<br/>â€¢ ì„¸ê¸ˆ ì‹ ê³  ì˜ë¬´ (ê°œì¸ ì±…ì„)</p>
                                                    </div>
                                                    <div>
                                                        <strong className="text-gray-800">ì œ5ì¡° (ê¸ˆì§€í–‰ìœ„)</strong>
                                                        <p>â€¢ í”Œë«í¼ ì™¸ ì§ì ‘ ê±°ë˜ ìœ ë„<br/>â€¢ í—ˆìœ„ ë¦¬ë·° ì‘ì„±<br/>â€¢ ìŠ¤íŒ¸ ë˜ëŠ” ê´‘ê³ ì„± ë©”ì‹œì§€ ë°œì†¡<br/>â€¢ ê¸°íƒ€ ì„œë¹„ìŠ¤ ìš´ì˜ì— ë°©í•´ë˜ëŠ” í–‰ìœ„</p>
                                                    </div>
                                                    <div>
                                                        <p>â€» ë³¸ ì•½ê´€ì— ë™ì˜í•˜ì§€ ì•Šì„ ê²½ìš° ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="space-y-3">
                                                <div key="privacy-consent">
                                                    <div 
                                                        className="flex items-center space-x-3 cursor-pointer p-3 border rounded-lg"
                                                        style={{
                                                            borderColor: privacyConsent ? '#3b82f6' : '#d1d5db',
                                                            backgroundColor: privacyConsent ? '#eff6ff' : 'white'
                                                        }}
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            e.stopPropagation();
                                                            const newValue = !privacyConsent;
                                                            setPrivacyConsent(newValue);
                                                            
                                                            // DOM ì§ì ‘ ì¡°ì‘ìœ¼ë¡œ ë™ê¸°í™”
                                                            setTimeout(() => {
                                                                const checkbox = document.getElementById('general-privacy-checkbox');
                                                                if (checkbox) {
                                                                    checkbox.checked = newValue;
                                                                    console.log('General privacy checkbox set to:', newValue);
                                                                }
                                                            }, 0);
                                                        }}
                                                    >
                                                        <input
                                                            id="general-privacy-checkbox"
                                                            type="checkbox"
                                                            readOnly
                                                            className="mt-1 w-4 h-4 pointer-events-none expert-checkbox"
                                                            style={{ accentColor: '#3b82f6' }}
                                                        />
                                                        <div className="flex-1 text-sm text-gray-700 font-medium select-none">
                                                            [í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜
                                                            <span className="text-red-500 ml-1">*</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div key="terms-consent">
                                                    <div 
                                                        className="flex items-center space-x-3 cursor-pointer p-3 border rounded-lg"
                                                        style={{
                                                            borderColor: termsConsent ? '#3b82f6' : '#d1d5db',
                                                            backgroundColor: termsConsent ? '#eff6ff' : 'white'
                                                        }}
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            e.stopPropagation();
                                                            const newValue = !termsConsent;
                                                            setTermsConsent(newValue);
                                                            
                                                            // DOM ì§ì ‘ ì¡°ì‘ìœ¼ë¡œ ë™ê¸°í™”
                                                            setTimeout(() => {
                                                                const checkbox = document.getElementById('general-terms-checkbox');
                                                                if (checkbox) {
                                                                    checkbox.checked = newValue;
                                                                    console.log('General terms checkbox set to:', newValue);
                                                                }
                                                            }, 0);
                                                        }}
                                                    >
                                                        <input
                                                            id="general-terms-checkbox"
                                                            type="checkbox"
                                                            readOnly
                                                            className="mt-1 w-4 h-4 pointer-events-none expert-checkbox"
                                                            style={{ accentColor: '#3b82f6' }}
                                                        />
                                                        <div className="flex-1 text-sm text-gray-700 font-medium select-none">
                                                            [í•„ìˆ˜] ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜
                                                            <span className="text-red-500 ml-1">*</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                    <p className="text-red-800 text-sm">{error}</p>
                                </div>
                            )}

                            <div>
                                <button
                                    type="submit"
                                    className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-lg font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                                >
                                    {authMode === 'login' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}
                                </button>
                            </div>

                            <div className="text-center">
                                <button
                                    type="button"
                                    onClick={() => {
                                        setAuthMode(authMode === 'login' ? 'signup' : 'login');
                                        setIsLogin(authMode !== 'login');
                                        setError('');
                                        setEmail('');
                                        setPassword('');
                                        setConfirmPassword('');
                                        setPrivacyConsent(false);
                                        setCustomNickname('');
                                        setUseCustomNickname(false);
                                    }}
                                    className="text-blue-600 hover:text-blue-500 text-sm font-medium"
                                >
                                    {authMode === 'login' ? 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…' : 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸'}
                                </button>
                            </div>
                            
                            {/* ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš” ë§í¬ */}
                            {authMode === 'login' && (
                                <div className="text-center mt-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setAuthMode('resetPassword');
                                            setError('');
                                            setResetMessage('');
                                            setEmail('');
                                        }}
                                        className="text-sm text-gray-500 hover:text-blue-600"
                                    >
                                        ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?
                                    </button>
                                </div>
                            )}
                            </form>
                            )}
                        </div>
                        
                        <div className="flex items-center text-sm text-gray-500 mb-6">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="mx-4">ë˜ëŠ”</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>
                        
                        {/* ì†Œì…œ ë¡œê·¸ì¸ ë²„íŠ¼ë“¤ */}
                        <div className="space-y-3 mb-6">
                            <button
                                onClick={async () => {
                                    try {
                                        const result = await authManager.signInWithGoogle();
                                        if (result.success) {
                                            // OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°œìƒí•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” íŠ¹ë³„íˆ ì²˜ë¦¬í•  ê²ƒì´ ì—†ìŒ
                                            console.log('êµ¬ê¸€ ë¡œê·¸ì¸ ì‹œì‘ë¨');
                                        } else {
                                            setError(result.error);
                                        }
                                    } catch (error) {
                                        setError('êµ¬ê¸€ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                                    }
                                }}
                                className="w-full flex items-center justify-center py-3 px-4 border border-gray-300 rounded-lg bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300"
                            >
                                <svg className="w-5 h-5 mr-3" viewBox="0 0 24 24">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                <span className="text-gray-700 font-medium">êµ¬ê¸€ë¡œ ê³„ì†í•˜ê¸°</span>
                            </button>
                            
                            <button
                                onClick={async () => {
                                    try {
                                        const result = await authManager.signInWithKakao();
                                        if (result.success) {
                                            // OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°œìƒí•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” íŠ¹ë³„íˆ ì²˜ë¦¬í•  ê²ƒì´ ì—†ìŒ
                                            console.log('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œì‘ë¨');
                                        } else {
                                            setError(result.error);
                                        }
                                    } catch (error) {
                                        setError('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                                    }
                                }}
                                className="w-full flex items-center justify-center py-3 px-4 border border-gray-300 rounded-lg bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-all duration-300"
                            >
                                <svg className="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 3C7.03 3 3 6.47 3 10.75C3 13.64 5.11 16.17 8.08 17.31L7.45 19.84C7.4 20.05 7.57 20.24 7.77 20.17L11.17 18.47C11.44 18.49 11.72 18.5 12 18.5C16.97 18.5 21 15.03 21 10.75S16.97 3 12 3Z" fill="#3C1E1E"/>
                                </svg>
                                <span className="text-gray-900 font-medium">ì¹´ì¹´ì˜¤ë¡œ ê³„ì†í•˜ê¸°</span>
                            </button>
                            
                            <button
                                onClick={async () => {
                                    try {
                                        const result = await authManager.signInWithNaver();
                                        if (result.success) {
                                            // OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°œìƒí•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” íŠ¹ë³„íˆ ì²˜ë¦¬í•  ê²ƒì´ ì—†ìŒ
                                            console.log('ë„¤ì´ë²„ ë¡œê·¸ì¸ ì‹œì‘ë¨');
                                        } else {
                                            setError(result.error);
                                        }
                                    } catch (error) {
                                        setError('ë„¤ì´ë²„ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                                    }
                                }}
                                className="w-full flex items-center justify-center py-3 px-4 border border-gray-300 rounded-lg bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-300"
                            >
                                <svg className="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none">
                                    <path d="M21.6 12c0-5.3-4.3-9.6-9.6-9.6S2.4 6.7 2.4 12s4.3 9.6 9.6 9.6c2.8 0 5.3-1.2 7.1-3.1l-2.9-2.9c-0.8 0.8-1.9 1.3-3.1 1.3-2.4 0-4.4-2-4.4-4.4s2-4.4 4.4-4.4c1.2 0 2.3 0.5 3.1 1.3L19.1 6.2C17.3 4.4 14.8 3.2 12 3.2c-4.8 0-8.8 4-8.8 8.8s4 8.8 8.8 8.8c4.8 0 8.8-4 8.8-8.8" fill="white"/>
                                    <path d="M12 3.2c-4.8 0-8.8 4-8.8 8.8s4 8.8 8.8 8.8c4.8 0 8.8-4 8.8-8.8" fill="white" stroke="white" strokeWidth="0.8"/>
                                    <path d="M21.6 12c0-5.3-4.3-9.6-9.6-9.6S2.4 6.7 2.4 12s4.3 9.6 9.6 9.6" fill="white" stroke="white" strokeWidth="0.8"/>
                                </svg>
                                <span className="text-white font-medium">ë„¤ì´ë²„ë¡œ ê³„ì†í•˜ê¸°</span>
                            </button>
                        </div>
                        
                        <div className="flex items-center text-sm text-gray-500 mb-6">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="mx-4">ë˜ëŠ”</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>
                        
                        {/* ê²ŒìŠ¤íŠ¸ë¡œ ì´ìš©í•´ë³´ê¸° */}
                        <div className="text-center space-y-3">
                            <button
                                onClick={() => onAuthSuccess(generateGuestUser())}
                                className="group relative w-full flex justify-center py-3 px-4 border border-gray-300 text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300"
                            >
                                ğŸ§® ê²ŒìŠ¤íŠ¸ë¡œ ì´ìš©í•´ë³´ê¸°
                            </button>
                            <p className="text-center text-sm text-gray-500">
                                íšŒì›ê°€ì…ì—†ì´ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨í•´ë³´ê¸°
                            </p>
                        </div>
                        
                        {/* ì „ë¬¸ê°€ ë“±ë¡ */}
                        <div className="flex items-center text-sm text-gray-500 mb-6">
                            <div className="flex-grow border-t border-gray-300"></div>
                            <span className="mx-4">í˜„ì§ìì´ì‹ ê°€ìš”?</span>
                            <div className="flex-grow border-t border-gray-300"></div>
                        </div>
                        
                        <div className="text-center">
                            <button
                                onClick={() => setAuthMode('expert')}
                                className="group relative w-full flex justify-center py-3 px-4 border-2 border-orange-500 text-base font-medium rounded-lg text-orange-600 bg-orange-50 hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all duration-300"
                            >
                                ğŸ¯ í˜„ì§ìë¡œ ë“±ë¡í•˜ê¸°
                            </button>
                            <p className="text-center text-sm text-gray-500 mt-2">
                                êµ¬ì§ìì—ê²Œ ì·¨ì—…TIPì„ ì œê³µí•˜ê³  ë¶€ìˆ˜ì…ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // ë¸”ë¼ì¸ë“œì‹ ì»¤ë®¤ë‹ˆí‹° ì•±
        const CommunityApp = ({ setCurrentView, currentUser, checkCalculationForInteraction, handlePostClick, isAdminUser }) => {
            const [activeTopic, setActiveTopic] = useState('resume_review');
            const [posts, setPosts] = useState([]);
            const [newPost, setNewPost] = useState({ title: '', content: '', topic: 'resume_review', is_anonymous: true });
            const [showWriteForm, setShowWriteForm] = useState(false);
            const [showExpertWriteForm, setShowExpertWriteForm] = useState(false);
            const [expertPost, setExpertPost] = useState({
                title: '',
                content: '',
                category: 'travel',
                consultation_price: '20000',
                consultation_duration: '30',
                consultation_types: ['phone'],
                expert_title: '',
                expert_name: ''
            });
            const [newReply, setNewReply] = useState('');
            const [userProfile, setUserProfile] = useState(null);
            const [showExpertBookingModal, setShowExpertBookingModal] = useState(false);
            const [selectedExpertFromPost, setSelectedExpertFromPost] = useState(null);

            // ğŸ” ì»¤ë®¤ë‹ˆí‹° ê²€ìƒ‰ ë° ì •ë ¬ ìƒíƒœ ì¶”ê°€
            const [searchKeyword, setSearchKeyword] = useState('');
            const [searchLoading, setSearchLoading] = useState(false);
            const [searchDebounceTimer, setSearchDebounceTimer] = useState(null);
            const [searchFilters, setSearchFilters] = useState({
                sortBy: 'latest', // latest, popular, replies
                showAdvancedFilters: false,
                filterByReplies: 0, // ìµœì†Œ ëŒ“ê¸€ ìˆ˜
                filterByDate: 'all', // all, today, week, month
                filterByType: 'all' // all, general, expert
            });

            // ì „ë¬¸ê°€ ê²Œì‹œê¸€ì—ì„œ ì „ë¬¸ê°€ ì •ë³´ ì¶”ì¶œ
            const getExpertFromPost = (post) => {
                if (post.topic !== 'expert') return null;
                
                return {
                    id: post.user_hash,
                    name: post.expert_name,
                    title: post.expert_title,
                    profileImage: 'ğŸ¯',
                    price: post.consultation_price,
                    hourlyRate: post.consultation_price?.replace(/[^0-9]/g, '') || '50000',
                    availableTypes: ['phone', 'video', 'chat']
                };
            };


            // êµ¬ì§ì ì»¤ë®¤ë‹ˆí‹° í† í”½ (ì·¨ì—… ì¤€ë¹„ 5ê°œ ì¹´í…Œê³ ë¦¬)
            const topics = {
                'resume_review': { name: 'ì„œë¥˜ì¤€ë¹„', icon: 'ğŸ“', description: 'ì´ë ¥ì„œ, ìê¸°ì†Œê°œì„œ ì‘ì„±' },
                'interview_prep': { name: 'ë©´ì ‘ì¤€ë¹„', icon: 'ğŸ¤', description: 'ë©´ì ‘ ìŠ¤í‚¬, ì§ˆë¬¸ ëŒ€ë¹„' },
                'industry_info': { name: 'ì—…ê³„ì •ë³´', icon: 'ğŸ¢', description: 'ê¸°ì—… ì •ë³´, ì—…ê³„ ë™í–¥' },
                'job_analysis': { name: 'ì§ë¬´íƒêµ¬', icon: 'ğŸ’¼', description: 'ì§ë¬´ ì´í•´, ìŠ¤í‚¬ ìš”êµ¬ì‚¬í•­' },
                'networking': { name: 'ë„¤íŠ¸ì›Œí‚¹', icon: 'ğŸ¤', description: 'ì¸ë§¥ í˜•ì„±, ë©˜í†  ì°¾ê¸°' }
            };

            // ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ë³´ê¸°ìš© ìƒ˜í”Œ ë°ì´í„° (ìƒì„¸ë³´ê¸°ëŠ” ê³„ì‚° í›„ ê°€ëŠ¥)
            const samplePosts = [
                {
                    id: '1',
                    title: 'ì´ë ¥ì„œ ìê¸°ì†Œê°œì„œ í”¼ë“œë°± ë¶€íƒë“œë ¤ìš”',
                    content: 'ì‹ ì… ê°œë°œì ì§€ì›í•˜ëŠ”ë° ì´ë ¥ì„œ ê²€í†  ì¢€ í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”? í”„ë¡œì íŠ¸ ê²½í—˜ì´ ë¶€ì¡±í•œ ê²ƒ ê°™ì•„ì„œìš”.',
                    topic: 'resume_review',
                    user_hash: 'user123',
                    age_badge: '20-24ì„¸',
                    is_hot: true,
                    replies_count: 12,
                    likes_count: 8,
                    created_at: '2025-01-20T10:30:00Z'
                },
                {
                    id: '2',
                    title: 'ITê¸°ì—… ë©´ì ‘ í›„ê¸° ê³µìœ ë“œë ¤ìš”',
                    content: 'ë„¤ì¹´ë¼ì¿ ë°° ì¤‘ í•œ ê³³ ë©´ì ‘ ë´¤ìŠµë‹ˆë‹¤. ê¸°ìˆ ë©´ì ‘ì—ì„œ ì´ëŸ° ê±¸ ë¬¼ì–´ë³´ë”ë¼ê³ ìš”.',
                    topic: 'interview_prep',
                    asset_group: 'middle', 
                    user_hash: 'user456',
                    age_badge: '25-29ì„¸',
                    is_hot: false,
                    replies_count: 7,
                    likes_count: 5,
                    created_at: '2025-01-20T09:15:00Z'
                },
                {
                    id: '3',
                    title: 'í•€í…Œí¬ ì—…ê³„ ë™í–¥ ê¶ê¸ˆí•´ìš”',
                    content: 'í•€í…Œí¬ ìª½ìœ¼ë¡œ ì´ì§í•˜ë ¤ëŠ”ë° ìš”ì¦˜ ì±„ìš© ë™í–¥ì´ë‚˜ í•„ìš” ìŠ¤í‚¬ì´ ê¶ê¸ˆí•©ë‹ˆë‹¤.',
                    topic: 'industry_info',
                    user_hash: 'user789',
                    age_badge: '30-34ì„¸',
                    is_hot: true,
                    replies_count: 15,
                    likes_count: 12,
                    created_at: '2025-01-20T08:45:00Z'
                },
                {
                    id: '4',
                    title: 'UXë””ìì´ë„ˆ ì§ë¬´ ê¶ê¸ˆí•´ìš”',
                    content: 'UXë””ìì´ë„ˆë¡œ ì „í–¥í•˜ë ¤ëŠ”ë° ì‹¤ì œ ì—…ë¬´ëŠ” ì–´ë–¤ì§€, í•„ìš”í•œ ìŠ¤í‚¬ì€ ë­”ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤.',
                    topic: 'job_analysis',
                    user_hash: 'user101', 
                    age_badge: '25-29ì„¸',
                    is_hot: false,
                    replies_count: 9,
                    likes_count: 6,
                    created_at: '2025-01-19T16:20:00Z'
                },
                {
                    id: '5',
                    title: 'ì‹ ì… ê°œë°œì ì·¨ì—… ì¤€ë¹„ ì–´ë–»ê²Œ ì‹œì‘í• ê¹Œìš”?',
                    content: '20ëŒ€ ì¤‘ë°˜ì¸ë° ê°œë°œì ì·¨ì—…ì„ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”. ì–´ë–¤ ê²ƒë¶€í„° ì‹œì‘í•´ì•¼ í• ì§€...',
                    topic: 'health',
                    user_hash: 'user202',
                    age_badge: '20-24ì„¸', 
                    is_hot: false,
                    replies_count: 4,
                    likes_count: 3,
                    created_at: '2025-01-19T14:30:00Z'
                },
                // ì „ë¬¸ê°€ ê²Œì‹œê¸€ ìƒ˜í”Œ
                {
                    id: '6',
                    title: 'ì‹ ì… ê°œë°œì ì·¨ì—… ì¤€ë¹„, ì´ê²ƒë§Œì€ ê¼­ í™•ì¸í•˜ì„¸ìš”!',
                    content: 'ì•ˆë…•í•˜ì„¸ìš”, ITê°œë°œ í˜„ì§ì ê¹€ê°œë°œìì…ë‹ˆë‹¤. ì‹ ì… ê°œë°œìë¡œ ì·¨ì—…ì„ ì¤€ë¹„í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤...',
                    topic: 'expert',
                    expert_category: 'travel',
                    user_hash: 'expert_kim_travel',
                    expert_badge: 'ì¸ì¦ ì „ë¬¸ê°€',
                    expert_name: 'ê¹€ê°œë°œì',
                    expert_title: 'ITê°œë°œ í˜„ì§ì',
                    consultation_price: '60,000ì›/60ë¶„',
                    is_hot: true,
                    replies_count: 23,
                    likes_count: 45,
                    created_at: '2025-01-21T09:00:00Z'
                },
                {
                    id: '7', 
                    title: 'íšŒê³„ ì§ë¬´ ì¤€ë¹„ ì „ëµ - ìê²©ì¦ê³¼ ì‹¤ë¬´ì˜ ìµœì  ë°¸ëŸ°ìŠ¤',
                    content: 'íšŒê³„/ì„¸ë¬´ í˜„ì§ì ìµœíšŒê³„ì‚¬ì…ë‹ˆë‹¤. ë§ì€ ë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œëŠ” íšŒê³„ ì§ë¬´ ì¤€ë¹„ ì‹œ ìê²©ì¦ê³¼ ì‹¤ë¬´ ê²½í—˜ì˜ ìµœì  ë°¸ëŸ°ìŠ¤ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤...',
                    topic: 'expert',
                    expert_category: 'legal',
                    user_hash: 'expert_choi_tax',
                    expert_badge: 'ì¸ì¦ ì „ë¬¸ê°€',
                    expert_name: 'ìµœíšŒê³„ì‚¬',
                    expert_title: 'íšŒê³„/ì„¸ë¬´ í˜„ì§ì',
                    consultation_price: '100,000ì›/60ë¶„',
                    is_hot: true,
                    replies_count: 18,
                    likes_count: 32,
                    created_at: '2025-01-20T15:30:00Z'
                },
            ];

            // ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”ì‹œ ì„¸ì…˜ í™•ì¸
            useEffect(() => {
                initializeCommunity();
            }, [currentUser]);

            // í† í”½ ë³€ê²½ì‹œ ê²Œì‹œê¸€ ë‹¤ì‹œ ë¡œë“œ
            useEffect(() => {
                if (currentUser) {
                    loadPosts();
                }
            }, [activeTopic, currentUser]);

            const initializeCommunity = async () => {
                try {
                    if (currentUser) {
                        // Supabase ì—°ê²°ì´ ìˆì„ ë•Œë§Œ ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ
                        if (supabase) {
                            try {
                                const { data: profile, error } = await supabase
                                    .from('user_profiles')
                                    .select('*')
                                    .eq('id', currentUser.id)
                                    .single();
                                
                                if (!error && profile) {
                                    setUserProfile(profile);
                                    console.log(`ì»¤ë®¤ë‹ˆí‹° ì ‘ì†: ${profile.nickname}`);
                                }
                            } catch (supabaseError) {
                                console.log('Supabase ì—°ê²° ì—†ìŒ, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©');
                            }
                        } else {
                            // Supabaseê°€ ì—†ì„ ë•Œ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ë¡œ ì„ì‹œ í”„ë¡œí•„ ìƒì„±
                            setUserProfile({
                                id: currentUser.id,
                                nickname: currentUser.nickname || currentUser.email,
                                email: currentUser.email
                            });
                            console.log('ì»¤ë®¤ë‹ˆí‹° ì ‘ì† (ë¡œì»¬ ëª¨ë“œ)');
                        }
                        
                        // ê²Œì‹œê¸€ ë¡œë“œ (í•­ìƒ ì‹¤í–‰)
                        await loadPosts();
                    }
                } catch (error) {
                    console.error('ì»¤ë®¤ë‹ˆí‹° ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ê²Œì‹œê¸€ UIëŠ” í‘œì‹œ
                    await loadPosts();
                }
            };

            const loadPosts = async () => {
                if (!currentUser) return;
                try {
                    if (supabase) {
                        const { data, error } = await supabase
                            .from('job_seeker_posts')
                            .select('*')
                            .eq('category', activeTopic)
                            .order('created_at', { ascending: false });
                        
                        if (error) throw error;
                        setPosts(data || []);
                    } else {
                        // Supabase ì—°ê²°ì´ ì—†ì„ ë•Œ ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ
                        const filteredPosts = samplePosts.filter(post => 
                            post.topic === activeTopic
                        );
                        setPosts(filteredPosts);
                    }
                } catch (error) {
                    console.error('ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ë°œìƒì‹œ ìƒ˜í”Œ ë°ì´í„°ë¡œ í´ë°±
                    const filteredPosts = samplePosts.filter(post => 
                        post.topic === activeTopic
                    );
                    setPosts(filteredPosts);
                }
            };

            // ë‚´ ìì‚° ê·¸ë£¹ ìë™ ê°ì§€ (ê³„ì‚°ê¸° ê²°ê³¼ ê¸°ë°˜)
            const detectMyAssetGroup = () => {
                // ì‹¤ì œë¡œëŠ” ê³„ì‚°ê¸° ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìì‚° ê·¸ë£¹ì„ ê°ì§€
                // í˜„ì¬ëŠ” ìƒ˜í”Œë¡œ 'middle' ë°˜í™˜
                return 'middle';
            };

            // ğŸ” ê²€ìƒ‰ ì…ë ¥ ì²˜ë¦¬ (ë””ë°”ìš´ìŠ¤ ì ìš©)
            const handleSearchInput = (value) => {
                setSearchKeyword(value);
                setSearchLoading(true);
                
                // ê¸°ì¡´ íƒ€ì´ë¨¸ í´ë¦¬ì–´
                if (searchDebounceTimer) {
                    clearTimeout(searchDebounceTimer);
                }
                
                // ìƒˆ íƒ€ì´ë¨¸ ì„¤ì • (500ms ë””ë°”ìš´ìŠ¤)
                const newTimer = setTimeout(() => {
                    setSearchLoading(false);
                }, 500);
                
                setSearchDebounceTimer(newTimer);
            };

            // ê²Œì‹œê¸€ í•„í„°ë§ ë° ê²€ìƒ‰
            const getFilteredPosts = () => {
                let filtered = posts.filter(post => post.topic === activeTopic);
                
                // 1. í…ìŠ¤íŠ¸ ê²€ìƒ‰ í•„í„°ë§
                if (searchKeyword.trim()) {
                    const keyword = searchKeyword.toLowerCase();
                    filtered = filtered.filter(post => {
                        return (
                            post.title?.toLowerCase().includes(keyword) ||
                            post.content?.toLowerCase().includes(keyword) ||
                            post.expert_name?.toLowerCase().includes(keyword) ||
                            post.expert_title?.toLowerCase().includes(keyword)
                        );
                    });
                }
                
                // 2. ìœ í˜• í•„í„°ë§ (ì¼ë°˜ ê¸€ vs ì „ë¬¸ê°€ ê¸€)
                if (searchFilters.filterByType !== 'all') {
                    filtered = filtered.filter(post => {
                        if (searchFilters.filterByType === 'expert') {
                            return post.topic === 'expert';
                        } else if (searchFilters.filterByType === 'general') {
                            return post.topic !== 'expert';
                        }
                        return true;
                    });
                }
                
                // 3. ëŒ“ê¸€ ìˆ˜ í•„í„°ë§
                if (searchFilters.filterByReplies > 0) {
                    filtered = filtered.filter(post => {
                        const replies = post.replies_count || 0;
                        return replies >= searchFilters.filterByReplies;
                    });
                }
                
                // 4. ë‚ ì§œ í•„í„°ë§
                if (searchFilters.filterByDate !== 'all') {
                    const now = new Date();
                    filtered = filtered.filter(post => {
                        const postDate = new Date(post.created_at);
                        const diffMs = now - postDate;
                        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                        
                        switch (searchFilters.filterByDate) {
                            case 'today':
                                return diffDays === 0;
                            case 'week':
                                return diffDays <= 7;
                            case 'month':
                                return diffDays <= 30;
                            default:
                                return true;
                        }
                    });
                }
                
                // 5. ì •ë ¬
                filtered.sort((a, b) => {
                    switch (searchFilters.sortBy) {
                        case 'popular':
                            return (b.likes_count || 0) - (a.likes_count || 0);
                        case 'replies':
                            return (b.replies_count || 0) - (a.replies_count || 0);
                        case 'latest':
                        default:
                            return new Date(b.created_at) - new Date(a.created_at);
                    }
                });
                
                return filtered;
            };

            const filteredPosts = getFilteredPosts();

            // í˜„ì¬ ì»¤ë®¤ë‹ˆí‹° ê·¸ë£¹ ì •ì˜
            const currentGroup = {
                name: 'êµ¬ì§ì',
                emoji: 'ğŸ¯'
            };

            // ì‹œê°„ í¬ë§·íŒ… (ë¸”ë¼ì¸ë“œì‹)
            const formatTime = (dateString) => {
                const now = new Date();
                const posted = new Date(dateString);
                const diffMs = now - posted;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffHours / 24);
                
                if (diffHours < 1) return 'ë°©ê¸ˆ ì „';
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                return posted.toLocaleDateString();
            };

            const createPost = async () => {
                if (!currentUser) {
                    showNotification('ë¡œê·¸ì¸ í•„ìš”', 'ê²Œì‹œê¸€ ì‘ì„±ì„ ìœ„í•´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                    return;
                }

                if (!newPost.title.trim() || !newPost.content.trim()) {
                    showNotification('ì…ë ¥ ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }

                try {
                    const postData = {
                        ...newPost,
                        topic: activeTopic,
                        author_nickname: userProfile?.nickname || 'ìµëª…',
                        author_id: currentUser.id,
                        age_badge: '20-24ì„¸', // í–¥í›„ í”„ë¡œí•„ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
                        is_hot: false,
                        replies_count: 0,
                        likes_count: 0,
                        created_at: new Date().toISOString()
                    };

                    if (supabase) {
                        const { data, error } = await supabase
                            .from('job_seeker_posts')
                            .insert([postData])
                            .select();
                        
                        if (error) throw error;
                        setPosts([data[0], ...posts]);
                    } else {
                        // ë¡œì»¬ ìƒíƒœì—ë§Œ ì¶”ê°€
                        const newId = String(Date.now());
                        setPosts([{ ...postData, id: newId }, ...posts]);
                    }

                    // í™œë™ ê¸°ë¡ (í•„ìš”ì‹œ ì¶”ê°€)

                    setNewPost({ title: '', content: '', topic: activeTopic, is_anonymous: true });
                    setShowWriteForm(false);
                    showNotification('ê²Œì‹œê¸€ ë“±ë¡ ì™„ë£Œ', 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                } catch (error) {
                    console.error('ê²Œì‹œê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
                    showNotification('ì˜¤ë¥˜ ë°œìƒ', 'ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                }
            };


            // í”„ë¡œê·¸ë ˆì‹œë¸Œ ì ‘ê·¼: ë¨¼ì € ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë³´ì—¬ì£¼ê³ , ìƒí˜¸ì‘ìš© ì‹œì—ë§Œ ê³„ì‚° ì²´í¬

            // ì •ìƒ ì ‘ê·¼: ì»¤ë®¤ë‹ˆí‹° í™”ë©´
            // ê¸°ë³¸ ì»¤ë®¤ë‹ˆí‹° ê·¸ë£¹ (ë‚˜ì¤‘ì— ê³„ì‚° ê²°ê³¼ ê¸°ë°˜ ê·¸ë£¹ ë°°ì • ê°€ëŠ¥)

            return (
                <div className="max-w-4xl mx-auto space-y-4">
                    {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
                    <div className="flex justify-between items-center mb-4">
                        <button
                            onClick={() => setCurrentView('main')}
                            className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                            </svg>
                            ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                        <div className="flex-1"></div>
                    </div>
                    
                    {/* í—¤ë” - ê°„ì†Œí™” */}
                    <div className="bg-white rounded-lg shadow-md p-4">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center space-x-3">
                                <span className="text-2xl">{currentGroup.emoji}</span>
                                <h1 className="text-xl md:text-2xl font-bold text-gray-800">ì»¤ë®¤ë‹ˆí‹°</h1>
                                {isAdminUser(currentUser) && (
                                    <span className="px-2 py-1 bg-red-100 text-red-600 text-xs font-medium rounded-full">
                                        ğŸ‘‘ ê´€ë¦¬ì
                                    </span>
                                )}
                            </div>
                            <div className="flex items-center">
                                <button
                                    onClick={() => {
                                        if (checkCalculationForInteraction()) {
                                            setShowWriteForm(true);
                                        }
                                    }}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg font-medium text-sm md:text-base whitespace-nowrap"
                                >
                                    âœï¸ ê¸€ì“°ê¸°
                                </button>
                            </div>
                        </div>

                        {/* í† í”½ ë³´ë“œ - ì»´íŒ©íŠ¸ */}
                        <div>
                            <h3 className="text-sm font-medium text-gray-600 mb-2">ğŸ“‚ í† í”½ ë³´ë“œ</h3>
                            <div className="grid grid-cols-4 md:grid-cols-8 gap-1">
                                {Object.entries(topics)
                                    .filter(([key, topic]) => {
                                        // ì „ë¬¸ê°€ ì „ìš© í† í”½ì€ ê´€ë¦¬ìì™€ ì „ë¬¸ê°€ë§Œ í‘œì‹œ
                                        if (topic.isExpertOnly) {
                                            return isAdminUser(currentUser) || 
                                                   (currentUser && currentUser.user_type === 'expert');
                                        }
                                        return true;
                                    })
                                    .map(([key, topic]) => (
                                    <button
                                        key={key}
                                        onClick={() => setActiveTopic(key)}
                                        className={`p-2 rounded-lg text-center transition-colors ${
                                            activeTopic === key
                                                ? 'bg-blue-50 border border-blue-300'
                                                : 'bg-gray-50 hover:bg-gray-100 border border-transparent'
                                        }`}
                                        title={topic.description}
                                    >
                                        <div className="text-base mb-1">{topic.icon}</div>
                                        <div className="font-medium text-gray-800 text-xs leading-tight">{topic.name}</div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* ê¸€ì“°ê¸° ëª¨ë‹¬ */}
                    {showWriteForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                                <div className="p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-xl font-bold">âœï¸ ìƒˆ ê¸€ ì‘ì„±</h3>
                                        <button
                                            onClick={() => setShowWriteForm(false)}
                                            className="text-gray-400 hover:text-gray-600"
                                        >
                                            âœ•
                                        </button>
                                    </div>
                                    
                                    <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                                        <p className="text-sm text-blue-800">
                                            <strong>{currentGroup.name}</strong> ì»¤ë®¤ë‹ˆí‹°ì˜{' '}
                                            <strong>{topics[activeTopic].name}</strong> í† í”½ì— ê¸€ì„ ì‘ì„±í•©ë‹ˆë‹¤
                                        </p>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">ì œëª©</label>
                                            <input
                                                type="text"
                                                value={newPost.title}
                                                onChange={(e) => setNewPost({...newPost, title: e.target.value})}
                                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                                maxLength={100}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">ë‚´ìš©</label>
                                            <textarea
                                                value={newPost.content}
                                                onChange={(e) => setNewPost({...newPost, content: e.target.value})}
                                                className="w-full p-3 border rounded-lg h-40 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ê¶ê¸ˆí•œ ì ì´ë‚˜ ê²½í—˜ë‹´ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"
                                                maxLength={1000}
                                            />
                                            <p className="text-xs text-gray-500 mt-1">{newPost.content.length}/1000</p>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <input
                                                type="checkbox"
                                                id="anonymous"
                                                checked={newPost.is_anonymous}
                                                onChange={(e) => setNewPost({...newPost, is_anonymous: e.target.checked})}
                                                className="rounded"
                                            />
                                            <label htmlFor="anonymous" className="text-sm text-gray-600">
                                                ìµëª…ìœ¼ë¡œ ê²Œì‹œ (ì¶”ì²œ)
                                            </label>
                                        </div>
                                        <div className="flex space-x-3 pt-4">
                                            <button
                                                onClick={createPost}
                                                className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium"
                                            >
                                                ê²Œì‹œí•˜ê¸°
                                            </button>
                                            <button
                                                onClick={() => setShowWriteForm(false)}
                                                className="px-6 py-3 border rounded-lg hover:bg-gray-50"
                                            >
                                                ì·¨ì†Œ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* í˜„ì¬ ì„ íƒëœ í† í”½ ì •ë³´ */}
                    <div className="bg-white rounded-lg shadow-md p-4">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center space-x-3">
                                <span className="text-lg">{topics[activeTopic].icon}</span>
                                <div>
                                    <h2 className="font-bold text-lg">{topics[activeTopic].name}</h2>
                                    <p className="text-sm text-gray-600">{currentGroup.name} ì»¤ë®¤ë‹ˆí‹°</p>
                                </div>
                            </div>
                            <div className="text-right text-sm text-gray-500">
                                <p>ê²Œì‹œê¸€ {filteredPosts.length}ê°œ (ì „ì²´ {posts.length}ê°œ)</p>
                                <p>{topics[activeTopic].description}</p>
                            </div>
                        </div>

                        {/* ğŸ” ì»¤ë®¤ë‹ˆí‹° ê²€ìƒ‰ ë° í•„í„° ì„¹ì…˜ */}
                        <div className="bg-gray-50 p-4 rounded-lg space-y-4">
                            {/* ê²€ìƒ‰ ë°” */}
                            <div className="relative">
                                <input
                                    type="text"
                                    placeholder="ê²Œì‹œê¸€ ì œëª©, ë‚´ìš©, ì „ë¬¸ê°€ëª… ê²€ìƒ‰..."
                                    value={searchKeyword}
                                    onChange={(e) => handleSearchInput(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                />
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    {searchLoading ? (
                                        <div className="animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                                    ) : (
                                        <span className="text-gray-400">ğŸ”</span>
                                    )}
                                </div>
                                {searchKeyword && (
                                    <button
                                        onClick={() => {
                                            setSearchKeyword('');
                                            if (searchDebounceTimer) clearTimeout(searchDebounceTimer);
                                        }}
                                        className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                                    >
                                        âœ•
                                    </button>
                                )}
                            </div>

                            {/* í•„í„° ë° ì •ë ¬ */}
                            <div className="flex flex-wrap items-center justify-between gap-3">
                                {/* ì •ë ¬ ì˜µì…˜ */}
                                <div className="flex items-center space-x-2">
                                    <span className="text-sm text-gray-600">ì •ë ¬:</span>
                                    <select
                                        value={searchFilters.sortBy}
                                        onChange={(e) => setSearchFilters({...searchFilters, sortBy: e.target.value})}
                                        className="px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="latest">ìµœì‹ ìˆœ</option>
                                        <option value="popular">ì¸ê¸°ìˆœ</option>
                                        <option value="replies">ëŒ“ê¸€ë§ì€ìˆœ</option>
                                    </select>
                                </div>

                                {/* ê³ ê¸‰ í•„í„° í† ê¸€ */}
                                <button
                                    onClick={() => setSearchFilters({...searchFilters, showAdvancedFilters: !searchFilters.showAdvancedFilters})}
                                    className={`px-3 py-1 text-sm font-medium rounded transition-colors ${
                                        searchFilters.showAdvancedFilters 
                                            ? 'bg-blue-100 text-blue-700 border border-blue-300' 
                                            : 'bg-gray-100 text-gray-600 border border-gray-300'
                                    }`}
                                >
                                    ğŸ›ï¸ ìƒì„¸ í•„í„° {searchFilters.showAdvancedFilters ? 'ì ‘ê¸°' : 'í¼ì¹˜ê¸°'}
                                </button>

                                {/* ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ */}
                                <div className="text-sm text-gray-600">
                                    {searchKeyword && ` (ê²€ìƒ‰ì–´: "${searchKeyword}")`}
                                </div>
                            </div>

                            {/* ê³ ê¸‰ í•„í„° íŒ¨ë„ */}
                            {searchFilters.showAdvancedFilters && (
                                <div className="bg-white p-3 rounded border space-y-3">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        {/* ê¸€ ìœ í˜• í•„í„° */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                ê¸€ ìœ í˜•
                                            </label>
                                            <select
                                                value={searchFilters.filterByType}
                                                onChange={(e) => setSearchFilters({...searchFilters, filterByType: e.target.value})}
                                                className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                                            >
                                                <option value="all">ì „ì²´</option>
                                                <option value="general">ì¼ë°˜ ê¸€</option>
                                                <option value="expert">ì „ë¬¸ê°€ ê¸€</option>
                                            </select>
                                        </div>

                                        {/* ëŒ“ê¸€ ìˆ˜ í•„í„° */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                ìµœì†Œ ëŒ“ê¸€ ìˆ˜: {searchFilters.filterByReplies}ê°œ
                                            </label>
                                            <input
                                                type="range"
                                                min="0"
                                                max="20"
                                                value={searchFilters.filterByReplies}
                                                onChange={(e) => setSearchFilters({...searchFilters, filterByReplies: parseInt(e.target.value)})}
                                                className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                            />
                                            <div className="flex justify-between text-xs text-gray-500">
                                                <span>ì „ì²´</span>
                                                <span>20ê°œ+</span>
                                            </div>
                                        </div>

                                        {/* ë‚ ì§œ í•„í„° */}
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                ì‘ì„± ê¸°ê°„
                                            </label>
                                            <select
                                                value={searchFilters.filterByDate}
                                                onChange={(e) => setSearchFilters({...searchFilters, filterByDate: e.target.value})}
                                                className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                                            >
                                                <option value="all">ì „ì²´ ê¸°ê°„</option>
                                                <option value="today">ì˜¤ëŠ˜</option>
                                                <option value="week">ì¼ì£¼ì¼</option>
                                                <option value="month">í•œ ë‹¬</option>
                                            </select>
                                        </div>
                                    </div>

                                    {/* í•„í„° ì´ˆê¸°í™” */}
                                    <div className="flex justify-end">
                                        <button
                                            onClick={() => {
                                                setSearchFilters({
                                                    sortBy: 'latest',
                                                    showAdvancedFilters: searchFilters.showAdvancedFilters,
                                                    filterByReplies: 0,
                                                    filterByDate: 'all',
                                                    filterByType: 'all'
                                                });
                                                setSearchKeyword('');
                                            }}
                                            className="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700 transition-colors"
                                        >
                                            ğŸ”„ í•„í„° ì´ˆê¸°í™”
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>


                    {/* ê²Œì‹œê¸€ ëª©ë¡ - ë¸”ë¼ì¸ë“œì‹ */}
                    <div className="space-y-2">
                                {filteredPosts.map(post => (
                                    <div key={post.id} className={`rounded-lg shadow-md hover:shadow-lg transition-shadow ${
                                        post.topic === 'expert' ? 'bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500' : 'bg-white'
                                    }`}>
                                        <div className="p-4">
                                            <div className="flex items-start justify-between mb-3">
                                                <div className="flex-1">
                                                    {/* ë±ƒì§€ë“¤ */}
                                                    <div className="flex items-center space-x-2 mb-2">
                                                        {post.topic === 'expert' ? (
                                                            <>
                                                                <span className="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold">
                                                                    ğŸ¯ {post.expert_badge}
                                                                </span>
                                                                <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                                                    {post.expert_name}
                                                                </span>
                                                                {post.consultation_price && (
                                                                    <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                                                                        ğŸ’° {post.consultation_price}
                                                                    </span>
                                                                )}
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">
                                                                </span>
                                                                <span className="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">
                                                                    {post.age_badge}
                                                                </span>
                                                            </>
                                                        )}
                                                        {post.is_hot && (
                                                            <span className="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-medium">
                                                                ğŸ”¥ HOT
                                                            </span>
                                                        )}
                                                    </div>
                                                    
                                                    {/* ì œëª© */}
                                                    <h3 
                                                        className={`font-bold cursor-pointer hover:text-blue-600 transition-colors line-clamp-2 ${
                                                            post.topic === 'expert' ? 'text-orange-900' : 'text-gray-800'
                                                        }`}
                                                        onClick={() => handlePostClick(post)}
                                                    >
                                                        {post.title}
                                                    </h3>
                                                    
                                                    {/* ì „ë¬¸ê°€ íƒ€ì´í‹€ */}
                                                    {post.topic === 'expert' && post.expert_title && (
                                                        <p className="text-orange-700 text-sm font-medium mt-1">
                                                            {post.expert_title}
                                                        </p>
                                                    )}
                                                    
                                                    {/* ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° */}
                                                    <p className="text-gray-600 text-sm mt-2 line-clamp-2">
                                                        {post.content.length > 120 ? `${post.content.substring(0, 120)}...` : post.content}
                                                    </p>
                                                    
                                                    {/* ì „ë¬¸ê°€ ê²Œì‹œê¸€ ì•¡ì…˜ ë²„íŠ¼ */}
                                                    {post.topic === 'expert' && (
                                                        <div className="mt-3 flex space-x-2">
                                                            <button 
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    if (currentUser?.isGuest) {
                                                                        setShowSignupModal(true);
                                                                        return;
                                                                    }
                                                                    const expert = getExpertFromPost(post);
                                                                    if (expert) {
                                                                        setSelectedExpertFromPost(expert);
                                                                        setShowExpertBookingModal(true);
                                                                    }
                                                                }}
                                                                className="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs font-medium"
                                                            >
                                                                ğŸ“ ìƒë‹´ ì˜ˆì•½
                                                            </button>
                                                            <button 
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handlePostClick(post);
                                                                }}
                                                                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium"
                                                            >
                                                                ğŸ“ ì§ˆë¬¸í•˜ê¸°
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                {/* ìš°ì¸¡ ë©”íƒ€ ì •ë³´ */}
                                                <div className="text-right text-sm text-gray-500 ml-4">
                                                    <p>{formatTime(post.created_at)}</p>
                                                    <div className="flex items-center justify-end space-x-2 mt-1">
                                                        <span className="flex items-center">ğŸ’¬ {post.replies_count}</span>
                                                        <span className="flex items-center">ğŸ‘ {post.likes_count}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                
                                {filteredPosts.length === 0 && (
                                    <div className="bg-white rounded-lg p-12 text-center">
                                        {searchKeyword || searchFilters.filterByType !== 'all' || searchFilters.filterByReplies > 0 || searchFilters.filterByDate !== 'all' ? (
                                            <>
                                                <div className="text-6xl mb-4">ğŸ”</div>
                                                <h3 className="text-lg font-semibold text-gray-800 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                                <p className="text-gray-600 mb-4">
                                                    {searchKeyword && `"${searchKeyword}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`}
                                                    {!searchKeyword && "ì„¤ì •í•œ í•„í„° ì¡°ê±´ì— ë§ëŠ” ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤."}
                                                </p>
                                                <div className="space-y-2">
                                                    <button
                                                        onClick={() => {
                                                            setSearchKeyword('');
                                                            setSearchFilters({
                                                                ...searchFilters,
                                                                filterByReplies: 0,
                                                                filterByDate: 'all',
                                                                filterByType: 'all'
                                                            });
                                                        }}
                                                        className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg mr-2"
                                                    >
                                                        ğŸ”„ ê²€ìƒ‰ ì´ˆê¸°í™”
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            if (checkCalculationForInteraction()) {
                                                                setShowWriteForm(true);
                                                            }
                                                        }}
                                                        className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"
                                                    >
                                                        âœï¸ ìƒˆ ê¸€ ì‘ì„±í•˜ê¸°
                                                    </button>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                <div className="text-6xl mb-4">ğŸ“</div>
                                                <h3 className="text-lg font-semibold text-gray-800 mb-2">
                                                    {currentGroup.name}ì˜ {topics[activeTopic].name}
                                                </h3>
                                                <p className="text-gray-600 mb-4">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                                <button
                                                    onClick={() => {
                                                        if (checkCalculationForInteraction()) {
                                                            setShowWriteForm(true);
                                                        }
                                                    }}
                                                    className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg"
                                                >
                                                    ì²« ë²ˆì§¸ ê¸€ ì‘ì„±í•˜ê¸° âœï¸
                                                </button>
                                            </>
                                        )}
                                    </div>
                                )}
                    </div>
                    
                    {/* í˜„ì§ì ë©˜í† ë§ ì˜ˆì•½ ëª¨ë‹¬ */}
                    {showExpertBookingModal && selectedExpertFromPost && 
                        <ConsultationBookingComponent
                            expert={selectedExpertFromPost}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowExpertBookingModal(false);
                                setSelectedExpertFromPost(null);
                            }}
                        />}
                </div>
            );
        };

        // ì „ë¬¸ê°€ ì‹¤ì‹œê°„ ì±„íŒ… ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ExpertChatComponent = ({ consultation, currentUser, onClose, userType }) => {
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [chatStatus, setChatStatus] = useState('active'); // active, paused, completed
            const [chatTimer, setChatTimer] = useState(0);
            const [isTyping, setIsTyping] = useState(false);
            const [showFileUpload, setShowFileUpload] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const messagesEndRef = useRef(null);

            // ì±„íŒ… ì´ˆê¸°í™”
            useEffect(() => {
                const initializeChat = async () => {
                    try {
                        // ê¸°ì¡´ ë©”ì‹œì§€ ë¡œë“œ
                        const { data, error } = await supabase
                            .from('chat_messages')
                            .select('*')
                            .eq('consultation_id', consultation.id)
                            .order('created_at', { ascending: true });

                        if (error) throw error;
                        setMessages(data || []);
                        setConnectionStatus('connected');

                        // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
                        const subscription = supabase
                            .channel(`consultation_${consultation.id}`)
                            .on('postgres_changes', {
                                event: 'INSERT',
                                schema: 'public',
                                table: 'chat_messages',
                                filter: `consultation_id=eq.${consultation.id}`
                            }, (payload) => {
                                setMessages(prev => [...prev, payload.new]);
                                scrollToBottom();
                            })
                            .subscribe();

                        return () => {
                            subscription.unsubscribe();
                        };
                    } catch (error) {
                        console.error('ì±„íŒ… ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                        setConnectionStatus('error');
                    }
                };

                initializeChat();
            }, [consultation.id]);

            // íƒ€ì´ë¨¸ ê´€ë¦¬
            useEffect(() => {
                let interval;
                if (chatStatus === 'active') {
                    interval = setInterval(() => {
                        setChatTimer(prev => prev + 1);
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [chatStatus]);

            // ìŠ¤í¬ë¡¤ ìë™ ì´ë™
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // ë©”ì‹œì§€ ì „ì†¡
            const sendMessage = async () => {
                if (!newMessage.trim()) return;

                const messageData = {
                    consultation_id: consultation.id,
                    sender_id: currentUser.id,
                    sender_type: userType,
                    message_text: newMessage.trim(),
                    message_type: 'text',
                    created_at: new Date().toISOString()
                };

                try {
                    const { error } = await supabase
                        .from('chat_messages')
                        .insert(messageData);

                    if (error) throw error;

                    setNewMessage('');
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                    alert('ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ì‹œê°„ í¬ë§·íŒ…
            const formatTimer = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            // ë©”ì‹œì§€ ì‹œê°„ í¬ë§·íŒ…
            const formatMessageTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl w-full max-w-4xl h-[80vh] flex flex-col shadow-xl">
                        {/* í—¤ë” */}
                        <div className="p-4 border-b border-gray-200 bg-blue-50 rounded-t-xl">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h3 className="text-lg font-bold text-gray-900">
                                        ğŸ’¬ {userType === 'expert' ? 'êµ¬ì§ì' : 'í˜„ì§ì'}ì™€ì˜ ë©˜í† ë§
                                    </h3>
                                    <div className="flex items-center space-x-4 text-sm text-gray-600 mt-1">
                                        <span className="flex items-center">
                                            <div className={`w-2 h-2 rounded-full mr-2 ${
                                                connectionStatus === 'connected' ? 'bg-green-500' : 
                                                connectionStatus === 'connecting' ? 'bg-yellow-500' : 'bg-red-500'
                                            }`}></div>
                                            {connectionStatus === 'connected' ? 'ì—°ê²°ë¨' : 
                                             connectionStatus === 'connecting' ? 'ì—°ê²° ì¤‘' : 'ì—°ê²° ì˜¤ë¥˜'}
                                        </span>
                                        <span>â° {formatTimer(chatTimer)}</span>
                                        <span className={`px-2 py-1 rounded-full text-xs ${
                                            chatStatus === 'active' ? 'bg-green-100 text-green-800' :
                                            chatStatus === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-gray-100 text-gray-800'
                                        }`}>
                                            {chatStatus === 'active' ? 'ìƒë‹´ ì§„í–‰ ì¤‘' :
                                             chatStatus === 'paused' ? 'ì ì‹œ ëŒ€ê¸°' : 'ìƒë‹´ ì™„ë£Œ'}
                                        </span>
                                    </div>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => setChatStatus(chatStatus === 'active' ? 'paused' : 'active')}
                                        className={`px-3 py-1 rounded text-sm font-medium ${
                                            chatStatus === 'active' 
                                                ? 'bg-yellow-500 text-white hover:bg-yellow-600'
                                                : 'bg-green-500 text-white hover:bg-green-600'
                                        }`}
                                    >
                                        {chatStatus === 'active' ? 'â¸ï¸ ì¼ì‹œì •ì§€' : 'â–¶ï¸ ì¬ì‹œì‘'}
                                    </button>
                                    <button 
                                        onClick={onClose}
                                        className="text-gray-500 hover:text-gray-700 text-xl px-2"
                                    >
                                        âœ•
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* ë©”ì‹œì§€ ì˜ì—­ */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                            {messages.length === 0 ? (
                                <div className="text-center text-gray-500 mt-8">
                                    <p className="text-lg">ğŸ’¬ ìƒë‹´ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                                    <p className="text-sm mt-2">í¸ì•ˆí•˜ê²Œ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”.</p>
                                </div>
                            ) : (
                                messages.map((message, index) => {
                                    const isMyMessage = message.sender_id === currentUser.id;
                                    return (
                                        <div key={index} className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[70%] ${isMyMessage ? 'order-2' : 'order-1'}`}>
                                                <div className={`p-3 rounded-lg ${
                                                    isMyMessage 
                                                        ? 'bg-blue-500 text-white rounded-br-sm' 
                                                        : 'bg-white text-gray-900 rounded-bl-sm shadow-sm border'
                                                }`}>
                                                    <p className="whitespace-pre-wrap">{message.message_text}</p>
                                                </div>
                                                <div className={`text-xs text-gray-500 mt-1 ${isMyMessage ? 'text-right' : 'text-left'}`}>
                                                    {formatMessageTime(message.created_at)}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                            {isTyping && (
                                <div className="flex justify-start">
                                    <div className="bg-white text-gray-500 p-3 rounded-lg rounded-bl-sm shadow-sm border max-w-[70%]">
                                        <div className="flex space-x-1">
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* ì…ë ¥ ì˜ì—­ */}
                        <div className="p-4 border-t border-gray-200 bg-white rounded-b-xl">
                            <div className="flex space-x-2">
                                <button
                                    onClick={() => setShowFileUpload(!showFileUpload)}
                                    className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
                                    title="íŒŒì¼ ì²¨ë¶€"
                                >
                                    ğŸ“
                                </button>
                                <input
                                    type="text"
                                    value={newMessage}
                                    onChange={(e) => setNewMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && sendMessage()}
                                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Enter: ì „ì†¡, Shift+Enter: ì¤„ë°”ê¿ˆ)"
                                    className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                    disabled={chatStatus !== 'active'}
                                />
                                <button
                                    onClick={sendMessage}
                                    disabled={!newMessage.trim() || chatStatus !== 'active'}
                                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors"
                                >
                                    ì „ì†¡
                                </button>
                            </div>
                            {showFileUpload && (
                                <div className="mt-2 p-3 bg-gray-50 rounded-lg">
                                    <input
                                        type="file"
                                        className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                                        accept="image/*,application/pdf,.doc,.docx,.txt"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">ì´ë¯¸ì§€, PDF, ë¬¸ì„œ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥ (ìµœëŒ€ 10MB)</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ì „ë¬¸ê°€ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ExpertBookingManagementComponent = ({ currentUser, userType = 'expert' }) => {
            const [bookings, setBookings] = useState([]);
            const [activeTab, setActiveTab] = useState('upcoming'); // upcoming, completed, cancelled
            const [loading, setLoading] = useState(true);
            const [showChatModal, setShowChatModal] = useState(false);
            const [selectedConsultation, setSelectedConsultation] = useState(null);
            const [showCompletionModal, setShowCompletionModal] = useState(false);

            // ì˜ˆì•½ ëª©ë¡ ë¡œë“œ
            useEffect(() => {
                const loadBookings = async () => {
                    try {
                        setLoading(true);
                        
                        const query = supabase
                            .from('consultation_bookings')
                            .select(`
                                *,
                                expert:experts!consultation_bookings_expert_id_fkey(name, title, specialties),
                                client:user_profiles!consultation_bookings_client_id_fkey(nickname, email)
                            `);

                        // ì „ë¬¸ê°€ì¸ ê²½ìš° ìì‹ ì˜ ì˜ˆì•½ë§Œ, ê³ ê°ì¸ ê²½ìš° ìì‹ ì´ ì˜ˆì•½í•œ ê²ƒë§Œ
                        if (userType === 'expert') {
                            query.eq('expert_id', currentUser.id);
                        } else {
                            query.eq('client_id', currentUser.id);
                        }

                        const { data, error } = await query.order('scheduled_time', { ascending: false });

                        if (error) throw error;
                        setBookings(data || []);
                    } catch (error) {
                        console.error('ì˜ˆì•½ ëª©ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
                        setBookings([]);
                    } finally {
                        setLoading(false);
                    }
                };

                loadBookings();
            }, [currentUser.id, userType]);

            // ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ (ìˆ˜ìµ ì •ì‚° í¬í•¨)
            const completeConsultation = async (bookingId, rating = null, review = null) => {
                try {
                    const booking = bookings.find(b => b.id === bookingId);
                    if (!booking) throw new Error('ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

                    const now = new Date().toISOString();

                    // 1. ì˜ˆì•½ ìƒíƒœë¥¼ ì™„ë£Œë¡œ ì—…ë°ì´íŠ¸ (ìŠ¤í‚¤ë§ˆ í•„ë“œëª…ì— ë§ì¶¤)
                    const updateData = { 
                        booking_status: 'completed',
                        completed_at: now,
                        updated_at: now
                    };

                    // êµ¬ì§ì í‰ì /ë¦¬ë·° ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
                    if (rating !== null) updateData.job_seeker_rating = rating;
                    if (review) updateData.job_seeker_feedback = review;

                    const { error: updateError } = await supabase
                        .from('consultation_bookings')
                        .update(updateData)
                        .eq('id', bookingId);

                    if (updateError) throw updateError;

                    // 2. ìˆ˜ìµ ì •ì‚° ì²˜ë¦¬ (ê¸°ì¡´ expert_payout í•„ë“œ ì—…ë°ì´íŠ¸)
                    const totalAmount = booking.total_amount || booking.payment_amount;
                    const platformFeeRate = booking.platform_fee_rate || 0.20;
                    const platformFee = Math.round(totalAmount * platformFeeRate);
                    const expertPayout = totalAmount - platformFee;

                    // consultation_bookings í…Œì´ë¸”ì— ì •ì‚° ì •ë³´ ì—…ë°ì´íŠ¸  
                    const { error: settlementError } = await supabase
                        .from('consultation_bookings')
                        .update({
                            platform_fee: platformFee,
                            expert_payout: expertPayout
                        })
                        .eq('id', bookingId);

                    if (settlementError) throw settlementError;

                    // 3. fee_settlements í…Œì´ë¸”ì— ì •ì‚° ë ˆì½”ë“œ ìƒì„±
                    const { error: feeSettlementError } = await supabase
                        .from('fee_settlements')
                        .insert({
                            booking_id: bookingId,
                            expert_id: booking.professional_id,
                            total_revenue: totalAmount,
                            platform_fee: platformFee,
                            expert_payout: expertPayout,
                            settlement_status: 'completed',
                            completed_date: now
                        });

                    if (feeSettlementError) {
                        console.warn('ì •ì‚° ë ˆì½”ë“œ ìƒì„± ì‹¤íŒ¨:', feeSettlementError);
                        // ì •ì‚° ë ˆì½”ë“œ ìƒì„± ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì§„í–‰
                    }

                    // 4. ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    setBookings(prev => prev.map(booking => 
                        booking.id === bookingId 
                            ? { ...booking, booking_status: 'completed', updated_at: now } 
                            : booking
                    ));

                    // 5. ìƒë‹´ ì™„ë£Œ ì•Œë¦¼ ì‹œìŠ¤í…œ
                    await sendConsultationCompletionNotifications(booking, expertPayout, platformFee);

                    // 6. ì™„ë£Œ í›„ ì‚¬ìš©ìë³„ ë§ì¶¤ ì•ˆë‚´
                    const isExpert = currentUser.id === booking.professional_id;
                    if (isExpert) {
                        alert('ğŸ¯ ìƒë‹´ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' + 
                              `ğŸ’° ìˆ˜ìµ ì •ì‚°: ${expertPayout.toLocaleString()}ì›\n` +
                              `ğŸ“Š í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ: ${platformFee.toLocaleString()}ì›\n\n` +
                              'ğŸ“ˆ ë” ë§ì€ êµ¬ì§ì ë„ì›€ìœ¼ë¡œ ìˆ˜ìµì„ ëŠ˜ë ¤ë³´ì„¸ìš”!');
                    } else {
                        alert('ğŸ‰ ë©˜í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                              'ğŸ’¡ ë°›ìœ¼ì‹  ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ ì·¨ì—… ì¤€ë¹„ë¥¼ ì´ì–´ê°€ì„¸ìš”\n' +
                              'ğŸ“ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ í›„ê¸°ë¥¼ ê³µìœ í•˜ì‹œë©´ ë‹¤ë¥¸ êµ¬ì§ìë“¤ì—ê²Œ ë„ì›€ì´ ë©ë‹ˆë‹¤\n' +
                              'ğŸ” ì¶”ê°€ ë©˜í† ë§ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ë‹¤ë¥¸ í˜„ì§ìë¥¼ ì°¾ì•„ë³´ì„¸ìš”!');
                    }
                } catch (error) {
                    console.error('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert(`ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
                }
            };

            // ìƒë‹´ ì™„ë£Œ ì•Œë¦¼ ì‹œìŠ¤í…œ
            const sendConsultationCompletionNotifications = async (booking, expertPayout, platformFee) => {
                try {
                    // 1. í”Œë«í¼ ë‚´ ì•Œë¦¼ ìƒì„± (ì–‘ë°©í–¥)
                    const notifications = [
                        {
                            user_id: booking.job_seeker_id,
                            type: 'consultation_completed',
                            title: 'ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
                            message: `${booking.expert?.name || 'í˜„ì§ì'}ë‹˜ê³¼ì˜ ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í›„ê¸° ì‘ì„±ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.`,
                            related_id: booking.id,
                            is_read: false
                        },
                        {
                            user_id: booking.professional_id,
                            type: 'consultation_completed',
                            title: 'ìƒë‹´ ì™„ë£Œ ë° ìˆ˜ìµ ì •ì‚°',
                            message: `${booking.jobSeeker?.nickname || 'êµ¬ì§ì'}ë‹˜ê³¼ì˜ ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ìµ ${expertPayout.toLocaleString()}ì›ì´ ì •ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                            related_id: booking.id,
                            is_read: false
                        }
                    ];

                    // ì•Œë¦¼ í…Œì´ë¸”ì— ì €ì¥ (notifications í…Œì´ë¸”ì´ ìˆë‹¤ë©´)
                    const { error: notificationError } = await supabase
                        .from('notifications')
                        .insert(notifications);

                    if (notificationError) {
                        console.warn('ì•Œë¦¼ ì €ì¥ ì‹¤íŒ¨:', notificationError);
                        // ì•Œë¦¼ ì €ì¥ ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì§„í–‰
                    }

                    // 2. ì´ë©”ì¼ ì•Œë¦¼ (Supabase Edge Functions)
                    await sendConsultationCompletionEmails(booking, expertPayout, platformFee);
                    
                    // 3. ì‚¬ìš©ì ê°€ì´ë˜ìŠ¤ ë©”ì‹œì§€ ìƒì„±
                    await createCompletionGuidanceMessage(booking);
                    
                    console.log('ìƒë‹´ ì™„ë£Œ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ');
                } catch (error) {
                    console.error('ì•Œë¦¼ ë°œì†¡ ì˜¤ë¥˜:', error);
                    // ì•Œë¦¼ ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì •ìƒ ì§„í–‰
                }
            };

            // ìƒë‹´ ì™„ë£Œ í›„ ê°€ì´ë˜ìŠ¤ ë©”ì‹œì§€ ìƒì„±
            const createCompletionGuidanceMessage = async (booking) => {
                try {
                    const expertGuidance = {
                        type: 'guidance',
                        title: 'ğŸ¯ ìƒë‹´ ì™„ë£Œ - ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´',
                        messages: [
                            'âœ… ìƒë‹´ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
                            'ğŸ’° ìˆ˜ìµ ì •ì‚°ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤',
                            'ğŸ“ˆ ë” ë§ì€ êµ¬ì§ìë¥¼ ë„ìš°ì‹¤ ìˆ˜ ìˆë„ë¡ í”„ë¡œí•„ì„ ì—…ë°ì´íŠ¸í•´ë³´ì„¸ìš”',
                            'ğŸŒŸ ì¢‹ì€ ë¦¬ë·°ê°€ ìŒ“ì´ë©´ ë” ë§ì€ ì˜ˆì•½ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤'
                        ]
                    };

                    const jobSeekerGuidance = {
                        type: 'guidance', 
                        title: 'ğŸ‰ ë©˜í† ë§ ì™„ë£Œ - ì·¨ì—… ì„±ê³µì„ ì‘ì›í•©ë‹ˆë‹¤!',
                        messages: [
                            'âœ… í˜„ì§ì ë©˜í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤',
                            'ğŸ’¡ ë°›ìœ¼ì‹  ì¡°ì–¸ì„ ì‹¤í–‰ì— ì˜®ê²¨ë³´ì„¸ìš”',
                            'ğŸ“ ì»¤ë®¤ë‹ˆí‹°ì— ë©˜í† ë§ í›„ê¸°ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”',
                            'ğŸ” ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ë‹¤ë¥¸ í˜„ì§ì ë©˜í† ë§ë„ ì´ìš©í•´ë³´ì„¸ìš”'
                        ]
                    };

                    // ê°€ì´ë˜ìŠ¤ ë©”ì‹œì§€ë¥¼ ì±„íŒ…ë°©ì— ìë™ ë°œì†¡
                    const chatRoom = await findOrCreateConsultationChatRoom(booking.id);
                    if (chatRoom) {
                        // í˜„ì§ììš© ê°€ì´ë˜ìŠ¤
                        await supabase.from('chat_messages').insert({
                            room_id: chatRoom.id,
                            user_id: null, // ì‹œìŠ¤í…œ ë©”ì‹œì§€
                            message_text: `${expertGuidance.title}\n\n${expertGuidance.messages.join('\n')}`,
                            message_type: 'system_guidance',
                            created_at: new Date().toISOString()
                        });

                        // êµ¬ì§ììš© ê°€ì´ë˜ìŠ¤  
                        await supabase.from('chat_messages').insert({
                            room_id: chatRoom.id,
                            user_id: null, // ì‹œìŠ¤í…œ ë©”ì‹œì§€
                            message_text: `${jobSeekerGuidance.title}\n\n${jobSeekerGuidance.messages.join('\n')}`,
                            message_type: 'system_guidance',
                            created_at: new Date().toISOString()
                        });
                    }
                } catch (error) {
                    console.error('ê°€ì´ë˜ìŠ¤ ë©”ì‹œì§€ ìƒì„± ì˜¤ë¥˜:', error);
                    // ê°€ì´ë˜ìŠ¤ ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì •ìƒ ì§„í–‰
                }
            };

            // ìƒë‹´ìš© ì±„íŒ…ë°© ì°¾ê¸° ë˜ëŠ” ìƒì„± 
            const findOrCreateConsultationChatRoom = async (bookingId) => {
                try {
                    // ê¸°ì¡´ ì±„íŒ…ë°© í™•ì¸
                    const { data: existingRoom } = await supabase
                        .from('chat_rooms')
                        .select('*')
                        .eq('name', `ìƒë‹´ ${bookingId}`)
                        .eq('room_type', 'consultation')
                        .single();

                    if (existingRoom) return existingRoom;

                    // ìƒˆ ì±„íŒ…ë°© ìƒì„±
                    const { data: newRoom, error } = await supabase
                        .from('chat_rooms')
                        .insert({
                            name: `ìƒë‹´ ${bookingId}`,
                            description: 'í˜„ì§ì ë©˜í† ë§ ì±„íŒ…ë°©',
                            room_type: 'consultation'
                        })
                        .select()
                        .single();

                    if (error) throw error;
                    return newRoom;
                } catch (error) {
                    console.error('ì±„íŒ…ë°© ìƒì„±/ì°¾ê¸° ì˜¤ë¥˜:', error);
                    return null;
                }
            };

            // ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ (Supabase Edge Functions)
            const sendConsultationCompletionEmails = async (booking, expertPayout, platformFee) => {
                try {
                    // êµ¬ì§ì ì´ë©”ì¼
                    const jobSeekerEmailData = {
                        to: booking.jobSeeker?.email,
                        subject: 'ğŸ‰ ì¸ì‚¬ì´ë“œì¡ ë©˜í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
                        template: 'consultation_completed_jobseeker',
                        variables: {
                            jobSeekerName: booking.jobSeeker?.nickname,
                            expertName: booking.expert?.name,
                            consultationDate: new Date(booking.scheduled_time).toLocaleDateString('ko-KR'),
                            consultationType: booking.consultation_type,
                            duration: booking.duration_minutes
                        }
                    };

                    // í˜„ì§ì ì´ë©”ì¼
                    const expertEmailData = {
                        to: booking.expert?.email,
                        subject: 'ğŸ’° ì¸ì‚¬ì´ë“œì¡ ë©˜í† ë§ ì™„ë£Œ ë° ìˆ˜ìµ ì •ì‚° ì•ˆë‚´',
                        template: 'consultation_completed_expert',
                        variables: {
                            expertName: booking.expert?.name,
                            jobSeekerName: booking.jobSeeker?.nickname,
                            consultationDate: new Date(booking.scheduled_time).toLocaleDateString('ko-KR'),
                            payout: expertPayout,
                            platformFee: platformFee,
                            totalAmount: booking.total_amount || booking.payment_amount
                        }
                    };

                    // Supabase Edge Functions í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„ì€ ì„œë²„ì¸¡ í•„ìš”)
                    const emailPromises = [
                        fetch('/api/send-email', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(jobSeekerEmailData)
                        }),
                        fetch('/api/send-email', {
                            method: 'POST', 
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(expertEmailData)
                        })
                    ];

                    // ì´ë©”ì¼ ë°œì†¡ (ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì •ìƒ ì§„í–‰)
                    const results = await Promise.allSettled(emailPromises);
                    
                    results.forEach((result, index) => {
                        if (result.status === 'rejected') {
                            console.warn(`ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (${index === 0 ? 'êµ¬ì§ì' : 'í˜„ì§ì'}):`, result.reason);
                        }
                    });

                    console.log('ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ (ì„±ê³µ/ì‹¤íŒ¨ ë¬´ê´€í•˜ê²Œ ìƒë‹´ ì™„ë£Œ ì§„í–‰)');
                } catch (error) {
                    console.error('ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ ì˜¤ë¥˜:', error);
                    // ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨í•´ë„ ìƒë‹´ ì™„ë£ŒëŠ” ì •ìƒ ì§„í–‰
                }
            };

            // ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì¼ë°˜)
            const updateBookingStatus = async (bookingId, newStatus) => {
                try {
                    const { error } = await supabase
                        .from('consultation_bookings')
                        .update({ 
                            booking_status: newStatus, 
                            updated_at: new Date().toISOString() 
                        })
                        .eq('id', bookingId);

                    if (error) throw error;

                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    setBookings(prev => prev.map(booking => 
                        booking.id === bookingId 
                            ? { ...booking, booking_status: newStatus } 
                            : booking
                    ));

                    const statusText = {
                        'accepted': 'ìŠ¹ì¸',
                        'rejected': 'ê±°ì ˆ', 
                        'cancelled': 'ì·¨ì†Œ',
                        'completed': 'ì™„ë£Œ'
                    };
                    alert(`ì˜ˆì•½ì´ ${statusText[newStatus] || 'ì—…ë°ì´íŠ¸'}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } catch (error) {
                    console.error('ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                    alert('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ì±„íŒ… ì‹œì‘
            const startChat = (booking) => {
                setSelectedConsultation(booking);
                setShowChatModal(true);
            };

            // ì˜ˆì•½ í•„í„°ë§ (ìŠ¤í‚¤ë§ˆì— ë§ì¶¤)
            const filteredBookings = bookings.filter(booking => {
                const now = new Date();
                const scheduledDateTime = new Date(`${booking.scheduled_date}T${booking.scheduled_time}`);
                const status = booking.booking_status || booking.status; // í˜¸í™˜ì„± ìœ ì§€
                
                switch (activeTab) {
                    case 'upcoming':
                        return ['requested', 'accepted'].includes(status) && scheduledDateTime >= now;
                    case 'completed':
                        return status === 'completed' || scheduledDateTime < now;
                    case 'cancelled':
                        return ['cancelled', 'rejected', 'no_show'].includes(status);
                    default:
                        return true;
                }
            });

            // ì‹œê°„ í¬ë§·íŒ…
            const formatDateTime = (dateTime) => {
                const date = new Date(dateTime);
                return date.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            // ìƒíƒœ ë±ƒì§€ ìŠ¤íƒ€ì¼
            const getStatusBadge = (status) => {
                const styles = {
                    pending: 'bg-yellow-100 text-yellow-800',
                    confirmed: 'bg-green-100 text-green-800',
                    completed: 'bg-blue-100 text-blue-800',
                    cancelled: 'bg-red-100 text-red-800'
                };
                
                const labels = {
                    pending: 'ëŒ€ê¸°ì¤‘',
                    confirmed: 'í™•ì •',
                    completed: 'ì™„ë£Œ',
                    cancelled: 'ì·¨ì†Œ'
                };

                return (
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${styles[status] || styles.pending}`}>
                        {labels[status] || status}
                    </span>
                );
            };

            if (loading) {
                return (
                    <div className="bg-white rounded-lg p-8 text-center">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                        <p className="text-gray-600">ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                );
            }

            return (
                <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="p-6">
                        <h3 className="text-xl font-bold text-gray-900 mb-6">
                            {userType === 'expert' ? 'ğŸ“‹ ìƒë‹´ ì˜ˆì•½ ê´€ë¦¬' : 'ğŸ“… ë‚˜ì˜ ìƒë‹´ ì˜ˆì•½'}
                        </h3>

                        {/* íƒ­ ë©”ë‰´ */}
                        <div className="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg">
                            {[
                                { id: 'upcoming', label: 'ì˜ˆì •ëœ ìƒë‹´', count: bookings.filter(b => ['pending', 'confirmed'].includes(b.status)).length },
                                { id: 'completed', label: 'ì™„ë£Œëœ ìƒë‹´', count: bookings.filter(b => b.status === 'completed').length },
                                { id: 'cancelled', label: 'ì·¨ì†Œëœ ìƒë‹´', count: bookings.filter(b => b.status === 'cancelled').length }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                        activeTab === tab.id
                                            ? 'bg-white text-blue-600 shadow-sm'
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                >
                                    {tab.label} ({tab.count})
                                </button>
                            ))}
                        </div>

                        {/* ì˜ˆì•½ ëª©ë¡ */}
                        <div className="space-y-4">
                            {filteredBookings.length === 0 ? (
                                <div className="text-center py-8 text-gray-500">
                                    <p className="text-lg">ğŸ“… {activeTab === 'upcoming' ? 'ì˜ˆì •ëœ' : activeTab === 'completed' ? 'ì™„ë£Œëœ' : 'ì·¨ì†Œëœ'} ìƒë‹´ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                    <p className="text-sm mt-2">
                                        {userType === 'expert' 
                                            ? 'ê³ ê°ë“¤ì˜ ìƒë‹´ ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.' 
                                            : 'í˜„ì§ìì™€ ë©˜í† ë§ì„ ì˜ˆì•½í•´ë³´ì„¸ìš”.'}
                                    </p>
                                </div>
                            ) : (
                                filteredBookings.map(booking => (
                                    <div key={booking.id} className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex-1">
                                                <h4 className="font-semibold text-gray-900">
                                                    {userType === 'expert' 
                                                        ? `${booking.client?.nickname || 'ìµëª…'} ë‹˜ê³¼ì˜ ìƒë‹´`
                                                        : `${booking.expert?.name || 'í˜„ì§ì'} ë‹˜ê³¼ì˜ ë©˜í† ë§`
                                                    }
                                                </h4>
                                                <p className="text-sm text-gray-600 mt-1">ğŸ“… {formatDateTime(booking.scheduled_time)}</p>
                                                <p className="text-sm text-gray-600">ğŸ’¬ {booking.consultation_topic}</p>
                                                <p className="text-sm text-gray-600">ğŸ’° ìƒë‹´ë£Œ: {booking.payment_amount?.toLocaleString()}ì›</p>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                {getStatusBadge(booking.status)}
                                            </div>
                                        </div>

                                        {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                                        <div className="flex space-x-2 pt-3 border-t border-gray-100">
                                            {(booking.booking_status || booking.status) === 'accepted' && (
                                                <button
                                                    onClick={() => startChat(booking)}
                                                    className="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                                >
                                                    ğŸ’¬ ì±„íŒ… ì‹œì‘
                                                </button>
                                            )}
                                            
                                            {userType === 'expert' && (booking.booking_status || booking.status) === 'requested' && (
                                                <>
                                                    <button
                                                        onClick={() => updateBookingStatus(booking.id, 'accepted')}
                                                        className="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600"
                                                    >
                                                        âœ… ìŠ¹ì¸
                                                    </button>
                                                    <button
                                                        onClick={() => updateBookingStatus(booking.id, 'rejected')}
                                                        className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                                    >
                                                        âŒ ê±°ì ˆ
                                                    </button>
                                                </>
                                            )}
                                            
                                            {(booking.booking_status || booking.status) === 'accepted' && (
                                                <button
                                                    onClick={() => {
                                                        if (userType === 'client') {
                                                            // êµ¬ì§ìëŠ” í‰ì /ë¦¬ë·°ì™€ í•¨ê»˜ ì™„ë£Œ ì²˜ë¦¬
                                                            setSelectedConsultation(booking);
                                                            setShowCompletionModal(true);
                                                        } else {
                                                            // í˜„ì§ìëŠ” ë°”ë¡œ ì™„ë£Œ ì²˜ë¦¬
                                                            if (confirm('ìƒë‹´ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì™„ë£Œ ì‹œ ìˆ˜ìµ ì •ì‚°ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.')) {
                                                                completeConsultation(booking.id);
                                                            }
                                                        }
                                                    }}
                                                    className="px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600"
                                                >
                                                    âœ… ì™„ë£Œ
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* ì±„íŒ… ëª¨ë‹¬ */}
                    {showChatModal && selectedConsultation && (
                        <ExpertChatComponent
                            consultation={selectedConsultation}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowChatModal(false);
                                setSelectedConsultation(null);
                            }}
                            userType={userType}
                        />
                    )}

                    {/* ìƒë‹´ ì™„ë£Œ í‰ì /ë¦¬ë·° ëª¨ë‹¬ */}
                    {showCompletionModal && selectedConsultation && 
                        <ConsultationCompletionModal
                            consultation={selectedConsultation}
                            onComplete={completeConsultation}
                            onClose={() => {
                                setShowCompletionModal(false);
                                setSelectedConsultation(null);
                            }}
                        />}
                </div>
            );
        };

        // ìƒë‹´ ì™„ë£Œ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
        const ConsultationCompletionModal = ({ consultation, onComplete, onClose }) => {
            const [rating, setRating] = useState(5);
            const [review, setReview] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                
                try {
                    await onComplete(consultation.id, rating, review);
                    onClose();
                } catch (error) {
                    console.error('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl max-w-lg w-full">
                        {/* í—¤ë” */}
                        <div className="p-6 border-b border-gray-200">
                            <div className="flex justify-between items-center">
                                <h2 className="text-xl font-bold text-gray-900">
                                    ğŸ‰ ìƒë‹´ ì™„ë£Œ
                                </h2>
                                <button
                                    onClick={onClose}
                                    className="text-gray-400 hover:text-gray-600"
                                >
                                    âœ•
                                </button>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="p-6 space-y-6">
                            {/* ìƒë‹´ ì •ë³´ */}
                            <div className="bg-gray-50 rounded-lg p-4">
                                <h3 className="font-medium text-gray-900 mb-2">
                                    {consultation.expert?.name}ë‹˜ê³¼ì˜ ë©˜í† ë§
                                </h3>
                                <div className="text-sm text-gray-600 space-y-1">
                                    <div>ğŸ“… {new Date(consultation.scheduled_time).toLocaleString('ko-KR')}</div>
                                    <div>â±ï¸ {consultation.duration_minutes}ë¶„ ìƒë‹´</div>
                                    <div>ğŸ’° ê²°ì œ ê¸ˆì•¡: {consultation.total_amount?.toLocaleString() || consultation.payment_amount?.toLocaleString()}ì›</div>
                                </div>
                            </div>

                            {/* í‰ì  ì…ë ¥ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë©˜í† ë§ ë§Œì¡±ë„
                                </label>
                                <div className="flex items-center space-x-2">
                                    {[1, 2, 3, 4, 5].map(star => (
                                        <button
                                            key={star}
                                            type="button"
                                            onClick={() => setRating(star)}
                                            className={`text-2xl transition-colors ${
                                                star <= rating ? 'text-yellow-400' : 'text-gray-300'
                                            }`}
                                        >
                                            â­
                                        </button>
                                    ))}
                                    <span className="ml-2 text-sm text-gray-600">
                                        ({rating}ì )
                                    </span>
                                </div>
                            </div>

                            {/* ë¦¬ë·° ì…ë ¥ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë©˜í† ë§ í›„ê¸° (ì„ íƒì‚¬í•­)
                                </label>
                                <textarea
                                    value={review}
                                    onChange={(e) => setReview(e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="4"
                                    placeholder="í˜„ì§ìë‹˜ì˜ ë©˜í† ë§ì€ ì–´ë– ì…¨ë‚˜ìš”? ì†”ì§í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."
                                />
                            </div>

                            {/* ì œì¶œ ë²„íŠ¼ */}
                            <div className="flex space-x-3">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    type="submit"
                                    disabled={isSubmitting}
                                    className={`flex-1 py-3 rounded-lg font-medium ${
                                        isSubmitting
                                            ? 'bg-gray-400 cursor-not-allowed'
                                            : 'bg-green-600 hover:bg-green-700 text-white'
                                    }`}
                                >
                                    {isSubmitting ? 'ì™„ë£Œ ì²˜ë¦¬ ì¤‘...' : 'âœ… ìƒë‹´ ì™„ë£Œ'}
                                </button>
                            </div>

                            <div className="text-xs text-gray-500 text-center">
                                ì™„ë£Œ ì²˜ë¦¬ ì‹œ í˜„ì§ìì—ê²Œ ìˆ˜ìµì´ ìë™ ì •ì‚°ë©ë‹ˆë‹¤
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // ìƒë‹´ ì™„ë£Œ í™•ì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ConsultationCompletionComponent = ({ consultation, onClose, userType }) => {
            const [isCompleting, setIsCompleting] = useState(false);
            const [showReviewForm, setShowReviewForm] = useState(false);
            const [review, setReview] = useState({
                rating: 5,
                reviewTitle: '',
                reviewContent: '',
                professionalismRating: 5,
                communicationRating: 5,
                satisfactionRating: 5,
                wouldRecommend: true
            });

            const handleComplete = async () => {
                setIsCompleting(true);
                try {
                    // TODO: Supabaseì— ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const completionData = {
                        consultationId: consultation.id,
                        userType, // 'expert' ë˜ëŠ” 'client'
                        completedAt: new Date().toISOString()
                    };
                    
                    console.log('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬:', completionData);
                    
                    if (userType === 'client') {
                        setShowReviewForm(true);
                    } else {
                        alert('ìƒë‹´ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                        onClose();
                    }
                } catch (error) {
                    console.error('ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                } finally {
                    setIsCompleting(false);
                }
            };

            const handleReviewSubmit = async () => {
                try {
                    if (!supabase) {
                        console.log('ë°ëª¨ ëª¨ë“œ: í›„ê¸° ì €ì¥:', review);
                        alert('í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! (ë°ëª¨ ëª¨ë“œ)');
                        onClose();
                        return;
                    }

                    // í›„ê¸° ë°ì´í„° ì €ì¥
                    const { error: reviewError } = await supabase
                        .from('consultation_bookings')
                        .insert({
                            consultation_id: consultation.id,
                            client_id: consultation.client_id,
                            expert_id: consultation.expert_id,
                            overall_rating: review.rating,
                            professionalism_rating: review.professionalismRating,
                            communication_rating: review.communicationRating,
                            satisfaction_rating: review.satisfactionRating,
                            review_title: review.reviewTitle,
                            review_content: review.reviewContent,
                            would_recommend: review.wouldRecommend,
                            created_at: new Date().toISOString()
                        });

                    if (reviewError) throw reviewError;

                    // ì „ë¬¸ê°€ í‰ì  ì—…ë°ì´íŠ¸
                    const { data: reviews, error: avgError } = await supabase
                        .from('consultation_bookings')
                        .select('overall_rating')
                        .eq('expert_id', consultation.expert_id);

                    if (!avgError && reviews?.length > 0) {
                        const avgRating = reviews.reduce((sum, r) => sum + r.overall_rating, 0) / reviews.length;
                        
                        await supabase
                            .from('experts')
                            .update({
                                average_rating: Math.round(avgRating * 10) / 10,
                                total_reviews: reviews.length
                            })
                            .eq('id', consultation.expert_id);
                    }

                    // ìƒë‹´ ì„¸ì…˜ ì™„ë£Œ ì²˜ë¦¬
                    await supabase
                        .from('consultation_bookings')
                        .update({ 
                            status: 'completed',
                            completed_at: new Date().toISOString()
                        })
                        .eq('id', consultation.id);
                    
                    alert('í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
                    onClose();
                } catch (error) {
                    console.error('í›„ê¸° ì €ì¥ ì˜¤ë¥˜:', error);
                    alert('í›„ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };

            if (showReviewForm) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl max-h-90vh overflow-y-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-xl font-bold text-gray-900">ìƒë‹´ í›„ê¸° ì‘ì„±</h3>
                                <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                            </div>

                            <div className="space-y-6">
                                {/* ì „ì²´ í‰ì  */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ì „ì²´ ë§Œì¡±ë„ *</label>
                                    <div className="flex space-x-1">
                                        {[1, 2, 3, 4, 5].map(star => (
                                            <button
                                                key={star}
                                                onClick={() => setReview(prev => ({ ...prev, rating: star }))}
                                                className={`text-2xl ${star <= review.rating ? 'text-yellow-400' : 'text-gray-300'}`}
                                            >
                                                â­
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ì„¸ë¶€ í‰ê°€ */}
                                <div className="space-y-4">
                                    <h4 className="font-medium">ì„¸ë¶€ í‰ê°€</h4>
                                    
                                    {[
                                        { key: 'professionalismRating', label: 'ì „ë¬¸ì„±' },
                                        { key: 'communicationRating', label: 'ì†Œí†µ' },
                                        { key: 'satisfactionRating', label: 'ë§Œì¡±ë„' }
                                    ].map(({ key, label }) => (
                                        <div key={key}>
                                            <label className="block text-sm text-gray-600 mb-1">{label}</label>
                                            <div className="flex space-x-1">
                                                {[1, 2, 3, 4, 5].map(star => (
                                                    <button
                                                        key={star}
                                                        onClick={() => setReview(prev => ({ ...prev, [key]: star }))}
                                                        className={`text-lg ${star <= review[key] ? 'text-yellow-400' : 'text-gray-300'}`}
                                                    >
                                                        â­
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* í›„ê¸° ì œëª© */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">í›„ê¸° ì œëª©</label>
                                    <input
                                        type="text"
                                        value={review.reviewTitle}
                                        onChange={(e) => setReview(prev => ({ ...prev, reviewTitle: e.target.value }))}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        placeholder="í›„ê¸° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    />
                                </div>

                                {/* í›„ê¸° ë‚´ìš© */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒì„¸ í›„ê¸°</label>
                                    <textarea
                                        value={review.reviewContent}
                                        onChange={(e) => setReview(prev => ({ ...prev, reviewContent: e.target.value }))}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        rows="4"
                                        placeholder="ìƒë‹´ ê²½í—˜ì„ ë‹¤ë¥¸ ë¶„ë“¤ê³¼ ê³µìœ í•´ì£¼ì„¸ìš”"
                                    />
                                </div>

                                {/* ì¶”ì²œ ì—¬ë¶€ */}
                                <div>
                                    <label className="flex items-center">
                                        <input
                                            type="checkbox"
                                            checked={review.wouldRecommend}
                                            onChange={(e) => setReview(prev => ({ ...prev, wouldRecommend: e.target.checked }))}
                                            className="h-4 w-4 text-blue-600"
                                        />
                                        <span className="ml-2 text-sm text-gray-700">ì´ ì „ë¬¸ê°€ë¥¼ ë‹¤ë¥¸ ë¶„ë“¤ê»˜ ì¶”ì²œí•˜ì‹œê² ì–´ìš”?</span>
                                    </label>
                                </div>

                                <div className="flex space-x-4">
                                    <button
                                        onClick={() => setShowReviewForm(false)}
                                        className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ë‚˜ì¤‘ì— ì‘ì„±
                                    </button>
                                    <button
                                        onClick={handleReviewSubmit}
                                        className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                    >
                                        í›„ê¸° ë“±ë¡
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl">
                        <div className="text-center">
                            <div className="text-6xl mb-4">âœ…</div>
                            <h3 className="text-xl font-bold text-gray-900 mb-4">ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆë‚˜ìš”?</h3>
                            
                            <div className="bg-gray-50 p-4 rounded-lg mb-6 text-left">
                                <div className="space-y-2 text-sm">
                                    <div><strong>ì „ë¬¸ê°€:</strong> {consultation.expertName}</div>
                                    <div><strong>ìƒë‹´ ì¼ì‹œ:</strong> {consultation.scheduledTime}</div>
                                    <div><strong>ìƒë‹´ ì£¼ì œ:</strong> {consultation.topic}</div>
                                </div>
                            </div>
                            
                            <p className="text-gray-600 mb-6">
                                {userType === 'expert' 
                                    ? 'ìƒë‹´ì„ ì™„ë£Œí•˜ì…¨ìœ¼ë©´ ì™„ë£Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.' 
                                    : 'ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ì™„ë£Œ í™•ì¸ í›„ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.'
                                }
                            </p>
                            
                            <div className="flex space-x-4">
                                <button
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ë‚˜ì¤‘ì—
                                </button>
                                <button
                                    onClick={handleComplete}
                                    disabled={isCompleting}
                                    className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300"
                                >
                                    {isCompleting ? 'ì²˜ë¦¬ì¤‘...' : 'ìƒë‹´ ì™„ë£Œ'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ì˜ˆì•½ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const ConsultationBookingComponent = ({ expert, onClose, currentUser }) => {
            const [selectedDate, setSelectedDate] = useState('');
            const [selectedTime, setSelectedTime] = useState('');
            const [consultationType, setConsultationType] = useState('phone');
            const [consultationTopic, setConsultationTopic] = useState('');
            const [clientQuestions, setClientQuestions] = useState('');
            const [phoneNumber, setPhoneNumber] = useState('');
            const [currentStep, setCurrentStep] = useState(1);
            const [bookingResult, setBookingResult] = useState(null);
            const [paymentLoading, setPaymentLoading] = useState(false);
            const [paymentError, setPaymentError] = useState(null);
            const [showCalendar, setShowCalendar] = useState(false);
            
            // í˜„ì¬ ì›” ë‹¬ë ¥ í‘œì‹œë¥¼ ìœ„í•œ ìƒíƒœ
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [selectedDateInfo, setSelectedDateInfo] = useState(null);

            // ìº˜ë¦°ë” ìƒì„± í•¨ìˆ˜ (ì›”ë³„ ë·°)
            const generateCalendarDays = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const days = [];
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let i = 0; i < 42; i++) { // 6ì£¼ * 7ì¼
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isToday = currentDate.getTime() === today.getTime();
                    const isPast = currentDate < today;
                    const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                    const isAvailable = !isPast && !isWeekend && isCurrentMonth;
                    
                    days.push({
                        date: currentDate,
                        isCurrentMonth,
                        isToday,
                        isPast,
                        isWeekend,
                        isAvailable,
                        dateString: currentDate.toISOString().split('T')[0]
                    });
                }
                return days;
            };

            // ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ ìƒì„± (ê¸°ì¡´ í˜¸í™˜ì„±)
            const getAvailableDates = () => {
                const dates = [];
                const today = new Date();
                for (let i = 1; i <= 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    // ì£¼ë§ ì œì™¸ (í† : 6, ì¼: 0)
                    if (date.getDay() !== 0 && date.getDay() !== 6) {
                        dates.push(date);
                    }
                }
                return dates;
            };

            // ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ ìƒì„±
            const getAvailableTimes = () => {
                const times = [];
                for (let hour = 9; hour <= 18; hour++) {
                    times.push(`${hour.toString().padStart(2, '0')}:00`);
                    if (hour < 18) {
                        times.push(`${hour.toString().padStart(2, '0')}:30`);
                    }
                }
                return times;
            };

            const handleBooking = async () => {
                if (!selectedDate || !selectedTime || !consultationTopic) {
                    alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }

                // ê²°ì œ ë‹¨ê³„ë¡œ ì´ë™
                const bookingData = {
                    expertId: expert.id,
                    clientUserHash: currentUser?.id || 'guest_' + Date.now(),
                    scheduledTime: `${selectedDate} ${selectedTime}`,
                    consultationType,
                    consultationTopic,
                    clientQuestions,
                    phoneNumber: consultationType === 'phone' ? phoneNumber : '',
                    paymentAmount: parseInt(expert.hourlyRate),
                    platformFee: Math.round(parseInt(expert.hourlyRate) * 0.1),
                    expertPayout: Math.round(parseInt(expert.hourlyRate) * 0.9)
                };
                
                setBookingResult(bookingData);
                setCurrentStep(3); // ê²°ì œ ë‹¨ê³„
            };

            // ê²°ì œ ì²˜ë¦¬ í•¨ìˆ˜ (í˜„ì¬ Mock, ì¶”í›„ í† ìŠ¤í˜ì´ë¨¼ì¸  API ì—°ë™ ì˜ˆì •)
            const handlePayment = async (paymentMethod) => {
                try {
                    setPaymentLoading(true);
                    setPaymentError(null); // ì´ì „ ì—ëŸ¬ ì´ˆê¸°í™”
                    
                    // ê²°ì œ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ 
                    console.log('ğŸ“± ê²°ì œ ì‹œì‘:', { 
                        method: paymentMethod, 
                        amount: bookingResult.paymentAmount,
                        expert: expert.name
                    });
                    
                    // ê²°ì œ API í˜¸ì¶œ (í˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜, ì¶”í›„ ì‹¤ì œ APIë¡œ êµì²´)
                    let paymentResult;
                    
                    if (paymentMethod === 'card' || paymentMethod === 'kakaopay' || paymentMethod === 'toss') {
                        // TODO: ì‹¤ì œ ê²°ì œ API ì—°ë™ ì‹œ ì—¬ê¸°ë¥¼ êµì²´
                        // í˜„ì¬ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Mock ê²°ì œ
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        // ì‹œë®¬ë ˆì´ì…˜: 10% í™•ë¥ ë¡œ ê²°ì œ ì‹¤íŒ¨ (í…ŒìŠ¤íŠ¸ìš©)
                        const shouldFail = Math.random() < 0.1;
                        if (shouldFail && paymentMethod === 'card') {
                            throw new Error('CARD_DECLINED');
                        }
                        
                        // ê²°ì œ ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
                        paymentResult = {
                            paymentId: `mock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            transactionId: `TXN${Date.now()}`,
                            amount: bookingResult.paymentAmount,
                            method: paymentMethod,
                            paidAt: new Date().toISOString(),
                            status: 'completed',
                            isTestPayment: true // í…ŒìŠ¤íŠ¸ ê²°ì œ í‘œì‹œ
                        };
                    } else {
                        throw new Error('UNSUPPORTED_METHOD');
                    }
                    
                    console.log('ğŸ’³ ê²°ì œ ì™„ë£Œ:', paymentResult);
                    
                    // Supabaseì— ì˜ˆì•½ ì •ë³´ ì €ì¥
                    const { error } = await supabase
                        .from('consultation_bookings')
                        .insert({
                            expert_id: bookingResult.expertId,
                            client_id: currentUser.id,
                            scheduled_time: bookingResult.scheduledTime,
                            consultation_type: bookingResult.consultationType,
                            consultation_topic: bookingResult.consultationTopic,
                            client_questions: bookingResult.clientQuestions,
                            payment_amount: bookingResult.paymentAmount,
                            platform_fee: bookingResult.platformFee,
                            expert_payout: bookingResult.expertPayout,
                            payment_method: paymentMethod,
                            payment_id: paymentResult.paymentId,
                            transaction_id: paymentResult.transactionId,
                            status: 'confirmed'
                        });

                    if (error) throw error;
                    
                    // ê²°ì œ ê²°ê³¼ë¥¼ bookingResultì— ì¶”ê°€
                    setBookingResult(prev => ({
                        ...prev,
                        paymentResult: paymentResult
                    }));
                    
                    setCurrentStep(4); // ì™„ë£Œ ë‹¨ê³„
                    
                    // ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ ë°œì†¡
                    try {
                        await EmailManager.sendConsultationBookedEmail(currentUser.id, {
                            clientName: currentUser.nickname || currentUser.email,
                            expertName: expert.name,
                            date: selectedSlot.date,
                            time: selectedSlot.time,
                            duration: selectedSlot.duration,
                            method: selectedSlot.method,
                            amount: selectedSlot.price,
                            bookingId: bookingResult.id
                        });
                        console.log('âœ… ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ');
                    } catch (emailError) {
                        console.error('âŒ ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailError);
                    }
                    
                    showToast('ğŸ‰ ìƒë‹´ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    
                } catch (error) {
                    console.error('ğŸ’¥ ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    
                    // ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì„¤ì •
                    let userFriendlyError = {
                        title: 'ê²°ì œ ì‹¤íŒ¨',
                        message: 'ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        code: error.message,
                        canRetry: true
                    };
                    
                    switch(error.message) {
                        case 'CARD_DECLINED':
                            userFriendlyError = {
                                title: 'ì¹´ë“œ ê²°ì œ ì‹¤íŒ¨',
                                message: 'ì¹´ë“œ ìŠ¹ì¸ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´ë“œì‚¬ì— ë¬¸ì˜í•˜ê±°ë‚˜ ë‹¤ë¥¸ ê²°ì œ ë°©ë²•ì„ ì‹œë„í•´ì£¼ì„¸ìš”.',
                                code: 'ì¹´ë“œ ìŠ¹ì¸ ê±°ì ˆ',
                                canRetry: true
                            };
                            break;
                        case 'UNSUPPORTED_METHOD':
                            userFriendlyError = {
                                title: 'ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²°ì œë°©ë²•',
                                message: 'ì„ íƒí•˜ì‹  ê²°ì œ ë°©ë²•ì„ í˜„ì¬ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                                code: 'ê²°ì œë°©ë²• ì˜¤ë¥˜',
                                canRetry: false
                            };
                            break;
                        case 'NETWORK_ERROR':
                            userFriendlyError = {
                                title: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜',
                                message: 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                                code: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜',
                                canRetry: true
                            };
                            break;
                        case 'INSUFFICIENT_FUNDS':
                            userFriendlyError = {
                                title: 'ì”ì•¡ ë¶€ì¡±',
                                message: 'ê³„ì¢Œ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì”ì•¡ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                                code: 'ì”ì•¡ ë¶€ì¡±',
                                canRetry: true
                            };
                            break;
                        default:
                            if (error.message.includes('timeout')) {
                                userFriendlyError = {
                                    title: 'ê²°ì œ ì‹œê°„ ì´ˆê³¼',
                                    message: 'ê²°ì œ ì²˜ë¦¬ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                                    code: 'ì‹œê°„ ì´ˆê³¼',
                                    canRetry: true
                                };
                            }
                    }
                    
                    setPaymentError(userFriendlyError);
                    showToast(userFriendlyError.title + ': ' + userFriendlyError.message, 'error');
                } finally {
                    setPaymentLoading(false);
                }
            };

            // ê²°ì œ ë‹¨ê³„ (3ë‹¨ê³„)
            if (currentStep === 3 && bookingResult) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-xl relative">
                            {/* ê²°ì œ ì§„í–‰ ì¤‘ ì˜¤ë²„ë ˆì´ */}
                            {paymentLoading && (
                                <div className="absolute inset-0 bg-white bg-opacity-95 rounded-xl flex items-center justify-center z-10">
                                    <div className="text-center">
                                        <div className="relative mb-4">
                                            <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <span className="text-xl">ğŸ’³</span>
                                            </div>
                                        </div>
                                        <h4 className="text-lg font-semibold text-gray-800 mb-2">ê²°ì œ ì²˜ë¦¬ ì¤‘...</h4>
                                        <div className="text-sm text-gray-600 space-y-1">
                                            <p>ì•ˆì „í•œ ê²°ì œ ì„œë²„ë¡œ ì •ë³´ë¥¼ ì „ì†¡í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
                                            <p className="text-xs text-gray-500">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” (ì•½ 2-5ì´ˆ)</p>
                                        </div>
                                        <div className="mt-4 bg-blue-50 p-3 rounded-lg">
                                            <div className="flex items-center justify-center space-x-2 text-sm text-blue-700">
                                                <span className="inline-block w-2 h-2 bg-blue-400 rounded-full animate-pulse"></span>
                                                <span>ê²°ì œ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</span>
                                                <span className="inline-block w-2 h-2 bg-blue-400 rounded-full animate-pulse animation-delay-300"></span>
                                            </div>
                                        </div>
                                        <div className="mt-3 text-xs text-gray-500">
                                            âš ï¸ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•˜ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ë§ˆì„¸ìš”
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div className="text-center mb-6">
                                <div className="text-4xl mb-4">ğŸ’³</div>
                                <h3 className="text-xl font-bold text-gray-900">ê²°ì œí•˜ê¸°</h3>
                                <p className="text-sm text-gray-600 mt-2">ìƒë‹´ ì˜ˆì•½ì„ ì™„ë£Œí•˜ê¸° ìœ„í•´ ê²°ì œí•´ì£¼ì„¸ìš”</p>
                            </div>

                            {/* ê²°ì œ ì •ë³´ ìš”ì•½ */}
                            <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span>ì „ë¬¸ê°€:</span>
                                        <span className="font-medium">{expert.name}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>ìƒë‹´ ì‹œê°„:</span>
                                        <span className="font-medium">{bookingResult.scheduledTime}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>ìƒë‹´ ë°©ì‹:</span>
                                        <span className="font-medium">
                                            {consultationType === 'phone' ? 'ğŸ“ ì „í™”' :
                                             consultationType === 'video' ? 'ğŸ“¹ í™”ìƒ' : 'ğŸ’¬ ì±„íŒ…'}
                                        </span>
                                    </div>
                                    <hr className="my-2 border-blue-200" />
                                    <div className="flex justify-between font-bold text-lg">
                                        <span>ì´ ê²°ì œê¸ˆì•¡:</span>
                                        <span className="text-blue-600">{bookingResult.paymentAmount.toLocaleString()}ì›</span>
                                    </div>
                                    <div className="text-xs text-gray-500 text-right">
                                        (í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ {bookingResult.platformFee.toLocaleString()}ì› í¬í•¨)
                                    </div>
                                </div>
                            </div>

                            {/* ê²°ì œ ë°©ë²• ì„ íƒ */}
                            <div className="space-y-3 mb-6">
                                <h4 className="font-medium text-gray-800">ê²°ì œ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</h4>
                                <p className="text-xs text-gray-500 mb-3">ëª¨ë“  ê²°ì œ ë°©ì‹ì€ SSL ì•”í˜¸í™”ë¡œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤</p>
                                
                                <button
                                    onClick={() => handlePayment('card')}
                                    disabled={paymentLoading}
                                    className={`w-full p-4 border-2 rounded-lg transition-colors text-left ${
                                        paymentLoading 
                                            ? 'border-gray-200 bg-gray-50 cursor-not-allowed' 
                                            : 'border-blue-200 hover:border-blue-400 hover:bg-blue-50'
                                    }`}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ’³</span>
                                            <div>
                                                <div className="font-medium">ì‹ ìš©ì¹´ë“œ</div>
                                                <div className="text-sm text-gray-500">êµ­ë‚´ì™¸ ëª¨ë“  ì‹ ìš©ì¹´ë“œ ì§€ì›</div>
                                                <div className="text-xs text-blue-600 mt-1">ìˆ˜ìˆ˜ë£Œ: 2.9% + 100ì› (ì¹´ë“œì‚¬ ë¶€ë‹´)</div>
                                                <div className="text-xs text-gray-400">ì¦‰ì‹œ ìŠ¹ì¸, ì•ˆì „í•œ PGì‚¬ ê²°ì œ</div>
                                            </div>
                                        </div>
                                        <div className="text-blue-600 font-medium">
                                            {paymentLoading ? (
                                                <div className="inline-block animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                                            ) : (
                                                'ì„ íƒ'
                                            )}
                                        </div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => handlePayment('kakaopay')}
                                    disabled={paymentLoading}
                                    className={`w-full p-4 border-2 rounded-lg transition-colors text-left ${
                                        paymentLoading 
                                            ? 'border-gray-200 bg-gray-50 cursor-not-allowed' 
                                            : 'border-yellow-200 hover:border-yellow-400 hover:bg-yellow-50'
                                    }`}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ’°</span>
                                            <div>
                                                <div className="font-medium">ì¹´ì¹´ì˜¤í˜ì´</div>
                                                <div className="text-sm text-gray-500">ì¹´ì¹´ì˜¤í†¡ì—ì„œ ê°„í¸ ê²°ì œ</div>
                                                <div className="text-xs text-yellow-600 mt-1">ìˆ˜ìˆ˜ë£Œ: 2.5% (ì—…ê³„ ìµœì €)</div>
                                                <div className="text-xs text-gray-400">QRì½”ë“œ ë˜ëŠ” ì¹´í†¡ ì•Œë¦¼ìœ¼ë¡œ ê²°ì œ</div>
                                            </div>
                                        </div>
                                        <div className="text-yellow-600 font-medium">
                                            {paymentLoading ? (
                                                <div className="inline-block animate-spin rounded-full h-5 w-5 border-b-2 border-yellow-600"></div>
                                            ) : (
                                                'ì„ íƒ'
                                            )}
                                        </div>
                                    </div>
                                </button>

                                <button
                                    onClick={() => handlePayment('toss')}
                                    disabled={paymentLoading}
                                    className={`w-full p-4 border-2 rounded-lg transition-colors text-left ${
                                        paymentLoading 
                                            ? 'border-gray-200 bg-gray-50 cursor-not-allowed' 
                                            : 'border-blue-200 hover:border-blue-400 hover:bg-blue-50'
                                    }`}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center">
                                            <span className="text-2xl mr-3">ğŸ¦</span>
                                            <div>
                                                <div className="font-medium">í† ìŠ¤í˜ì´</div>
                                                <div className="text-sm text-gray-500">í† ìŠ¤ì•± ê°„í¸ê²°ì œ</div>
                                                <div className="text-xs text-blue-600 mt-1">ìˆ˜ìˆ˜ë£Œ: 2.7% (ì•± ë‚´ í• ì¸ ì ìš©)</div>
                                                <div className="text-xs text-gray-400">ìƒì²´ì¸ì¦ìœ¼ë¡œ ë¹ ë¥´ê³  ì•ˆì „</div>
                                            </div>
                                        </div>
                                        <div className="text-blue-600 font-medium">
                                            {paymentLoading ? (
                                                <div className="inline-block animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                                            ) : (
                                                'ì„ íƒ'
                                            )}
                                        </div>
                                    </div>
                                </button>

                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <div className="text-xs text-gray-600">
                                        <span className="font-medium">ğŸ’¡ ê²°ì œ íŒ:</span> 
                                        ì¹´ì¹´ì˜¤í˜ì´ê°€ ìˆ˜ìˆ˜ë£Œê°€ ê°€ì¥ ì €ë ´í•˜ë©°, ëª¨ë“  ê²°ì œ ë°©ì‹ ë™ì¼í•œ ë³´ì•ˆ ìˆ˜ì¤€ì„ ì œê³µí•©ë‹ˆë‹¤.
                                    </div>
                                </div>
                            </div>

                            {/* ê²°ì œ ì—ëŸ¬ ë©”ì‹œì§€ */}
                            {paymentError && (
                                <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
                                    <div className="flex items-start">
                                        <span className="text-2xl mr-3">âš ï¸</span>
                                        <div className="flex-1">
                                            <h4 className="text-lg font-semibold text-red-800 mb-2">{paymentError.title}</h4>
                                            <p className="text-sm text-red-700 mb-3">{paymentError.message}</p>
                                            <div className="text-xs text-red-600 mb-4">
                                                <strong>ì˜¤ë¥˜ ì½”ë“œ:</strong> {paymentError.code}
                                            </div>
                                            {paymentError.canRetry && (
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setPaymentError(null);
                                                        }}
                                                        className="px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors"
                                                    >
                                                        ë‹¤ì‹œ ì‹œë„
                                                    </button>
                                                    <button
                                                        onClick={() => setCurrentStep(2)}
                                                        className="px-4 py-2 border border-red-300 text-red-700 text-sm rounded-lg hover:bg-red-50 transition-colors"
                                                    >
                                                        ì´ì „ ë‹¨ê³„ë¡œ
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="mt-3 bg-red-100 p-3 rounded-lg">
                                        <div className="text-xs text-red-700">
                                            <strong>ğŸ’¡ í•´ê²° ë°©ë²•:</strong>
                                            <ul className="mt-1 space-y-1 ml-4">
                                                {paymentError.code === 'ì¹´ë“œ ìŠ¹ì¸ ê±°ì ˆ' && (
                                                    <>
                                                        <li>â€¢ ì¹´ë“œ í•œë„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                                                        <li>â€¢ ë‹¤ë¥¸ ì¹´ë“œë¡œ ì‹œë„í•´ë³´ì„¸ìš”</li>
                                                        <li>â€¢ ì¹´ë“œì‚¬ ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”</li>
                                                    </>
                                                )}
                                                {paymentError.code === 'ì”ì•¡ ë¶€ì¡±' && (
                                                    <>
                                                        <li>â€¢ ê³„ì¢Œ ì”ì•¡ì„ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                                                        <li>â€¢ ë‹¤ë¥¸ ê²°ì œ ë°©ë²•ì„ ì‹œë„í•´ì£¼ì„¸ìš”</li>
                                                    </>
                                                )}
                                                {paymentError.code === 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜' && (
                                                    <>
                                                        <li>â€¢ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                                                        <li>â€¢ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”</li>
                                                    </>
                                                )}
                                                {paymentError.code === 'ì‹œê°„ ì´ˆê³¼' && (
                                                    <>
                                                        <li>â€¢ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”</li>
                                                        <li>â€¢ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë³´ì„¸ìš”</li>
                                                    </>
                                                )}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-3">
                                <button
                                    onClick={() => setCurrentStep(2)}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì´ì „
                                </button>
                                <button
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ì˜ˆì•½ ì™„ë£Œ ë‹¨ê³„ (4ë‹¨ê³„)
            if (currentStep === 4 && bookingResult) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                        <div className="bg-white rounded-xl p-6 max-w-lg w-full shadow-xl max-h-90vh overflow-y-auto">
                            <div className="text-center">
                                <div className="text-6xl mb-4">ğŸ‰</div>
                                <h3 className="text-2xl font-bold text-gray-900 mb-2">ê²°ì œ ì™„ë£Œ!</h3>
                                <p className="text-sm text-gray-600 mb-6">ìƒë‹´ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                
                                {/* ì˜ˆì•½ ìƒì„¸ ì •ë³´ */}
                                <div className="bg-green-50 border border-green-200 rounded-xl p-5 mb-6 text-left">
                                    <h4 className="font-bold text-green-800 mb-4 text-center">ğŸ“‹ ì˜ˆì•½ ìƒì„¸ ì •ë³´</h4>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ì˜ˆì•½ ID:</span>
                                            <span className="text-sm font-mono bg-gray-100 px-2 py-1 rounded">
                                                {bookingResult.paymentResult?.transactionId || 'N/A'}
                                            </span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ì „ë¬¸ê°€:</span>
                                            <span className="text-sm font-medium text-gray-800">{expert.name}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ì „ë¬¸ ë¶„ì•¼:</span>
                                            <span className="text-sm text-gray-800">{expert.category || expert.field}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ìƒë‹´ ì¼ì‹œ:</span>
                                            <span className="text-sm font-medium text-blue-700">{bookingResult.scheduledTime}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ìƒë‹´ ë°©ì‹:</span>
                                            <span className="text-sm font-medium">
                                                {consultationType === 'phone' ? 'ğŸ“ ì „í™” ìƒë‹´' :
                                                 consultationType === 'video' ? 'ğŸ“¹ í™”ìƒ ìƒë‹´' : 'ğŸ’¬ ì±„íŒ… ìƒë‹´'}
                                            </span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ìƒë‹´ ì£¼ì œ:</span>
                                            <span className="text-sm text-gray-800">{bookingResult.consultationTopic || 'ë¯¸ì§€ì •'}</span>
                                        </div>
                                        <hr className="border-green-200" />
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ê²°ì œ ë°©ë²•:</span>
                                            <span className="text-sm font-medium">
                                                {bookingResult.paymentResult?.method === 'card' ? 'ğŸ’³ ì‹ ìš©ì¹´ë“œ' :
                                                 bookingResult.paymentResult?.method === 'kakaopay' ? 'ğŸ’° ì¹´ì¹´ì˜¤í˜ì´' :
                                                 bookingResult.paymentResult?.method === 'toss' ? 'ğŸ¦ í† ìŠ¤í˜ì´' : 'ê¸°íƒ€'}
                                            </span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ê²°ì œ ê¸ˆì•¡:</span>
                                            <span className="text-lg font-bold text-green-700">{bookingResult.paymentAmount.toLocaleString()}ì›</span>
                                        </div>
                                        <div className="text-xs text-gray-500 text-right">
                                            (í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ {bookingResult.platformFee.toLocaleString()}ì› í¬í•¨)
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm font-medium text-gray-600">ê²°ì œ ì¼ì‹œ:</span>
                                            <span className="text-xs text-gray-500">
                                                {new Date().toLocaleString('ko-KR')}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                {/* ì—°ë½ì²˜ ì •ë³´ */}
                                <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6 text-left">
                                    <h4 className="font-medium text-orange-800 mb-2">ğŸ“ ì—°ë½ì²˜ ì •ë³´</h4>
                                    <div className="text-sm text-orange-700 space-y-1">
                                        <p><strong>ê³ ê°ë‹˜ ì—°ë½ì²˜:</strong> {phoneNumber || 'ë¯¸ì…ë ¥'}</p>
                                        <p className="text-xs text-orange-600">â€» ì „ë¬¸ê°€ê°€ ìƒë‹´ ì „ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤</p>
                                    </div>
                                </div>

                                <div className="bg-blue-50 p-4 rounded-lg mb-6">
                                    <h4 className="font-medium text-blue-800 mb-2">ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„</h4>
                                    <ul className="text-sm text-blue-700 text-left space-y-1">
                                        <li>â€¢ ì „ë¬¸ê°€ê°€ 24ì‹œê°„ ë‚´ ì—°ë½ë“œë¦½ë‹ˆë‹¤</li>
                                        <li>â€¢ ìƒë‹´ ì „ ì¤€ë¹„ì‚¬í•­ì„ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤</li>
                                        <li>â€¢ ë§ˆì´í˜ì´ì§€ì—ì„œ ì˜ˆì•½ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                        <li>â€¢ ì·¨ì†ŒëŠ” ìƒë‹´ 24ì‹œê°„ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                                        <li>â€¢ ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤</li>
                                    </ul>
                                </div>

                                {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                                <div className="flex flex-col gap-2">
                                    <button
                                        onClick={onClose}
                                        className="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium"
                                    >
                                        âœ“ í™•ì¸ ì™„ë£Œ
                                    </button>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => {
                                                // ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™ (ì˜ˆì•½ ë‚´ì—­ í™•ì¸)
                                                onClose();
                                                // ì‹¤ì œë¡œëŠ” ë§ˆì´í˜ì´ì§€ íƒ­ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë¡œì§ í•„ìš”
                                            }}
                                            className="flex-1 py-2 border border-blue-300 text-blue-700 text-sm rounded-lg hover:bg-blue-50"
                                        >
                                            ğŸ“‹ ì˜ˆì•½ í™•ì¸
                                        </button>
                                        <button
                                            onClick={() => {
                                                // ì˜ìˆ˜ì¦ ì¶œë ¥ ê¸°ëŠ¥ (Mock)
                                                alert('ì˜ìˆ˜ì¦ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
                                            }}
                                            className="flex-1 py-2 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50"
                                        >
                                            ğŸ§¾ ì˜ìˆ˜ì¦
                                        </button>
                                    </div>
                                </div>

                                {bookingResult.paymentResult?.isTestPayment && (
                                    <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <div className="text-xs text-yellow-800">
                                            âš ï¸ <strong>í…ŒìŠ¤íŠ¸ ê²°ì œì…ë‹ˆë‹¤.</strong> ì‹¤ì œ ê¸ˆì•¡ì´ ì²­êµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full shadow-xl max-h-90vh overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold text-gray-900">ìƒë‹´ ì˜ˆì•½</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>

                        {/* ì „ë¬¸ê°€ ì •ë³´ */}
                        <div className="bg-orange-50 p-4 rounded-lg mb-6">
                            <div className="flex items-center gap-4">
                                <div className="text-3xl">{expert.profileImage}</div>
                                <div>
                                    <h4 className="font-bold text-gray-800">{expert.name}</h4>
                                    <p className="text-sm text-gray-600">{expert.title}</p>
                                    <p className="text-sm font-medium text-orange-600">{expert.price}</p>
                                </div>
                            </div>
                        </div>

                        {currentStep === 1 && (
                            <div className="space-y-6">
                                <h4 className="font-bold text-lg">1ë‹¨ê³„: ë‚ ì§œ ë° ì‹œê°„ ì„ íƒ</h4>
                                
                                {/* ë‚ ì§œ ì„ íƒ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ë‚ ì§œ *</label>
                                    <select
                                        value={selectedDate}
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        required
                                    >
                                        <option value="">ë‚ ì§œ ì„ íƒ</option>
                                        {getAvailableDates().map(date => (
                                            <option key={date.toISOString()} value={date.toISOString().split('T')[0]}>
                                                {date.toLocaleDateString('ko-KR', { 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric',
                                                    weekday: 'short'
                                                })}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                {/* ì‹œê°„ ì„ íƒ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ì‹œê°„ *</label>
                                    <div className="grid grid-cols-4 gap-2">
                                        {getAvailableTimes().map(time => (
                                            <button
                                                key={time}
                                                onClick={() => setSelectedTime(time)}
                                                className={`p-2 text-sm rounded-lg border transition-colors ${
                                                    selectedTime === time
                                                        ? 'bg-orange-500 text-white border-orange-500'
                                                        : 'bg-white text-gray-700 border-gray-300 hover:bg-orange-50'
                                                }`}
                                            >
                                                {time}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ìƒë‹´ ë°©ì‹ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ë°©ì‹ *</label>
                                    <div className="space-y-2">
                                        {expert.availableTypes?.map(type => (
                                            <label key={type} className="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                                <input
                                                    type="radio"
                                                    name="consultationType"
                                                    value={type}
                                                    checked={consultationType === type}
                                                    onChange={(e) => setConsultationType(e.target.value)}
                                                    className="h-4 w-4 text-orange-600"
                                                />
                                                <div className="ml-3">
                                                    <div className="font-medium">
                                                        {type === 'phone' ? 'ğŸ“ ì „í™” ìƒë‹´' :
                                                         type === 'video' ? 'ğŸ“¹ í™”ìƒ ìƒë‹´' : 'ğŸ’¬ ì±„íŒ… ìƒë‹´'}
                                                    </div>
                                                </div>
                                            </label>
                                        )) || (
                                            <label className="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                                <input
                                                    type="radio"
                                                    name="consultationType"
                                                    value="phone"
                                                    checked={true}
                                                    onChange={() => setConsultationType('phone')}
                                                    className="h-4 w-4 text-orange-600"
                                                />
                                                <div className="ml-3">
                                                    <div className="font-medium">ğŸ“ ì „í™” ìƒë‹´</div>
                                                </div>
                                            </label>
                                        )}
                                    </div>
                                </div>

                                <div className="flex justify-between">
                                    <button
                                        onClick={onClose}
                                        className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={() => setCurrentStep(2)}
                                        disabled={!selectedDate || !selectedTime}
                                        className="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:bg-gray-300"
                                    >
                                        ë‹¤ìŒ ë‹¨ê³„
                                    </button>
                                </div>
                            </div>
                        )}

                        {currentStep === 2 && (
                            <div className="space-y-6">
                                <h4 className="font-bold text-lg">2ë‹¨ê³„: ìƒë‹´ ë‚´ìš©</h4>
                                
                                {/* ìƒë‹´ ì£¼ì œ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒë‹´ ì£¼ì œ *</label>
                                    <input
                                        type="text"
                                        value={consultationTopic}
                                        onChange={(e) => setConsultationTopic(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        placeholder="ìƒë‹´ë°›ê³  ì‹¶ì€ ì£¼ì œë¥¼ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”"
                                        required
                                    />
                                </div>

                                {/* êµ¬ì²´ì ì¸ ì§ˆë¬¸ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">êµ¬ì²´ì ì¸ ì§ˆë¬¸ì´ë‚˜ ìƒí™©</label>
                                    <textarea
                                        value={clientQuestions}
                                        onChange={(e) => setClientQuestions(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg"
                                        rows="4"
                                        placeholder="ìƒë‹´ì„ ìœ„í•´ ì „ë¬¸ê°€ê°€ ë¯¸ë¦¬ ì•Œì•„ì•¼ í•  ë‚´ìš©ì´ë‚˜ ì§ˆë¬¸ì„ ì ì–´ì£¼ì„¸ìš”"
                                    />
                                </div>

                                {/* ì „í™”ë²ˆí˜¸ (ì „í™” ìƒë‹´ì¸ ê²½ìš°) */}
                                {consultationType === 'phone' && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">ì—°ë½ì²˜ *</label>
                                        <input
                                            type="tel"
                                            value={phoneNumber}
                                            onChange={(e) => setPhoneNumber(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg"
                                            placeholder="010-1234-5678"
                                            required
                                        />
                                    </div>
                                )}

                                {/* ì˜ˆì•½ ìš”ì•½ */}
                                <div className="bg-gray-50 p-4 rounded-lg">
                                    <h5 className="font-medium mb-2">ì˜ˆì•½ ìš”ì•½</h5>
                                    <div className="text-sm space-y-1">
                                        <div>ğŸ“… ë‚ ì§œ: {selectedDate}</div>
                                        <div>â° ì‹œê°„: {selectedTime}</div>
                                        <div>ğŸ“ ë°©ì‹: {consultationType === 'phone' ? 'ì „í™” ìƒë‹´' : consultationType === 'video' ? 'í™”ìƒ ìƒë‹´' : 'ì±„íŒ… ìƒë‹´'}</div>
                                        <div>ğŸ’° ìƒë‹´ë£Œ: {expert.price}</div>
                                    </div>
                                </div>

                                <div className="flex justify-between">
                                    <button
                                        onClick={() => setCurrentStep(1)}
                                        className="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì´ì „
                                    </button>
                                    <button
                                        onClick={handleBooking}
                                        className="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600"
                                    >
                                        ì˜ˆì•½ í™•ì •
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ì „ë¬¸ê°€ ê¸€ ì‘ì„± ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
        const ExpertPostWriteModal = ({ isOpen, onClose, currentUser, onSuccess, isAdminUser }) => {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                category: 'tech_development',
                serviceType: 'video',
                price: '',
                duration: '60',
                availableDays: [],
                availableTimeSlots: [],
                tags: []
            });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [error, setError] = useState('');
            const [tagInput, setTagInput] = useState('');

            // ì¹´í…Œê³ ë¦¬ ì •ì˜
            const categories = {
                'tech_development': { name: 'IT/ê°œë°œ', icon: 'ğŸ’»', color: 'blue' },
                'finance_consulting': { name: 'ê¸ˆìœµ/ì»¨ì„¤íŒ…', icon: 'ğŸ’°', color: 'green' },
                'marketing_planning': { name: 'ë§ˆì¼€íŒ…/ê¸°íš', icon: 'ğŸ“Š', color: 'purple' },
                'manufacturing': { name: 'ì œì¡°/ì—”ì§€ë‹ˆì–´ë§', icon: 'âš™ï¸', color: 'orange' },
                'others': { name: 'ê¸°íƒ€', icon: 'ğŸ’¼', color: 'gray' }
            };

            // ì„œë¹„ìŠ¤ ìœ í˜• (ìƒë‹´ ë°©ì‹)
            const serviceTypes = {
                'video': 'ğŸ“¹ ì˜ìƒ ë©˜í† ë§ (ì¶”ì²œ)',
                'phone': 'ğŸ“ ì „í™” ë©˜í† ë§',
                'chat': 'ğŸ’¬ ì±„íŒ… ë©˜í† ë§'
            };

            // ìš”ì¼ ì˜µì…˜
            const dayOptions = [
                { value: 'mon', label: 'ì›”' },
                { value: 'tue', label: 'í™”' },
                { value: 'wed', label: 'ìˆ˜' },
                { value: 'thu', label: 'ëª©' },
                { value: 'fri', label: 'ê¸ˆ' },
                { value: 'sat', label: 'í† ' },
                { value: 'sun', label: 'ì¼' }
            ];

            // ì‹œê°„ ìŠ¬ë¡¯ ì˜µì…˜ (9ì‹œ-18ì‹œ, 1ì‹œê°„ ë‹¨ìœ„)
            const timeSlotOptions = [
                { value: '09:00', label: '09:00' },
                { value: '10:00', label: '10:00' },
                { value: '11:00', label: '11:00' },
                { value: '12:00', label: '12:00' },
                { value: '13:00', label: '13:00' },
                { value: '14:00', label: '14:00' },
                { value: '15:00', label: '15:00' },
                { value: '16:00', label: '16:00' },
                { value: '17:00', label: '17:00' },
                { value: '18:00', label: '18:00' },
                { value: '19:00', label: '19:00' },
                { value: '20:00', label: '20:00' }
            ];

            // í¼ ì´ˆê¸°í™”
            useEffect(() => {
                if (isOpen) {
                    setFormData({
                        title: '',
                        content: '',
                        category: 'tech_development',
                        serviceType: 'video',
                        price: '',
                        duration: '60',
                        availableDays: [],
                        availableTimeSlots: [],
                        tags: []
                    });
                    setError('');
                    setTagInput('');
                }
            }, [isOpen]);

            // ì…ë ¥ê°’ ë³€ê²½ í•¸ë“¤ëŸ¬
            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                setError('');
            };

            // ìš”ì¼ ì„ íƒ í•¸ë“¤ëŸ¬
            const handleDayToggle = (dayValue) => {
                setFormData(prev => ({
                    ...prev,
                    availableDays: prev.availableDays.includes(dayValue)
                        ? prev.availableDays.filter(day => day !== dayValue)
                        : [...prev.availableDays, dayValue]
                }));
            };

            // ì‹œê°„ ìŠ¬ë¡¯ ì„ íƒ í•¸ë“¤ëŸ¬
            const handleTimeSlotToggle = (timeValue) => {
                setFormData(prev => ({
                    ...prev,
                    availableTimeSlots: prev.availableTimeSlots.includes(timeValue)
                        ? prev.availableTimeSlots.filter(time => time !== timeValue)
                        : [...prev.availableTimeSlots, timeValue]
                }));
            };

            // íƒœê·¸ ì¶”ê°€
            const handleAddTag = () => {
                const trimmedTag = tagInput.trim();
                if (trimmedTag && !formData.tags.includes(trimmedTag) && formData.tags.length < 5) {
                    setFormData(prev => ({
                        ...prev,
                        tags: [...prev.tags, trimmedTag]
                    }));
                    setTagInput('');
                }
            };

            // íƒœê·¸ ì‚­ì œ
            const handleRemoveTag = (tagToRemove) => {
                setFormData(prev => ({
                    ...prev,
                    tags: prev.tags.filter(tag => tag !== tagToRemove)
                }));
            };

            // í¼ ìœ íš¨ì„± ê²€ì‚¬
            const validateForm = () => {
                if (!formData.title.trim()) return 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (!formData.content.trim()) return 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (!formData.price.trim()) return 'ìƒë‹´ë£Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                if (formData.availableDays.length === 0) return 'ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                if (formData.availableTimeSlots.length === 0) return 'ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                
                const price = parseInt(formData.price.replace(/,/g, ''));
                if (isNaN(price) || price < 30000) return 'ìƒë‹´ë£ŒëŠ” ìµœì†Œ 30,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                if (price > 500000) return 'ìƒë‹´ë£ŒëŠ” ìµœëŒ€ 500,000ì› ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.';

                return null;
            };

            // ê¸€ ì‘ì„± ì œì¶œ
            const handleSubmit = async () => {
                const validationError = validateForm();
                if (validationError) {
                    setError(validationError);
                    return;
                }

                setIsSubmitting(true);
                
                try {
                    let expertProfile = null;

                    // ê´€ë¦¬ìëŠ” ì „ë¬¸ê°€ í”„ë¡œí•„ ì—†ì´ë„ ê¸€ ì‘ì„± ê°€ëŠ¥
                    if (isAdminUser && isAdminUser(currentUser)) {
                        // ê´€ë¦¬ììš© ì„ì‹œ í”„ë¡œí•„ ìƒì„±
                        expertProfile = {
                            id: 'admin-' + currentUser.id,
                            name: currentUser.email?.split('@')[0] || 'ê´€ë¦¬ì',
                            title: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                            user_id: currentUser.id
                        };
                    } else {
                        // ì¼ë°˜ ì‚¬ìš©ìëŠ” ì „ë¬¸ê°€ í”„ë¡œí•„ í™•ì¸
                        const { data: profile } = await supabase
                            .from('experts')
                            .select('*')
                            .eq('user_id', currentUser.id)
                            .eq('is_verified', true)
                            .eq('is_active', true)
                            .single();

                        if (!profile) {
                            setError('ìŠ¹ì¸ëœ ì „ë¬¸ê°€ë§Œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                            return;
                        }
                        expertProfile = profile;
                    }

                    // ì¼ë°˜ ì „ë¬¸ê°€ì˜ ê²½ìš° job_seeker_posts í…Œì´ë¸”ì— ì €ì¥
                    if (!isAdminUser || !isAdminUser(currentUser)) {
                        const postData = {
                            expert_id: expertProfile.id,
                            title: formData.title.trim(),
                            content: formData.content.trim(),
                            service_description: `ì„œë¹„ìŠ¤ ìœ í˜•: ${serviceTypes[formData.serviceType]}\nì†Œìš” ì‹œê°„: ${formData.duration}ë¶„\nìƒë‹´ë£Œ: ${formData.price}ì›\nê°€ëŠ¥ ìš”ì¼: ${formData.availableDays.map(d => dayOptions.find(opt => opt.value === d)?.label).join(', ')}\nê°€ëŠ¥ ì‹œê°„: ${formData.availableTimeSlots.join(', ')}\nğŸ’¬ í”Œë«í¼ ë‚´ ì±„íŒ…ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ìƒë‹´ë°›ìœ¼ì„¸ìš”`,
                            category: formData.category,
                            consultation_type: [formData.serviceType],
                            price_info: `${formData.price}ì› / ${formData.duration}ë¶„`,
                            sample_questions: formData.tags
                        };

                        // job_seeker_posts í…Œì´ë¸”ì— ì €ì¥
                        const { data: expertPost, error: expertError } = await supabase
                            .from('job_seeker_posts')
                            .insert([postData])
                            .select()
                            .single();

                        if (expertError) {
                            throw expertError;
                        }
                    }

                    // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ë¡œë„ ë™ì‹œ ë“±ë¡ (ì „ë¬¸ê°€ ì¹´í…Œê³ ë¦¬)
                    const communityPostData = {
                        user_hash: currentUser.userHash,
                        topic: 'expert',
                        title: formData.title.trim(),
                        content: formData.content.trim(),
                        expert_category: formData.category,
                        expert_name: expertProfile.name,
                        expert_title: expertProfile.title,
                        expert_badge: isAdminUser && isAdminUser(currentUser) ? 'ğŸ‘‘ ìŠˆí¼ê´€ë¦¬ì' : 'ì¸ì¦ ì „ë¬¸ê°€',
                        created_at: new Date().toISOString()
                    };

                    const { error: communityError } = await supabase
                        .from('job_seeker_posts')
                        .insert([communityPostData]);

                    if (communityError) {
                        console.warn('ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ë“±ë¡ ì‹¤íŒ¨:', communityError);
                    }

                    showNotification(
                        'ì„œë¹„ìŠ¤ ê²Œì‹œ ì™„ë£Œ!',
                        'ì„œë¹„ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\ní˜„ì§ì ì°¾ê¸°ì—ì„œ êµ¬ì§ìë“¤ì´ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                        'success'
                    );

                    onSuccess && onSuccess();
                    onClose();

                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
                    setError('ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } finally {
                    setIsSubmitting(false);
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        {/* í—¤ë” */}
                        <div className="sticky top-0 bg-white border-b p-4 flex items-center justify-between">
                            <h2 className="text-lg font-bold">ğŸ“ ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-700 text-xl"
                            >
                                âœ•
                            </button>
                        </div>

                        {/* ë‚´ìš© */}
                        <div className="p-6 space-y-6">
                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded p-3 text-red-700 text-sm">
                                    {error}
                                </div>
                            )}

                            {/* ì¹´í…Œê³ ë¦¬ ì„ íƒ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-3">
                                    ğŸ’¼ ì „ë¬¸ ë¶„ì•¼ *
                                </label>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    {Object.entries(categories).map(([key, category]) => (
                                        <button
                                            key={key}
                                            type="button"
                                            onClick={() => handleInputChange('category', key)}
                                            className={`p-4 rounded-xl text-center transition-all border-2 ${
                                                formData.category === key
                                                    ? 'border-blue-500 bg-blue-50 text-blue-700 shadow-md transform scale-105'
                                                    : 'border-gray-200 bg-white text-gray-600 hover:bg-gray-50 hover:border-gray-300'
                                            }`}
                                        >
                                            <div className="text-2xl mb-2">{category.icon}</div>
                                            <div className="font-semibold text-sm">{category.name}</div>
                                            {formData.category === key && (
                                                <div className="text-xs text-blue-600 mt-1">âœ“ ì„ íƒë¨</div>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* ì œëª© */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì œëª© *
                                </label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => handleInputChange('title', e.target.value)}
                                    placeholder="ì˜ˆ: ì‹ ì… ê°œë°œì ì·¨ì—… ì¤€ë¹„ ì™„ì „ ê°€ì´ë“œ"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    maxLength={100}
                                />
                                <div className="text-xs text-gray-500 mt-1">
                                    {formData.title.length}/100
                                </div>
                            </div>

                            {/* ë‚´ìš© */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë‚´ìš© *
                                </label>
                                <textarea
                                    value={formData.content}
                                    onChange={(e) => handleInputChange('content', e.target.value)}
                                    placeholder="í˜„ì§ìë¡œì„œ ì œê³µí•˜ëŠ” ë©˜í† ë§ì„ ìƒì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.&#10;- ë©˜í† ë§ ë‚´ìš©&#10;- ê²½ë ¥ ë° ì „ë¬¸ì„±&#10;- êµ¬ì§ìì—ê²Œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê°€ì¹˜"
                                    rows={8}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    maxLength={2000}
                                />
                                <div className="text-xs text-gray-500 mt-1">
                                    {formData.content.length}/2000
                                </div>
                            </div>

                            {/* ì„œë¹„ìŠ¤ ì •ë³´ */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* ì„œë¹„ìŠ¤ ìœ í˜• */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ì„œë¹„ìŠ¤ ìœ í˜•
                                    </label>
                                    <select
                                        value={formData.serviceType}
                                        onChange={(e) => handleInputChange('serviceType', e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                        {Object.entries(serviceTypes).map(([key, label]) => (
                                            <option key={key} value={key}>{label}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* ì†Œìš” ì‹œê°„ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        ì†Œìš” ì‹œê°„ (ë¶„)
                                    </label>
                                    <select
                                        value={formData.duration}
                                        onChange={(e) => handleInputChange('duration', e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                        <option value="15">15ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="60">60ë¶„</option>
                                    </select>
                                </div>
                            </div>

                            {/* ìƒë‹´ë£Œ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ğŸ’° ìƒë‹´ë£Œ *
                                </label>
                                <div className="relative">
                                    <input
                                        type="text"
                                        value={formData.price}
                                        onChange={(e) => {
                                            const value = e.target.value.replace(/[^0-9]/g, '');
                                            const formatted = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                                            handleInputChange('price', formatted);
                                        }}
                                        placeholder="80,000"
                                        className="w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                    <span className="absolute right-3 top-3 text-gray-500 font-medium">ì›</span>
                                </div>
                                
                                {/* ê¶Œì¥ ê°€ê²© ë²„íŠ¼ë“¤ */}
                                <div className="mt-3">
                                    <p className="text-xs text-gray-600 mb-2">ğŸ’¡ ê¶Œì¥ ê°€ê²© (60ë¶„ ê¸°ì¤€)</p>
                                    <div className="flex flex-wrap gap-2">
                                        {['50,000', '80,000', '120,000', '150,000'].map(price => (
                                            <button
                                                key={price}
                                                type="button"
                                                onClick={() => handleInputChange('price', price)}
                                                className={`px-3 py-1.5 text-xs rounded-full border transition-colors ${
                                                    formData.price === price
                                                        ? 'bg-blue-100 border-blue-300 text-blue-700'
                                                        : 'bg-gray-50 border-gray-200 text-gray-600 hover:bg-gray-100'
                                                }`}
                                            >
                                                {price}ì›
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="text-xs text-gray-500 mt-2">
                                    ğŸ”¸ ìµœì†Œ 30,000ì› ì´ìƒ, ìµœëŒ€ 500,000ì› ì´í•˜<br/>
                                    ğŸ”¸ í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ 10% ì°¨ê° í›„ ì§€ê¸‰
                                </div>
                            </div>

                            {/* ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-3">
                                    ğŸ“… ìƒë‹´ ê°€ëŠ¥ ìš”ì¼ * ({formData.availableDays.length}ì¼ ì„ íƒë¨)
                                </label>
                                <div className="grid grid-cols-7 gap-2">
                                    {dayOptions.map(day => (
                                        <button
                                            key={day.value}
                                            type="button"
                                            onClick={() => handleDayToggle(day.value)}
                                            className={`py-3 rounded-lg text-sm font-medium transition-all ${
                                                formData.availableDays.includes(day.value)
                                                    ? 'bg-blue-500 text-white shadow-md transform scale-105'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {day.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="text-xs text-gray-500 mt-2">
                                    ğŸ’¡ ìƒë‹´ ê°€ëŠ¥í•œ ìš”ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš” (ìµœì†Œ 1ì¼ ì´ìƒ)
                                </div>
                            </div>

                            {/* ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-3">
                                    ğŸ• ìƒë‹´ ê°€ëŠ¥ ì‹œê°„ * ({formData.availableTimeSlots.length}ì‹œê°„ ì„ íƒë¨)
                                </label>
                                
                                {/* ë¹ ë¥¸ ì„ íƒ ë²„íŠ¼ë“¤ */}
                                <div className="flex flex-wrap gap-2 mb-3 p-3 bg-gray-50 rounded-lg">
                                    <span className="text-xs text-gray-600 font-medium">ë¹ ë¥¸ ì„ íƒ:</span>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            const morningTimes = ['09:00', '10:00', '11:00'];
                                            handleInputChange('availableTimeSlots', morningTimes);
                                        }}
                                        className="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors"
                                    >
                                        ì˜¤ì „ (9-12ì‹œ)
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            const afternoonTimes = ['13:00', '14:00', '15:00', '16:00', '17:00'];
                                            handleInputChange('availableTimeSlots', afternoonTimes);
                                        }}
                                        className="text-xs px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors"
                                    >
                                        ì˜¤í›„ (1-6ì‹œ)
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            const eveningTimes = ['18:00', '19:00', '20:00'];
                                            handleInputChange('availableTimeSlots', eveningTimes);
                                        }}
                                        className="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition-colors"
                                    >
                                        ì €ë… (6-8ì‹œ)
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-4 gap-2">
                                    {timeSlotOptions.map(time => (
                                        <button
                                            key={time.value}
                                            type="button"
                                            onClick={() => handleTimeSlotToggle(time.value)}
                                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                formData.availableTimeSlots.includes(time.value)
                                                    ? 'bg-green-500 text-white shadow-md transform scale-105'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {time.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="text-xs text-gray-500 mt-2">
                                    ğŸ’¡ êµ¬ì§ìë“¤ì´ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì‹œê°„ëŒ€ì…ë‹ˆë‹¤ (ìµœì†Œ 3ì‹œê°„ ì´ìƒ ê¶Œì¥)
                                </div>
                            </div>

                            {/* íƒœê·¸ */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ğŸ·ï¸ ì „ë¬¸ íƒœê·¸ ({formData.tags.length}/5ê°œ)
                                </label>
                                {/* ì¶”ì²œ íƒœê·¸ */}
                                <div className="mb-3 p-3 bg-blue-50 rounded-lg">
                                    <p className="text-xs text-blue-700 font-medium mb-2">ğŸ’¡ ì¶”ì²œ íƒœê·¸ (í´ë¦­ìœ¼ë¡œ ì¶”ê°€)</p>
                                    <div className="flex flex-wrap gap-2">
                                        {(() => {
                                            const recommendedTags = {
                                                'tech_development': ['ì‹ ì…', 'ê²½ë ¥', 'ë©´ì ‘ì¤€ë¹„', 'ê¸°ìˆ ìŠ¤íƒ', 'í¬íŠ¸í´ë¦¬ì˜¤', 'ì´ë ¥ì„œ', 'ì½”ë”©í…ŒìŠ¤íŠ¸'],
                                                'finance_consulting': ['ê¸ˆìœµê¶Œ', 'ìê²©ì¦', 'CPA', 'CFA', 'íˆ¬ì', 'ì¬ë¬´ê´€ë¦¬', 'ê²½ì œ'],
                                                'marketing_planning': ['ë¸Œëœë”©', 'ë””ì§€í„¸ë§ˆì¼€íŒ…', 'ì†Œì…œë¯¸ë””ì–´', 'ê´‘ê³ ', 'ê¸°íš', 'ë¶„ì„', 'ì „ëµ'],
                                                'manufacturing': ['ìƒì‚°ê´€ë¦¬', 'í’ˆì§ˆê´€ë¦¬', 'ì•ˆì „', 'ê³µì •ê°œì„ ', 'ê¸°ìˆ ', 'ì œì¡°ì—…'],
                                                'others': ['ì»¤ë¦¬ì–´', 'ì·¨ì—…', 'ì´ì§', 'ìƒë‹´', 'ë©˜í† ë§']
                                            };
                                            return (recommendedTags[formData.category] || recommendedTags.others).map(tag => (
                                                <button
                                                    key={tag}
                                                    type="button"
                                                    onClick={() => {
                                                        if (!formData.tags.includes(tag) && formData.tags.length < 5) {
                                                            handleInputChange('tags', [...formData.tags, tag]);
                                                        }
                                                    }}
                                                    disabled={formData.tags.includes(tag) || formData.tags.length >= 5}
                                                    className={`text-xs px-2 py-1 rounded transition-colors ${
                                                        formData.tags.includes(tag) 
                                                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                                            : 'bg-white text-blue-600 border border-blue-300 hover:bg-blue-100'
                                                    }`}
                                                >
                                                    {tag}
                                                </button>
                                            ));
                                        })()}
                                    </div>
                                </div>

                                <div className="flex gap-2 mb-3">
                                    <input
                                        type="text"
                                        value={tagInput}
                                        onChange={(e) => setTagInput(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter') {
                                                e.preventDefault();
                                                handleAddTag();
                                            }
                                        }}
                                        placeholder="ì§ì ‘ íƒœê·¸ ì…ë ¥ í›„ ì—”í„°"
                                        className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        maxLength={10}
                                    />
                                    <button
                                        type="button"
                                        onClick={handleAddTag}
                                        disabled={!tagInput.trim() || formData.tags.length >= 5}
                                        className="px-4 py-3 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 disabled:bg-gray-300 transition-colors"
                                    >
                                        ì¶”ê°€
                                    </button>
                                </div>
                                
                                {/* ì„ íƒëœ íƒœê·¸ë“¤ */}
                                {formData.tags.length > 0 && (
                                    <div className="flex flex-wrap gap-2 mb-3">
                                        {formData.tags.map((tag, index) => (
                                            <span
                                                key={index}
                                                className="inline-flex items-center px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded-full"
                                            >
                                                #{tag}
                                                <button
                                                    type="button"
                                                    onClick={() => handleRemoveTag(tag)}
                                                    className="ml-2 text-blue-500 hover:text-blue-700 text-lg"
                                                >
                                                    Ã—
                                                </button>
                                            </span>
                                        ))}
                                    </div>
                                )}
                                
                                <div className="text-xs text-gray-500">
                                    ğŸ’¡ êµ¬ì§ìê°€ ê²€ìƒ‰í•  ë•Œ ë„ì›€ì´ ë˜ëŠ” í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”
                                </div>
                            </div>

                            {/* ì œì¶œ ì „ ê²€í†  */}
                            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 className="text-sm font-medium text-green-800 mb-2">ğŸ“‹ ë“±ë¡ ì „ ìµœì¢… í™•ì¸</h4>
                                <div className="space-y-1 text-xs text-green-700">
                                    <div className="flex items-center space-x-2">
                                        <span className={formData.title.length >= 10 ? 'âœ…' : 'âš ï¸'}>
                                            {formData.title.length >= 10 ? 'âœ…' : 'âš ï¸'}
                                        </span>
                                        <span>ì œëª©: {formData.title.length >= 10 ? 'ì ì ˆí•¨' : '10ì ì´ìƒ ê¶Œì¥'} ({formData.title.length}ì)</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <span className={formData.content.length >= 100 ? 'âœ…' : 'âš ï¸'}>
                                            {formData.content.length >= 100 ? 'âœ…' : 'âš ï¸'}
                                        </span>
                                        <span>ë‚´ìš©: {formData.content.length >= 100 ? 'ì ì ˆí•¨' : '100ì ì´ìƒ ê¶Œì¥'} ({formData.content.length}ì)</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <span className={formData.price && parseInt(formData.price.replace(/,/g, '')) >= 30000 ? 'âœ…' : 'âš ï¸'}>
                                            {formData.price && parseInt(formData.price.replace(/,/g, '')) >= 30000 ? 'âœ…' : 'âš ï¸'}
                                        </span>
                                        <span>ìƒë‹´ë£Œ: {formData.price ? 'ì„¤ì •ë¨' : 'ë¯¸ì„¤ì •'}</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <span className={formData.availableDays.length >= 3 ? 'âœ…' : 'âš ï¸'}>
                                            {formData.availableDays.length >= 3 ? 'âœ…' : 'âš ï¸'}
                                        </span>
                                        <span>ìƒë‹´ ê°€ëŠ¥ì¼: {formData.availableDays.length}ì¼ ({formData.availableDays.length >= 3 ? 'ì¶©ë¶„í•¨' : '3ì¼ ì´ìƒ ê¶Œì¥'})</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <span className={formData.availableTimeSlots.length >= 3 ? 'âœ…' : 'âš ï¸'}>
                                            {formData.availableTimeSlots.length >= 3 ? 'âœ…' : 'âš ï¸'}
                                        </span>
                                        <span>ìƒë‹´ ì‹œê°„: {formData.availableTimeSlots.length}ì‹œê°„ ({formData.availableTimeSlots.length >= 3 ? 'ì¶©ë¶„í•¨' : '3ì‹œê°„ ì´ìƒ ê¶Œì¥'})</span>
                                    </div>
                                </div>
                            </div>

                            {/* ë²„íŠ¼ */}
                            <div className="flex gap-3 pt-6 border-t">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    disabled={isSubmitting}
                                    className="flex-1 py-4 px-6 border-2 border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    type="button"
                                    onClick={handleSubmit}
                                    disabled={isSubmitting || !formData.title.trim() || !formData.content.trim() || !formData.price || formData.availableDays.length === 0 || formData.availableTimeSlots.length === 0}
                                    className="flex-1 py-4 px-6 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-bold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                                >
                                    {isSubmitting ? (
                                        <>
                                            <div className="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                                            ì„œë¹„ìŠ¤ ë“±ë¡ ì¤‘...
                                        </>
                                    ) : (
                                        'ğŸš€ ì„œë¹„ìŠ¤ ë“±ë¡í•˜ê¸°'
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        // ì±„íŒ… ë‚´ì—­ ì»´í¬ë„ŒíŠ¸ (ë§ˆì´í˜ì´ì§€ìš©)
        const ChatHistoryComponent = ({ currentUser }) => {
            const [chatHistory, setChatHistory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [selectedChatToDelete, setSelectedChatToDelete] = useState(null);

            // ì±„íŒ… ë‚´ì—­ ë¡œë“œ
            const loadChatHistory = async () => {
                try {
                    setLoading(true);
                    const { data, error } = await supabase
                        .from('chat_rooms')
                        .select(`
                            *,
                            chat_participants!inner(user_id),
                            chat_messages(
                                id,
                                content,
                                sender_id,
                                created_at,
                                message_type
                            )
                        `)
                        .eq('chat_participants.user_id', currentUser.id)
                        .eq('is_active', true)
                        .order('updated_at', { ascending: false });

                    if (error) throw error;
                    
                    // ë§ˆì§€ë§‰ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì±„íŒ…ë°© ì •ë³´ ì •ë¦¬
                    const processedHistory = data.map(room => {
                        const messages = room.chat_messages || [];
                        const lastMessage = messages.length > 0 ? messages[messages.length - 1] : null;
                        
                        return {
                            id: room.id,
                            title: room.title,
                            room_type: room.room_type,
                            created_at: room.created_at,
                            updated_at: room.updated_at,
                            messageCount: messages.length,
                            lastMessage: lastMessage ? {
                                content: lastMessage.content,
                                created_at: lastMessage.created_at,
                                isFromMe: lastMessage.sender_id === currentUser.id
                            } : null
                        };
                    });

                    setChatHistory(processedHistory);
                } catch (error) {
                    console.error('ì±„íŒ… ë‚´ì—­ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì±„íŒ… ë‚´ì—­ ì‚­ì œ
            const deleteChatHistory = async (chatRoomId) => {
                try {
                    // ì‹¤ì œë¡œëŠ” ì±„íŒ…ë°©ì„ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ì‚¬ìš©ì ì°¸ì—¬ë§Œ ì œê±°
                    const { error } = await supabase
                        .from('chat_participants')
                        .delete()
                        .eq('room_id', chatRoomId)
                        .eq('user_id', currentUser.id);

                    if (error) throw error;

                    // ë¡œì»¬ ìƒíƒœì—ì„œ ì œê±°
                    setChatHistory(prev => prev.filter(chat => chat.id !== chatRoomId));
                    setShowDeleteModal(false);
                    setSelectedChatToDelete(null);
                    
                    showToast('ì±„íŒ… ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    console.error('ì±„íŒ… ë‚´ì—­ ì‚­ì œ ì˜¤ë¥˜:', error);
                    showToast('ì±„íŒ… ë‚´ì—­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            // ì±„íŒ…ë°© ìœ í˜•ë³„ ì•„ì´ì½˜
            const getRoomTypeIcon = (roomType) => {
                switch (roomType) {
                    case 'consultation':
                        return 'ğŸ¯';
                    case 'community':
                        return 'ğŸ’¬';
                    case 'support':
                        return 'ğŸ§';
                    default:
                        return 'ğŸ’¬';
                }
            };

            // ë‚ ì§œ í¬ë§·íŒ…
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = now - date;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) return 'ì–´ì œ';
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                if (diffDays < 30) return `${Math.ceil(diffDays / 7)}ì£¼ ì „`;
                return date.toLocaleDateString('ko-KR');
            };

            useEffect(() => {
                if (currentUser) {
                    loadChatHistory();
                }
            }, [currentUser]);

            if (loading) {
                return (
                    <div className="flex items-center justify-center py-12">
                        <div className="text-center">
                            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p className="mt-2 text-gray-600">ì±„íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 rounded-xl">
                        <h2 className="text-xl font-bold mb-2">ğŸ’¬ ë©˜í† ë§ ë‚´ì—­</h2>
                        <p className="text-blue-100">í˜„ì§ì ë©˜í† ë§ ë° ë„¤íŠ¸ì›Œí‚¹ ë‚´ì—­ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
                    </div>

                    {chatHistory.length === 0 ? (
                        <div className="text-center py-12">
                            <div className="text-4xl mb-4">ğŸ’­</div>
                            <h3 className="text-lg font-medium text-gray-800 mb-2">ì•„ì§ ë©˜í† ë§ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p className="text-gray-600 mb-6">í˜„ì§ì ë©˜í† ë§ì„ ì‹œì‘í•˜ê±°ë‚˜ ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í•´ë³´ì„¸ìš”.</p>
                            
                            <div className="max-w-md mx-auto bg-blue-50 border border-blue-200 rounded-lg p-6 text-left">
                                <h4 className="font-semibold text-blue-900 mb-3">ğŸ’¡ ë©˜í† ë§ ê¸°ëŠ¥ ì•ˆë‚´</h4>
                                <div className="space-y-2 text-sm text-blue-800">
                                    <div className="flex items-start gap-2">
                                        <span>ğŸ¯</span>
                                        <span>í˜„ì§ì 1:1 ë©˜í† ë§ ì±„íŒ…</span>
                                    </div>
                                    <div className="flex items-start gap-2">
                                        <span>ğŸ’¬</span>
                                        <span>ì»¤ë¦¬ì–´ ê·¸ë£¹ ì±„íŒ…</span>
                                    </div>
                                    <div className="flex items-start gap-2">
                                        <span>ğŸ§</span>
                                        <span>ê³ ê° ì§€ì› ì±„íŒ…</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {chatHistory.map((chat) => (
                                <div key={chat.id} className="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div className="flex justify-between items-start mb-4">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-3 mb-2">
                                                <span className="text-2xl">{getRoomTypeIcon(chat.room_type)}</span>
                                                <h3 className="font-semibold text-gray-800 text-lg">
                                                    {chat.title || 'ì±„íŒ…ë°©'}
                                                </h3>
                                                <span className="px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">
                                                    {chat.room_type === 'consultation' ? 'í˜„ì§ì ë©˜í† ë§' :
                                                     chat.room_type === 'community' ? 'ì»¤ë®¤ë‹ˆí‹°' : 'ì§€ì›'}
                                                </span>
                                            </div>
                                            
                                            <div className="text-sm text-gray-600 space-y-1">
                                                <div>ğŸ’¬ ë©”ì‹œì§€: {chat.messageCount}ê°œ</div>
                                                <div>ğŸ“… ìƒì„±ì¼: {formatDate(chat.created_at)}</div>
                                                {chat.lastMessage && (
                                                    <div className="bg-gray-50 p-3 rounded-lg mt-2">
                                                        <div className="text-xs text-gray-500 mb-1">
                                                            {chat.lastMessage.isFromMe ? 'ë‚˜' : 'ìƒëŒ€ë°©'} â€¢ {formatDate(chat.lastMessage.created_at)}
                                                        </div>
                                                        <div className="text-sm text-gray-700">
                                                            {chat.lastMessage.content.length > 50 
                                                                ? chat.lastMessage.content.substring(0, 50) + '...'
                                                                : chat.lastMessage.content
                                                            }
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <div className="flex gap-2 ml-4">
                                            <button
                                                onClick={() => {
                                                    setSelectedChatToDelete(chat);
                                                    setShowDeleteModal(true);
                                                }}
                                                className="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"
                                                title="ì±„íŒ… ë‚´ì—­ ì‚­ì œ"
                                            >
                                                ğŸ—‘ï¸ ì‚­ì œ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* ì±„íŒ… ì‚­ì œ í™•ì¸ ëª¨ë‹¬ */}
                    {showDeleteModal && selectedChatToDelete && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 max-w-md mx-4">
                                <div className="text-center mb-6">
                                    <div className="text-4xl mb-4">âš ï¸</div>
                                    <h3 className="text-lg font-semibold text-gray-800 mb-2">ì±„íŒ… ë‚´ì—­ ì‚­ì œ</h3>
                                    <p className="text-gray-600">
                                        "{selectedChatToDelete.title}" ì±„íŒ… ë‚´ì—­ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                                    </p>
                                    <p className="text-sm text-red-600 mt-2">
                                        âš ï¸ ì‚­ì œëœ ì±„íŒ…ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                                    </p>
                                </div>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => {
                                            setShowDeleteModal(false);
                                            setSelectedChatToDelete(null);
                                        }}
                                        className="flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={() => deleteChatHistory(selectedChatToDelete.id)}
                                        className="flex-1 py-3 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700"
                                    >
                                        ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì‹¤ì‹œê°„ ì±„íŒ… ì»´í¬ë„ŒíŠ¸ - í˜„ì§ì-êµ¬ì§ì ë©˜í† ë§ìš© ê°œì„  + WebRTC
        const ChatComponent = ({ currentUser, isAdminUser }) => {
            const [chatRooms, setChatRooms] = useState([]);
            const [selectedRoom, setSelectedRoom] = useState(null);
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [participants, setParticipants] = useState([]);
            const [loading, setLoading] = useState(true);
            const [sending, setSending] = useState(false);
            const [showCreateRoom, setShowCreateRoom] = useState(false);
            const [isExpertConsultation, setIsExpertConsultation] = useState(false);
            
            // WebRTC í†µí™” ê´€ë ¨ ìƒíƒœ
            const [isCallActive, setIsCallActive] = useState(false);
            const [callType, setCallType] = useState(null); // 'audio' | 'video'
            const [localStream, setLocalStream] = useState(null);
            const [remoteStream, setRemoteStream] = useState(null);
            const [peerConnection, setPeerConnection] = useState(null);
            const [isMuted, setIsMuted] = useState(false);
            const [isVideoOff, setIsVideoOff] = useState(false);
            const [callStatus, setCallStatus] = useState('idle'); // 'idle' | 'calling' | 'ringing' | 'connected' | 'ended'
            // íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ - ì „ë¬¸ê°€ ì¸ì¦ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
            
            // ìƒë‹´ íƒ€ì´ë¨¸ ê´€ë ¨ ìƒíƒœ
            const [isConsultationActive, setIsConsultationActive] = useState(false);
            const [consultationStartTime, setConsultationStartTime] = useState(null);
            const [consultationDuration, setConsultationDuration] = useState(0); // ì´ˆ ë‹¨ìœ„
            const [consultationTimeLimit, setConsultationTimeLimit] = useState(60 * 60); // 1ì‹œê°„ ê¸°ë³¸
            const [showTimeWarning, setShowTimeWarning] = useState(false);
            
            const messagesEndRef = useRef(null);
            const messageSubscription = useRef(null);
            const localVideoRef = useRef(null);
            const remoteVideoRef = useRef(null);
            const fileInputRef = useRef(null);
            const callSubscription = useRef(null);
            const consultationTimerRef = useRef(null);

            // ìƒë‹´ íƒ€ì´ë¨¸ ì‹œì‘
            const startConsultation = () => {
                const startTime = new Date();
                setIsConsultationActive(true);
                setConsultationStartTime(startTime);
                setConsultationDuration(0);
                setShowTimeWarning(false);
                
                // 1ì´ˆë§ˆë‹¤ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                consultationTimerRef.current = setInterval(() => {
                    const now = new Date();
                    const elapsed = Math.floor((now - startTime) / 1000);
                    setConsultationDuration(elapsed);
                    
                    // ì‹œê°„ ê²½ê³  (5ë¶„ ë‚¨ì•˜ì„ ë•Œ)
                    if (elapsed >= consultationTimeLimit - 300 && !showTimeWarning) {
                        setShowTimeWarning(true);
                        showToast('â° ìƒë‹´ ì‹œê°„ì´ 5ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.', 'warning');
                    }
                    
                    // ì‹œê°„ ì´ˆê³¼
                    if (elapsed >= consultationTimeLimit) {
                        endConsultation();
                        showToast('â° ìƒë‹´ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                    }
                }, 1000);
                
                showToast('â–¶ï¸ ìƒë‹´ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            };
            
            // ìƒë‹´ íƒ€ì´ë¨¸ ì¢…ë£Œ
            const endConsultation = () => {
                setIsConsultationActive(false);
                if (consultationTimerRef.current) {
                    clearInterval(consultationTimerRef.current);
                    consultationTimerRef.current = null;
                }
                showToast('â¹ï¸ ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            };
            
            // ìƒë‹´ ì‹œê°„ ì—°ì¥ (10ë¶„)
            const extendConsultation = () => {
                setConsultationTimeLimit(prev => prev + 600); // 10ë¶„ ì¶”ê°€
                setShowTimeWarning(false);
                showToast('â° ìƒë‹´ ì‹œê°„ì´ 10ë¶„ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            };
            
            // ì‹œê°„ í¬ë§·íŒ… (00:00:00)
            const formatTime = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
            const getRemainingTime = () => {
                return Math.max(0, consultationTimeLimit - consultationDuration);
            };

            // ì±„íŒ…ë°© ëª©ë¡ ë¡œë“œ
            const loadChatRooms = async () => {
                try {
                    const { data, error } = await supabase
                        .from('chat_rooms')
                        .select('*')
                        .eq('is_active', true)
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setChatRooms(data || []);
                    
                    // ì²« ë²ˆì§¸ ì±„íŒ…ë°©ì„ ê¸°ë³¸ ì„ íƒ
                    if (data && data.length > 0) {
                        setSelectedRoom(data[0]);
                    }
                } catch (error) {
                    console.error('ì±„íŒ…ë°© ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì±„íŒ…ë°© ì°¸ì—¬
            const joinRoom = async (room) => {
                try {
                    // ì°¸ì—¬ìë¡œ ì¶”ê°€ (ì´ë¯¸ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸)
                    await supabase
                        .from('chat_participants')
                        .upsert({
                            room_id: room.id,
                            user_id: currentUser.id,
                            is_active: true
                        }, {
                            onConflict: 'room_id,user_id'
                        });
                        
                    setSelectedRoom(room);
                    loadMessages(room.id);
                    loadParticipants(room.id);
                } catch (error) {
                    console.error('ì±„íŒ…ë°© ì°¸ì—¬ ì˜¤ë¥˜:', error);
                }
            };

            // ë©”ì‹œì§€ ë¡œë“œ
            const loadMessages = async (roomId) => {
                try {
                    const { data, error } = await supabase
                        .from('chat_messages')
                        .select('*')
                        .eq('room_id', roomId)
                        .order('created_at', { ascending: true })
                        .limit(100); // ìµœê·¼ 100ê°œ ë©”ì‹œì§€ë§Œ

                    if (error) throw error;
                    setMessages(data || []);
                    
                    // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
                    setTimeout(() => scrollToBottom(), 100);
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            };

            // ì°¸ì—¬ì ë¡œë“œ
            const loadParticipants = async (roomId) => {
                try {
                    const { data, error } = await supabase
                        .from('chat_participants')
                        .select(`
                            *,
                            user_profiles:user_id (
                                nickname,
                                role
                            )
                        `)
                        .eq('room_id', roomId)
                        .eq('is_active', true);

                    if (error) throw error;
                    setParticipants(data || []);
                } catch (error) {
                    console.error('ì°¸ì—¬ì ë¡œë“œ ì˜¤ë¥˜:', error);
                }
            };

            // ë©”ì‹œì§€ ì „ì†¡
            const sendMessage = async (e) => {
                e.preventDefault();
                if (!newMessage.trim() || !selectedRoom || sending) return;

                try {
                    setSending(true);
                    const { error } = await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: selectedRoom.id,
                            user_id: currentUser.id,
                            user_nickname: currentUser.nickname || currentUser.email,
                            message_text: newMessage.trim(),
                            message_type: 'text'
                        });

                    if (error) throw error;
                    setNewMessage('');
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                    alert('ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSending(false);
                }
            };

            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
            const setupRealtimeSubscription = (roomId) => {
                // ê¸°ì¡´ êµ¬ë… í•´ì œ
                if (messageSubscription.current) {
                    messageSubscription.current.unsubscribe();
                }

                // ìƒˆ ë©”ì‹œì§€ êµ¬ë…
                messageSubscription.current = supabase
                    .channel(`chat-${roomId}`)
                    .on('postgres_changes', {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'chat_messages',
                        filter: `room_id=eq.${roomId}`
                    }, (payload) => {
                        const message = payload.new;
                        
                        // WebRTC ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì²˜ë¦¬
                        if (message.message_type === 'webrtc-signal') {
                            try {
                                const signalData = JSON.parse(message.message_text);
                                handleSignalingMessage(signalData);
                            } catch (error) {
                                console.error('ì‹œê·¸ë„ë§ ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:', error);
                            }
                        } else {
                            // ì¼ë°˜ ì±„íŒ… ë©”ì‹œì§€ë§Œ í™”ë©´ì— í‘œì‹œ
                            setMessages(prev => [...prev, message]);
                            setTimeout(() => scrollToBottom(), 100);
                        }
                    })
                    .subscribe();
            };

            useEffect(() => {
                if (currentUser) {
                    loadChatRooms();
                }

                return () => {
                    if (messageSubscription.current) {
                        messageSubscription.current.unsubscribe();
                    }
                    
                    // WebRTC ë¦¬ì†ŒìŠ¤ ì •ë¦¬
                    if (localStream) {
                        localStream.getTracks().forEach(track => track.stop());
                    }
                    if (peerConnection) {
                        peerConnection.close();
                    }
                };
            }, [currentUser]);

            useEffect(() => {
                if (selectedRoom) {
                    setupRealtimeSubscription(selectedRoom.id);
                }
            }, [selectedRoom]);

            // ë©”ì‹œì§€ ì‹œê°„ í¬ë§·
            const formatMessageTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            };

            // WebRTC êµ¬ì„±
            const rtcConfiguration = {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' }
                ]
            };

            // WebRTC í†µí™” ì‹œì‘
            const startCall = async (type) => {
                if (!selectedRoom || (selectedRoom.room_type !== 'private' && selectedRoom.room_type !== 'consultation')) {
                    alert('í”„ë¼ì´ë¹— ë©˜í† ë§ë°©ì—ì„œë§Œ í†µí™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }

                try {
                    setCallStatus('calling');
                    setCallType(type);
                    
                    // ì‚¬ìš©ì ë¯¸ë””ì–´ ê¶Œí•œ ìš”ì²­
                    const constraints = {
                        audio: true,
                        video: type === 'video'
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    setLocalStream(stream);
                    
                    if (localVideoRef.current && type === 'video') {
                        localVideoRef.current.srcObject = stream;
                    }

                    // PeerConnection ìƒì„±
                    const pc = new RTCPeerConnection(rtcConfiguration);
                    setPeerConnection(pc);

                    // ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ì„ PeerConnectionì— ì¶”ê°€
                    stream.getTracks().forEach(track => {
                        pc.addTrack(track, stream);
                    });

                    // ì›ê²© ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹  ì²˜ë¦¬
                    pc.ontrack = (event) => {
                        const [remoteStream] = event.streams;
                        setRemoteStream(remoteStream);
                        if (remoteVideoRef.current) {
                            remoteVideoRef.current.srcObject = remoteStream;
                        }
                    };

                    // ICE candidate ì²˜ë¦¬
                    pc.onicecandidate = async (event) => {
                        if (event.candidate) {
                            await sendSignalingMessage({
                                type: 'ice-candidate',
                                candidate: event.candidate,
                                roomId: selectedRoom.id,
                                from: currentUser.id
                            });
                        }
                    };

                    // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
                    pc.onconnectionstatechange = () => {
                        console.log('Connection state:', pc.connectionState);
                        if (pc.connectionState === 'connected') {
                            setCallStatus('connected');
                            setIsCallActive(true);
                        } else if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {
                            endCall();
                        }
                    };

                    // offer ìƒì„± ë° ì „ì†¡
                    const offer = await pc.createOffer();
                    await pc.setLocalDescription(offer);

                    await sendSignalingMessage({
                        type: 'offer',
                        offer: offer,
                        callType: type,
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });

                } catch (error) {
                    console.error('í†µí™” ì‹œì‘ ì˜¤ë¥˜:', error);
                    alert('í†µí™”ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬/ì¹´ë©”ë¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    setCallStatus('idle');
                }
            };

            // í†µí™” ì¢…ë£Œ
            const endCall = () => {
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    setLocalStream(null);
                }
                
                if (peerConnection) {
                    peerConnection.close();
                    setPeerConnection(null);
                }
                
                setRemoteStream(null);
                setIsCallActive(false);
                setCallStatus('idle');
                setCallType(null);
                setIsMuted(false);
                setIsVideoOff(false);

                // í†µí™” ì¢…ë£Œ ì‹ í˜¸ ì „ì†¡
                if (selectedRoom) {
                    sendSignalingMessage({
                        type: 'end-call',
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });
                }
            };

            // ìŒì†Œê±° í† ê¸€
            const toggleMute = () => {
                if (localStream) {
                    const audioTrack = localStream.getAudioTracks()[0];
                    if (audioTrack) {
                        audioTrack.enabled = !audioTrack.enabled;
                        setIsMuted(!audioTrack.enabled);
                    }
                }
            };

            // ë¹„ë””ì˜¤ í† ê¸€
            const toggleVideo = () => {
                if (localStream && callType === 'video') {
                    const videoTrack = localStream.getVideoTracks()[0];
                    if (videoTrack) {
                        videoTrack.enabled = !videoTrack.enabled;
                        setIsVideoOff(!videoTrack.enabled);
                    }
                }
            };

            // ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡ (Supabase ì±„íŒ… ë©”ì‹œì§€ ì´ìš©)
            const sendSignalingMessage = async (signalData) => {
                try {
                    await supabase
                        .from('chat_messages')
                        .insert({
                            room_id: signalData.roomId,
                            user_id: currentUser.id,
                            user_nickname: currentUser.nickname || currentUser.email,
                            message_text: JSON.stringify(signalData),
                            message_type: 'webrtc-signal'
                        });
                } catch (error) {
                    console.error('ì‹œê·¸ë„ë§ ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                }
            };

            // WebRTC ì‹œê·¸ë„ë§ ì²˜ë¦¬
            const handleSignalingMessage = async (signalData) => {
                try {
                    switch (signalData.type) {
                        case 'offer':
                            await handleOffer(signalData);
                            break;
                        case 'answer':
                            await handleAnswer(signalData);
                            break;
                        case 'ice-candidate':
                            await handleIceCandidate(signalData);
                            break;
                        case 'end-call':
                            endCall();
                            break;
                    }
                } catch (error) {
                    console.error('ì‹œê·¸ë„ë§ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                }
            };

            // Offer ì²˜ë¦¬
            const handleOffer = async (signalData) => {
                if (!peerConnection && signalData.from !== currentUser.id) {
                    const shouldAccept = confirm('ìŒì„±/ì˜ìƒ í†µí™” ìš”ì²­ì´ ì™”ìŠµë‹ˆë‹¤. ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (!shouldAccept) return;

                    setCallStatus('ringing');
                    setCallType(signalData.callType);

                    // ì‚¬ìš©ì ë¯¸ë””ì–´ ê°€ì ¸ì˜¤ê¸°
                    const constraints = {
                        audio: true,
                        video: signalData.callType === 'video'
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    setLocalStream(stream);

                    if (localVideoRef.current && signalData.callType === 'video') {
                        localVideoRef.current.srcObject = stream;
                    }

                    // PeerConnection ìƒì„±
                    const pc = new RTCPeerConnection(rtcConfiguration);
                    setPeerConnection(pc);

                    stream.getTracks().forEach(track => {
                        pc.addTrack(track, stream);
                    });

                    pc.ontrack = (event) => {
                        const [remoteStream] = event.streams;
                        setRemoteStream(remoteStream);
                        if (remoteVideoRef.current) {
                            remoteVideoRef.current.srcObject = remoteStream;
                        }
                    };

                    pc.onicecandidate = async (event) => {
                        if (event.candidate) {
                            await sendSignalingMessage({
                                type: 'ice-candidate',
                                candidate: event.candidate,
                                roomId: selectedRoom.id,
                                from: currentUser.id
                            });
                        }
                    };

                    pc.onconnectionstatechange = () => {
                        if (pc.connectionState === 'connected') {
                            setCallStatus('connected');
                            setIsCallActive(true);
                        } else if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {
                            endCall();
                        }
                    };

                    // remote description ì„¤ì • ë° answer ìƒì„±
                    await pc.setRemoteDescription(signalData.offer);
                    const answer = await pc.createAnswer();
                    await pc.setLocalDescription(answer);

                    await sendSignalingMessage({
                        type: 'answer',
                        answer: answer,
                        roomId: selectedRoom.id,
                        from: currentUser.id
                    });
                }
            };

            // Answer ì²˜ë¦¬
            const handleAnswer = async (signalData) => {
                if (peerConnection && signalData.from !== currentUser.id) {
                    await peerConnection.setRemoteDescription(signalData.answer);
                }
            };

            // ICE Candidate ì²˜ë¦¬
            const handleIceCandidate = async (signalData) => {
                if (peerConnection && signalData.from !== currentUser.id) {
                    await peerConnection.addIceCandidate(signalData.candidate);
                }
            };

            // ì±„íŒ… íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ - ì „ë¬¸ê°€ ì¸ì¦ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
            // ìƒë‹´ ì‹œ ìë£Œ ê³µìœ ëŠ” ì´ë©”ì¼ ë“± ì™¸ë¶€ ì±„ë„ ê¶Œì¥

            if (loading) {
                return (
                    <div className="flex items-center justify-center h-96">
                        <div className="text-center">
                            <div className="text-4xl mb-4">ğŸ’¬</div>
                            <p className="text-gray-500">ì±„íŒ…ë°©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            // í˜„ì§ì ë©˜í† ë§ ìš”ì²­ í•¨ìˆ˜
            const requestExpertConsultation = async () => {
                try {
                    const roomName = `${currentUser.nickname || currentUser.email}ë‹˜ì˜ ë©˜í† ë§ì‹¤`;
                    const { data, error } = await supabase
                        .from('chat_rooms')
                        .insert({
                            name: roomName,
                            description: 'í˜„ì§ìì™€ì˜ 1:1 ì·¨ì—… ë©˜í† ë§ì„ ìœ„í•œ í”„ë¼ì´ë¹— ì±„íŒ…ë°©ì…ë‹ˆë‹¤.',
                            room_type: 'consultation',
                            created_by: currentUser.id,
                            max_participants: 2
                        })
                        .select()
                        .single();

                    if (error) throw error;
                    
                    // ìƒì„±ëœ ë°©ì— ìë™ ì°¸ì—¬
                    await joinRoom(data);
                    loadChatRooms();
                    setShowCreateRoom(false);
                } catch (error) {
                    console.error('ìƒë‹´ë°© ìƒì„± ì˜¤ë¥˜:', error);
                    alert('ìƒë‹´ë°© ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[700px] flex flex-col lg:flex-row">
                    {/* ì±„íŒ…ë°© ëª©ë¡ (ì™¼ìª½/ìƒë‹¨) */}
                    <div className="w-full lg:w-1/3 border-b lg:border-b-0 lg:border-r border-gray-200 flex flex-col h-48 lg:h-auto">
                        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-4 text-white">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-lg font-bold">ğŸ’¬ ì‹¤ì‹œê°„ ë©˜í† ë§</h2>
                                    <p className="text-blue-100 text-sm">í˜„ì§ìì™€ ì†Œí†µí•˜ì„¸ìš”</p>
                                </div>
                                <button
                                    onClick={() => setShowCreateRoom(true)}
                                    className="px-3 py-1 bg-white bg-opacity-20 rounded-lg text-sm hover:bg-opacity-30 transition-colors"
                                >
                                    + ë©˜í† ë§ ìš”ì²­
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto">
                            {chatRooms.length === 0 ? (
                                <div className="text-center py-8 px-4">
                                    <div className="text-4xl mb-2">ğŸ”</div>
                                    <p className="text-gray-500 text-sm mb-4">ì•„ì§ ì°¸ì—¬ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                    <button
                                        onClick={() => setShowCreateRoom(true)}
                                        className="text-blue-600 text-sm underline hover:text-blue-700"
                                    >
                                        í˜„ì§ì ë©˜í† ë§ ìš”ì²­í•˜ê¸°
                                    </button>
                                </div>
                            ) : (
                                chatRooms.map((room) => (
                                    <div
                                        key={room.id}
                                        onClick={() => joinRoom(room)}
                                        className={`p-3 cursor-pointer border-b border-gray-100 hover:bg-gray-50 transition-all duration-200 ${
                                            selectedRoom?.id === room.id ? 'bg-blue-50 border-l-4 border-l-blue-500 shadow-sm' : ''
                                        }`}
                                    >
                                        <div className="flex items-start justify-between mb-2">
                                            <h3 className="font-medium text-gray-800 text-sm truncate pr-2">{room.name}</h3>
                                            <span className={`px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0 ${
                                                room.room_type === 'consultation' ? 'bg-orange-100 text-orange-700' :
                                                room.room_type === 'private' ? 'bg-purple-100 text-purple-700' :
                                                'bg-green-100 text-green-700'
                                            }`}>
                                                {room.room_type === 'consultation' ? 'ğŸ‘¨â€ğŸ’¼' :
                                                 room.room_type === 'private' ? 'ğŸ”’' : 'ğŸ‘¥'}
                                            </span>
                                        </div>
                                        <p className="text-xs text-gray-600 line-clamp-2 mb-2">{room.description}</p>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center text-xs text-gray-500">
                                                <span className="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                                í™œì„± ìƒíƒœ
                                            </div>
                                            <div className="text-xs text-gray-400">
                                                {new Date(room.created_at).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* ì±„íŒ… ì˜ì—­ (ì˜¤ë¥¸ìª½) */}
                    <div className="flex-1 flex flex-col">
                        {selectedRoom ? (
                            <>
                                {/* ì±„íŒ…ë°© í—¤ë” - í˜„ì§ì ë©˜í† ë§ìš© ê°œì„  */}
                                <div className="bg-gradient-to-r from-gray-50 to-blue-50 px-4 py-3 border-b border-gray-200">
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center space-x-3">
                                            <div className={`w-3 h-3 rounded-full ${
                                                selectedRoom.room_type === 'consultation' ? 'bg-orange-400' :
                                                selectedRoom.room_type === 'private' ? 'bg-purple-400' :
                                                'bg-green-400'
                                            } animate-pulse`}></div>
                                            <div>
                                                <h3 className="font-bold text-gray-800 flex items-center">
                                                    {selectedRoom.name}
                                                    {selectedRoom.room_type === 'private' && (
                                                        <span className="ml-2 text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">
                                                            ğŸ”’ í”„ë¼ì´ë¹— ë©˜í† ë§
                                                        </span>
                                                    )}
                                                </h3>
                                                <p className="text-xs text-gray-600">{selectedRoom.description}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center space-x-4">
                                            <div className="text-right">
                                                <div className="text-sm text-gray-600">
                                                    ğŸ‘¥ {participants.length}ëª…
                                                </div>
                                                {(selectedRoom.room_type === 'private' || selectedRoom.room_type === 'consultation') && (
                                                    <div className="text-xs text-green-600 font-medium">
                                                        âœ… ë©˜í† ë§ ì§„í–‰ì¤‘
                                                    </div>
                                                )}
                                            </div>
                                            {/* ë©˜í† ë§ ë„êµ¬ ë²„íŠ¼ë“¤ */}
                                            {(selectedRoom.room_type === 'private' || selectedRoom.room_type === 'consultation') && (
                                                <div className="flex space-x-1">
                                                    {!isCallActive ? (
                                                        <>
                                                            <button
                                                                onClick={() => startCall('audio')}
                                                                disabled={callStatus !== 'idle'}
                                                                className="p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50"
                                                                title="ìŒì„± í†µí™”"
                                                            >
                                                                ğŸ“
                                                            </button>
                                                            <button
                                                                onClick={() => startCall('video')}
                                                                disabled={callStatus !== 'idle'}
                                                                className="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50"
                                                                title="ì˜ìƒ í†µí™”"
                                                            >
                                                                ğŸ“¹
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <div className="flex space-x-1">
                                                            <button
                                                                onClick={toggleMute}
                                                                className={`p-2 rounded-lg transition-colors ${
                                                                    isMuted 
                                                                        ? 'text-red-600 bg-red-50' 
                                                                        : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                                                                }`}
                                                                title={isMuted ? 'ìŒì†Œê±° í•´ì œ' : 'ìŒì†Œê±°'}
                                                            >
                                                                {isMuted ? 'ğŸ”‡' : 'ğŸ¤'}
                                                            </button>
                                                            {callType === 'video' && (
                                                                <button
                                                                    onClick={toggleVideo}
                                                                    className={`p-2 rounded-lg transition-colors ${
                                                                        isVideoOff 
                                                                            ? 'text-red-600 bg-red-50' 
                                                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                                                                    }`}
                                                                    title={isVideoOff ? 'ë¹„ë””ì˜¤ ì¼œê¸°' : 'ë¹„ë””ì˜¤ ë„ê¸°'}
                                                                >
                                                                    {isVideoOff ? 'ğŸ“µ' : 'ğŸ“¹'}
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={endCall}
                                                                className="p-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors"
                                                                title="í†µí™” ì¢…ë£Œ"
                                                            >
                                                                ğŸ“´
                                                            </button>
                                                        </div>
                                                    )}
                                                    {/* íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ - ì´ë©”ì¼ë¡œ ìë£Œ ìš”ì²­ ê¶Œì¥ */}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* ë¹„ë””ì˜¤ í†µí™” ì˜ì—­ */}
                                {isCallActive && callType === 'video' && (
                                    <div className="bg-black p-4 flex-shrink-0">
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 h-64">
                                            {/* ì›ê²© ë¹„ë””ì˜¤ (ìƒëŒ€ë°©) */}
                                            <div className="relative bg-gray-800 rounded-lg overflow-hidden">
                                                <video
                                                    ref={remoteVideoRef}
                                                    autoPlay
                                                    playsInline
                                                    className="w-full h-full object-cover"
                                                />
                                                <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                                    ìƒëŒ€ë°©
                                                </div>
                                            </div>
                                            
                                            {/* ë¡œì»¬ ë¹„ë””ì˜¤ (ë³¸ì¸) */}
                                            <div className="relative bg-gray-700 rounded-lg overflow-hidden">
                                                <video
                                                    ref={localVideoRef}
                                                    autoPlay
                                                    playsInline
                                                    muted
                                                    className="w-full h-full object-cover"
                                                />
                                                <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                                    ë‚˜
                                                </div>
                                                {isVideoOff && (
                                                    <div className="absolute inset-0 bg-gray-600 flex items-center justify-center">
                                                        <div className="text-white text-center">
                                                            <div className="text-4xl mb-2">ğŸ“µ</div>
                                                            <div>ë¹„ë””ì˜¤ êº¼ì§</div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {/* í†µí™” ìƒíƒœ í‘œì‹œ */}
                                        <div className="text-center text-white mt-2">
                                            {callStatus === 'calling' && 'ğŸ“ í†µí™” ì—°ê²° ì¤‘...'}
                                            {callStatus === 'ringing' && 'ğŸ“ ìƒëŒ€ë°©ì´ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...'}
                                            {callStatus === 'connected' && (
                                                <span className="text-green-400">âœ… í†µí™” ì—°ê²°ë¨</span>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* ìŒì„± í†µí™” ìƒíƒœ í‘œì‹œ */}
                                {isCallActive && callType === 'audio' && (
                                    <div className="bg-gradient-to-r from-green-500 to-blue-500 p-4 text-white text-center flex-shrink-0">
                                        <div className="flex items-center justify-center space-x-4">
                                            <div className="text-2xl animate-pulse">ğŸ“</div>
                                            <div>
                                                <div className="font-medium">ìŒì„± í†µí™” ì§„í–‰ì¤‘</div>
                                                <div className="text-sm opacity-90">
                                                    {callStatus === 'calling' && 'í†µí™” ì—°ê²° ì¤‘...'}
                                                    {callStatus === 'ringing' && 'ìƒëŒ€ë°© ì‘ë‹µ ëŒ€ê¸°ì¤‘...'}
                                                    {callStatus === 'connected' && 'âœ… ì—°ê²°ë¨'}
                                                </div>
                                            </div>
                                            <div className="text-2xl">
                                                {isMuted ? 'ğŸ”‡' : 'ğŸ¤'}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* ë©”ì‹œì§€ ì˜ì—­ - í˜„ì§ì ë©˜í† ë§ìš© ê°œì„  */}
                                <div className={`flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 ${
                                    isCallActive ? 'max-h-64' : ''
                                }`}>
                                    {messages.length === 0 ? (
                                        <div className="text-center text-gray-500 mt-16">
                                            <div className="text-6xl mb-4">
                                                {selectedRoom.room_type === 'private' ? 'ğŸ¥' : 'ğŸ’­'}
                                            </div>
                                            <h3 className="text-lg font-medium mb-2">
                                                {selectedRoom.room_type === 'private' ? 'ìƒë‹´ì„ ì‹œì‘í•˜ì„¸ìš”' : 'ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”'}
                                            </h3>
                                            <p className="text-sm">
                                                {selectedRoom.room_type === 'private' 
                                                    ? 'í˜„ì§ìì™€ ì•ˆì „í•œ 1:1 ë©˜í† ë§ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤'
                                                    : 'ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!'
                                                }
                                            </p>
                                        </div>
                                    ) : (
                                        messages.map((message, index) => {
                                            const isMyMessage = message.user_id === currentUser.id;
                                            const isExpertMessage = message.user_nickname && message.user_nickname.includes('ì „ë¬¸ê°€');
                                            const showAvatar = index === 0 || messages[index - 1].user_id !== message.user_id;
                                            
                                            return (
                                                <div
                                                    key={message.id}
                                                    className={`flex items-end space-x-2 ${
                                                        isMyMessage ? 'justify-end flex-row-reverse space-x-reverse' : 'justify-start'
                                                    }`}
                                                >
                                                    {/* í”„ë¡œí•„ ì•„ì´ì½˜ */}
                                                    {showAvatar && !isMyMessage && (
                                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${
                                                            isExpertMessage 
                                                                ? 'bg-orange-100 text-orange-700' 
                                                                : 'bg-blue-100 text-blue-700'
                                                        }`}>
                                                            {isExpertMessage ? 'ğŸ‘¨â€ğŸ’¼' : 'ğŸ‘¤'}
                                                        </div>
                                                    )}
                                                    {showAvatar && isMyMessage && (
                                                        <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                                            ë‚˜
                                                        </div>
                                                    )}
                                                    
                                                    {/* ë©”ì‹œì§€ ë²„ë¸” */}
                                                    <div className={`max-w-xs lg:max-w-md ${!showAvatar ? 'ml-10' : ''}`}>
                                                        {/* ë°œì‹ ì ì´ë¦„ (ì „ë¬¸ê°€ ê°•ì¡°) */}
                                                        {!isMyMessage && showAvatar && (
                                                            <div className={`text-xs font-medium mb-1 ml-1 ${
                                                                isExpertMessage ? 'text-orange-700' : 'text-gray-600'
                                                            }`}>
                                                                {isExpertMessage && 'â­ '}
                                                                {message.user_nickname}
                                                                {isExpertMessage && ' (ì „ë¬¸ê°€)'}
                                                            </div>
                                                        )}
                                                        
                                                        {/* ë©”ì‹œì§€ ë‚´ìš© */}
                                                        <div className={`px-4 py-3 rounded-2xl shadow-sm ${
                                                            isMyMessage
                                                                ? 'bg-blue-500 text-white rounded-br-md'
                                                                : isExpertMessage
                                                                    ? 'bg-orange-50 text-orange-900 border border-orange-200 rounded-bl-md'
                                                                    : 'bg-white text-gray-800 border border-gray-200 rounded-bl-md'
                                                        }`}>
                                                            {message.message_type === 'file' ? (
                                                                <div className="flex items-center space-x-2">
                                                                    <div className="text-2xl">ğŸ“</div>
                                                                    <div className="flex-1">
                                                                        <div className="font-medium">{message.message_text}</div>
                                                                        <button
                                                                            onClick={async () => {
                                                                                try {
                                                                                    if (message.file_url) {
                                                                                        // 1. ë‹¤ìš´ë¡œë“œ ì¹´ìš´íŠ¸ ì¦ê°€
                                                                                        if (message.file_id) {
                                                                                            await supabase
                                                                                                .from('chat_files')
                                                                                                .update({ 
                                                                                                    download_count: supabase.sql`download_count + 1` 
                                                                                                })
                                                                                                .eq('id', message.file_id);
                                                                                        }
                                                                                        
                                                                                        // 2. ìƒˆ íƒ­ì—ì„œ íŒŒì¼ ì—´ê¸° (ë‹¤ìš´ë¡œë“œ)
                                                                                        window.open(message.file_url, '_blank');
                                                                                        
                                                                                        // 3. ì‚¬ìš©ì í”¼ë“œë°±
                                                                                        setTimeout(() => {
                                                                                            const fileName = message.message_text.replace('ğŸ“ ', '').split(' (')[0];
                                                                                            console.log(`íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ${fileName}`);
                                                                                        }, 100);
                                                                                    } else {
                                                                                        alert('íŒŒì¼ URLì´ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì´ ì†ìƒë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                                                                                    }
                                                                                } catch (error) {
                                                                                    console.error('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                                                                                    alert('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                                                                                }
                                                                            }}
                                                                            className={`text-xs underline hover:no-underline ${
                                                                                isMyMessage ? 'text-blue-200' : 'text-blue-600'
                                                                            }`}
                                                                        >
                                                                            ë‹¤ìš´ë¡œë“œ (ë°ëª¨)
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="whitespace-pre-wrap break-words leading-relaxed">
                                                                    {message.message_text}
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {/* ì‹œê°„ */}
                                                        <div className={`text-xs mt-1 px-1 ${
                                                            isMyMessage ? 'text-right text-gray-400' : 'text-left text-gray-500'
                                                        }`}>
                                                            {formatMessageTime(message.created_at)}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                    <div ref={messagesEndRef} />
                                </div>

                                {/* ë©”ì‹œì§€ ì…ë ¥ - í˜„ì§ì ë©˜í† ë§ìš© ê°œì„  */}
                                <div className="border-t border-gray-200 bg-white p-4">
                                    {selectedRoom.room_type === 'private' && (
                                        <div className="flex items-center justify-between bg-blue-50 rounded-lg px-3 py-2 mb-3 text-sm">
                                            <div className="flex items-center space-x-2">
                                                <span className="w-2 h-2 bg-green-400 rounded-full"></span>
                                                <span className="text-blue-700 font-medium">ì•ˆì „í•œ 1:1 ìƒë‹´ ì§„í–‰ì¤‘</span>
                                            </div>
                                            <div className="text-xs text-blue-600">
                                                ğŸ”’ ì•”í˜¸í™”ëœ ëŒ€í™”
                                            </div>
                                        </div>
                                    )}
                                    
                                    <form onSubmit={sendMessage} className="space-y-3">
                                        <div className="flex gap-2">
                                            <div className="flex-1 relative">
                                                <input
                                                    type="text"
                                                    value={newMessage}
                                                    onChange={(e) => setNewMessage(e.target.value)}
                                                    placeholder={
                                                        selectedRoom.room_type === 'private' 
                                                            ? "ê¶ê¸ˆí•œ ì ì„ ìì„¸íˆ ë§ì”€í•´ ì£¼ì„¸ìš”..."
                                                            : "ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                                    }
                                                    className="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                    disabled={sending}
                                                    maxLength="1000"
                                                />
                                                <div className="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-400">
                                                    {newMessage.length}/1000
                                                </div>
                                            </div>
                                            <button
                                                type="submit"
                                                disabled={!newMessage.trim() || sending}
                                                className={`px-6 py-3 rounded-xl font-medium transition-all duration-200 ${
                                                    !newMessage.trim() || sending
                                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                        : selectedRoom.room_type === 'private'
                                                            ? 'bg-orange-500 hover:bg-orange-600 text-white shadow-lg hover:shadow-xl'
                                                            : 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl'
                                                }`}
                                            >
                                                {sending ? (
                                                    <div className="flex items-center space-x-2">
                                                        <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                                                        <span>ì „ì†¡ì¤‘</span>
                                                    </div>
                                                ) : (
                                                    'ì „ì†¡ ğŸ“¤'
                                                )}
                                            </button>
                                        </div>
                                        
                                        {/* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ (ìƒë‹´ìš©) */}
                                        {selectedRoom.room_type === 'private' && newMessage === '' && (
                                            <div className="flex flex-wrap gap-2">
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('ì•ˆë…•í•˜ì„¸ìš”! ë©˜í† ë§ ìš”ì²­ë“œë¦½ë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ‘‹ ì¸ì‚¬
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('ì´ë ¥ì„œ í”¼ë“œë°± ë¶€íƒë“œë¦½ë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ“ ì´ë ¥ì„œ í”¼ë“œë°±
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => setNewMessage('ê¸°ìˆ ë©´ì ‘ ëŒ€ë¹„ ë©˜í† ë§ ë°›ê³  ì‹¶ìŠµë‹ˆë‹¤.')}
                                                    className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                                                >
                                                    ğŸ¤ ë©´ì ‘ ì½”ì¹­
                                                </button>
                                            </div>
                                        )}
                                    </form>
                                </div>
                            </>
                        ) : (
                            <div className="flex items-center justify-center h-full text-gray-500">
                                <div className="text-center max-w-md">
                                    <div className="text-6xl mb-6">ğŸ¥</div>
                                    <h3 className="text-xl font-semibold text-gray-700 mb-4">í˜„ì§ì ë©˜í† ë§ ì‹œì‘í•˜ê¸°</h3>
                                    <p className="text-gray-600 mb-6 leading-relaxed">
                                        ì·¨ì—… ì¤€ë¹„, ì»¤ë¦¬ì–´ ê³ ë¯¼, ì—…ê³„ ì •ë³´ì— ëŒ€í•´<br/>
                                        í˜„ì§ìì™€ ì•ˆì „í•˜ê²Œ ìƒë‹´í•˜ì„¸ìš”
                                    </p>
                                    <button
                                        onClick={() => setShowCreateRoom(true)}
                                        className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl"
                                    >
                                        ğŸš€ ìƒˆ ë©˜í† ë§ ì‹œì‘í•˜ê¸°
                                    </button>
                                    <div className="mt-4 text-sm text-gray-500">
                                        ğŸ’¡ 1:1 í”„ë¼ì´ë¹— ë©˜í† ë§ | ğŸ”’ ì•ˆì „í•œ ì•”í˜¸í™” ëŒ€í™”
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì œê±°ë¨ - í•„ìš”ì‹œ ì´ë©”ì¼ë¡œ ìë£Œ ìš”ì²­ */}

                    {/* ìƒë‹´ë°© ìƒì„± ëª¨ë‹¬ */}
                    {showCreateRoom && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
                                <div className="text-center mb-6">
                                    <div className="text-4xl mb-3">ğŸ¥</div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-2">í˜„ì§ì ë©˜í† ë§ ìš”ì²­</h3>
                                    <p className="text-gray-600 text-sm">
                                        í˜„ì§ìì™€ì˜ 1:1 ë©˜í† ë§ë°©ì„ ìƒì„±í•©ë‹ˆë‹¤
                                    </p>
                                </div>
                                
                                <div className="space-y-4 mb-6">
                                    <div className="bg-blue-50 rounded-lg p-4">
                                        <div className="flex items-center space-x-3">
                                            <div className="text-2xl">ğŸ‘¤</div>
                                            <div>
                                                <div className="font-medium text-gray-800">
                                                    {currentUser?.nickname || currentUser?.email}
                                                </div>
                                                <div className="text-sm text-gray-600">ë©˜í† ë§ ì‹ ì²­ì</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-orange-50 rounded-lg p-4">
                                        <h4 className="font-medium text-gray-800 mb-2">ğŸ¯ ë©˜í† ë§ ê°€ëŠ¥ ë¶„ì•¼</h4>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <div className="text-gray-700">â€¢ ì´ë ¥ì„œ ê²€í† </div>
                                            <div className="text-gray-700">â€¢ ë©´ì ‘ ì½”ì¹­</div>
                                            <div className="text-gray-700">â€¢ ì—…ê³„ ì •ë³´</div>
                                            <div className="text-gray-700">â€¢ ì»¤ë¦¬ì–´ ì„¤ê³„</div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-green-50 rounded-lg p-4">
                                        <h4 className="font-medium text-gray-800 mb-2">âœ… ë©˜í† ë§ í˜œíƒ</h4>
                                        <div className="text-sm space-y-1">
                                            <div className="text-gray-700">â€¢ í˜„ì§ì 1:1 ë§ì¶¤ ë©˜í† ë§</div>
                                            <div className="text-gray-700">â€¢ ì•ˆì „í•œ í”„ë¼ì´ë¹— ëŒ€í™”</div>
                                            <div className="text-gray-700">â€¢ ì´ë ¥ì„œ ë“± ìë£Œ ê³µìœ  ê°€ëŠ¥</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => setShowCreateRoom(false)}
                                        className="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={requestExpertConsultation}
                                        className="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors shadow-lg"
                                    >
                                        ë©˜í† ë§ ì‹œì‘í•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ìª½ì§€ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸
        const MessagesComponent = ({ currentUser, isAdminUser }) => {
            const [messages, setMessages] = useState([]);
            const [selectedConversation, setSelectedConversation] = useState(null);
            const [conversations, setConversations] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [loading, setLoading] = useState(true);
            const [sending, setSending] = useState(false);
            const [showNewMessageModal, setShowNewMessageModal] = useState(false);
            const [newRecipientEmail, setNewRecipientEmail] = useState('');
            const [newMessageSubject, setNewMessageSubject] = useState('');
            const [newMessageContent, setNewMessageContent] = useState('');

            // ìª½ì§€í•¨ ë¡œë“œ
            const loadConversations = async () => {
                try {
                    setLoading(true);
                    console.log('ğŸ’Œ ìª½ì§€í•¨ ë¡œë”© ì‹œì‘...');
                    
                    // ë°œì‹ /ìˆ˜ì‹  ìª½ì§€ë¥¼ ëª¨ë‘ ë¶ˆëŸ¬ì™€ì„œ ëŒ€í™”ë³„ë¡œ ê·¸ë£¹í™”
                    const { data: sentMessages, error: sentError } = await supabase
                        .from('private_messages')
                        .select(`
                            *,
                            recipient:recipient_id(nickname, email),
                            sender:sender_id(nickname, email)
                        `)
                        .eq('sender_id', currentUser.id)
                        .order('created_at', { ascending: false });

                    const { data: receivedMessages, error: receivedError } = await supabase
                        .from('private_messages')
                        .select(`
                            *,
                            recipient:recipient_id(nickname, email), 
                            sender:sender_id(nickname, email)
                        `)
                        .eq('recipient_id', currentUser.id)
                        .order('created_at', { ascending: false });

                    if (sentError) throw sentError;
                    if (receivedError) throw receivedError;

                    // ëŒ€í™” ìƒëŒ€ë³„ë¡œ ê·¸ë£¹í™”
                    const allMessages = [...(sentMessages || []), ...(receivedMessages || [])];
                    const conversationMap = new Map();

                    allMessages.forEach(message => {
                        const isFromMe = message.sender_id === currentUser.id;
                        const partnerId = isFromMe ? message.recipient_id : message.sender_id;
                        const partnerInfo = isFromMe ? message.recipient : message.sender;
                        
                        if (!conversationMap.has(partnerId)) {
                            conversationMap.set(partnerId, {
                                partnerId,
                                partnerInfo,
                                messages: [],
                                lastMessage: null,
                                unreadCount: 0
                            });
                        }
                        
                        const conversation = conversationMap.get(partnerId);
                        conversation.messages.push(message);
                        
                        if (!conversation.lastMessage || new Date(message.created_at) > new Date(conversation.lastMessage.created_at)) {
                            conversation.lastMessage = message;
                        }
                        
                        if (!isFromMe && !message.is_read) {
                            conversation.unreadCount++;
                        }
                    });

                    const conversationsList = Array.from(conversationMap.values())
                        .sort((a, b) => new Date(b.lastMessage.created_at) - new Date(a.lastMessage.created_at));

                    setConversations(conversationsList);
                    console.log('âœ… ìª½ì§€í•¨ ë¡œë”© ì™„ë£Œ:', conversationsList.length, 'ê°œ ëŒ€í™”');
                    
                } catch (error) {
                    console.error('âŒ ìª½ì§€í•¨ ë¡œë”© ì‹¤íŒ¨:', error);
                } finally {
                    setLoading(false);
                }
            };

            // íŠ¹ì • ëŒ€í™”ì˜ ë©”ì‹œì§€ë“¤ ë¡œë“œ
            const loadMessages = async (partnerId) => {
                try {
                    const { data, error } = await supabase
                        .from('private_messages')
                        .select(`
                            *,
                            sender:sender_id(nickname, email),
                            recipient:recipient_id(nickname, email)
                        `)
                        .or(`and(sender_id.eq.${currentUser.id},recipient_id.eq.${partnerId}),and(sender_id.eq.${partnerId},recipient_id.eq.${currentUser.id})`)
                        .order('created_at', { ascending: true });

                    if (error) throw error;
                    
                    setMessages(data || []);
                    
                    // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ë“¤ì„ ì½ìŒ ì²˜ë¦¬
                    const unreadMessages = data?.filter(msg => 
                        msg.recipient_id === currentUser.id && !msg.is_read
                    );
                    
                    if (unreadMessages?.length > 0) {
                        const { error: markReadError } = await supabase
                            .from('private_messages')
                            .update({ is_read: true, read_at: new Date().toISOString() })
                            .in('id', unreadMessages.map(msg => msg.id));
                            
                        if (markReadError) {
                            console.error('ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:', markReadError);
                        }
                    }
                    
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ë¡œë”© ì‹¤íŒ¨:', error);
                }
            };

            // ìƒˆ ìª½ì§€ ë°œì†¡
            const sendMessage = async () => {
                if (!newMessage.trim() || !selectedConversation) return;
                
                try {
                    setSending(true);
                    
                    const { error } = await supabase
                        .from('private_messages')
                        .insert({
                            sender_id: currentUser.id,
                            recipient_id: selectedConversation.partnerId,
                            subject: 'ë‹µì¥',
                            content: newMessage.trim(),
                            is_read: false
                        });
                    
                    if (error) throw error;
                    
                    // ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡
                    try {
                        await EmailManager.sendNewMessageEmail(selectedConversation.partnerId, {
                            senderName: currentUser.nickname || currentUser.email,
                            receiverName: selectedConversation.partnerNickname,
                            subject: 'ë‹µì¥',
                            content: newMessage.trim().substring(0, 100) + (newMessage.trim().length > 100 ? '...' : ''),
                            messageId: 'reply_' + Date.now()
                        });
                        console.log('âœ… ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ');
                    } catch (emailError) {
                        console.error('âŒ ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailError);
                    }
                    
                    setNewMessage('');
                    await loadMessages(selectedConversation.partnerId);
                    await loadConversations(); // ëŒ€í™” ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    
                } catch (error) {
                    console.error('ìª½ì§€ ë°œì†¡ ì‹¤íŒ¨:', error);
                    alert('ìª½ì§€ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSending(false);
                }
            };

            // ìƒˆ ëŒ€í™” ì‹œì‘
            const startNewConversation = async () => {
                if (!newRecipientEmail.trim() || !newMessageSubject.trim() || !newMessageContent.trim()) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                try {
                    setSending(true);
                    
                    // ìˆ˜ì‹ ì í™•ì¸
                    const { data: recipientData, error: recipientError } = await supabase
                        .from('user_profiles')
                        .select('id, nickname, email, role')
                        .eq('email', newRecipientEmail.trim())
                        .single();
                    
                    if (recipientError) {
                        alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    const { error } = await supabase
                        .from('private_messages')
                        .insert({
                            sender_id: currentUser.id,
                            recipient_id: recipientData.id,
                            subject: newMessageSubject.trim(),
                            content: newMessageContent.trim(),
                            is_read: false
                        });
                    
                    if (error) throw error;
                    
                    // ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡
                    try {
                        await EmailManager.sendNewMessageEmail(recipientData.id, {
                            senderName: currentUser.nickname || currentUser.email,
                            receiverName: recipientData.nickname || recipientData.email,
                            subject: newMessageSubject.trim(),
                            content: newMessageContent.trim().substring(0, 100) + (newMessageContent.trim().length > 100 ? '...' : ''),
                            messageId: 'new_' + Date.now()
                        });
                        console.log('âœ… ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ');
                    } catch (emailError) {
                        console.error('âŒ ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailError);
                    }
                    
                    setShowNewMessageModal(false);
                    setNewRecipientEmail('');
                    setNewMessageSubject('');
                    setNewMessageContent('');
                    
                    await loadConversations();
                    
                } catch (error) {
                    console.error('ìƒˆ ìª½ì§€ ë°œì†¡ ì‹¤íŒ¨:', error);
                    alert('ìª½ì§€ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSending(false);
                }
            };

            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ëŒ€í™” ëª©ë¡ ë¡œë“œ
            useEffect(() => {
                if (currentUser?.id) {
                    loadConversations();
                }
            }, [currentUser]);

            // ëŒ€í™” ì„ íƒ ì‹œ í•´ë‹¹ ë©”ì‹œì§€ë“¤ ë¡œë“œ
            useEffect(() => {
                if (selectedConversation) {
                    loadMessages(selectedConversation.partnerId);
                }
            }, [selectedConversation]);

            return (
                <div className="max-w-6xl mx-auto p-4">
                    <div className="bg-white rounded-lg shadow-sm border min-h-[600px]">
                        <div className="border-b border-gray-200 p-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <span className="text-2xl">ğŸ’Œ</span>
                                <h2 className="text-xl font-semibold text-gray-800">ìª½ì§€</h2>
                            </div>
                            <button
                                onClick={() => setShowNewMessageModal(true)}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
                            >
                                <span>âœï¸</span> ìƒˆ ìª½ì§€
                            </button>
                        </div>

                        <div className="flex h-[calc(600px-73px)]">
                            {/* ëŒ€í™” ëª©ë¡ */}
                            <div className="w-1/3 border-r border-gray-200 overflow-y-auto">
                                {loading ? (
                                    <div className="flex items-center justify-center h-full">
                                        <div className="text-gray-500">ë¡œë”© ì¤‘...</div>
                                    </div>
                                ) : conversations.length === 0 ? (
                                    <div className="flex flex-col items-center justify-center h-full text-gray-500 p-4">
                                        <div className="text-4xl mb-2">ğŸ’­</div>
                                        <p className="text-center">ì•„ì§ ì£¼ê³ ë°›ì€ ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                        <p className="text-sm text-center mt-1">ìƒˆ ìª½ì§€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                                    </div>
                                ) : (
                                    <div className="divide-y divide-gray-100">
                                        {conversations.map((conversation) => (
                                            <div
                                                key={conversation.partnerId}
                                                className={`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${
                                                    selectedConversation?.partnerId === conversation.partnerId 
                                                        ? 'bg-blue-50 border-r-2 border-blue-500' 
                                                        : ''
                                                }`}
                                                onClick={() => setSelectedConversation(conversation)}
                                            >
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <div className="font-medium text-gray-900">
                                                                {conversation.partnerInfo?.nickname || 
                                                                 conversation.partnerInfo?.email || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                                            </div>
                                                            {conversation.unreadCount > 0 && (
                                                                <div className="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                                    {conversation.unreadCount}
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="text-sm text-gray-600 line-clamp-2">
                                                            {conversation.lastMessage?.content || 'ë©”ì‹œì§€ ì—†ìŒ'}
                                                        </div>
                                                        <div className="text-xs text-gray-400 mt-1">
                                                            {conversation.lastMessage && 
                                                             new Date(conversation.lastMessage.created_at).toLocaleDateString('ko-KR', {
                                                                month: 'short',
                                                                day: 'numeric',
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                             })
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* ë©”ì‹œì§€ ì˜ì—­ */}
                            <div className="flex-1 flex flex-col">
                                {selectedConversation ? (
                                    <>
                                        {/* ëŒ€í™” í—¤ë” */}
                                        <div className="border-b border-gray-200 p-4">
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">
                                                    {selectedConversation.partnerInfo?.nickname?.[0] || 
                                                     selectedConversation.partnerInfo?.email?.[0] || '?'}
                                                </div>
                                                <div>
                                                    <div className="font-medium text-gray-900">
                                                        {selectedConversation.partnerInfo?.nickname || 
                                                         selectedConversation.partnerInfo?.email || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        {selectedConversation.partnerInfo?.email}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* ë©”ì‹œì§€ ëª©ë¡ */}
                                        <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                            {messages.map((message) => {
                                                const isFromMe = message.sender_id === currentUser.id;
                                                return (
                                                    <div key={message.id} className={`flex ${isFromMe ? 'justify-end' : 'justify-start'}`}>
                                                        <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                                                            isFromMe 
                                                                ? 'bg-blue-600 text-white' 
                                                                : 'bg-gray-100 text-gray-900'
                                                        }`}>
                                                            {message.subject && message.subject !== 'ë‹µì¥' && (
                                                                <div className={`text-sm font-medium mb-1 ${
                                                                    isFromMe ? 'text-blue-100' : 'text-gray-700'
                                                                }`}>
                                                                    ì œëª©: {message.subject}
                                                                </div>
                                                            )}
                                                            <div className="whitespace-pre-wrap">
                                                                {message.content}
                                                            </div>
                                                            <div className={`text-xs mt-1 ${
                                                                isFromMe ? 'text-blue-100' : 'text-gray-500'
                                                            }`}>
                                                                {new Date(message.created_at).toLocaleString('ko-KR')}
                                                                {isFromMe && (
                                                                    <span className="ml-2">
                                                                        {message.is_read ? 'ì½ìŒ' : 'ë³´ëƒ„'}
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        {/* ë©”ì‹œì§€ ì…ë ¥ */}
                                        <div className="border-t border-gray-200 p-4">
                                            <div className="flex gap-2">
                                                <textarea
                                                    value={newMessage}
                                                    onChange={(e) => setNewMessage(e.target.value)}
                                                    className="flex-1 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                    rows="3"
                                                    placeholder="ë‹µì¥ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter' && !e.shiftKey) {
                                                            e.preventDefault();
                                                            sendMessage();
                                                        }
                                                    }}
                                                />
                                                <button
                                                    onClick={sendMessage}
                                                    disabled={sending || !newMessage.trim()}
                                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                                >
                                                    {sending ? 'ë°œì†¡ ì¤‘...' : 'ë°œì†¡'}
                                                </button>
                                            </div>
                                        </div>
                                    </>
                                ) : (
                                    <div className="flex-1 flex items-center justify-center text-gray-500">
                                        <div className="text-center">
                                            <div className="text-4xl mb-2">ğŸ’¬</div>
                                            <p>ëŒ€í™”ë¥¼ ì„ íƒí•˜ì—¬ ìª½ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* ìƒˆ ìª½ì§€ ì‘ì„± ëª¨ë‹¬ */}
                    {showNewMessageModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg max-w-md w-full">
                                <div className="border-b border-gray-200 p-4">
                                    <h3 className="text-lg font-semibold text-gray-900">ìƒˆ ìª½ì§€ ë³´ë‚´ê¸°</h3>
                                </div>
                                
                                <div className="p-4 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ë°›ëŠ” ì‚¬ëŒ (ì´ë©”ì¼)</label>
                                        <input
                                            type="email"
                                            value={newRecipientEmail}
                                            onChange={(e) => setNewRecipientEmail(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="example@email.com"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ì œëª©</label>
                                        <input
                                            type="text"
                                            value={newMessageSubject}
                                            onChange={(e) => setNewMessageSubject(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="ìª½ì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">ë‚´ìš©</label>
                                        <textarea
                                            value={newMessageContent}
                                            onChange={(e) => setNewMessageContent(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            rows="5"
                                            placeholder="ìª½ì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                        />
                                    </div>
                                </div>
                                
                                <div className="border-t border-gray-200 p-4 flex gap-3">
                                    <button
                                        onClick={() => setShowNewMessageModal(false)}
                                        className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button
                                        onClick={startNewConversation}
                                        disabled={sending}
                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {sending ? 'ë°œì†¡ ì¤‘...' : 'ë°œì†¡'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ìƒë‹´ íƒ€ì´ë¨¸ ì»´í¬ë„ŒíŠ¸
        const ConsultationTimerComponent = ({ 
            isActive, 
            duration, 
            timeLimit, 
            onStart, 
            onEnd, 
            onExtend, 
            showWarning 
        }) => {
            const formatTime = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            const getRemainingTime = () => Math.max(0, timeLimit - duration);
            const remainingTime = getRemainingTime();
            const isNearEnd = remainingTime <= 300; // 5ë¶„ ì´í•˜
            
            if (!isActive) {
                return (
                    <div className="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="text-2xl">â°</div>
                                <div>
                                    <div className="font-medium text-gray-800">ìƒë‹´ ëŒ€ê¸° ì¤‘</div>
                                    <div className="text-sm text-gray-600">ìƒë‹´ì„ ì‹œì‘í•˜ë ¤ë©´ íƒ€ì´ë¨¸ë¥¼ í™œì„±í™”í•˜ì„¸ìš”</div>
                                </div>
                            </div>
                            <button
                                onClick={onStart}
                                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                            >
                                â–¶ï¸ ìƒë‹´ ì‹œì‘
                            </button>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className={`border rounded-lg p-4 mb-4 ${
                    isNearEnd ? 'bg-red-50 border-red-300' : 'bg-green-50 border-green-300'
                }`}>
                    <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-3">
                            <div className={`text-2xl ${isNearEnd ? 'animate-pulse' : ''}`}>
                                {isNearEnd ? 'ğŸš¨' : 'â°'}
                            </div>
                            <div>
                                <div className="font-medium text-gray-800">
                                    ìƒë‹´ ì§„í–‰ ì¤‘ ({formatTime(duration)})
                                </div>
                                <div className={`text-sm ${isNearEnd ? 'text-red-600 font-medium' : 'text-gray-600'}`}>
                                    ë‚¨ì€ ì‹œê°„: {formatTime(remainingTime)}
                                </div>
                            </div>
                        </div>
                        
                        <div className="flex gap-2">
                            <button
                                onClick={onExtend}
                                className="px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"
                                title="10ë¶„ ì—°ì¥"
                            >
                                â±ï¸ +10ë¶„
                            </button>
                            <button
                                onClick={onEnd}
                                className="px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors"
                            >
                                â¹ï¸ ì¢…ë£Œ
                            </button>
                        </div>
                    </div>
                    
                    {/* ì§„í–‰ë¥  ë°” */}
                    <div className="w-full bg-gray-200 rounded-full h-2">
                        <div 
                            className={`h-2 rounded-full transition-all duration-1000 ${
                                isNearEnd ? 'bg-red-500' : 'bg-green-500'
                            }`}
                            style={{ width: `${Math.min(100, (duration / timeLimit) * 100)}%` }}
                        ></div>
                    </div>
                    
                    {showWarning && isNearEnd && (
                        <div className="mt-3 p-2 bg-red-100 border border-red-300 rounded-lg">
                            <div className="flex items-center gap-2">
                                <span className="text-red-600">âš ï¸</span>
                                <span className="text-sm text-red-800 font-medium">
                                    ìƒë‹´ ì‹œê°„ì´ ê³§ ì¢…ë£Œë©ë‹ˆë‹¤. ì—°ì¥ì´ í•„ìš”í•˜ë©´ +10ë¶„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                                </span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ì»´í¬ë„ŒíŠ¸
        const AnnouncementComponent = ({ currentUser, isAdminUser }) => {
            const [announcements, setAnnouncements] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showWriteModal, setShowWriteModal] = useState(false);
            const [selectedAnnouncement, setSelectedAnnouncement] = useState(null);
            const [showDetailModal, setShowDetailModal] = useState(false);

            // ê³µì§€ì‚¬í•­ ëª©ë¡ ë¡œë“œ
            const loadAnnouncements = async () => {
                try {
                    setLoading(true);
                    const { data, error } = await supabase
                        .from('announcements')
                        .select('*')
                        .eq('is_active', true)
                        .order('is_important', { ascending: false })
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setAnnouncements(data || []);
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            // ì¡°íšŒìˆ˜ ì¦ê°€
            const incrementViewCount = async (announcementId) => {
                if (!currentUser || currentUser.isGuest) return;
                
                try {
                    await supabase
                        .from('announcement_views')
                        .upsert({ 
                            announcement_id: announcementId, 
                            user_id: currentUser.id 
                        }, { 
                            onConflict: 'announcement_id,user_id' 
                        });
                } catch (error) {
                    console.error('ì¡°íšŒìˆ˜ ì¦ê°€ ì˜¤ë¥˜:', error);
                }
            };

            useEffect(() => {
                loadAnnouncements();
            }, []);

            // ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸°
            const handleAnnouncementClick = (announcement) => {
                setSelectedAnnouncement(announcement);
                setShowDetailModal(true);
                incrementViewCount(announcement.id);
            };

            // ê³µì§€ì‚¬í•­ ì‚­ì œ (ê´€ë¦¬ìë§Œ)
            const handleDeleteAnnouncement = async (id) => {
                if (!isAdminUser(currentUser)) return;
                
                if (confirm('ì •ë§ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        const { error } = await supabase
                            .from('announcements')
                            .update({ is_active: false })
                            .eq('id', id);

                        if (error) throw error;
                        
                        alert('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        loadAnnouncements();
                    } catch (error) {
                        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            };

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        {/* í—¤ë” */}
                        <div className="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-8 text-white">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold mb-2">ğŸ“¢ ê³µì§€ì‚¬í•­</h1>
                                    <p className="text-blue-100">
                                        ì¸ì‚¬ì´ë“œì¡ì˜ ìƒˆë¡œìš´ ì†Œì‹ê³¼ ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”
                                    </p>
                                </div>
                                {isAdminUser(currentUser) && (
                                    <button
                                        onClick={() => setShowWriteModal(true)}
                                        className="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors"
                                    >
                                        âœï¸ ê³µì§€ ì‘ì„±
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* ê³µì§€ì‚¬í•­ ëª©ë¡ */}
                        <div className="p-6">
                            {loading ? (
                                <div className="text-center py-12">
                                    <div className="text-4xl mb-4">ğŸ“¡</div>
                                    <p className="text-gray-500">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                </div>
                            ) : announcements.length === 0 ? (
                                <div className="text-center py-12">
                                    <div className="text-4xl mb-4">ğŸ“­</div>
                                    <p className="text-gray-500">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {announcements.map((announcement) => (
                                        <div
                                            key={announcement.id}
                                            className={`border rounded-lg p-5 cursor-pointer transition-all hover:shadow-md ${
                                                announcement.is_important
                                                    ? 'border-red-300 bg-red-50 hover:bg-red-100'
                                                    : 'border-gray-200 bg-white hover:bg-gray-50'
                                            }`}
                                            onClick={() => handleAnnouncementClick(announcement)}
                                        >
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        {announcement.is_important && (
                                                            <span className="bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">
                                                                ì¤‘ìš”
                                                            </span>
                                                        )}
                                                        <h3 className="text-lg font-semibold text-gray-800 line-clamp-1">
                                                            {announcement.title}
                                                        </h3>
                                                    </div>
                                                    <p className="text-gray-600 text-sm line-clamp-2 mb-3">
                                                        {announcement.content}
                                                    </p>
                                                    <div className="text-xs text-gray-400">
                                                        {new Date(announcement.created_at).toLocaleDateString('ko-KR', {
                                                            year: 'numeric',
                                                            month: 'long',
                                                            day: 'numeric',
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        })}
                                                    </div>
                                                </div>
                                                {isAdminUser(currentUser) && (
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleDeleteAnnouncement(announcement.id);
                                                        }}
                                                        className="text-red-400 hover:text-red-600 p-1"
                                                        title="ì‚­ì œ"
                                                    >
                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                        </svg>
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */}
                    {showDetailModal && selectedAnnouncement && 
                        <AnnouncementDetailModal
                            announcement={selectedAnnouncement}
                            onClose={() => {
                                setShowDetailModal(false);
                                setSelectedAnnouncement(null);
                            }}
                        />}

                    {/* ê³µì§€ì‚¬í•­ ì‘ì„± ëª¨ë‹¬ */}
                    {showWriteModal && 
                        <AnnouncementWriteModal
                            currentUser={currentUser}
                            onClose={() => setShowWriteModal(false)}
                            onSuccess={() => {
                                setShowWriteModal(false);
                                loadAnnouncements();
                            }}
                        />}
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬
        const AnnouncementDetailModal = ({ announcement, onClose }) => {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-xl">
                        <div className="flex justify-between items-start mb-6">
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                    {announcement.is_important && (
                                        <span className="bg-red-500 text-white px-2 py-1 rounded text-xs font-medium">
                                            ì¤‘ìš”
                                        </span>
                                    )}
                                    <h2 className="text-xl font-bold text-gray-800">
                                        {announcement.title}
                                    </h2>
                                </div>
                                <p className="text-sm text-gray-500">
                                    {new Date(announcement.created_at).toLocaleDateString('ko-KR', {
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}
                                </p>
                            </div>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                            >
                                Ã—
                            </button>
                        </div>

                        <div className="prose prose-sm max-w-none">
                            <div className="whitespace-pre-wrap text-gray-700 leading-relaxed">
                                {announcement.content}
                            </div>
                        </div>

                        <div className="mt-6 pt-4 border-t border-gray-200">
                            <button
                                onClick={onClose}
                                className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                í™•ì¸
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ê³µì§€ì‚¬í•­ ì‘ì„± ëª¨ë‹¬
        const AnnouncementWriteModal = ({ currentUser, onClose, onSuccess }) => {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                is_important: false
            });
            const [submitting, setSubmitting] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.title.trim() || !formData.content.trim()) {
                    alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    setSubmitting(true);
                    const { error } = await supabase
                        .from('announcements')
                        .insert({
                            title: formData.title.trim(),
                            content: formData.content.trim(),
                            is_important: formData.is_important,
                            created_by: currentUser.id
                        });

                    if (error) throw error;

                    alert('ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    onSuccess();
                } catch (error) {
                    console.error('ê³µì§€ì‚¬í•­ ë“±ë¡ ì˜¤ë¥˜:', error);
                    alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSubmitting(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                    <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-gray-800">ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
                            <button
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 text-2xl font-bold"
                            >
                                Ã—
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ì œëª© *
                                </label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    ë‚´ìš© *
                                </label>
                                <textarea
                                    value={formData.content}
                                    onChange={(e) => setFormData(prev => ({ ...prev, content: e.target.value }))}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="10"
                                    placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                    required
                                />
                            </div>

                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="is_important"
                                    checked={formData.is_important}
                                    onChange={(e) => setFormData(prev => ({ ...prev, is_important: e.target.checked }))}
                                    className="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"
                                />
                                <label htmlFor="is_important" className="ml-2 text-sm text-gray-700">
                                    ì¤‘ìš” ê³µì§€ì‚¬í•­ìœ¼ë¡œ ì„¤ì • (ìƒë‹¨ì— ê³ ì •ë©ë‹ˆë‹¤)
                                </label>
                            </div>

                            <div className="flex gap-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    type="submit"
                                    disabled={submitting}
                                    className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400"
                                >
                                    {submitting ? 'ë“±ë¡ ì¤‘...' : 'ë“±ë¡í•˜ê¸°'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // í˜„ì§ì ì°¾ê¸° ì»´í¬ë„ŒíŠ¸ - ì·¨ì—… ë©˜í† ë§ ì „ìš©
        const ExpertFinderComponent = ({ currentUser, isAdminUser, setShowSignupModal }) => {
            const [activeCategory, setActiveCategory] = useState('tech_development');
            const [showBookingModal, setShowBookingModal] = useState(false);
            const [selectedExpert, setSelectedExpert] = useState(null);
            const [showWriteModal, setShowWriteModal] = useState(false);
            const [isExpert, setIsExpert] = useState(false);
            
            // ğŸ” ê²€ìƒ‰ ë° í•„í„°ë§ ìƒíƒœ
            const [searchKeyword, setSearchKeyword] = useState('');
            const [searchFilters, setSearchFilters] = useState({
                minExperience: 0,
                maxPrice: 500000,
                minRating: 0,
                sortBy: 'rating', // rating, price, experience, reviews
                showAdvancedFilters: false
            });
            const [searchLoading, setSearchLoading] = useState(false);
            const [searchDebounceTimer, setSearchDebounceTimer] = useState(null);

            // ì „ë¬¸ê°€ ì—¬ë¶€ í™•ì¸ (ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ )
            useEffect(() => {
                const checkExpertStatus = async () => {
                    if (!currentUser) {
                        setIsExpert(false);
                        return;
                    }

                    // ê´€ë¦¬ìëŠ” ëª¨ë“  ì „ë¬¸ê°€ ê¶Œí•œ ë³´ìœ 
                    if (isAdminUser && isAdminUser(currentUser)) {
                        setIsExpert(true);
                        return;
                    }

                    try {
                        const { data: expertProfile } = await supabase
                            .from('experts')
                            .select('is_verified, is_active')
                            .eq('user_id', currentUser.id)
                            .single();

                        setIsExpert(expertProfile?.is_verified === true && expertProfile?.is_active === true);
                    } catch (error) {
                        setIsExpert(false);
                    }
                };

                checkExpertStatus();
            }, [currentUser]);

            // ê¸€ì“°ê¸° ì™„ë£Œ í›„ ìƒˆë¡œê³ ì¹¨
            const handleWriteSuccess = () => {
                // í•„ìš”ì‹œ ì „ë¬¸ê°€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ë¡œì§ ì¶”ê°€
                console.log('ì „ë¬¸ê°€ ê¸€ ì‘ì„± ì™„ë£Œ');
            };
            
            // í˜„ì§ì ë©˜í†  ì—…ê³„ë³„ ì¹´í…Œê³ ë¦¬ ì •ì˜
            const expertCategories = {
                'tech_development': {
                    name: 'IT/ê°œë°œ',
                    icon: 'ğŸ’»',
                    color: 'from-blue-500 to-indigo-500',
                    bgColor: 'from-blue-50 to-indigo-50',
                    description: 'ê°œë°œì, ì—”ì§€ë‹ˆì–´, IT ì „ë¬¸ê°€'
                },
                'finance_consulting': {
                    name: 'ê¸ˆìœµ/ì»¨ì„¤íŒ…',
                    icon: 'ğŸ’°',
                    color: 'from-green-500 to-emerald-500',
                    bgColor: 'from-green-50 to-emerald-50',
                    description: 'ê¸ˆìœµê¶Œ, ì»¨ì„¤íŒ… í˜„ì§ì'
                },
                'marketing_planning': {
                    name: 'ë§ˆì¼€íŒ…/ê¸°íš',
                    icon: 'ğŸ“Š',
                    color: 'from-purple-500 to-pink-500',
                    bgColor: 'from-purple-50 to-pink-50',
                    description: 'ë§ˆì¼€í„°, ê¸°íšì, ì „ëµ ë‹´ë‹¹ì'
                }
            };

            // í˜„ì§ì ë©˜í†  ë°ì´í„° ìƒíƒœ ê´€ë¦¬
            const [expertData, setExpertData] = useState({});
            const [loading, setLoading] = useState(true);
            
            // ì‹¤ì œ ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                loadExpertData();
            }, []);

            const loadExpertData = async () => {
                try {
                    setLoading(true);
                    
                    // professionals í…Œì´ë¸”ì—ì„œ ìŠ¹ì¸ëœ ì „ë¬¸ê°€ ë°ì´í„° ì¡°íšŒ
                    const { data: experts, error } = await supabase
                        .from('professionals')
                        .select(`
                            id, name, title, company, specialties, 
                            hourly_rate, experience_years, bio,
                            rating_average, review_count, response_rate,
                            industry, category, profile_image_url,
                            is_active, approved_at
                        `)
                        .eq('is_approved', true)
                        .eq('is_active', true)
                        .order('rating_average', { ascending: false });

                    if (error) {
                        console.error('ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ì‹œ ëª¨ì˜ë°ì´í„° ì‚¬ìš©
                        // ì‹¤ì œ ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ (í˜„ì¬ëŠ” ë¹ˆ ê°ì²´ë¡œ ì‹œì‘)
                        setExpertData({});
                        return;
                    }

                    // ì¹´í…Œê³ ë¦¬ë³„ ì „ë¬¸ê°€ ë°ì´í„° ë¶„ë¥˜
                    const categorizedExperts = {
                        'tech_development': experts.filter(e => e.category === 'tech_development'),
                        'finance_consulting': experts.filter(e => e.category === 'finance_consulting'), 
                        'marketing_strategy': experts.filter(e => e.category === 'marketing_strategy')
                    };

                    // ì‹¤ì œ ë°ì´í„°ê°€ ë¡œë“œë  ë•Œê¹Œì§€ëŠ” ë¹ˆ ì¹´í…Œê³ ë¦¬ë¡œ í‘œì‹œ
                    // Supabase ì—°ë™ í›„ ì‹¤ì œ ì „ë¬¸ê°€ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.

                    setExpertData(categorizedExperts);
                } catch (error) {
                    console.error('ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    setExpertData({});
                } finally {
                    setLoading(false);
                }
            };

            // ëª¨ì˜ë°ì´í„° ë°˜í™˜ í•¨ìˆ˜ (í´ë°±ìš©)
            /* TODO: ì‹¤ì œ Supabase ì—°ë™ í›„ ì œê±° ì˜ˆì •
            const getMockExpertData = () => ({
                'tech_development': [
                    {
                        id: 1,
                        name: 'ê¹€ê°œë°œíŒ€ì¥',
                        title: 'ë„¤ì´ë²„ â€¢ ë°±ì—”ë“œ ê°œë°œíŒ€ì¥',
                        experience: '15ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 87,
                        specialties: ['ë°±ì—”ë“œê°œë°œ', 'ì‹œìŠ¤í…œì„¤ê³„', 'ê¸°ìˆ ë©´ì ‘', 'ì»¤ë¦¬ì–´íŒ¨ìŠ¤'],
                        price: '80,000ì›/60ë¶„',
                        responseRate: 95,
                        profileImage: 'ğŸ’»'
                    },
                    {
                        id: 2,
                        name: 'ë°•í”„ë¡ íŠ¸ì—”ë“œ',
                        title: 'ì¹´ì¹´ì˜¤ â€¢ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì',
                        experience: '8ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 64,
                        specialties: ['React', 'Vue.js', 'í”„ë¡ íŠ¸ì—”ë“œ ë©´ì ‘', 'í¬íŠ¸í´ë¦¬ì˜¤'],
                        price: '60,000ì›/45ë¶„',
                        responseRate: 92,
                        profileImage: 'âš›ï¸'
                    },
                    {
                        id: 3,
                        name: 'ì´ë°ì´í„°ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸',
                        title: 'êµ¬ê¸€ ì½”ë¦¬ì•„ â€¢ ë°ì´í„°ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸',
                        experience: '12ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 52,
                        specialties: ['ë°ì´í„°ë¶„ì„', 'AI/ML', 'ë°ì´í„°ì§ë¬´', 'ì´ì§ì „ëµ'],
                        price: '100,000ì›/60ë¶„',
                        responseRate: 88,
                        profileImage: 'ğŸ“Š'
                    }
                ],
                'finance_consulting': [
                    {
                        id: 4,
                        name: 'ìµœê¸ˆìœµì „ë¬¸ê°€',
                        title: 'ì‚¼ì„±ì¦ê¶Œ â€¢ ê¸ˆìœµê¶Œ í˜„ì§ì',
                        experience: '18ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 93,
                        specialties: ['ê¸ˆìœµê¶Œì…ì‚¬', 'íˆ¬ììƒí’ˆ', 'CFAì¤€ë¹„', 'ê¸ˆìœµë©´ì ‘'],
                        price: '70,000ì›/60ë¶„',
                        responseRate: 97,
                        profileImage: 'ğŸ’°'
                    },
                    {
                        id: 5,
                        name: 'ì •ì»¨ì„¤í„´íŠ¸',
                        title: 'ë§¥í‚¨ì§€ â€¢ ì „ëµ ì»¨ì„¤í„´íŠ¸',
                        experience: '10ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 76,
                        specialties: ['ê²½ì˜ì»¨ì„¤íŒ…', 'ì¼€ì´ìŠ¤ë©´ì ‘', 'ë…¼ë¦¬ì ì‚¬ê³ ', 'MBAì¤€ë¹„'],
                        price: '120,000ì›/90ë¶„',
                        responseRate: 94,
                        profileImage: 'ğŸ“‹'
                    },
                    {
                        id: 6,
                        name: 'í•œíšŒê³„ì‚¬',
                        title: 'ë”œë¡œì´íŠ¸ â€¢ íšŒê³„ ë§¤ë‹ˆì €',
                        experience: '14ë…„ ê²½ë ¥',
                        rating: 4.7,
                        reviews: 45,
                        specialties: ['íšŒê³„ë²•ì¸', 'CPAì¤€ë¹„', 'ê°ì‚¬ì—…ë¬´', 'íšŒê³„ì»¤ë¦¬ì–´'],
                        price: '90,000ì›/60ë¶„',
                        responseRate: 96,
                        profileImage: 'ğŸ“ˆ'
                    }
                ],
                'marketing_planning': [
                    {
                        id: 7,
                        name: 'ìœ¤ë§ˆì¼€í„°',
                        title: 'LGì „ì â€¢ ë§ˆì¼€íŒ… íŒ€ì¥',
                        experience: '12ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 68,
                        specialties: ['ë¸Œëœë“œë§ˆì¼€íŒ…', 'ë””ì§€í„¸ë§ˆì¼€íŒ…', 'ë§ˆì¼€íŒ…ì „ëµ', 'ìº í˜ì¸ê¸°íš'],
                        price: '70,000ì›/60ë¶„',
                        responseRate: 91,
                        profileImage: 'ğŸ“±'
                    },
                    {
                        id: 8,
                        name: 'ì¡°ê¸°íšì',
                        title: 'SKí…”ë ˆì½¤ â€¢ ì‚¬ì—…ê¸°íš ì°¨ì¥',
                        experience: '16ë…„ ê²½ë ¥',
                        rating: 4.9,
                        reviews: 84,
                        specialties: ['ì‚¬ì—…ê¸°íš', 'ì „ëµìˆ˜ë¦½', 'í”„ë¡œì íŠ¸ê´€ë¦¬', 'MBAê²½í—˜'],
                        price: '80,000ì›/60ë¶„',
                        responseRate: 89,
                        profileImage: 'ğŸ¯'
                    },
                    {
                        id: 9,
                        name: 'ë¬¸UXë””ìì´ë„ˆ',
                        title: 'í† ìŠ¤ â€¢ UXë””ìì¸ ë¦¬ë“œ',
                        experience: '9ë…„ ê²½ë ¥',
                        rating: 4.8,
                        reviews: 57,
                        specialties: ['UXë””ìì¸', 'ì„œë¹„ìŠ¤ê¸°íš', 'ë””ìì¸ë©´ì ‘', 'í¬íŠ¸í´ë¦¬ì˜¤'],
                        price: '85,000ì›/60ë¶„',
                        responseRate: 93,
                        profileImage: 'ğŸ¨'
                    }
                ]
            }); */

            // ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                const loadExperts = async () => {
                    try {
                        setLoading(true);
                        
                        if (!supabase) {
                            // ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ê¸°ì¡´ ë°ì´í„° ì‚¬ìš©
                            setLoading(false);
                            return;
                        }

                        // Supabaseì—ì„œ ì „ë¬¸ê°€ ë°ì´í„° ë¡œë“œ
                        const { data: experts, error } = await supabase
                            .from('experts')
                            .select(`
                                *,
                                user_profiles!experts_user_id_fkey(nickname, email)
                            `)
                            .eq('is_verified', true)
                            .eq('is_active', true);

                        if (error) throw error;

                        // ì¹´í…Œê³ ë¦¬ë³„ë¡œ í˜„ì§ì ë¶„ë¥˜
                        const categorizedExperts = {
                            tech_development: [],
                            finance_consulting: [],
                            marketing_planning: []
                        };

                        experts?.forEach(expert => {
                            const category = expert.industry?.toLowerCase() || 'tech_development';
                            const mappedCategory = {
                                'technology': 'tech_development',
                                'it': 'tech_development',
                                'finance': 'finance_consulting',
                                'consulting': 'finance_consulting',
                                'marketing': 'marketing_planning',
                                'planning': 'marketing_planning'
                            }[category] || category;

                            if (categorizedExperts[mappedCategory]) {
                                categorizedExperts[mappedCategory].push({
                                    id: expert.id,
                                    name: expert.name || expert.user_profiles?.nickname || 'í˜„ì§ì',
                                    title: expert.title || expert.company + ' â€¢ ' + expert.position,
                                    experience: `${expert.experience_years || 5}ë…„ ê²½ë ¥`,
                                    rating: expert.average_rating || 4.5,
                                    reviews: expert.total_reviews || 0,
                                    specialties: expert.specialties || ['ì·¨ì—…ë©˜í† ë§'],
                                    price: `${(expert.hourly_rate || 50000).toLocaleString()}ì›/60ë¶„`,
                                    responseRate: expert.response_rate || 95,
                                    profileImage: expert.profile_image || 'ğŸ‘¨â€ğŸ’¼'
                                });
                            }
                        });

                        // ì‹¤ì œ Supabase ë°ì´í„°ë§Œ ì‚¬ìš©

                        setExpertData(categorizedExperts);
                    } catch (error) {
                        console.error('ì „ë¬¸ê°€ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                        // ì—ëŸ¬ ì‹œ ê¸°ë³¸ ë°ì´í„° ìœ ì§€
                    } finally {
                        setLoading(false);
                    }
                };

                loadExperts();
            }, []);

            // ğŸ” ê²€ìƒ‰ ë””ë°”ìš´ì‹± í•¨ìˆ˜
            const handleSearchInput = (value) => {
                setSearchKeyword(value);
                setSearchLoading(true);
                
                // ê¸°ì¡´ íƒ€ì´ë¨¸ í´ë¦¬ì–´
                if (searchDebounceTimer) {
                    clearTimeout(searchDebounceTimer);
                }
                
                // 500ms í›„ ê²€ìƒ‰ ì‹¤í–‰
                const timer = setTimeout(() => {
                    setSearchLoading(false);
                }, 500);
                
                setSearchDebounceTimer(timer);
            };
            
            // ğŸ¯ í˜„ì§ì í•„í„°ë§ ë° ì •ë ¬ í•¨ìˆ˜
            const getFilteredAndSortedExperts = () => {
                let experts = expertData[activeCategory] || [];
                
                // 1. í…ìŠ¤íŠ¸ ê²€ìƒ‰ í•„í„°ë§
                if (searchKeyword.trim()) {
                    const keyword = searchKeyword.toLowerCase();
                    experts = experts.filter(expert => {
                        return (
                            expert.name?.toLowerCase().includes(keyword) ||
                            expert.title?.toLowerCase().includes(keyword) ||
                            expert.company?.toLowerCase().includes(keyword) ||
                            expert.specialties?.some(s => s.toLowerCase().includes(keyword))
                        );
                    });
                }
                
                // 2. ê²½ë ¥ í•„í„°ë§
                if (searchFilters.minExperience > 0) {
                    experts = experts.filter(expert => {
                        const years = expert.experience_years || 
                                    (expert.experience?.match(/\d+/) ? parseInt(expert.experience.match(/\d+/)[0]) : 0);
                        return years >= searchFilters.minExperience;
                    });
                }
                
                // 3. ê°€ê²© í•„í„°ë§
                if (searchFilters.maxPrice < 500000) {
                    experts = experts.filter(expert => {
                        const price = expert.hourly_rate || 
                                    (expert.price?.match(/[\d,]+/) ? parseInt(expert.price.replace(/,/g, '').match(/\d+/)[0]) : 0);
                        return price <= searchFilters.maxPrice;
                    });
                }
                
                // 4. í‰ì  í•„í„°ë§
                if (searchFilters.minRating > 0) {
                    experts = experts.filter(expert => {
                        const rating = expert.rating || expert.rating_average || 0;
                        return rating >= searchFilters.minRating;
                    });
                }
                
                // 5. ì •ë ¬
                experts.sort((a, b) => {
                    switch (searchFilters.sortBy) {
                        case 'price':
                            const priceA = a.hourly_rate || (a.price?.match(/[\d,]+/) ? parseInt(a.price.replace(/,/g, '').match(/\d+/)[0]) : 0);
                            const priceB = b.hourly_rate || (b.price?.match(/[\d,]+/) ? parseInt(b.price.replace(/,/g, '').match(/\d+/)[0]) : 0);
                            return priceA - priceB;
                        case 'experience':
                            const expA = a.experience_years || (a.experience?.match(/\d+/) ? parseInt(a.experience.match(/\d+/)[0]) : 0);
                            const expB = b.experience_years || (b.experience?.match(/\d+/) ? parseInt(b.experience.match(/\d+/)[0]) : 0);
                            return expB - expA;
                        case 'reviews':
                            return (b.reviews || b.review_count || 0) - (a.reviews || a.review_count || 0);
                        case 'rating':
                        default:
                            return (b.rating || b.rating_average || 0) - (a.rating || a.rating_average || 0);
                    }
                });
                
                return experts;
            };

            const currentExperts = getFilteredAndSortedExperts();
            const currentCategory = expertCategories[activeCategory];

            // ë¡œë”© ìƒíƒœ ë Œë”ë§
            if (loading) {
                return (
                    <div className="space-y-6">
                        <div className="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg">
                            <div className="text-center">
                                <div className="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                                <h3 className="text-lg font-bold text-gray-800 mb-2">í˜„ì§ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
                                <p className="text-gray-600">ìµœì‹  í˜„ì§ì ë©˜í†  ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {/* ì „ë¬¸ê°€ ëª©ë¡ ì„¹ì…˜ */}
                    <div className={`bg-gradient-to-r ${currentCategory.bgColor} p-6 rounded-lg`}>
                        {/* í—¤ë” */}
                        <div className="mb-6">
                            <div className="text-center mb-4">
                                <h3 className="text-lg md:text-xl font-bold text-gray-800 no-break-korean">
                                    ğŸ¯ ê´€ì‹¬ìˆëŠ” ë¶„ì•¼ì˜ í˜„ì§ìì—ê²Œ ì •ë³´ë¥¼ ì–»ìœ¼ì„¸ìš”!
                                </h3>
                            </div>

                            {/* ğŸ” ê²€ìƒ‰ ë° í•„í„° ì„¹ì…˜ */}
                            <div className="bg-white p-4 rounded-lg shadow-sm border space-y-4">
                                {/* ê²€ìƒ‰ ë°” */}
                                <div className="relative">
                                    <div className="relative">
                                        <input
                                            type="text"
                                            placeholder="í˜„ì§ì ì´ë¦„, íšŒì‚¬, ì „ë¬¸ë¶„ì•¼ ê²€ìƒ‰..."
                                            value={searchKeyword}
                                            onChange={(e) => handleSearchInput(e.target.value)}
                                            className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                        />
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            {searchLoading ? (
                                                <div className="animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full"></div>
                                            ) : (
                                                <span className="text-gray-400">ğŸ”</span>
                                            )}
                                        </div>
                                        {searchKeyword && (
                                            <button
                                                onClick={() => {
                                                    setSearchKeyword('');
                                                    if (searchDebounceTimer) clearTimeout(searchDebounceTimer);
                                                }}
                                                className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                                            >
                                                âœ•
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* í•„í„° ë° ì •ë ¬ */}
                                <div className="flex flex-wrap items-center justify-between gap-3">
                                    {/* ì •ë ¬ ì˜µì…˜ */}
                                    <div className="flex items-center space-x-2">
                                        <span className="text-sm text-gray-600">ì •ë ¬:</span>
                                        <select
                                            value={searchFilters.sortBy}
                                            onChange={(e) => setSearchFilters({...searchFilters, sortBy: e.target.value})}
                                            className="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"
                                        >
                                            <option value="rating">í‰ì ìˆœ</option>
                                            <option value="price">ê°€ê²©ë‚®ì€ìˆœ</option>
                                            <option value="experience">ê²½ë ¥ë§ì€ìˆœ</option>
                                            <option value="reviews">í›„ê¸°ë§ì€ìˆœ</option>
                                        </select>
                                    </div>

                                    {/* ê³ ê¸‰ í•„í„° í† ê¸€ */}
                                    <button
                                        onClick={() => setSearchFilters({...searchFilters, showAdvancedFilters: !searchFilters.showAdvancedFilters})}
                                        className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${
                                            searchFilters.showAdvancedFilters 
                                                ? 'bg-blue-100 text-blue-700 border border-blue-300' 
                                                : 'bg-gray-100 text-gray-600 border border-gray-300'
                                        }`}
                                    >
                                        ğŸ›ï¸ ìƒì„¸ í•„í„° {searchFilters.showAdvancedFilters ? 'ì ‘ê¸°' : 'í¼ì¹˜ê¸°'}
                                    </button>

                                    {/* ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ */}
                                    <div className="text-sm text-gray-600">
                                        ì´ <span className="font-semibold text-blue-600">{currentExperts.length}</span>ëª…
                                        {searchKeyword && ` (ê²€ìƒ‰ì–´: "${searchKeyword}")`}
                                    </div>
                                </div>

                                {/* ê³ ê¸‰ í•„í„° íŒ¨ë„ */}
                                {searchFilters.showAdvancedFilters && (
                                    <div className="bg-gray-50 p-4 rounded-md space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            {/* ê²½ë ¥ í•„í„° */}
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    ìµœì†Œ ê²½ë ¥: {searchFilters.minExperience}ë…„
                                                </label>
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="20"
                                                    value={searchFilters.minExperience}
                                                    onChange={(e) => setSearchFilters({...searchFilters, minExperience: parseInt(e.target.value)})}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                />
                                                <div className="flex justify-between text-xs text-gray-500">
                                                    <span>ì‹ ì…</span>
                                                    <span>20ë…„+</span>
                                                </div>
                                            </div>

                                            {/* ê°€ê²© í•„í„° */}
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    ìµœëŒ€ ìƒë‹´ë£Œ: {searchFilters.maxPrice.toLocaleString()}ì›
                                                </label>
                                                <input
                                                    type="range"
                                                    min="30000"
                                                    max="500000"
                                                    step="10000"
                                                    value={searchFilters.maxPrice}
                                                    onChange={(e) => setSearchFilters({...searchFilters, maxPrice: parseInt(e.target.value)})}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                />
                                                <div className="flex justify-between text-xs text-gray-500">
                                                    <span>3ë§Œì›</span>
                                                    <span>50ë§Œì›+</span>
                                                </div>
                                            </div>

                                            {/* í‰ì  í•„í„° */}
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    ìµœì†Œ í‰ì : {searchFilters.minRating === 0 ? 'ì „ì²´' : `${searchFilters.minRating}ì `}
                                                </label>
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="5"
                                                    step="0.5"
                                                    value={searchFilters.minRating}
                                                    onChange={(e) => setSearchFilters({...searchFilters, minRating: parseFloat(e.target.value)})}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                />
                                                <div className="flex justify-between text-xs text-gray-500">
                                                    <span>ì „ì²´</span>
                                                    <span>5ì </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* í•„í„° ì´ˆê¸°í™” */}
                                        <div className="flex justify-end">
                                            <button
                                                onClick={() => {
                                                    setSearchFilters({
                                                        minExperience: 0,
                                                        maxPrice: 500000,
                                                        minRating: 0,
                                                        sortBy: 'rating',
                                                        showAdvancedFilters: searchFilters.showAdvancedFilters
                                                    });
                                                    setSearchKeyword('');
                                                }}
                                                className="px-4 py-2 bg-gray-600 text-white text-sm rounded-md hover:bg-gray-700 transition-colors"
                                            >
                                                ğŸ”„ í•„í„° ì´ˆê¸°í™”
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {/* ì „ë¬¸ê°€ ì „ìš© ì„œë¹„ìŠ¤ ê²Œì‹œ ì„¹ì…˜ */}
                        {isExpert && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div className="flex flex-col md:flex-row items-center justify-between gap-3">
                                    <div className="text-center md:text-left">
                                        <p className="text-sm font-medium text-blue-800 no-break-korean">
                                            ğŸ’¡ ì „ë¬¸ê°€ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆì–´ìš”!
                                        </p>
                                        <p className="text-xs text-blue-600 mt-1">
                                            êµ¬ì§ìë“¤ì´ ì˜ˆì•½í•˜ê³  ë©˜í† ë§ë°›ì„ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => setShowWriteModal(true)}
                                        className="px-4 py-2.5 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors shadow-md no-break-korean whitespace-nowrap"
                                        title="ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°"
                                    >
                                        ğŸ“ ë‚´ ì„œë¹„ìŠ¤ ê²Œì‹œí•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* ì¹´í…Œê³ ë¦¬ íƒ­ */}
                    <div className="grid grid-cols-3 gap-2 mb-6">
                        {Object.entries(expertCategories).map(([key, category]) => (
                            <button
                                key={key}
                                onClick={() => setActiveCategory(key)}
                                className={`p-3 rounded-lg text-center transition-all duration-300 ${
                                    activeCategory === key
                                        ? `bg-gradient-to-r ${category.color} text-white shadow-lg`
                                        : 'bg-white text-gray-600 hover:bg-gray-50'
                                }`}
                            >
                                <div className="text-base md:text-lg mb-1">{category.icon}</div>
                                <div className="font-semibold text-xs leading-tight no-break-korean responsive-text-sm">{category.name}</div>
                            </button>
                        ))}
                    </div>

                    {/* ì „ë¬¸ê°€ ëª©ë¡ */}
                    <div className="space-y-4 mb-6">
                        {loading ? (
                            // ë¡œë”© ìƒíƒœ
                            <>
                                {[1, 2, 3, 4].map(i => (
                                    <div key={i} className="bg-white rounded-lg p-4 shadow-md animate-pulse">
                                        <div className="flex items-start gap-4">
                                            <div className="w-12 h-12 bg-gray-200 rounded-full"></div>
                                            <div className="flex-1">
                                                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                                                <div className="h-3 bg-gray-200 rounded w-1/2 mb-2"></div>
                                                <div className="h-3 bg-gray-200 rounded w-2/3 mb-3"></div>
                                                <div className="h-8 bg-gray-200 rounded w-20"></div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </>
                        ) : currentExperts.length === 0 ? (
                            // ì „ë¬¸ê°€ê°€ ì—†ëŠ” ê²½ìš°
                            <div className="text-center py-8 bg-white rounded-lg">
                                <div className="text-4xl mb-4">ğŸ”</div>
                                <p className="text-gray-600 mb-2">í˜„ì¬ ì´ ë¶„ì•¼ ì „ë¬¸ê°€ê°€ ë“±ë¡ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤</p>
                                <p className="text-sm text-gray-500">ê³§ ì „ë¬¸ê°€ë“¤ì„ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                            </div>
                        ) : (
                            currentExperts.map(expert => (
                            <div key={expert.id} className="bg-white rounded-lg p-4 shadow-md">
                                <div className="flex items-start gap-4">
                                    {/* í”„ë¡œí•„ */}
                                    <div className="text-3xl">{expert.profileImage || expert.profile_image_url || 'ğŸ‘¨â€ğŸ’¼'}</div>
                                    
                                    {/* ì •ë³´ */}
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-1">
                                            <h4 className="font-bold text-gray-800 break-keep">{expert.name}</h4>
                                            <div className="flex items-center gap-1">
                                                <span className="text-yellow-500">â­</span>
                                                <span className="text-sm font-medium">{expert.rating || expert.rating_average || 5.0}</span>
                                                <span className="text-xs text-gray-500">({expert.reviews || expert.review_count || 0})</span>
                                            </div>
                                        </div>
                                        
                                        <p className="text-sm text-gray-600 mb-2 break-keep">
                                            {expert.title || `${expert.company} â€¢ ${expert.experience || expert.experience_years + 'ë…„ ê²½ë ¥'}`}
                                        </p>
                                        <p className="text-xs text-gray-500 mb-2 break-keep">
                                            {expert.experience || (expert.experience_years ? `${expert.experience_years}ë…„ ê²½ë ¥` : 'ê²½ë ¥ ì •ë³´ ì—†ìŒ')}
                                        </p>
                                        
                                        {/* ì „ë¬¸ë¶„ì•¼ íƒœê·¸ */}
                                        <div className="flex flex-wrap gap-1 mb-3">
                                            {(expert.specialties || []).map((specialty, index) => (
                                                <span key={index} className="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded no-break-korean">
                                                    {specialty}
                                                </span>
                                            ))}
                                        </div>
                                        
                                        {/* í•˜ë‹¨ ì •ë³´ */}
                                        <div className="flex items-center justify-between">
                                            <div className="text-sm">
                                                <span className="font-semibold text-blue-600">
                                                    {expert.price || (expert.hourly_rate ? `${expert.hourly_rate.toLocaleString()}ì›/ì‹œê°„` : 'ìƒë‹´ë£Œ í˜‘ì˜')}
                                                </span>
                                                <span className="text-xs text-gray-500 ml-2">
                                                    ì‘ë‹µë¥  {expert.responseRate || expert.response_rate || 90}%
                                                </span>
                                            </div>
                                            <button 
                                                onClick={() => {
                                                    if (currentUser?.isGuest) {
                                                        setShowSignupModal(true);
                                                        return;
                                                    }
                                                    setSelectedExpert(expert);
                                                    setShowBookingModal(true);
                                                }}
                                                className="px-3 md:px-4 py-2 bg-blue-500 text-white rounded-lg text-xs md:text-sm font-medium hover:bg-blue-600 transition-colors no-break-korean"
                                            >
                                                ìƒë‹´ ì˜ˆì•½
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            ))
                        )}
                    </div>

                    {/* ì•ˆë‚´ ë©”ì‹œì§€ */}
                    <div className="bg-white p-4 rounded-lg">
                        <h4 className="font-bold text-gray-800 mb-2">ğŸ›¡ï¸ ì•ˆì „í•œ ì „ë¬¸ê°€ í”Œë«í¼</h4>
                        <div className="text-sm text-gray-600 space-y-1">
                            <p>âœ… ëª¨ë“  ì „ë¬¸ê°€ ìê²©ì¦ ê²€ì¦ ì™„ë£Œ</p>
                            <p>âœ… ê¸ˆìœµìƒí’ˆ íŒë§¤ ì™„ì „ ê¸ˆì§€ (ìˆœìˆ˜ ìƒë‹´ë§Œ)</p>
                            <p>âœ… íˆ¬ëª…í•œ í›„ê¸° ì‹œìŠ¤í…œ</p>
                            <p>âœ… ë¹„ëŒ€ë©´ ìƒë‹´ìœ¼ë¡œ ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ê²Œ</p>
                            <p>ğŸš§ í˜„ì¬ ì‹œë²” ìš´ì˜ ì¤‘ - 2025ë…„ 3ì›” ì •ì‹ ì˜¤í”ˆ ì˜ˆì •</p>
                        </div>
                    </div>
                    
                    {/* ëª¨ë‹¬ë“¤ */}
                    {/* ì˜ˆì•½ ëª¨ë‹¬ */}
                    {showBookingModal && selectedExpert && (
                        <ConsultationBookingComponent
                            expert={selectedExpert}
                            currentUser={currentUser}
                            onClose={() => {
                                setShowBookingModal(false);
                                setSelectedExpert(null);
                            }}
                        />
                    )}

                    {/* ì „ë¬¸ê°€ ê¸€ì“°ê¸° ëª¨ë‹¬ */}
                    {showWriteModal && (
                        <ExpertPostWriteModal
                            isOpen={showWriteModal}
                            onClose={() => setShowWriteModal(false)}
                            currentUser={currentUser}
                            onSuccess={handleWriteSuccess}
                            isAdminUser={isAdminUser}
                        />
                    )}
                </div>
            );
        };

        // ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        const PostDetailPage = ({ post, setCurrentView, currentUser, checkCalculationForInteraction, isAdminUser }) => {
            const [replies, setReplies] = useState([]);
            const [newReply, setNewReply] = useState('');
            const [likes, setLikes] = useState(post.likes || 0);
            const [isLiked, setIsLiked] = useState(false);

            // ëŒ“ê¸€ ë¡œë“œ
            useEffect(() => {
                const loadReplies = async () => {
                    try {
                        if (supabase) {
                            const { data, error } = await supabase
                                .from('post_comments')
                                .select('*')
                                .eq('post_id', post.id)
                                .order('created_at', { ascending: true });
                            
                            if (error) throw error;
                            setReplies(data || []);
                        }
                    } catch (error) {
                        console.error('ëŒ“ê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
                        setReplies([]);
                    }
                };

                loadReplies();
            }, [post.id]);

            return (
                <div className="max-w-4xl mx-auto">
                    {/* ë’¤ë¡œê°€ê¸° í—¤ë” */}
                    <div className="flex items-center mb-6">
                        <button 
                            onClick={() => setCurrentView('community')}
                            className="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
                        >
                            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                            </svg>
                            ì»¤ë®¤ë‹ˆí‹°ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>

                    {/* ê²Œì‹œê¸€ ìƒì„¸ */}
                    <div className="bg-white rounded-lg shadow-md overflow-hidden">
                        <div className="p-6">
                            {/* ì œëª© */}
                            <h1 className="text-2xl font-bold text-gray-800 mb-4">{post.title}</h1>
                            
                            {/* ì‘ì„±ì ì •ë³´ */}
                            <div className="flex items-center text-sm text-gray-500 mb-6">
                                <span className="bg-gray-100 px-2 py-1 rounded mr-2">ìµëª…</span>
                                <span>{new Date(post.created_at).toLocaleDateString()}</span>
                                <span className="mx-2">â€¢</span>
                                <span>ì¡°íšŒ {post.views || 0}</span>
                            </div>
                            
                            {/* ë³¸ë¬¸ */}
                            <div className="prose max-w-none mb-8">
                                <p className="text-gray-800 whitespace-pre-wrap leading-relaxed">{post.content}</p>
                            </div>
                            
                            {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                            <div className="flex items-center space-x-6 py-4 border-t border-gray-200">
                                <button 
                                    onClick={async () => {
                                        if (!checkCalculationForInteraction('like_post')) return;
                                        
                                        try {
                                            const newLikesCount = isLiked ? likes - 1 : likes + 1;
                                            
                                            if (supabase) {
                                                const { error } = await supabase
                                                    .from('job_seeker_posts')
                                                    .update({ likes: newLikesCount })
                                                    .eq('id', post.id);
                                                
                                                if (error) throw error;
                                            }
                                            
                                            setLikes(newLikesCount);
                                            setIsLiked(!isLiked);
                                        } catch (error) {
                                            console.error('ì¢‹ì•„ìš” ì˜¤ë¥˜:', error);
                                        }
                                    }}
                                    className={`flex items-center transition-colors ${
                                        isLiked 
                                            ? 'text-blue-600 hover:text-blue-800' 
                                            : 'text-gray-600 hover:text-blue-600'
                                    }`}
                                >
                                    <span className="mr-1">{isLiked ? 'ğŸ‘' : 'ğŸ‘'}</span>
                                    <span>ê³µê° {likes}</span>
                                </button>
                                <button className="flex items-center text-gray-600 hover:text-gray-800 transition-colors">
                                    <span className="mr-1">ğŸ’¬</span>
                                    <span>ëŒ“ê¸€ {replies.length}</span>
                                </button>
                                <button 
                                    onClick={() => {
                                        if (navigator.share) {
                                            navigator.share({
                                                title: post.title,
                                                text: post.content.substring(0, 100) + '...',
                                                url: window.location.href
                                            });
                                        } else {
                                            // í´ë¦½ë³´ë“œì— ë³µì‚¬
                                            navigator.clipboard.writeText(window.location.href)
                                                .then(() => alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'))
                                                .catch(() => {
                                                    // í´ë°±: í…ìŠ¤íŠ¸ ì„ íƒ
                                                    const textArea = document.createElement('textarea');
                                                    textArea.value = window.location.href;
                                                    document.body.appendChild(textArea);
                                                    textArea.select();
                                                    document.execCommand('copy');
                                                    document.body.removeChild(textArea);
                                                    alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                                                });
                                        }
                                    }}
                                    className="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
                                >
                                    <span className="mr-1">ğŸ“¤</span>
                                    <span>ê³µìœ </span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* ëŒ“ê¸€ ì„¹ì…˜ */}
                    <div className="bg-white rounded-lg shadow-md mt-6 p-6">
                        <h3 className="text-lg font-semibold mb-4">ëŒ“ê¸€ {replies.length}ê°œ</h3>
                        
                        {/* ëŒ“ê¸€ ì‘ì„± */}
                        <div className="mb-6">
                            <textarea
                                value={newReply}
                                onChange={(e) => setNewReply(e.target.value)}
                                placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                                className="w-full p-3 border border-gray-200 rounded-lg resize-none"
                                rows="3"
                            />
                            <div className="flex justify-end mt-2">
                                <button
                                    onClick={async () => {
                                        if (!checkCalculationForInteraction('write_reply')) return;
                                        
                                        if (newReply.trim()) {
                                            try {
                                                const replyData = {
                                                    post_id: post.id,
                                                    content: newReply.trim(),
                                                    author_nickname: currentUser?.nickname || currentUser?.email || 'ìµëª…',
                                                    user_hash: currentUser?.user_hash || null,
                                                    is_anonymous: true,
                                                    created_at: new Date().toISOString()
                                                };

                                                if (supabase) {
                                                    const { data, error } = await supabase
                                                        .from('post_comments')
                                                        .insert([replyData])
                                                        .select();
                                                    
                                                    if (error) throw error;
                                                    setReplies([...replies, data[0]]);
                                                } else {
                                                    // ë¡œì»¬ ìƒíƒœì—ë§Œ ì¶”ê°€
                                                    setReplies([...replies, { ...replyData, id: Date.now() }]);
                                                }
                                                
                                                setNewReply('');
                                            } catch (error) {
                                                console.error('ëŒ“ê¸€ ì €ì¥ ì˜¤ë¥˜:', error);
                                                alert('ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                            }
                                        }
                                    }}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm"
                                >
                                    ëŒ“ê¸€ ì‘ì„±
                                </button>
                            </div>
                        </div>

                        {/* ëŒ“ê¸€ ëª©ë¡ */}
                        <div className="space-y-4">
                            {replies.length === 0 ? (
                                <div className="text-center py-8 text-gray-500">
                                    <div className="text-4xl mb-2">ğŸ’¬</div>
                                    <p>ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                                </div>
                            ) : (
                                replies.map((reply, index) => (
                                    <div key={reply.id || index} className="border-b border-gray-100 pb-4">
                                        <div className="flex items-center justify-between text-sm text-gray-500 mb-2">
                                            <div className="flex items-center">
                                                <span className="bg-blue-100 text-blue-600 px-2 py-1 rounded mr-2">
                                                    {reply.author_nickname || 'ìµëª…'}
                                                </span>
                                                <span>{new Date(reply.created_at).toLocaleDateString('ko-KR')} {new Date(reply.created_at).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</span>
                                            </div>
                                        </div>
                                        <p className="text-gray-800 leading-relaxed">{reply.content}</p>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        

        // ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ê¸° (ì»¤ë¦¬ì–´ ë©˜í† ë§ ì„œë¹„ìŠ¤)
        // ì¸ì‚¬ì´ë“œì¡ ì·¨ì—…ê²½ìŸë ¥ ê³„ì‚°ê¸° (6ë‹¨ê³„ ì§„ë‹¨ ì‹œìŠ¤í…œ)
        const CareerCompetitivenessCalculator = ({ savedCalculations = [], onCalculationComplete, setCurrentView, currentUser, showNotification, setAuthMode, setShowSaveResultSignupModal }) => {
            const [calculatorStep, setCalculatorStep] = useState(1);
            const [formData, setFormData] = useState({
                // 1ë‹¨ê³„: ê¸°ë³¸ì •ë³´
                age: '', educationLevel: '', major: '', targetIndustry: '', targetJob: '', currentStatus: '',
                // 2ë‹¨ê³„: ìŠ¤í‚¬ì—­ëŸ‰ 
                technicalSkills: [], certifications: [], languageSkills: [], portfolioProjects: '', portfolioQuality: '',
                // 3ë‹¨ê³„: ê²½í—˜ë¶„ì„
                internshipExperience: '', projectExperience: '', activityExperience: '', awardHistory: '', leadershipExperience: '',
                // 4ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬
                industryConnections: '', referenceLetters: '', mentorRelationships: '', socialNetworking: '', professionalCommunity: '',
                // 5ë‹¨ê³„: ì¤€ë¹„í˜„í™©
                resumeQuality: '', coverLetterQuality: '', interviewPreparation: '', applicationCount: '', preparationPeriod: '',
                // 6ë‹¨ê³„: ì‹œì¥ë¶„ì„
                industryGrowth: '', jobDemand: '', competitionLevel: '', salaryExpectation: '', locationFlexibility: ''
            });
            const [calculatorResult, setCalculatorResult] = useState(null);
            const [averageData, setAverageData] = useState(null);
            const [isResultSaved, setIsResultSaved] = useState(false);
            const [showScoreDetail, setShowScoreDetail] = useState(false);

            const handleInputChange = (field, value) => {
                const cleanValue = value === '' ? '' : value;
                setFormData({ ...formData, [field]: cleanValue });
            };

            // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ë©´ì„œ í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            const goToNextStep = (step) => {
                setCalculatorStep(step);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // ë‚˜ì´ ì…ë ¥ ì‹œ í‰ê·  ë°ì´í„° ì—…ë°ì´íŠ¸
            useEffect(() => {
                if (formData.age) {
                    setAverageData(getAverageDataByAge(parseInt(formData.age)));
                }
            }, [formData.age]);

            // ê²½ìŸë ¥ í‰ê°€ ê²°ê³¼ ë‹¤ì‹œ ê³„ì‚°
            useEffect(() => {
                if (calculatorResult && calculatorStep === 7) {
                    calculateCareerResults();
                    setIsResultSaved(false);
                }
            }, [formData]);

            const getAverageDataByAge = (age) => {
                if (age >= 30) return { skillLevel: 85, experienceLevel: 90, networkLevel: 80, preparationLevel: 70, competitionLevel: 60 };
                if (age >= 25) return { skillLevel: 75, experienceLevel: 70, networkLevel: 65, preparationLevel: 80, competitionLevel: 70 };
                if (age >= 20) return { skillLevel: 65, experienceLevel: 50, networkLevel: 45, preparationLevel: 85, competitionLevel: 80 };
                return { skillLevel: 60, experienceLevel: 30, networkLevel: 35, preparationLevel: 90, competitionLevel: 85 };
            };

            // ì ìˆ˜ë¥¼ ë“±ê¸‰ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
            const getGradeFromScore = (score) => {
                if (score >= 90) return { grade: 'S', color: 'text-purple-600', bg: 'bg-purple-50' };
                if (score >= 80) return { grade: 'A', color: 'text-blue-600', bg: 'bg-blue-50' };
                if (score >= 70) return { grade: 'B', color: 'text-green-600', bg: 'bg-green-50' };
                if (score >= 60) return { grade: 'C', color: 'text-yellow-600', bg: 'bg-yellow-50' };
                if (score >= 50) return { grade: 'D', color: 'text-orange-600', bg: 'bg-orange-50' };
                return { grade: 'F', color: 'text-red-600', bg: 'bg-red-50' };
            };
            
            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ì‹œ ì €ì¥ëœ ë°ì´í„° í™•ì¸ë§Œ (ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì•ˆí•¨)
            useEffect(() => {
                const saved = localStorage.getItem('insidejob_calculation_result');
                if (saved) {
                    console.log('ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.');
                }
            }, []);

            // ì·¨ì—…ê²½ìŸë ¥ ê³„ì‚° í•¨ìˆ˜ (6ë‹¨ê³„ ì¢…í•© í‰ê°€)
            const calculateCareerResults = () => {
                const age = parseInt(formData.age);
                
                // 1ë‹¨ê³„: ê¸°ë³¸ì •ë³´ ì ìˆ˜ (20ì )
                let basicScore = 0;
                if (formData.age && formData.educationLevel && formData.major && formData.targetIndustry && formData.targetJob) {
                    basicScore += 5; // ì™„ì „ì„± ì ìˆ˜
                    // ë‚˜ì´ë³„ ê°€ì‚°ì 
                    if (age <= 25) basicScore += 15; // ì‹ ì… ìµœì  ì—°ë ¹
                    else if (age <= 30) basicScore += 12; // ê²½ë ¥ì§ ì‹œì‘
                    else if (age <= 35) basicScore += 8; // ì¤‘ê²¬ê¸‰
                    else basicScore += 5; // ì‹œë‹ˆì–´ê¸‰ ê²½ë ¥
                }
                
                // 2ë‹¨ê³„: ìŠ¤í‚¬ì—­ëŸ‰ ì ìˆ˜ (25ì )
                let skillScore = 0;
                if (formData.technicalSkills && formData.technicalSkills.length > 0) skillScore += 8;
                if (formData.certifications && formData.certifications.length > 0) skillScore += 6;
                if (formData.languageSkills && formData.languageSkills.length > 0) skillScore += 6;
                if (formData.portfolioProjects && formData.portfolioQuality) skillScore += 5;
                
                // 3ë‹¨ê³„: ê²½í—˜ë¶„ì„ ì ìˆ˜ (20ì )
                let experienceScore = 0;
                if (formData.internshipExperience) experienceScore += 6;
                if (formData.projectExperience) experienceScore += 6;
                if (formData.activityExperience) experienceScore += 4;
                if (formData.awardHistory) experienceScore += 2;
                if (formData.leadershipExperience) experienceScore += 2;
                
                // 4ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì ìˆ˜ (15ì )
                let networkScore = 0;
                if (formData.industryConnections) networkScore += 5;
                if (formData.referenceLetters) networkScore += 4;
                if (formData.mentorRelationships) networkScore += 3;
                if (formData.socialNetworking) networkScore += 2;
                if (formData.professionalCommunity) networkScore += 1;
                
                // 5ë‹¨ê³„: ì¤€ë¹„í˜„í™© ì ìˆ˜ (15ì )
                let preparationScore = 0;
                if (formData.resumeQuality) preparationScore += 4;
                if (formData.coverLetterQuality) preparationScore += 4;
                if (formData.interviewPreparation) preparationScore += 3;
                if (formData.applicationCount) preparationScore += 2;
                if (formData.preparationPeriod) preparationScore += 2;
                
                // 6ë‹¨ê³„: ì‹œì¥ë¶„ì„ ì ìˆ˜ (15ì )
                let marketScore = 0;
                if (formData.industryGrowth) marketScore += 4;
                if (formData.jobDemand) marketScore += 4;
                if (formData.competitionLevel) marketScore += 3;
                if (formData.salaryExpectation) marketScore += 2;
                if (formData.locationFlexibility) marketScore += 2;
                
                // ì¢…í•© ì ìˆ˜ ê³„ì‚° (100ì  ë§Œì )
                const totalScore = basicScore + skillScore + experienceScore + networkScore + preparationScore + marketScore;
                
                // ë“±ê¸‰ ì‚°ì •
                let grade = 'Fê¸‰';
                if (totalScore >= 90) grade = 'Sê¸‰';
                else if (totalScore >= 80) grade = 'Aê¸‰';
                else if (totalScore >= 70) grade = 'Bê¸‰';
                else if (totalScore >= 60) grade = 'Cê¸‰';
                else if (totalScore >= 50) grade = 'Dê¸‰';
                
                // ì·¨ì—… ì„±ê³µë¥  ë° ì˜ˆìƒ ê¸°ê°„ ê³„ì‚°
                const successRate = Math.min(95, Math.max(10, totalScore - 5));
                const expectedJobPeriod = totalScore >= 80 ? 2 : totalScore >= 60 ? 4 : totalScore >= 40 ? 6 : 12;
                
                const result = {
                    totalScore: totalScore,
                    grade: grade,
                    skillScore: skillScore,
                    experienceScore: experienceScore,
                    preparationScore: preparationScore,
                    networkScore: networkScore,
                    marketScore: marketScore,
                    basicScore: basicScore,
                    predictedSuccessRate: successRate,
                    estimatedJobPeriod: expectedJobPeriod,
                    scoreBreakdown: {
                        basic: { score: basicScore, maxScore: 20, category: 'ê¸°ë³¸ì •ë³´' },
                        skill: { score: skillScore, maxScore: 25, category: 'ìŠ¤í‚¬ì—­ëŸ‰' },
                        experience: { score: experienceScore, maxScore: 20, category: 'ê²½í—˜ë¶„ì„' },
                        network: { score: networkScore, maxScore: 15, category: 'ë„¤íŠ¸ì›Œí¬' },
                        preparation: { score: preparationScore, maxScore: 15, category: 'ì¤€ë¹„í˜„í™©' },
                        market: { score: marketScore, maxScore: 15, category: 'ì‹œì¥ë¶„ì„' }
                    },
                    recommendations: generateRecommendations(basicScore, skillScore, experienceScore, networkScore, preparationScore, marketScore),
                    peerComparison: generatePeerComparison(totalScore, age, formData.educationLevel, formData.targetIndustry)
                };

                setCalculatorResult(result);
                
                // ì„¸ì…˜ ìƒì„±ì„ ìœ„í•œ ì½œë°± í˜¸ì¶œ
                if (onCalculationComplete) {
                    onCalculationComplete(result);
                }
                
                setCalculatorStep(7); // ê²°ê³¼ ë‹¨ê³„ë¡œ ì´ë™
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // ê°œì„  ì¶”ì²œì‚¬í•­ ìƒì„±
            const generateRecommendations = (basicScore, skillScore, experienceScore, networkScore, preparationScore, marketScore) => {
                const recommendations = [];
                
                if (basicScore < 15) recommendations.push('ëª©í‘œ ì—…ê³„ì™€ ì§ë¬´ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ë¦¬ì„œì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                if (skillScore < 20) recommendations.push('ì§ë¬´ ê´€ë ¨ ê¸°ìˆ  ìŠ¤í‚¬ ë³´ê°•ê³¼ ìê²©ì¦ ì·¨ë“ì„ ê¶Œì¥í•©ë‹ˆë‹¤');
                if (experienceScore < 15) recommendations.push('ì¸í„´ì‹­ì´ë‚˜ í”„ë¡œì íŠ¸ ê²½í—˜ì„ ëŠ˜ë ¤ë³´ì„¸ìš”');
                if (networkScore < 10) recommendations.push('ì—…ê³„ ì„ ë°°ë“¤ê³¼ì˜ ë„¤íŠ¸ì›Œí‚¹ í™œë™ì„ ì‹œì‘í•´ë³´ì„¸ìš”');
                if (preparationScore < 10) recommendations.push('ì´ë ¥ì„œì™€ ìê¸°ì†Œê°œì„œ í’ˆì§ˆ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤');
                if (marketScore < 10) recommendations.push('ëª©í‘œ ì—…ê³„ì˜ ì‹œì¥ ë™í–¥ ë¶„ì„ì„ ë” ìì„¸íˆ í•´ë³´ì„¸ìš”');
                
                return recommendations;
            };

            // ë˜ë˜ ë¹„êµ ë°ì´í„° ìƒì„±
            const generatePeerComparison = (totalScore, age, educationLevel, targetIndustry) => {
                const peerAverage = age <= 25 ? 65 : age <= 30 ? 70 : 75;
                const industryAverage = targetIndustry === 'tech_development' ? 75 : 
                                     targetIndustry === 'finance_consulting' ? 78 : 70;
                
                return {
                    myScore: totalScore,
                    peerAverage: peerAverage,
                    industryAverage: industryAverage,
                    percentile: Math.round((totalScore / 100) * 100)
                };
            };

            // ì ìˆ˜ ìƒì„¸ë³´ê¸° í† ê¸€
            const toggleScoreDetail = () => {
                setShowScoreDetail(!showScoreDetail);
            };
            
            
            // ê³„ì‚°ê²°ê³¼ ì €ì¥ í•¨ìˆ˜ 
            const saveCalculationResult = () => {
                if (!calculatorResult) return;
                
                // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìì¸ ê²½ìš° ì €ì¥ìš© íšŒì›ê°€ì… ëª¨ë‹¬ í‘œì‹œ
                if (currentUser?.isGuest) {
                    setShowSaveResultSignupModal(true);
                    return;
                }
                
                // íšŒì› ì‚¬ìš©ìì¸ ê²½ìš° ì§ì ‘ ì €ì¥
                const savedResult = {
                    ...calculatorResult,
                    formData: formData,
                    savedAt: new Date().toISOString(),
                    calculatedAt: new Date().toISOString()
                };
                
                localStorage.setItem('insidejob_calculation_result', JSON.stringify(savedResult));
                setIsResultSaved(true);
                
                showNotification('ì €ì¥ ì™„ë£Œ', 'ì§„ë‹¨ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾\në§ˆì´í˜ì´ì§€ì—ì„œ ì–¸ì œë“  ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
            };
            
            // ì €ì¥ëœ ì§„ë‹¨ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸° (localStorage)
            const loadCalculationResult = () => {
                const saved = localStorage.getItem('insidejob_calculation_result');
                if (saved) {
                    try {
                        const savedData = JSON.parse(saved);
                        setFormData(savedData.formData);
                        setCalculatorResult(savedData);
                        setCalculatorStep(7); // ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™
                        setIsResultSaved(true);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        showNotification('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ', 'ì €ì¥ëœ ì§„ë‹¨ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ğŸ“Š', 'success');
                    } catch (error) {
                        console.error('ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        showNotification('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } else {
                    showNotification('ì €ì¥ëœ ë°ì´í„° ì—†ìŒ', 'ì•„ì§ ì €ì¥ëœ ì§„ë‹¨ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                }
            };
            

            // ì»¤ë®¤ë‹ˆí‹° ì´ë™
            const joinCommunity = () => {
                setCurrentView('community');
            };


            // 1ë‹¨ê³„ ë Œë”ë§
            if (calculatorStep === 1) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => setCurrentView('main')}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ¯ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨</h1>
                                <p className="text-xl text-gray-600">ê¸°ë³¸ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '16.67%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">1ë‹¨ê³„ / 6ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="space-y-6">
                                    <div className="mb-6">
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ‚ ë‚˜ì´</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            pattern="[0-9]*"
                                            value={formData.age}
                                            onChange={(e) => {
                                                const numValue = e.target.value.replace(/[^0-9]/g, '');
                                                handleInputChange('age', numValue);
                                            }}
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            placeholder=""
                                            autoComplete="off"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ“ ìµœì¢…í•™ë ¥</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.educationLevel}
                                            onChange={(e) => handleInputChange('educationLevel', e.target.value)}
                                        >
                                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                            <option value="high_school">ê³ ë“±í•™êµ ì¡¸ì—…</option>
                                            <option value="college">ì „ë¬¸ëŒ€ ì¡¸ì—…</option>
                                            <option value="university">4ë…„ì œ ëŒ€í•™ ì¡¸ì—…</option>
                                            <option value="graduate">ëŒ€í•™ì› ì´ìƒ</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ“š ì „ê³µë¶„ì•¼</label>
                                        <input
                                            type="text"
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.major}
                                            onChange={(e) => handleInputChange('major', e.target.value)}
                                            placeholder="ì˜ˆ: ì»´í“¨í„°ê³µí•™, ê²½ì˜í•™, ë””ìì¸ ë“±"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ¢ í¬ë§ ì—…ê³„</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.targetIndustry}
                                            onChange={(e) => handleInputChange('targetIndustry', e.target.value)}
                                        >
                                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                            <option value="tech_development">IT/ê°œë°œ</option>
                                            <option value="finance_consulting">ê¸ˆìœµ/ì»¨ì„¤íŒ…</option>
                                            <option value="marketing_planning">ë§ˆì¼€íŒ…/ê¸°íš</option>
                                            <option value="manufacturing">ì œì¡°/ì—”ì§€ë‹ˆì–´ë§</option>
                                            <option value="public_education">ê³µê³µ/êµìœ¡</option>
                                            <option value="service_retail">ì„œë¹„ìŠ¤/ìœ í†µ</option>
                                            <option value="media_creative">ë¯¸ë””ì–´/í¬ë¦¬ì—ì´í‹°ë¸Œ</option>
                                            <option value="healthcare">ì˜ë£Œ/ë°”ì´ì˜¤</option>
                                            <option value="construction_real_estate">ê±´ì„¤/ë¶€ë™ì‚°</option>
                                            <option value="others">ê¸°íƒ€</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ’¼ í¬ë§ ì§ë¬´</label>
                                        <input
                                            type="text"
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.targetJob}
                                            onChange={(e) => handleInputChange('targetJob', e.target.value)}
                                            placeholder="ì˜ˆ: ë°±ì—”ë“œ ê°œë°œì, ë§ˆì¼€íŒ… ê¸°íšì, UI/UX ë””ìì´ë„ˆ ë“±"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-3">ğŸ“‹ í˜„ì¬ ìƒíƒœ</label>
                                        <select
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg"
                                            value={formData.currentStatus}
                                            onChange={(e) => handleInputChange('currentStatus', e.target.value)}
                                        >
                                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                            <option value="student">ì¬í•™ìƒ</option>
                                            <option value="job_seeker">êµ¬ì§ì</option>
                                            <option value="employed">ì¬ì§ì (ì´ì§ ì¤€ë¹„)</option>
                                            <option value="career_change">ê²½ë ¥ ì „í™˜ì</option>
                                            <option value="freelancer">í”„ë¦¬ëœì„œ</option>
                                        </select>
                                    </div>

                                    <button
                                        onClick={() => goToNextStep(2)}
                                        className="btn-primary w-full text-xl py-4"
                                        disabled={!formData.age || !formData.educationLevel || !formData.major || !formData.targetIndustry || !formData.targetJob}
                                    >
                                        ë‹¤ìŒ ë‹¨ê³„ â†’
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 2ë‹¨ê³„ ë Œë”ë§ (ìŠ¤í‚¬ ì—­ëŸ‰)
            if (calculatorStep === 2) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(1)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ì´ì „ ë‹¨ê³„
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ› ï¸ ìŠ¤í‚¬ ì—­ëŸ‰</h1>
                                <p className="text-xl text-gray-600">ë³´ìœ í•˜ê³  ê³„ì‹  ê¸°ìˆ ê³¼ ëŠ¥ë ¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '33.33%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">2ë‹¨ê³„ / 6ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="bg-blue-50 border-l-4 border-blue-400 p-6 mb-8 rounded-r-lg">
                                    <p className="text-lg text-blue-800">
                                        ğŸ’¡ <strong>ë³´ìœ í•œ ê¸°ìˆ ê³¼ ëŠ¥ë ¥ì„ ëª¨ë‘ ì²´í¬í•´ì£¼ì„¸ìš”</strong><br/>
                                        ë‹¤ì–‘í•œ ìŠ¤í‚¬ì´ ê²½ìŸë ¥ í‰ê°€ì— ë°˜ì˜ë©ë‹ˆë‹¤.
                                    </p>
                                </div>

                                <div className="space-y-8">
                                    {/* Technical Skills Section */}
                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-4">ğŸ’» ê¸°ìˆ  ìŠ¤í‚¬</label>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            {[
                                                'JavaScript', 'Python', 'Java', 'C/C++', 'C#', 'PHP',
                                                'React', 'Vue.js', 'Angular', 'Node.js', 'Spring', 'Django',
                                                'HTML/CSS', 'SQL', 'MongoDB', 'AWS', 'Git', 'Docker'
                                            ].map(skill => (
                                                <label key={skill} className="flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={formData.technicalSkills?.includes(skill) || false}
                                                        onChange={(e) => {
                                                            const currentSkills = formData.technicalSkills || [];
                                                            if (e.target.checked) {
                                                                handleInputChange('technicalSkills', [...currentSkills, skill]);
                                                            } else {
                                                                handleInputChange('technicalSkills', currentSkills.filter(s => s !== skill));
                                                            }
                                                        }}
                                                        className="rounded text-blue-600"
                                                    />
                                                    <span className="text-sm font-medium">{skill}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Certifications Section */}
                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-4">ğŸ† ìê²©ì¦/ì¸ì¦</label>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {[
                                                'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬', 'í† ìµ/í† í”Œ', 'AWS ì¸ì¦', 'êµ¬ê¸€ í´ë¼ìš°ë“œ ì¸ì¦',
                                                'ì»´í™œ 1ê¸‰', 'ì›Œë“œí”„ë¡œì„¸ì„œ', 'PMP', '6ì‹œê·¸ë§ˆ',
                                                'íšŒê³„ì‚¬', 'ë³€ë¦¬ì‚¬', 'ê¸°íƒ€ IT ì¸ì¦', 'ê¸°íƒ€ ì „ë¬¸ ìê²©ì¦'
                                            ].map(cert => (
                                                <label key={cert} className="flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={formData.certifications?.includes(cert) || false}
                                                        onChange={(e) => {
                                                            const currentCerts = formData.certifications || [];
                                                            if (e.target.checked) {
                                                                handleInputChange('certifications', [...currentCerts, cert]);
                                                            } else {
                                                                handleInputChange('certifications', currentCerts.filter(c => c !== cert));
                                                            }
                                                        }}
                                                        className="rounded text-blue-600"
                                                    />
                                                    <span className="text-sm font-medium">{cert}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Language Skills Section */}
                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-4">ğŸŒ ì–´í•™ ëŠ¥ë ¥</label>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {[
                                                'ì˜ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆë²¨)', 'ì˜ì–´ (íšŒí™” ê°€ëŠ¥)', 'ì˜ì–´ (ê¸°ì´ˆ)',
                                                'ì¤‘êµ­ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆë²¨)', 'ì¤‘êµ­ì–´ (íšŒí™” ê°€ëŠ¥)', 'ì¤‘êµ­ì–´ (ê¸°ì´ˆ)',
                                                'ì¼ë³¸ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆë²¨)', 'ì¼ë³¸ì–´ (íšŒí™” ê°€ëŠ¥)', 'ì¼ë³¸ì–´ (ê¸°ì´ˆ)',
                                                'ê¸°íƒ€ ì–¸ì–´'
                                            ].map(lang => (
                                                <label key={lang} className="flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={formData.languageSkills?.includes(lang) || false}
                                                        onChange={(e) => {
                                                            const currentLangs = formData.languageSkills || [];
                                                            if (e.target.checked) {
                                                                handleInputChange('languageSkills', [...currentLangs, lang]);
                                                            } else {
                                                                handleInputChange('languageSkills', currentLangs.filter(l => l !== lang));
                                                            }
                                                        }}
                                                        className="rounded text-blue-600"
                                                    />
                                                    <span className="text-sm font-medium">{lang}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Portfolio Projects Section */}
                                    <div>
                                        <label className="block text-xl font-semibold text-gray-800 mb-4">ğŸ“ í¬íŠ¸í´ë¦¬ì˜¤ í”„ë¡œì íŠ¸ ìˆ˜</label>
                                        <select
                                            value={formData.portfolioProjects || ''}
                                            onChange={(e) => handleInputChange('portfolioProjects', e.target.value)}
                                            className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg bg-white"
                                        >
                                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                            <option value="0">0ê°œ (ì—†ìŒ)</option>
                                            <option value="1-2">1-2ê°œ</option>
                                            <option value="3-5">3-5ê°œ</option>
                                            <option value="6-10">6-10ê°œ</option>
                                            <option value="10+">10ê°œ ì´ìƒ</option>
                                        </select>
                                    </div>

                                    {/* Portfolio Quality Section - only show if projects > 0 */}
                                    {formData.portfolioProjects && formData.portfolioProjects !== '0' && (
                                        <div>
                                            <label className="block text-xl font-semibold text-gray-800 mb-4">â­ í¬íŠ¸í´ë¦¬ì˜¤ í’ˆì§ˆ (ìì²´ í‰ê°€)</label>
                                            <select
                                                value={formData.portfolioQuality || ''}
                                                onChange={(e) => handleInputChange('portfolioQuality', e.target.value)}
                                                className="w-full p-4 border-2 border-gray-200 rounded-lg text-lg bg-white"
                                            >
                                                <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                                <option value="basic">ê¸°ì´ˆ ìˆ˜ì¤€ (í•™ìŠµìš© í”„ë¡œì íŠ¸)</option>
                                                <option value="intermediate">ì¤‘ê¸‰ ìˆ˜ì¤€ (ì‹¤ìš©ì  ê¸°ëŠ¥ êµ¬í˜„)</option>
                                                <option value="advanced">ê³ ê¸‰ ìˆ˜ì¤€ (ìƒìš© ì„œë¹„ìŠ¤ ìˆ˜ì¤€)</option>
                                                <option value="professional">ì „ë¬¸ê°€ ìˆ˜ì¤€ (ê¸°ì—…ê¸‰ í’ˆì§ˆ)</option>
                                            </select>
                                        </div>
                                    )}

                                    <div className="flex gap-4 mt-8">
                                        <button
                                            onClick={() => goToNextStep(1)}
                                            className="flex items-center px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200"
                                        >
                                            <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                            </svg>
                                            ì´ì „ ë‹¨ê³„
                                        </button>
                                        <button
                                            onClick={() => goToNextStep(3)}
                                            className="btn-primary flex-1"
                                        >
                                            ë‹¤ìŒ ë‹¨ê³„ â†’
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 3ë‹¨ê³„ ë Œë”ë§ (ê²½ë ¥ ê²½í—˜ í‰ê°€)
            if (calculatorStep === 3) {
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(2)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ì´ì „ ë‹¨ê³„
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ’¼ ê²½ë ¥ ë° ê²½í—˜</h1>
                                <p className="text-xl text-gray-600">ë‹¹ì‹ ì˜ ë‹¤ì–‘í•œ ê²½í—˜ê³¼ í™œë™ì„ í‰ê°€í•´ë³´ì„¸ìš”</p>
                                <div className="w-full bg-gray-200 rounded-full h-4 mt-6 max-w-md mx-auto">
                                    <div className="bg-blue-600 h-4 rounded-full" style={{width: '50%'}}></div>
                                </div>
                                <p className="text-lg text-gray-500 mt-3">3ë‹¨ê³„ / 6ë‹¨ê³„</p>
                            </div>

                            <div className="card">
                                <div className="bg-blue-50 border-l-4 border-blue-400 p-6 mb-8 rounded-r-lg">
                                    <p className="text-lg text-blue-800">
                                        ğŸ’¡ <strong>ê° ì˜ì—­ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ìˆ˜ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”</strong><br/>
                                        ë‹¤ì–‘í•œ ê²½í—˜ì´ ëª¨ì—¬ ë‹¹ì‹ ë§Œì˜ ê²½ìŸë ¥ì„ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.
                                    </p>
                                </div>

                                {/* ì¸í„´ì‹­/ì‹¤ë¬´ ê²½í—˜ */}
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold text-gray-700 mb-3">
                                        ğŸ¢ ì¸í„´ì‹­/ì‹¤ë¬´ ê²½í—˜
                                    </label>
                                    <select 
                                        value={formData.internshipExperience || ''}
                                        onChange={(e) => handleInputChange('internshipExperience', e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 bg-white"
                                    >
                                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                        <option value="none">ì‹¤ë¬´ ê²½í—˜ ì—†ìŒ</option>
                                        <option value="short">ë‹¨ê¸° ì¸í„´ ê²½í—˜ (1-3ê°œì›”)</option>
                                        <option value="long">ì¥ê¸° ì¸í„´ ê²½í—˜ (3-12ê°œì›”)</option>
                                        <option value="multiple">ë‹¤ìˆ˜ì˜ ì¸í„´ ê²½í—˜</option>
                                        <option value="fulltime">ì •ê·œì§ ê²½í—˜ ìˆìŒ</option>
                                    </select>
                                </div>

                                {/* í”„ë¡œì íŠ¸ ê²½í—˜ */}
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold text-gray-700 mb-3">
                                        ğŸš€ í”„ë¡œì íŠ¸ ê²½í—˜
                                    </label>
                                    <select 
                                        value={formData.projectExperience || ''}
                                        onChange={(e) => handleInputChange('projectExperience', e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 bg-white"
                                    >
                                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                        <option value="none">í”„ë¡œì íŠ¸ ê²½í—˜ ì—†ìŒ</option>
                                        <option value="academic">ìˆ˜ì—…/ê³¼ì œ í”„ë¡œì íŠ¸ë§Œ</option>
                                        <option value="personal">ê°œì¸ í”„ë¡œì íŠ¸ ê²½í—˜</option>
                                        <option value="team">íŒ€ í”„ë¡œì íŠ¸ ë‹¤ìˆ˜ ì°¸ì—¬</option>
                                        <option value="commercial">ìƒì—…ì /ì‹¤ë¬´ í”„ë¡œì íŠ¸ ê²½í—˜</option>
                                    </select>
                                </div>

                                {/* í™œë™ ê²½í—˜ */}
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold text-gray-700 mb-3">
                                        ğŸ¯ ëŒ€ì™¸í™œë™/ë´‰ì‚¬ ê²½í—˜
                                    </label>
                                    <select 
                                        value={formData.activityExperience || ''}
                                        onChange={(e) => handleInputChange('activityExperience', e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 bg-white"
                                    >
                                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                        <option value="none">ëŒ€ì™¸í™œë™ ê²½í—˜ ì—†ìŒ</option>
                                        <option value="volunteer">ë´‰ì‚¬í™œë™ ì°¸ì—¬</option>
                                        <option value="club">ë™ì•„ë¦¬/í•™íšŒ í™œë™</option>
                                        <option value="contest">ê³µëª¨ì „/ëŒ€íšŒ ì°¸ì—¬</option>
                                        <option value="multiple">ë‹¤ì–‘í•œ ëŒ€ì™¸í™œë™ ê²½í—˜</option>
                                    </select>
                                </div>

                                {/* ìˆ˜ìƒ ê²½ë ¥ */}
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold text-gray-700 mb-3">
                                        ğŸ† ìˆ˜ìƒ/ì„±ì·¨ ê²½ë ¥
                                    </label>
                                    <select 
                                        value={formData.awardHistory || ''}
                                        onChange={(e) => handleInputChange('awardHistory', e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 bg-white"
                                    >
                                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                        <option value="none">ìˆ˜ìƒ ê²½ë ¥ ì—†ìŒ</option>
                                        <option value="academic">í•™ì—… ê´€ë ¨ ìƒ (ì¥í•™ê¸ˆ ë“±)</option>
                                        <option value="competition">ê³µëª¨ì „/ëŒ€íšŒ ì…ìƒ</option>
                                        <option value="certification">ìê²©ì¦/ì¸ì¦ì„œ ë³´ìœ </option>
                                        <option value="multiple">ë‹¤ìˆ˜ì˜ ìˆ˜ìƒ/ì¸ì¦ ê²½ë ¥</option>
                                    </select>
                                </div>

                                {/* ë¦¬ë”ì‹­ ê²½í—˜ */}
                                <div className="mb-6">
                                    <label className="block text-lg font-semibold text-gray-700 mb-3">
                                        ğŸ‘‘ ë¦¬ë”ì‹­/íŒ€ ê´€ë¦¬ ê²½í—˜
                                    </label>
                                    <select 
                                        value={formData.leadershipExperience || ''}
                                        onChange={(e) => handleInputChange('leadershipExperience', e.target.value)}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-700 bg-white"
                                    >
                                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                        <option value="none">ë¦¬ë”ì‹­ ê²½í—˜ ì—†ìŒ</option>
                                        <option value="member">íŒ€ êµ¬ì„±ì›ìœ¼ë¡œë§Œ ì°¸ì—¬</option>
                                        <option value="sub">ì„œë¸Œ ë¦¬ë”/íŒŒíŠ¸ ë¦¬ë” ê²½í—˜</option>
                                        <option value="leader">í”„ë¡œì íŠ¸ ë¦¬ë” ê²½í—˜</option>
                                        <option value="manager">íŒ€/ì¡°ì§ ê´€ë¦¬ ê²½í—˜</option>
                                    </select>
                                </div>

                                <div className="flex gap-4 mt-8">
                                    <button
                                        onClick={() => goToNextStep(2)}
                                        className="flex items-center px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200"
                                    >
                                        <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                        </svg>
                                        ì´ì „ ë‹¨ê³„
                                    </button>
                                    <button
                                        onClick={() => goToNextStep(4)}
                                        className="btn-primary flex-1"
                                    >
                                        ë‹¤ìŒ ë‹¨ê³„ â†’
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ê²°ê³¼ í™”ë©´ (ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ ê²°ê³¼)
            if (calculatorStep === 4 && calculatorResult) {
                const gradeInfo = getGradeFromScore(calculatorResult.totalScore);
                
                return (
                    <div className="min-h-screen py-8 px-4">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button
                                    onClick={() => goToNextStep(3)}
                                    className="flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 font-medium"
                                >
                                    <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°
                                </button>
                                <div className="flex-1"></div>
                            </div>
                            
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-3">ğŸ¯ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ ì™„ë£Œ!</h1>
                                <p className="text-gray-600">ë‹¹ì‹ ì˜ ì¢…í•©ì ì¸ ì·¨ì—… ì¤€ë¹„ ìƒíƒœë¥¼ ë¶„ì„í–ˆìŠµë‹ˆë‹¤</p>
                            </div>

                            {/* ì¢…í•© ë“±ê¸‰ í‘œì‹œ */}
                            <div className="card mb-6">
                                <div className="text-center">
                                    <div className={`inline-flex items-center justify-center w-32 h-32 rounded-full text-6xl font-bold mb-4 ${gradeInfo.bg} ${gradeInfo.color} border-4 border-current`}>
                                        {gradeInfo.grade}
                                    </div>
                                    <div className="text-2xl font-bold text-gray-800 mb-2">
                                        ì¢…í•© ì ìˆ˜: {calculatorResult.totalScore}ì  / 100ì 
                                    </div>
                                    <div className="text-lg text-gray-600 mb-4">
                                        ë“±ê¸‰: <span className={`font-bold ${gradeInfo.color}`}>{calculatorResult.grade}</span>
                                    </div>
                                    
                                    {/* ì„±ê³µë¥  ë° ì˜ˆìƒ ê¸°ê°„ */}
                                    <div className="grid grid-cols-2 gap-4 mt-6">
                                        <div className="bg-green-50 p-4 rounded-lg">
                                            <div className="text-2xl font-bold text-green-600 mb-1">
                                                {calculatorResult.predictedSuccessRate}%
                                            </div>
                                            <div className="text-sm text-green-700 font-medium">ì˜ˆìƒ ì·¨ì—… ì„±ê³µë¥ </div>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="text-2xl font-bold text-blue-600 mb-1">
                                                {calculatorResult.estimatedJobPeriod}ê°œì›”
                                            </div>
                                            <div className="text-sm text-blue-700 font-medium">ì˜ˆìƒ ì·¨ì—… ê¸°ê°„</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 6ê°œ ë¶„ì•¼ë³„ ì ìˆ˜ ë¶„ì„ */}
                            <div className="card mb-6">
                                <h3 className="text-xl font-bold mb-4">ğŸ“Š ë¶„ì•¼ë³„ ê²½ìŸë ¥ ë¶„ì„</h3>
                                <div className="space-y-4">
                                    {Object.values(calculatorResult.scoreBreakdown).map((item, index) => {
                                        const percentage = (item.score / item.maxScore) * 100;
                                        const scoreGrade = getGradeFromScore(percentage);
                                        
                                        return (
                                            <div key={index} className="border rounded-lg p-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <span className="font-semibold text-gray-800">{item.category}</span>
                                                    <div className="flex items-center gap-2">
                                                        <span className={`px-3 py-1 rounded-full text-sm font-bold ${scoreGrade.bg} ${scoreGrade.color}`}>
                                                            {scoreGrade.grade}
                                                        </span>
                                                        <span className="font-bold text-gray-700">
                                                            {item.score}/{item.maxScore}ì 
                                                        </span>
                                                    </div>
                                                </div>
                                                
                                                {/* ì§„í–‰ë¥  ë°” */}
                                                <div className="bg-gray-200 rounded-full h-3">
                                                    <div 
                                                        className={`h-3 rounded-full transition-all duration-300 ${
                                                            percentage >= 80 ? 'bg-green-500' :
                                                            percentage >= 60 ? 'bg-blue-500' :
                                                            percentage >= 40 ? 'bg-yellow-500' : 'bg-red-500'
                                                        }`}
                                                        style={{width: `${percentage}%`}}
                                                    ></div>
                                                </div>
                                                <div className="text-right text-sm text-gray-600 mt-1">
                                                    {percentage.toFixed(1)}%
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* ê°œì„  ì¶”ì²œì‚¬í•­ */}
                            {calculatorResult.recommendations && calculatorResult.recommendations.length > 0 && (
                                <div className="card mb-6">
                                    <h3 className="text-xl font-bold mb-4">ğŸ’¡ ê°œì„  ì¶”ì²œì‚¬í•­</h3>
                                    <div className="space-y-3">
                                        {calculatorResult.recommendations.map((recommendation, index) => (
                                            <div key={index} className="flex items-start gap-3 p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                                                <span className="text-yellow-600 font-bold text-lg">â€¢</span>
                                                <span className="text-gray-700">{recommendation}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* ë˜ë˜ ë¹„êµ */}
                            {calculatorResult.peerComparison && (
                                <div className="card mb-6">
                                    <h3 className="text-xl font-bold mb-4">ğŸ‘¥ ë˜ë˜ ë¹„êµ</h3>
                                    <div className="grid grid-cols-3 gap-4 text-center">
                                        <div className="bg-blue-50 p-4 rounded-lg">
                                            <div className="text-2xl font-bold text-blue-600 mb-1">
                                                {calculatorResult.peerComparison.myScore}ì 
                                            </div>
                                            <div className="text-sm text-blue-700">ë‚´ ì ìˆ˜</div>
                                        </div>
                                        <div className="bg-gray-50 p-4 rounded-lg">
                                            <div className="text-2xl font-bold text-gray-600 mb-1">
                                                {calculatorResult.peerComparison.peerAverage}ì 
                                            </div>
                                            <div className="text-sm text-gray-700">ë™ì—°ë ¹ í‰ê· </div>
                                        </div>
                                        <div className="bg-purple-50 p-4 rounded-lg">
                                            <div className="text-2xl font-bold text-purple-600 mb-1">
                                                {calculatorResult.peerComparison.industryAverage}ì 
                                            </div>
                                            <div className="text-sm text-purple-700">ì—…ê³„ í‰ê· </div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-4 text-center">
                                        <div className="text-lg font-semibold text-gray-700">
                                            ìƒìœ„ {100 - calculatorResult.peerComparison.percentile}% ìˆ˜ì¤€
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* ê³„ì‚° ê²°ê³¼ ì €ì¥ */}
                            {!isResultSaved ? (
                                <div className="text-center mb-6">
                                    <button
                                        onClick={saveCalculationResult}
                                        className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                                    >
                                        ğŸ’¾ ë‚´ ì§„ë‹¨ê²°ê³¼ ì €ì¥í•˜ê¸°
                                    </button>
                                    <div className="text-sm text-blue-600 mt-2 font-medium">
                                        ì§„ë‹¨ ê²°ê³¼ë¥¼ ì €ì¥í•˜ë©´ ë‚˜ì™€ ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ê³¼ ì´ì•¼ê¸°í•  ìˆ˜ ìˆì–´ìš”!
                                    </div>
                                    <div className="text-sm text-gray-500 mt-1">
                                        ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì§„ë‹¨í•˜ê³  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center mb-6">
                                    <div className="inline-block px-6 py-3 bg-green-100 text-green-800 rounded-lg font-semibold">
                                        âœ… ì§„ë‹¨ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
                                    </div>
                                    <div className="text-sm text-gray-500 mt-2">
                                        ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì§„ë‹¨í•˜ê³  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                    </div>
                                    <div className="text-sm text-blue-600 mt-1 font-medium">
                                        ğŸ‘‡ ì•„ë˜ì—ì„œ ë¹„ìŠ·í•œ ë¶„ë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”
                                    </div>
                                </div>
                            )}
                            
                            {/* ì»¤ë®¤ë‹ˆí‹° ì„¹ì…˜ - ì €ì¥ í›„ì—ë§Œ í‘œì‹œ */}
                            {isResultSaved && (
                                <div className="card mb-6">
                                    <h3 className="text-xl font-bold mb-4">ğŸ‘¥ ë‚˜ì™€ ë¹„ìŠ·í•œ ì‚¬ëŒë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”</h3>
                                
                                    {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
                                    <div className="grid grid-cols-3 gap-2 mb-6">
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'community' 
                                                    ? 'bg-gradient-to-r from-green-500 to-blue-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('community')}
                                        >
                                            ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬
                                        </button>
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'expert' 
                                                    ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('expert')}
                                        >
                                            ğŸ” í˜„ì§ì ì°¾ê¸°
                                        </button>
                                        <button
                                            className={`py-3 px-3 rounded-lg font-semibold transition-all duration-300 text-sm ${
                                                activeTab === 'mypage' 
                                                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg' 
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                            onClick={() => setActiveTab('mypage')}
                                        >
                                            ğŸ“‹ ë‚´ ì§„ë‹¨ë‚´ì—­
                                        </button>
                                    </div>

                                    {/* ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ íƒ­ */}
                                    {activeTab === 'community' && (
                                        <div className="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    ğŸ¤ <strong>ìµëª… ì·¨ì—… ì»¤ë®¤ë‹ˆí‹°</strong>ì—ì„œ<br/>
                                                    ë¹„ìŠ·í•œ ì§„ë‹¨ ê²°ê³¼ì™€ ë‚˜ì´ëŒ€({formData.age}ì„¸)ì˜ ì‚¬ëŒë“¤ê³¼ ì†”ì§í•œ ê²½í—˜ì„ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ì´ ì ìˆ˜ë¡œ ì •ë§ ì·¨ì—…ë ê¹Œìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ë©´ì ‘ì—ì„œ ì–´ë–¤ ì§ˆë¬¸ì´ ë‚˜ì˜¬ê¹Œìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"í¬íŠ¸í´ë¦¬ì˜¤ ì–´ë–»ê²Œ ë§Œë“œì…¨ë‚˜ìš”?"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-blue-600">"ë„¤íŠ¸ì›Œí‚¹ì€ ì–´ë–»ê²Œ í•˜ì„¸ìš”?"</div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-green-100 p-3 rounded-lg mb-4 text-center">
                                                <p className="text-green-800 font-semibold">
                                                    âœ¨ <strong>êµ¬ì¸êµ¬ì§ ì •ë³´ëŠ” ì¼ì²´ ì—†ìŠµë‹ˆë‹¤</strong> âœ¨
                                                </p>
                                                <p className="text-green-700 text-sm">ìˆœìˆ˜ ì·¨ì—… ì¤€ë¹„ ê²½í—˜ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤</p>
                                            </div>
                                            
                                            <button
                                                onClick={joinCommunity}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                ğŸ¤ ìµëª… ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬í•˜ê¸°
                                            </button>
                                        </div>
                                    )}

                                    {/* í˜„ì§ì ì°¾ê¸° íƒ­ */}
                                    {activeTab === 'expert' && (
                                        <div className="space-y-6">
                                            {/* í˜„ì§ì ë©˜í† ë§ ì„œë¹„ìŠ¤ ì†Œê°œ */}
                                            <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                                                <div className="flex items-center space-x-3 mb-4">
                                                    <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                                        <span className="text-white text-xl">ğŸ‘¨â€ğŸ’¼</span>
                                                    </div>
                                                    <div>
                                                        <h3 className="text-xl font-bold text-gray-900">í˜„ì§ì ë©˜í† ë§</h3>
                                                        <p className="text-sm text-gray-600">ì—…ê³„ í˜„ì§ìì™€ ì‹¤ë¬´ ì¤‘ì‹¬ 1:1 ì·¨ì—… ë©˜í† ë§</p>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                                    <div className="flex items-start space-x-3">
                                                        <span className="text-blue-500 text-lg">ğŸ’¼</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-900">ì‹¤ë¬´ ê²½í—˜ ê³µìœ </h4>
                                                            <p className="text-sm text-gray-600">í˜„ì§ìë§Œì´ ì•Œ ìˆ˜ ìˆëŠ” ìƒìƒí•œ ì—…ê³„ ì •ë³´</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex items-start space-x-3">
                                                        <span className="text-blue-500 text-lg">ğŸ¯</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-900">ê²€ì¦ëœ í˜„ì§ì</h4>
                                                            <p className="text-sm text-gray-600">ì¬ì§ì¦ëª…ì„œë¡œ ê²€ì¦ëœ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë©˜í† </p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex items-start space-x-3">
                                                        <span className="text-blue-500 text-lg">ğŸ“</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-900">ë‹¤ì–‘í•œ ë©˜í† ë§ ë°©ì‹</h4>
                                                            <p className="text-sm text-gray-600">ìŒì„±í†µí™”, ì˜ìƒí†µí™”ë¡œ í¸ë¦¬í•œ ìƒë‹´</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex items-start space-x-3">
                                                        <span className="text-blue-500 text-lg">â°</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-900">ìœ ì—°í•œ ì˜ˆì•½</h4>
                                                            <p className="text-sm text-gray-600">10ë¶„ ë‹¨ìœ„ë¡œ ì›í•˜ëŠ” ì‹œê°„ì— ì˜ˆì•½</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="bg-white rounded-lg p-4 mb-4">
                                                    <h4 className="font-medium text-gray-900 mb-2">ğŸ“‹ ì´ëŸ° ë¶„ë“¤ê»˜ ì¶”ì²œí•´ìš”</h4>
                                                    <ul className="text-sm text-gray-600 space-y-1">
                                                        <li>â€¢ ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ ê²°ê³¼ë¥¼ í˜„ì§ìì™€ ê²€í† í•˜ê³  ì‹¶ì€ ë¶„</li>
                                                        <li>â€¢ ì´ë ¥ì„œ, ìê¸°ì†Œê°œì„œ í”¼ë“œë°±ì´ í•„ìš”í•œ ë¶„</li>
                                                        <li>â€¢ ì—…ê³„ë³„ ì‹¤ë¬´ ì •ë³´ì™€ ë©´ì ‘ ê¿€íŒì´ ê¶ê¸ˆí•œ ë¶„</li>
                                                        <li>â€¢ ì»¤ë¦¬ì–´ ì „í™˜ì´ë‚˜ ì´ì§ ì „ëµì„ ì„¸ìš°ê³  ì‹¶ì€ ë¶„</li>
                                                    </ul>
                                                </div>
                                                
                                                {isGuest ? (
                                                    <div className="text-center space-y-3">
                                                        <p className="text-sm text-gray-600">í˜„ì§ì ë©˜í† ë§ì€ íšŒì›ë§Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                                        <button
                                                            onClick={() => setShowSignupModal(true)}
                                                            className="w-full bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-600 transition-colors"
                                                        >
                                                            íšŒì›ê°€ì…í•˜ê³  í˜„ì§ì ë©˜í† ë§ ğŸš€
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div className="text-center">
                                                        <button
                                                            onClick={() => setCurrentView('experts')}
                                                            className="w-full bg-orange-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-orange-600 transition-colors"
                                                        >
                                                            í˜„ì§ì ì°¾ê¸° ì‹œì‘í•˜ê¸° ğŸš€
                                                        </button>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* ë‚´ ì§„ë‹¨ë‚´ì—­ íƒ­ */}
                                    {activeTab === 'mypage' && (
                                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg">
                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <p className="text-gray-800 font-semibold">
                                                    ğŸ“‹ <strong>ë§ˆì´í˜ì´ì§€</strong>ì—ì„œ<br/>
                                                    ì €ì¥ëœ ì§„ë‹¨ ê²°ê³¼ì™€ í™œë™ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                                </p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ì§„ë‹¨ ê²°ê³¼ íˆìŠ¤í† ë¦¬"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ì»¤ë®¤ë‹ˆí‹° í™œë™ ë‚´ì—­"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ë©˜í† ë§ ì˜ˆì•½ í˜„í™©"</div>
                                                </div>
                                                <div className="bg-white p-2 rounded-lg text-center">
                                                    <div className="font-bold text-purple-600">"ê°œì¸ì •ë³´ ê´€ë¦¬"</div>
                                                </div>
                                            </div>
                                            
                                            <button
                                                onClick={() => setCurrentView('mypage')}
                                                className="w-full text-lg py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold transform hover:scale-105 transition-all duration-300"
                                            >
                                                ğŸ“‹ ë§ˆì´í˜ì´ì§€ ì´ë™í•˜ê¸°
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="text-center space-y-3">
                                <button
                                    onClick={() => goToNextStep(1)}
                                    className="text-gray-500 underline hover:text-gray-700"
                                >
                                    ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°
                                </button>
                            </div>
                            
                        </div>
                    </div>
                );
            }

            return <div>ì˜ëª»ëœ ë‹¨ê³„ì…ë‹ˆë‹¤.</div>;
        };

        // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì ê´€ë¦¬
        const createGuestUser = () => {
            const guestId = crypto.randomUUID();
            const guestNickname = authManager.nicknameGen.generate();
            const guestUser = {
                id: guestId,
                email: null,
                nickname: guestNickname,
                isGuest: true,
                createdAt: new Date().toISOString()
            };
            localStorage.setItem('insidejob_guest_user', JSON.stringify(guestUser));
            return guestUser;
        };

        // ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
        const InsideJobApp = () => {
            const [currentView, setCurrentView] = useState('login'); // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì‹œì‘
            const [selectedPost, setSelectedPost] = useState(null); // ì„ íƒëœ ê²Œì‹œê¸€ ìƒíƒœ
            const [savedCalculations, setSavedCalculations] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isGuest, setIsGuest] = useState(false);
            const [authMode, setAuthMode] = useState('login'); // 'login' ë˜ëŠ” 'signup'
            const [showAuthForm, setShowAuthForm] = useState(false); // ì›°ì»´ í˜ì´ì§€ì—ì„œ í¼ í‘œì‹œ ì—¬ë¶€
            const [showGuestConfirmModal, setShowGuestConfirmModal] = useState(false);
            const [showCommunityAccessModal, setShowCommunityAccessModal] = useState(false);
            const [showCalculationRequiredModal, setShowCalculationRequiredModal] = useState(false);
            const [showNotificationModal, setShowNotificationModal] = useState(false);
            const [notificationContent, setNotificationContent] = useState({ title: '', message: '', type: 'info' });
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [showSignupModal, setShowSignupModal] = useState(false);
            const [showSaveResultSignupModal, setShowSaveResultSignupModal] = useState(false);
            const [lastActivity, setLastActivity] = useState(Date.now());
            
            // ê³„ì‚°ê¸° ê´€ë ¨ state
            const [formData, setFormData] = useState({});
            const [calculatorResult, setCalculatorResult] = useState(null);
            const [calculatorStep, setCalculatorStep] = useState(1);

            // ì†Œì…œ ë¡œê·¸ì¸ ì½œë°± ì²˜ë¦¬
            useEffect(() => {
                const handleAuthStateChange = async () => {
                    try {
                        // Supabase Auth ìƒíƒœ ë³€í™” ê°ì§€
                        const { data: { subscription } } = supabaseClient.auth.onAuthStateChange(async (event, session) => {
                            console.log('Auth ìƒíƒœ ë³€í™”:', event, session?.user?.id);
                            
                            if (event === 'SIGNED_IN' && session?.user) {
                                // ì†Œì…œ ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì²˜ë¦¬
                                const result = await authManager.handleSocialLoginCallback(session.user);
                                if (result.success) {
                                    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                                    const currentUser = await authManager.getCurrentUser();
                                    if (currentUser) {
                                        handleAuthSuccess(currentUser);
                                    }
                                }
                            } else if (event === 'SIGNED_OUT') {
                                setCurrentUser(null);
                                setIsAuthenticated(false);
                                setIsGuest(false);
                                setCurrentView('login');
                            }
                        });
                        
                        // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ì‹œ êµ¬ë… í•´ì œ
                        return () => {
                            subscription?.unsubscribe();
                        };
                    } catch (error) {
                        console.error('Auth ìƒíƒœ ë³€í™” ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    }
                };
                
                handleAuthStateChange();
            }, []);
            
            // ì™¸ë¶€ í´ë¦­ì‹œ ë©”ë‰´ ë‹«ê¸°
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showMobileMenu && !event.target.closest('nav')) {
                        setShowMobileMenu(false);
                    }
                };
                
                document.addEventListener('click', handleClickOutside);
                return () => document.removeEventListener('click', handleClickOutside);
            }, [showMobileMenu]);

            // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ê´€ë¦¬
            useEffect(() => {
                const SESSION_TIMEOUT = 30 * 60 * 1000; // 30ë¶„

                const updateActivity = () => {
                    setLastActivity(Date.now());
                };

                const checkInactivity = () => {
                    if (currentUser && !isGuest && (Date.now() - lastActivity > SESSION_TIMEOUT)) {
                        handleLogout();
                        showNotification('ì„¸ì…˜ ë§Œë£Œ', 'ë³´ì•ˆì„ ìœ„í•´ 30ë¶„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'warning');
                    }
                };

                // ì‚¬ìš©ì í™œë™ ê°ì§€ ì´ë²¤íŠ¸
                const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                events.forEach(event => {
                    document.addEventListener(event, updateActivity, true);
                });

                // 5ë¶„ë§ˆë‹¤ ë¹„í™œì„± ì‹œê°„ ì²´í¬
                const inactivityTimer = setInterval(checkInactivity, 5 * 60 * 1000);

                return () => {
                    events.forEach(event => {
                        document.removeEventListener(event, updateActivity, true);
                    });
                    clearInterval(inactivityTimer);
                };
            }, [currentUser, isGuest, lastActivity]);
            
            // í†µí•© ì•Œë¦¼ ëª¨ë‹¬ í•¨ìˆ˜
            const showNotification = (title, message, type = 'info') => {
                setNotificationContent({ title, message, type });
                setShowNotificationModal(true);
            };

            // ì…ë ¥ê°’ ê²€ì¦ í•¨ìˆ˜ë“¤
            const validateUserInput = {
                email: (input) => {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return emailRegex.test(input) && input.length <= 100;
                },
                phone: (input) => {
                    const phoneRegex = /^010-\d{4}-\d{4}$/;
                    return phoneRegex.test(input);
                },
                businessNumber: (input) => {
                    const businessRegex = /^\d{3}-\d{2}-\d{5}$/;
                    return businessRegex.test(input);
                },
                name: (input) => {
                    return input && input.length >= 2 && input.length <= 20 && 
                           /^[ê°€-í£a-zA-Z\s]+$/.test(input);
                },
                password: (input) => {
                    return input && input.length >= 8 && input.length <= 100 &&
                           /^(?=.*[a-zA-Z])(?=.*[0-9])|(?=.*[a-zA-Z])(?=.*[!@#$%^&*])|(?=.*[0-9])(?=.*[!@#$%^&*])/.test(input);
                },
                text: (input, maxLength = 1000) => {
                    return input && input.length > 0 && input.length <= maxLength &&
                           !/[<>'"&]/.test(input); // XSS ë°©ì§€
                }
            };
            
            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
            useEffect(() => {
                initializeApp();
            }, []);

            const initializeApp = async () => {
                try {
                    // ê²ŒìŠ¤íŠ¸ ë°ì´í„° ì´ˆê¸°í™” (ì¼íšŒì„± ì‚¬ìš©)
                    localStorage.removeItem('insidejob_guest_user');
                    localStorage.removeItem('insidejob_calculation_result');
                    
                    // ìë™ ë¡œê·¸ì¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”
                    // í•­ìƒ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì‹œì‘
                    console.log('ìë™ ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
                    // ê²ŒìŠ¤íŠ¸ëŠ” í•­ìƒ welcome í™”ë©´ë¶€í„° ì‹œì‘
                } catch (error) {
                    console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                }
            };
            
            // ì¸ì¦ ì„±ê³µ í•¸ë“¤ëŸ¬
            const handleAuthSuccess = async (user) => {
                // ë¡œê·¸ì¸ ì„±ê³µì‹œ ë¡œê·¸ì•„ì›ƒ í”Œë˜ê·¸ ì œê±°
                localStorage.removeItem('insidejob_user_logged_out');
                
                // ì‚¬ìš©ì í”„ë¡œí•„ì—ì„œ ë‹‰ë„¤ì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                try {
                    const { data: profileData, error: profileError } = await supabase
                        .from('user_profiles')
                        .select('nickname')
                        .eq('id', user.id)
                        .single();
                    
                    if (profileData && profileData.nickname) {
                        user.nickname = profileData.nickname;
                        console.log('âœ… ë‹‰ë„¤ì„ ë¡œë“œ ì„±ê³µ:', profileData.nickname);
                    } else {
                        console.warn('âš ï¸ ë‹‰ë„¤ì„ ë¡œë“œ ì‹¤íŒ¨:', profileError);
                    }
                } catch (error) {
                    console.error('âŒ í”„ë¡œí•„ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
                
                // ê¸°ì¡´ ê²ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìˆë‹¤ë©´ íšŒì› ê³„ì •ìœ¼ë¡œ ì´ê´€
                const guestCalculation = localStorage.getItem('insidejob_calculation_result');
                
                setCurrentUser(user);
                setIsAuthenticated(true);
                setIsGuest(false);
                setCurrentView('main');
                
                const isAdmin = isAdminUser(user);
                console.log(`ë¡œê·¸ì¸ ì„±ê³µ${isAdmin ? ' (ê´€ë¦¬ì)' : ' (ì¼ë°˜ ì‚¬ìš©ì)'}`);
                loadSavedCalculations();
                
                // ê²ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
                localStorage.removeItem('planb_guest_user');
                
                // ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ê°€ ìˆì—ˆë‹¤ë©´ ì‹¤ì œë¡œ DBì— ì €ì¥
                if (guestCalculation) {
                    try {
                        const calculationData = JSON.parse(guestCalculation);
                        console.log('ğŸ”„ ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ ì´ê´€ ì‹œì‘...', calculationData.formData?.age);
                        
                        // Supabaseì— ì‹¤ì œ ì €ì¥
                        if (supabase) {
                            // ìë™ ì—°ë ¹ëŒ€ ê³„ì‚°
                            const getAgeGroup = (age) => {
                                if (age < 25) return '20ëŒ€';
                                if (age < 30) return '20ëŒ€ í›„ë°˜';
                                if (age < 35) return '30ëŒ€ ì´ˆë°˜';
                                if (age < 40) return '30ëŒ€ í›„ë°˜';
                                return '40ì„¸ì´ìƒ';
                            };
                            
                            const saveData = {
                                user_id: user.id,
                                user_hash: null, // íšŒì›ì€ user_hash ë¶ˆí•„ìš”
                                age: calculationData.formData?.age,
                                age_group: getAgeGroup(calculationData.formData?.age),
                                health_status: calculationData.formData?.health,
                                life_mode: calculationData.formData?.lifeMode,
                                skill_portfolio_score: calculationData.formData?.portfolioCount ? parseInt(calculationData.formData.portfolioCount) * 5 : 0,
                                severance_pay: calculationData.formData?.severancePay ? parseInt(calculationData.formData.severancePay) * 10000 : 0,
                                debt: calculationData.formData?.debt ? parseInt(calculationData.formData.debt) * 10000 : 0,
                                national_pension: calculationData.formData?.nationalPension ? parseInt(calculationData.formData.nationalPension) * 10000 : 0,
                                private_pension: calculationData.formData?.privatePension ? parseInt(calculationData.formData.privatePension) * 10000 : 0,
                                calculation_result: calculationData,
                                updated_at: new Date().toISOString()
                            };
                            
                            console.log('ğŸ’¾ Supabase ì €ì¥ ë°ì´í„°:', {
                                user_id: saveData.user_id,
                                age: saveData.age,
                                age_group: saveData.age_group,
                                hasCalculationResult: !!saveData.calculation_result
                            });
                            
                            const { error } = await supabase
                                .from('career_calculations')
                                .upsert(saveData);
                            
                            if (error) {
                                console.error('âŒ ê³„ì‚° ê²°ê³¼ DB ì €ì¥ ì‹¤íŒ¨:', error);
                                console.error('ğŸ” ì €ì¥ ì‹¤íŒ¨ ìƒì„¸:', JSON.stringify(error, null, 2));
                            } else {
                                console.log('âœ… ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ DB ì €ì¥ ì„±ê³µ');
                                // ì„±ê³µì ìœ¼ë¡œ ì €ì¥ëœ í›„ì—ë§Œ localStorage ì‚­ì œ
                                localStorage.removeItem('insidejob_calculation_result');
                                console.log('ğŸ—‘ï¸ localStorage ê³„ì‚° ê²°ê³¼ ì‚­ì œ ì™„ë£Œ');
                            }
                        }
                        
                        setTimeout(() => {
                            showNotification(
                                'íšŒì›ê°€ì… ì™„ë£Œ!', 
                                'ê³„ì‚° ê²°ê³¼ê°€ íšŒì› ê³„ì •ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì–¸ì œë“  ë‹¤ì‹œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš” ğŸ’¾', 
                                'success'
                            );
                        }, 1000);
                        
                    } catch (error) {
                        console.error('âŒ ê²ŒìŠ¤íŠ¸ ê³„ì‚° ê²°ê³¼ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                        setTimeout(() => {
                            showNotification(
                                'íšŒì›ê°€ì… ì™„ë£Œ!', 
                                'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì‚° ê²°ê³¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ ì–¸ì œë“  ë‹¤ì‹œ ê³„ì‚°í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.', 
                                'success'
                            );
                        }, 1000);
                    }
                }
            };
            
            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹œì‘ í•¸ë“¤ëŸ¬
            const handleGuestStart = () => {
                setShowGuestConfirmModal(true);
            };
            
            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ í™•ì¸ í›„ ì‹œì‘
            const confirmGuestStart = () => {
                const guestUser = createGuestUser();
                setCurrentUser(guestUser);
                setIsGuest(true);
                setCurrentView('main');
                setShowGuestConfirmModal(false);
                console.log(`ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹œì‘: ${guestUser.nickname}`);
            };
            
            
            // ë¡œê·¸ì•„ì›ƒ í•¸ë“¤ëŸ¬
            const handleLogout = async () => {
                if (isGuest) {
                    // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ì¢…ë£Œ
                    localStorage.removeItem('insidejob_guest_user');
                    localStorage.removeItem('insidejob_calculation_result');
                    setCurrentUser(null);
                    setIsGuest(false);
                    setCurrentView('login');
                    setSavedCalculations([]);
                } else {
                    // íšŒì› ë¡œê·¸ì•„ì›ƒ
                    const result = await authManager.signOut();
                    if (result.success) {
                        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¥¼ localStorageì— ì €ì¥
                        localStorage.setItem('insidejob_user_logged_out', 'true');
                        
                        setCurrentUser(null);
                        setIsAuthenticated(false);
                        setCurrentView('login');
                        setSavedCalculations([]);
                        localStorage.removeItem('insidejob_calculation_result');
                        console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ - ìë™ ë¡œê·¸ì¸ ë¹„í™œì„±í™”');
                    }
                }
            };
            
            // ì €ì¥ëœ ê³„ì‚°ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
            const loadSavedCalculations = () => {
                const saved = localStorage.getItem('insidejob_calculation_result');
                if (saved) {
                    // ì €ì¥ëœ ê³„ì‚° ê²°ê³¼ê°€ ìˆìœ¼ë©´ ê³„ì‚°ê¸° í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì—¬ ê²°ê³¼ í‘œì‹œ
                    setSavedCalculations([JSON.parse(saved)]);
                }
                // ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ì–´ë„ ì •ìƒì ì¸ ìƒí™©ì´ë¯€ë¡œ alert ì œê±°
            };

            // ê³„ì‚° ì™„ë£Œì‹œ ê²°ê³¼ ì €ì¥ ë° ì»¤ë®¤ë‹ˆí‹° ì•ˆë‚´
            const handleCalculationComplete = async (calculationResult) => {
                try {
                    // ê³„ì‚° ê²°ê³¼ë¥¼ localStorageì™€ Supabaseì— ì €ì¥
                    localStorage.setItem('planb_calculation_result', JSON.stringify(calculationResult));
                    
                    if (currentUser) {
                        // íšŒì›ì¸ ê²½ìš° Supabaseì—ë„ ì €ì¥
                        const { error } = await supabase
                            .from('career_calculations')
                            .upsert({
                                user_id: currentUser.id,
                                age: calculationResult.formData?.age,
                                age_group: getAgeGroup(calculationResult.formData?.age || 25),
                                health_status: calculationResult.formData?.health,
                                life_mode: calculationResult.formData?.lifeMode,
                                skill_portfolio_score: (calculationResult.formData?.portfolioCount || 0) * 5,
                                severance_pay: (calculationResult.formData?.severancePay || 0) * 10000,
                                debt: (calculationResult.formData?.debt || 0) * 10000,
                                national_pension: (calculationResult.formData?.nationalPension || 0) * 10000,
                                private_pension: (calculationResult.formData?.privatePension || 0) * 10000,
                                calculation_result: calculationResult,
                                updated_at: new Date().toISOString()
                            });
                        
                        if (error) {
                            console.error('ê³„ì‚° ê²°ê³¼ ì €ì¥ ì˜¤ë¥˜:', error);
                        }
                    }
                    
                    // ê³„ì‚° ì™„ë£Œ - ë³„ë„ ì•ˆë‚´ ì—†ì´ ì¡°ìš©íˆ ì™„ë£Œ
                    
                } catch (error) {
                    console.error('ê³„ì‚° ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                }
            };

            // ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì²´í¬ (ëª¨ë“  ì‚¬ìš©ìê°€ ëª©ë¡ ë³´ê¸° ê°€ëŠ¥, ìƒí˜¸ì‘ìš©ë§Œ ì œí•œ)
            const handleCommunityAccess = () => {
                console.log('ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì‹œë„:', { isAuthenticated, isGuest, currentUser });
                
                // ê²ŒìŠ¤íŠ¸, íšŒì› ëª¨ë‘ ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ ë³´ê¸° í—ˆìš©
                // ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë§Œ ë¡œê·¸ì¸ ìœ ë„
                if (!isAuthenticated && !isGuest) {
                    console.log('ë¡œê·¸ì¸ í¼ í‘œì‹œ');
                    setAuthMode('login');
                    setCurrentView('login');
                    setShowAuthForm(true);
                    return;
                }
                
                console.log('ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ë¡œ ì´ë™');
                setCurrentView('community');
            };
            
            // ê´€ë¦¬ì ê³„ì • ëª©ë¡ (ê°œë°œì/í…ŒìŠ¤íŠ¸ ê³„ì •)
            const isAdminUser = (user) => {
                if (!user || !user.email) return false;
                const adminEmails = [
                    'jwpaparoy@gmail.com',  // ê°œë°œì ê³„ì •
                    'knwwhr@gmail.com'      // ê´€ë¦¬ì ê³„ì •
                ];
                return adminEmails.includes(user.email.toLowerCase());
            };

            // ì‚¬ìš©ì íƒ€ì… í™•ì¸ í•¨ìˆ˜ (async) - ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ 
            const getUserType = async (user) => {
                if (!user) return 'guest';
                
                // ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì í™•ì¸
                if (user.isGuest) return 'guest';
                
                // ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œì„ ê°€ì§€ë¯€ë¡œ 'admin' ë°˜í™˜í•˜ì§€ë§Œ UIì—ì„œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥
                if (isAdminUser(user)) return 'admin';
                
                // 1ìˆœìœ„: user_profiles.role í™•ì¸ (getCurrentUserì—ì„œ ì´ë¯¸ ë¡œë“œë¨)
                if (user.role) {
                    console.log('ğŸ” User role from DB:', user.role);
                    if (user.role === 'expert') return 'expert';
                    if (user.role === 'admin') return 'admin';  
                    if (user.role === 'member') return 'member';
                }
                
                // 2ìˆœìœ„: experts í…Œì´ë¸”ì—ì„œ í™•ì¸ (ë°±ì—…ìš©)
                try {
                    const { data: expertProfile, error } = await supabase
                        .from('experts')
                        .select('id, verification_status')
                        .eq('email', user.email)
                        .single();
                    
                    if (expertProfile && expertProfile.verification_status === 'approved') {
                        return 'expert';
                    }
                } catch (error) {
                    // expert_profilesì— ì—†ìœ¼ë©´ ì¼ë°˜íšŒì›
                    console.log('Expert profile not found, user is regular member');
                }
                
                return 'member';
            };

            // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜ë“¤
            const hasAdminAccess = (user) => isAdminUser(user);
            const hasMemberAccess = (user) => user && (isAdminUser(user) || !isGuest);
            const hasExpertAccess = async (user) => {
                if (!user) return false;
                if (isAdminUser(user)) return true; // ê´€ë¦¬ìëŠ” ì „ë¬¸ê°€ ê¶Œí•œ í¬í•¨
                
                try {
                    const { data: expertProfile } = await supabase
                        .from('experts')
                        .select('verification_status')
                        .eq('email', user.email)
                        .single();
                    return expertProfile?.verification_status === 'approved';
                } catch {
                    return false;
                }
            };

            // ì‚¬ìš©ì íƒ€ì…ë³„ í‘œì‹œ ì´ë¦„
            const getUserTypeName = (userType) => {
                switch(userType) {
                    case 'admin': return 'ê´€ë¦¬ì';
                    case 'expert': return 'ì „ë¬¸ê°€';
                    case 'member': return 'ì¼ë°˜íšŒì›';
                    default: return 'ê²ŒìŠ¤íŠ¸';
                }
            };

            // ì»¤ë®¤ë‹ˆí‹° ìƒí˜¸ì‘ìš© ì²´í¬ (ìƒì„¸ë³´ê¸°/ê¸€ì“°ê¸°)
            const checkCalculationForInteraction = (action) => {
                // ê²ŒìŠ¤íŠ¸ì¸ ê²½ìš° íšŒì›ê°€ì… ìœ ë„
                if (isGuest) {
                    setShowCommunityAccessModal(true);
                    return false;
                }
                
                // ê´€ë¦¬ì ê³„ì •ì¸ ê²½ìš° ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ í—ˆìš©
                if (isAdminUser(currentUser)) {
                    console.log('ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ í—ˆìš©:', currentUser.email);
                    return true;
                }
                
                // ì¼ë°˜ íšŒì›ì¸ ê²½ìš° ê³„ì‚° ì™„ë£Œ ì²´í¬
                const hasCalculation = localStorage.getItem('planb_calculation_result');
                if (!hasCalculation) {
                    setShowCalculationRequiredModal(true);
                    return false;
                }
                return true;
            };

            // ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° í•¸ë“¤ëŸ¬ (í”„ë¡œê·¸ë ˆì‹œë¸Œ ì ‘ê·¼)
            const handlePostClick = (post) => {
                // ê³„ì‚° ì™„ë£Œ ì—¬ë¶€ ì²´í¬
                if (!checkCalculationForInteraction('view_post')) {
                    return; // ëª¨ë‹¬ì´ í‘œì‹œë¨
                }
                
                // ê³„ì‚° ì™„ë£Œëœ ì‚¬ìš©ìë§Œ ìƒì„¸ë³´ê¸° ê°€ëŠ¥
                setSelectedPost(post);
                setCurrentView('post-detail');
            };


            // ë¡œê·¸ì¸ í™”ë©´ (ê¸°ë³¸ í™”ë©´)
            if (currentView === 'login') {
                return <AuthComponent 
                    onAuthSuccess={handleAuthSuccess}
                    initialMode={authMode}
                    generateGuestUser={createGuestUser}
                />;
            }


            // ë§ˆì´í˜ì´ì§€
            if (currentView === 'mypage') {
                return <MyPageComponent 
                    currentUser={currentUser}
                    onClose={() => setCurrentView('main')}
                    getUserType={getUserType}
                    getUserTypeName={getUserTypeName}
                    isAdminUser={isAdminUser}
                    isGuest={isGuest}
                    setCurrentView={setCurrentView}
                    setFormData={setFormData}
                    setCalculatorResult={setCalculatorResult}
                    setCalculatorStep={setCalculatorStep}
                    showNotification={showNotification}
                />;
            }
            

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
                    <nav className="bg-white shadow-sm border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                {/* ë¡œê³  */}
                                <div 
                                    className="text-xl font-bold text-blue-600 cursor-pointer"
                                    onClick={() => setCurrentView('main')}
                                >
                                    ì¸ì‚¬ì´ë“œì¡
                                </div>

                                {/* í–„ë²„ê±° ë²„íŠ¼ */}
                                <button
                                    onClick={() => setShowMobileMenu(!showMobileMenu)}
                                    className="p-2 rounded-md text-gray-600 hover:text-blue-600 hover:bg-gray-100 transition-colors"
                                >
                                    <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        {showMobileMenu ? (
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        ) : (
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                        )}
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        {/* ì‚¬ì´ë“œë°” ë©”ë‰´ */}
                        {showMobileMenu && (
                            <>
                                {/* ì‚¬ì´ë“œë°” ë°°ê²½ ì˜¤ë²„ë ˆì´ */}
                                <div 
                                    className="fixed inset-0 bg-black bg-opacity-50 z-40"
                                    onClick={() => setShowMobileMenu(false)}
                                />
                                
                                {/* ì‚¬ì´ë“œë°” */}
                                <div className="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out">
                                    {/* ì‚¬ì´ë“œë°” í—¤ë” */}
                                    <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-blue-50">
                                        <div className="flex items-center space-x-2">
                                            <div className="text-xl font-bold text-blue-600">ì¸ì‚¬ì´ë“œì¡</div>
                                            <span className="text-xs text-gray-500">ë©”ë‰´</span>
                                        </div>
                                        <button
                                            onClick={() => setShowMobileMenu(false)}
                                            className="p-2 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    {/* ì‚¬ì´ë“œë°” ì»¨í…ì¸  */}
                                    <div className="flex flex-col h-full">
                                        {/* ì‚¬ìš©ì ì •ë³´ ì˜ì—­ì„ ìƒë‹¨ìœ¼ë¡œ ì´ë™ */}
                                        <div className="border-b border-gray-200 p-4 bg-gray-50">
                                            {isGuest ? (
                                                <>
                                                    <div className="px-3 py-2 text-amber-600 font-medium flex items-center text-sm">
                                                        <span className="mr-2 text-base">ğŸŒŸ</span>
                                                        <div className="flex-1 min-w-0">
                                                            <span className="truncate">{currentUser?.nickname}</span>
                                                            <div className="text-xs text-amber-500">(ê²ŒìŠ¤íŠ¸ ëª¨ë“œ - ê³„ì‚°ê¸° ì „ìš©)</div>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2 mt-2">
                                                        <button
                                                            onClick={() => {
                                                                setAuthMode('signup');
                                                                setCurrentView('login');
                                                                setShowAuthForm(true);
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">âœ¨</span>
                                                            íšŒì›ê°€ì…
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                handleLogout();
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-red-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">ğŸšª</span>
                                                            ë‚˜ê°€ê¸°
                                                        </button>
                                                    </div>
                                                </>
                                            ) : currentUser ? (
                                                <>
                                                    <div className="px-3 py-2 text-gray-700 font-medium flex items-center text-sm">
                                                        <span className="mr-2 text-base">
                                                            {isAdminUser(currentUser) ? 'ğŸ‘‘' : 'ğŸ‘¤'}
                                                        </span>
                                                        <div className="flex-1 min-w-0">
                                                            <div className="truncate">{currentUser?.nickname || currentUser?.email}</div>
                                                            {isAdminUser(currentUser) && (
                                                                <span className="text-red-500 text-xs bg-red-100 px-1 py-0.5 rounded mt-1 inline-block">ìŠˆí¼ê´€ë¦¬ì</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2 mt-2">
                                                        <button
                                                            onClick={() => {
                                                                setCurrentView('mypage');
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-blue-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">âš™ï¸</span>
                                                            ë§ˆì´í˜ì´ì§€
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                handleLogout();
                                                                setShowMobileMenu(false);
                                                            }}
                                                            className="flex-1 px-3 py-2 rounded-md text-gray-700 hover:bg-gray-200 hover:text-red-600 transition-colors flex items-center justify-center text-sm"
                                                        >
                                                            <span className="mr-2 text-base">ğŸšª</span>
                                                            ë¡œê·¸ì•„ì›ƒ
                                                        </button>
                                                    </div>
                                                </>
                                            ) : (
                                                <button
                                                    onClick={() => {
                                                        setAuthMode('login');
                                                        setCurrentView('login');
                                                        setShowAuthForm(true);
                                                        setShowMobileMenu(false);
                                                    }}
                                                    className="w-full px-3 py-2 rounded-md bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center justify-center text-sm"
                                                >
                                                    <span className="mr-2 text-base">ğŸ”‘</span>
                                                    ë¡œê·¸ì¸
                                                </button>
                                            )}
                                        </div>

                                        {/* ë©”ì¸ ë©”ë‰´ë“¤ */}
                                        <div className="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                                            {/* ê³„ì‚°ê¸°ëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê³µê°œ */}
                                            <button
                                                className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                    currentView === 'calculator' 
                                                        ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                        : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                }`}
                                                onClick={() => {
                                                    setCurrentView('calculator');
                                                    setShowMobileMenu(false);
                                                }}
                                            >
                                                <span className="mr-3 text-base">ğŸ§®</span>
                                                ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨
                                            </button>
                                            
                                            {/* ê²ŒìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í‘œì‹œ */}
                                            {!isGuest && (
                                                <>
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'community' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            handleCommunityAccess();
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ’¬</span>
                                                        ì»¤ë®¤ë‹ˆí‹°
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'experts' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            setCurrentView('experts');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ”</span>
                                                        í˜„ì§ì ì°¾ê¸°
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'announcements' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            setCurrentView('announcements');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ“¢</span>
                                                        ê³µì§€ì‚¬í•­
                                                    </button>
                                                    
                                                    <button
                                                        className={`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center text-sm ${
                                                            currentView === 'messages' 
                                                                ? 'bg-blue-100 text-blue-700 font-medium shadow-sm' 
                                                                : 'text-gray-700 hover:bg-gray-50 hover:text-blue-600'
                                                        }`}
                                                        onClick={() => {
                                                            // ìª½ì§€ëŠ” íšŒì›ë§Œ ê°€ëŠ¥ 
                                                            if (!checkCalculationForInteraction('message_access')) {
                                                                return;
                                                            }
                                                            setCurrentView('messages');
                                                            setShowMobileMenu(false);
                                                        }}
                                                    >
                                                        <span className="mr-3 text-base">ğŸ’Œ</span>
                                                        ìª½ì§€
                                                    </button>
                                                </>
                                            )}
                                            
                                            {/* ê²ŒìŠ¤íŠ¸ì—ê²Œë§Œ í‘œì‹œë˜ëŠ” ì•ˆë‚´ */}
                                            {isGuest && (
                                                <div className="px-3 py-4 border border-blue-200 rounded-lg bg-blue-50">
                                                    <div className="text-sm text-blue-600 mb-2 font-medium">ğŸŒŸ ê²ŒìŠ¤íŠ¸ ëª¨ë“œ</div>
                                                    <p className="text-xs text-blue-500 mb-3">í˜„ì¬ ê³„ì‚°ê¸°ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë” ë§ì€ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë ¤ë©´ íšŒì›ê°€ì…í•˜ì„¸ìš”!</p>
                                                    <div className="text-xs text-blue-400">
                                                        <div>â€¢ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬</div>
                                                        <div>â€¢ í˜„ì§ì ë©˜í† ë§</div>
                                                        <div>â€¢ ê°œì¸ ë°ì´í„° ì €ì¥</div>
                                                        <div>â€¢ ê³„ì‚° ê¸°ë¡ ê´€ë¦¬</div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </nav>
                    
                    {/* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {currentView === 'main' && (
                            <div className="text-center">
                                <div className="mb-8">
                                    <h1 className="text-4xl font-bold text-gray-800 mb-4">
                                        ì¸ì‚¬ì´ë“œì¡
                                    </h1>
                                    <p className="text-xl text-gray-600 mb-2">
                                        ì„±ê³µì ì¸ ì»¤ë¦¬ì–´ì˜ ì‹œì‘
                                    </p>
                                    
                                    {/* ì‚¬ìš©ì í™˜ì˜ ë©”ì‹œì§€ */}
                                    {currentUser && (
                                        <div className="text-lg text-blue-700 font-medium mb-6">
                                            ì•ˆë…•í•˜ì„¸ìš”, {currentUser.nickname || (currentUser.email ? currentUser.email.split('@')[0] : 'ì‚¬ìš©ì')}ë‹˜! ğŸ‘‹
                                            {isAdminUser(currentUser) && (
                                                <span className="ml-2 text-red-600 text-sm">
                                                    ğŸ‘‘ ìŠˆí¼ê´€ë¦¬ì
                                                </span>
                                            )}
                                        </div>
                                    )}
                                    
                                    {/* ë©”ì¸ í™”ë©´ ê³µì§€ì‚¬í•­ ë°°ë„ˆ */}
                                    <div 
                                        className="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-8 cursor-pointer hover:bg-blue-100 transition-colors max-w-2xl mx-auto"
                                        onClick={() => setCurrentView('announcements')}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-3">
                                                <div className="text-blue-600">
                                                    <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                                                    </svg>
                                                </div>
                                                <div className="flex-1">
                                                    <span className="text-sm font-medium text-blue-900">
                                                        ğŸ“¢ ìƒˆë¡œìš´ ì „ë¬¸ê°€ ë§¤ì¹­ ì„œë¹„ìŠ¤ ì˜¤í”ˆ! WebRTC ì˜ìƒí†µí™”ê¹Œì§€ ì§€ì› 
                                                    </span>
                                                </div>
                                            </div>
                                            <div className="text-blue-400">
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* ê¸°ëŠ¥ ì¹´ë“œë“¤ - í•µì‹¬ ì„œë¹„ìŠ¤ë§Œ í‘œì‹œ */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 max-w-4xl mx-auto">
                                    {/* 1. ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨ê¸° */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2" 
                                         onClick={() => setCurrentView('calculator')}>
                                        <div className="text-5xl mb-4">ğŸ¯</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            ì·¨ì—…ê²½ìŸë ¥ ì§„ë‹¨
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ë‚˜ì˜ í˜„ì¬ ì·¨ì—… ê²½ìŸë ¥ì„ ê°ê´€ì ìœ¼ë¡œ<br/>
                                            6ë‹¨ê³„ë¡œ ì •í™•íˆ ì§„ë‹¨í•´ë³´ì„¸ìš”
                                        </p>
                                        <div className="text-blue-600 font-semibold text-sm">
                                            â­ 10ë¶„ ì™„ë£Œ â€¢ ë¬´ë£Œ ì§„ë‹¨
                                        </div>
                                    </div>
                                    
                                    {/* 2. ì»¤ë®¤ë‹ˆí‹° */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2"
                                         onClick={handleCommunityAccess}>
                                        <div className="text-5xl mb-4">ğŸ’¬</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            ì»¤ë®¤ë‹ˆí‹°
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ê°™ì€ ê³ ë¯¼ì„ ê°€ì§„ ë¶„ë“¤ê³¼<br/>
                                            ê²½í—˜ê³¼ ì •ë³´ë¥¼ ê³µìœ í•˜ì„¸ìš”
                                        </p>
                                        <div className="text-purple-600 font-semibold text-sm">
                                            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ íšŒì› ì „ìš©
                                        </div>
                                    </div>
                                    
                                    {/* 3. í˜„ì§ì ë©˜í† ë§ */}
                                    <div className="card hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2"
                                         onClick={() => setCurrentView('experts')}>
                                        <div className="text-5xl mb-4">ğŸ‘¥</div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-3">
                                            í˜„ì§ì ì°¾ê¸°
                                        </h3>
                                        <p className="text-gray-600 mb-4 leading-relaxed">
                                            ğŸ’¼ ì‹¤ì œ ì·¨ì—… ì„±ê³µ í˜„ì§ì<br/>
                                            10ë¶„ ë‹¨ìœ„ ì‹¤ì‹œê°„ ë©˜í† ë§
                                        </p>
                                        <div className="text-left space-y-1 text-xs text-gray-600 mb-3">
                                            <div>ğŸ¢ ëŒ€ê¸°ì—…/ìŠ¤íƒ€íŠ¸ì—… í˜„ì§ì</div>
                                            <div>ğŸ“„ ì„œë¥˜/ë©´ì ‘ ì‹¤ì „ ì½”ì¹­</div>
                                            <div>ğŸ’¡ ì—…ê³„ ì¸ì‚¬ì´ë“œ ì •ë³´</div>
                                            <div>ğŸ¯ ë§ì¶¤í˜• ì·¨ì—… ì „ëµ</div>
                                        </div>
                                        <div className="text-orange-600 font-semibold text-sm">
                                            âš¡ ì¦‰ì‹œ ì˜ˆì•½ ê°€ëŠ¥
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        )}
                        
                        {currentView === 'calculator' && (
                            <CareerCompetitivenessCalculator 
                                savedCalculations={savedCalculations} 
                                onCalculationComplete={handleCalculationComplete} 
                                setCurrentView={setCurrentView} 
                                currentUser={currentUser} 
                                showNotification={showNotification} 
                                setAuthMode={setAuthMode} 
                                setShowSaveResultSignupModal={setShowSaveResultSignupModal} 
                            />
                        )}
                        
                        
                        {currentView === 'community' && (
                            <CommunityApp 
                                setCurrentView={setCurrentView} 
                                currentUser={currentUser} 
                                checkCalculationForInteraction={checkCalculationForInteraction} 
                                handlePostClick={handlePostClick} 
                                isAdminUser={isAdminUser} 
                            />
                        )}
                        
                        {currentView === 'post-detail' && selectedPost && (
                            <PostDetailPage 
                                post={selectedPost} 
                                setCurrentView={setCurrentView} 
                                currentUser={currentUser} 
                                checkCalculationForInteraction={checkCalculationForInteraction} 
                                isAdminUser={isAdminUser} 
                            />
                        )}
                        
                        {/* í˜„ì§ì ë©˜í† ë§ í˜ì´ì§€ - ê²ŒìŠ¤íŠ¸ ì ‘ê·¼ì œí•œ ì¶”ê°€ */}
                        {currentView === 'experts' && (
                            isGuest ? (
                                <div className="min-h-screen bg-gray-50 py-8">
                                    <div className="max-w-md mx-auto">
                                        <div className="bg-white rounded-2xl shadow-lg p-8">
                                            <div className="text-center">
                                                <div className="text-4xl mb-4">ğŸ”</div>
                                                <h3 className="text-lg font-bold text-gray-900 mb-3">
                                                    ê¶ê¸ˆí•˜ì‹œì£ ? <br/> ì·¨ì—…ê²½ìŸë ¥ì„ ë¨¼ì € ì§„ë‹¨í•´ë³´ì„¸ìš”
                                                </h3>
                                                <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                                    <strong>ìì‹ ì˜ ìƒí™©ì„ ì•Œì•„ì•¼ í˜„ì§ìì—ê²Œ ë” ë‚˜ì€ ë©˜í† ë§ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</strong><br/><br/>
                                                    3ë¶„ë§Œ ê³„ì‚°í•´ë³´ì‹œë©´ í˜„ì§ìë“¤ì„<br/>
                                                    ë§Œë‚˜ê³  ë©˜í† ë§ë°›ì„ ìˆ˜ ìˆì–´ìš”!
                                                </p>
                                                <div className="space-y-3">
                                                    <button
                                                        onClick={() => {
                                                            setCurrentView('calculator');
                                                        }}
                                                        className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                                    >
                                                        ğŸ§® ë°”ë¡œ ê³„ì‚°í•˜ëŸ¬ ê°€ê¸°
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setAuthMode('signup');
                                                            setCurrentView('login');
                                                            setShowAuthForm(true);
                                                        }}
                                                        className="w-full px-4 py-3 border border-blue-600 text-blue-600 rounded-lg font-medium hover:bg-blue-50 transition-colors text-sm"
                                                    >
                                                        âœ¨ íšŒì›ê°€ì…í•˜ê¸°
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="max-w-6xl mx-auto">
                                    <div className="card">
                                        <ExpertFinderComponent currentUser={currentUser} isAdminUser={isAdminUser} setShowSignupModal={setShowSignupModal} />
                                    </div>
                                </div>
                            )
                        )}

                        {/* ê³µì§€ì‚¬í•­ í˜ì´ì§€ - ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥ */}
                        {currentView === 'announcements' && (
                            <div className="max-w-6xl mx-auto">
                                <div className="card">
                                    <AnnouncementComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                                </div>
                            </div>
                        )}

                        {/* ìª½ì§€ ì‹œìŠ¤í…œ í˜ì´ì§€ - íšŒì›ë§Œ ì ‘ê·¼ ê°€ëŠ¥ */}
                        {currentView === 'messages' && (
                            <div className="max-w-6xl mx-auto">
                                <MessagesComponent currentUser={currentUser} isAdminUser={isAdminUser} />
                            </div>
                        )}
                    </main>
                    
                    {/* ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼ ì œí•œ ëª¨ë‹¬ */}
                    {showCommunityAccessModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowCommunityAccessModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ”’</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ëŠ” íšŒì›ë§Œ ê°€ëŠ¥í•´ìš” ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        ê²Œì‹œê¸€ì€ ë³´ì…¨ëŠ”ë° ì–´ë– ì„¸ìš”?<br/>
                                        <strong>ë” ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹œì£ ?</strong><br/><br/>
                                        íšŒì›ê°€ì…í•˜ì‹œë©´ ë‹¤ë¥¸ ë¶„ë“¤ê³¼<br/>
                                        ì†Œí†µí•˜ê³  ì •ë³´ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ìš”!
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowCommunityAccessModal(false);
                                                setAuthMode('signup');
                                                setCurrentView('login');
                                                setShowAuthForm(true);
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            ğŸ“ íšŒì›ê°€ì…í•˜ê³ <br/>
                                            ìƒì„¸ë‚´ìš© ë³´ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowCommunityAccessModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ê³„ì‚° í•„ìš” ì•ˆë‚´ ëª¨ë‹¬ */}
                    {showCalculationRequiredModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowCalculationRequiredModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ§®</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ê¶ê¸ˆí•˜ì‹œì£ ? <br/> ì·¨ì—…ê²½ìŸë ¥ì„ ë¨¼ì € ì§„ë‹¨í•´ë³´ì„¸ìš”
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>ë‚˜ì˜ ì·¨ì—…ê²½ìŸë ¥ì€ ì–¼ë§ˆë‚˜ ë ê¹Œìš”?</strong><br/><br/>
                                        3ë¶„ë§Œ ê³„ì‚°í•´ë³´ì‹œë©´ ë” ì¬ë¯¸ìˆê²Œ<br/>
                                        ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”!
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowCalculationRequiredModal(false);
                                                setCurrentView('calculator');
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            ğŸ§® ë°”ë¡œ ê³„ì‚°í•˜ëŸ¬ ê°€ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowCalculationRequiredModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* íšŒì›ê°€ì… ìœ ë„ ëª¨ë‹¬ (í˜„ì§ì ë©˜í† ë§ìš©) */}
                    {showSignupModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowSignupModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ‘¤</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        í˜„ì§ì ë©˜í† ë§ì„ ì´ìš©í•˜ì‹œë ¤ë©´<br/>íšŒì›ê°€ì…ì´ í•„ìš”í•´ìš” ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>1:1 ê°œì¸ ë§ì¶¤ í˜„ì§ì ë©˜í† ë§</strong>
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowSignupModal(false);
                                                setCurrentView('login');
                                                setAuthMode('signup');
                                            }}
                                            className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            âœ¨ ì§€ê¸ˆ íšŒì›ê°€ì…í•˜ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowSignupModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‹¤ìŒì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* ê³„ì‚° ê²°ê³¼ ì €ì¥ìš© íšŒì›ê°€ì… ëª¨ë‹¬ */}
                    {showSaveResultSignupModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowSaveResultSignupModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">ğŸ’¾</div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        ê³„ì‚° ê²°ê³¼ë¥¼ ì•ˆì „í•˜ê²Œ<br/>ì €ì¥í•˜ì‹œê² ì–´ìš”? ğŸ˜Š
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed">
                                        <strong>íšŒì›ê°€ì…í•˜ë©´ ê³„ì‚° ê²°ê³¼ê°€ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤!</strong><br/><br/>
                                        â€¢ ì–¸ì œë“  ë‹¤ì‹œ í™•ì¸ ê°€ëŠ¥<br/>
                                        â€¢ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¹„ìŠ·í•œ ë¶„ë“¤ê³¼ ì†Œí†µ<br/>
                                        â€¢ í˜„ì§ì ë©˜í† ë§ ì˜ˆì•½ ê°€ëŠ¥<br/>
                                    </p>
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowSaveResultSignupModal(false);
                                                setCurrentView('login');
                                                setAuthMode('signup');
                                            }}
                                            className="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transition-colors text-sm"
                                        >
                                            ğŸ’¾ íšŒì›ê°€ì…í•˜ê³  ì €ì¥í•˜ê¸°
                                        </button>
                                        <button
                                            onClick={() => setShowSaveResultSignupModal(false)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm"
                                        >
                                            ë‚˜ì¤‘ì— í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* í†µí•© ì•Œë¦¼ ëª¨ë‹¬ */}
                    {showNotificationModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4">
                            <div className="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl relative">
                                <button
                                    onClick={() => setShowNotificationModal(false)}
                                    className="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold"
                                >
                                    Ã—
                                </button>
                                <div className="text-center">
                                    <div className="text-4xl mb-4">
                                        {notificationContent.type === 'success' ? 'âœ…' : 
                                         notificationContent.type === 'error' ? 'âŒ' : 
                                         notificationContent.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                                    </div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-3">
                                        {notificationContent.title}
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-6 leading-relaxed whitespace-pre-line">
                                        {notificationContent.message}
                                    </p>
                                    <button
                                        onClick={() => setShowNotificationModal(false)}
                                        className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm"
                                    >
                                        í™•ì¸
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* í‘¸í„° */}
                    <footer className="bg-gray-800 text-white mt-16">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div className="text-center">
                                <h3 className="text-xl font-bold mb-4">ì¸ì‚¬ì´ë“œì¡</h3>
                                <p className="text-gray-300 mb-4">
                                    ì„±ê³µì ì¸ ì·¨ì—…ì„ ìœ„í•œ ë©˜í† ë§ í”Œë«í¼
                                </p>
                                <div className="text-gray-400 text-sm">
                                    Â© 2025 ì¸ì‚¬ì´ë“œì¡. All rights reserved.
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        // AuthManagerëŠ” ì´ë¯¸ ìœ„ì—ì„œ ì´ˆê¸°í™”ë˜ì—ˆìŒ
        
        // React ì•± ë Œë”ë§
        console.log('React ë° ReactDOM ë¡œë“œë¨:', { React, ReactDOM });
        console.log('Root element ì°¾ê¸°:', document.getElementById('root'));
        
        // React ì•± ë°”ë¡œ ë Œë”ë§
        try {
            console.log('ğŸš€ React ì•± ë Œë”ë§ ì‹œì‘...');
            const root = ReactDOM.createRoot(document.getElementById('root'));
            console.log('ğŸ¯ React Root ìƒì„± ì™„ë£Œ');
            root.render(React.createElement(InsideJobApp, null));
            console.log('âœ… React ì•± ë Œë”ë§ ì„±ê³µ');
        } catch (error) {
            console.error('âŒ React ì•± ë Œë”ë§ ì—ëŸ¬:', error);
            console.error('Error details:', {
                message: error.message,
                stack: error.stack,
                line: error.line,
                column: error.column
            });
            document.getElementById('root').innerHTML = `
                <div style="padding: 40px; text-align: center; font-family: -apple-system, sans-serif;">
                    <h1 style="color: #1f2937; margin-bottom: 20px;">ì¸ì‚¬ì´ë“œì¡</h1>
                    <p style="color: #dc2626; font-weight: bold; margin-bottom: 10px;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                    <p style="color: #374151; font-size: 14px; margin-bottom: 10px;">ì˜¤ë¥˜ ë‚´ìš©: ${error.message}</p>
                    <p style="color: #6b7280; font-size: 12px; margin-bottom: 20px;">ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš” (F12)</p>
                    <button onClick={() => location.reload()} style="margin-top: 20px; padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            `;
        }
    </script>
</body>
</html>